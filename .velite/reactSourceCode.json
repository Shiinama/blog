[
  {
    "slug": "/content/react-source-code/1.why-use-firber",
    "title": "1. React源码启蒙、梦开始的地方",
    "description": "探讨React的Fiber架构，解析其核心原理，揭示如何实现高效的任务调度，以及对React性能的提升。",
    "published": true,
    "date": "2022-11-20T00:00:00.000Z",
    "body": "const{Fragment:n,jsx:e,jsxs:i}=arguments[0];function _createMdxContent(r){const c={a:\"a\",code:\"code\",h2:\"h2\",h3:\"h3\",li:\"li\",ol:\"ol\",p:\"p\",span:\"span\",strong:\"strong\",ul:\"ul\",...r.components};return i(n,{children:[i(c.h2,{id:\"1-前因后果\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1-前因后果\",children:e(c.span,{className:\"icon icon-link\"})}),\"1. 前因后果\"]}),\"\\n\",e(c.p,{children:\"为什么React要使用Fiber？它解决了什么问题？它是怎么解决的？它是怎样的一个思路？以及为什么我们要先从Fiber入手去理解源码？这些是我们在理解Fiber路上需要关注的核心问题。\"}),\"\\n\",i(c.h2,{id:\"2-为什么使用fiber\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2-为什么使用fiber\",children:e(c.span,{className:\"icon icon-link\"})}),\"2. 为什么使用Fiber\"]}),\"\\n\",e(c.p,{children:\"它能解决以往react的卡顿问题。\"}),\"\\n\",i(c.h3,{id:\"21-解决的问题\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#21-解决的问题\",children:e(c.span,{className:\"icon icon-link\"})}),\"2.1 解决的问题\"]}),\"\\n\",e(c.p,{children:\"React 16之前，Virtual DOM的更新过程采用循环加递归实现。这种方式一旦开始就无法中断，导致大型应用中主线程长期被占用，影响用户交互和动画执行，造成页面卡顿。\"}),\"\\n\",e(c.p,{children:\"核心问题：递归无法中断，执行重任务耗时长。JavaScript又是单线程，无法同时执行其他任务，导致任务延迟、页面卡顿，用户体验差。\"}),\"\\n\",i(c.h3,{id:\"22-fiber的解决方案\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#22-fiber的解决方案\",children:e(c.span,{className:\"icon icon-link\"})}),\"2.2 Fiber的解决方案\"]}),\"\\n\",e(c.p,{children:\"Fiber本质上是一种新的调度算法，具有以下特点：\"}),\"\\n\",i(c.ul,{children:[\"\\n\",e(c.li,{children:\"可中断的渲染过程\"}),\"\\n\",e(c.li,{children:\"利用浏览器空闲时间执行任务\"}),\"\\n\",e(c.li,{children:\"放弃递归，采用循环方式\"}),\"\\n\",e(c.li,{children:\"更细粒度的任务划分\"}),\"\\n\"]}),\"\\n\",e(c.p,{children:\"Fiber通过Scheduler来利用浏览器空闲时间执行任务，解决长期占用主线程的问题。这意味着要放弃递归（因为它不可终止），保留循环（因为需要中断）。为了支持中断和恢复，任务被拆分为更小的单位。\"}),\"\\n\",i(c.h3,{id:\"23-为什么要从fiber入手理解源码\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#23-为什么要从fiber入手理解源码\",children:e(c.span,{className:\"icon icon-link\"})}),\"2.3 为什么要从Fiber入手理解源码\"]}),\"\\n\",e(c.p,{children:\"Fiber的构建过程以及最后的提交相当于源码的一条主线路。我们可以先理解这条主线，然后再拆解出支线去理解源码（例如Hooks、Suspense等）。\"}),\"\\n\",i(c.h2,{id:\"3-fiber的实现思路\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3-fiber的实现思路\",children:e(c.span,{className:\"icon icon-link\"})}),\"3. Fiber的实现思路\"]}),\"\\n\",e(c.p,{children:\"Fiber的工作过程可以分为两个主要阶段：\"}),\"\\n\",i(c.ol,{children:[\"\\n\",i(c.li,{children:[e(c.strong,{children:\"Render阶段\"}),\"（可中断）：构建Fiber树，进行diff算法比较。\"]}),\"\\n\",i(c.li,{children:[e(c.strong,{children:\"Commit阶段\"}),\"（不可中断）：将更新提交到DOM。\"]}),\"\\n\"]}),\"\\n\",i(c.h3,{id:\"31-初始渲染vs更新渲染\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#31-初始渲染vs更新渲染\",children:e(c.span,{className:\"icon icon-link\"})}),\"3.1 初始渲染vs更新渲染\"]}),\"\\n\",i(c.ul,{children:[\"\\n\",i(c.li,{children:[e(c.strong,{children:\"初始渲染\"}),\"：JSX → React.createElement（或react/jsx-runtime） → VDOM对象 → 构建Fiber对象 → 提交到真实DOM\"]}),\"\\n\",i(c.li,{children:[e(c.strong,{children:\"更新渲染\"}),\"：重新构建Fiber → 新旧Fiber对比 → 生成更新队列 → 提交到真实DOM\"]}),\"\\n\"]}),\"\\n\",i(c.h2,{id:\"4-实现fiber的关键步骤\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#4-实现fiber的关键步骤\",children:e(c.span,{className:\"icon icon-link\"})}),\"4. 实现Fiber的关键步骤\"]}),\"\\n\",i(c.ol,{children:[\"\\n\",e(c.li,{children:\"创建任务队列\"}),\"\\n\",e(c.li,{children:\"实现任务调度逻辑\"}),\"\\n\",e(c.li,{children:\"创建Fiber对象\"}),\"\\n\",e(c.li,{children:\"构建Effects数组\"}),\"\\n\",e(c.li,{children:\"实现初始化提交\"}),\"\\n\",e(c.li,{children:\"处理组件\"}),\"\\n\",e(c.li,{children:\"处理Fiber更新\"}),\"\\n\"]}),\"\\n\",i(c.h2,{id:\"5-react的启动模式\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#5-react的启动模式\",children:e(c.span,{className:\"icon icon-link\"})}),\"5. React的启动模式\"]}),\"\\n\",e(c.p,{children:\"React提供了三种启动模式：\"}),\"\\n\",i(c.ol,{children:[\"\\n\",i(c.li,{children:[e(c.strong,{children:\"Legacy模式\"}),\"：\",e(c.code,{children:\"ReactDOM.render(<App />, rootNode)\"})]}),\"\\n\",i(c.li,{children:[e(c.strong,{children:\"Blocking模式\"}),\"：\",e(c.code,{children:\"ReactDOM.createBlockingRoot(rootNode).render(<App />)\"})]}),\"\\n\",i(c.li,{children:[e(c.strong,{children:\"Concurrent模式\"}),\"：\",e(c.code,{children:\"ReactDOM.createRoot(rootNode).render(<App />)\"})]}),\"\\n\"]}),\"\\n\",e(c.p,{children:\"Concurrent模式（React 18默认）直接就是Fiber架构，去实现并发渲染、自动批处理等新特性。\"}),\"\\n\",i(c.h2,{id:\"6-总结\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#6-总结\",children:e(c.span,{className:\"icon icon-link\"})}),\"6. 总结\"]}),\"\\n\",i(c.p,{children:[e(c.code,{children:\"1.2节\"}),\"是一块的，\",e(c.code,{children:\"3,4\"}),\"节又是一块的。\"]})]})}return{default:function(n={}){const{wrapper:i}=n.components||{};return i?e(i,{...n,children:e(_createMdxContent,{...n})}):_createMdxContent(n)}};",
    "toc": {
      "content": [
        {
          "title": "1. 前因后果",
          "url": "#1-前因后果",
          "items": []
        },
        {
          "title": "2. 为什么使用Fiber",
          "url": "#2-为什么使用fiber",
          "items": [
            {
              "title": "2.1 解决的问题",
              "url": "#21-解决的问题",
              "items": []
            },
            {
              "title": "2.2 Fiber的解决方案",
              "url": "#22-fiber的解决方案",
              "items": []
            },
            {
              "title": "2.3 为什么要从Fiber入手理解源码",
              "url": "#23-为什么要从fiber入手理解源码",
              "items": []
            }
          ]
        },
        {
          "title": "3. Fiber的实现思路",
          "url": "#3-fiber的实现思路",
          "items": [
            {
              "title": "3.1 初始渲染vs更新渲染",
              "url": "#31-初始渲染vs更新渲染",
              "items": []
            }
          ]
        },
        {
          "title": "4. 实现Fiber的关键步骤",
          "url": "#4-实现fiber的关键步骤",
          "items": []
        },
        {
          "title": "5. React的启动模式",
          "url": "#5-react的启动模式",
          "items": []
        },
        {
          "title": "6. 总结",
          "url": "#6-总结",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "1.why-use-firber"
  },
  {
    "slug": "/content/react-source-code/10.react_task_queue",
    "title": "10.React Fiber架构：深入解析任务队列、可中断渲染、调度、同步模式",
    "description": "React Fiber架构：深入解析任务队列、可中断渲染、调度、同步模式",
    "published": true,
    "date": "2023-01-08T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:n,jsxs:e}=arguments[0];function _createMdxContent(r){const c={a:\"a\",code:\"code\",figure:\"figure\",h2:\"h2\",h3:\"h3\",h4:\"h4\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...r.components};return e(l,{children:[e(c.h2,{id:\"1-react-fiber架构深入解析任务队列可中断渲染调度同步模式\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1-react-fiber架构深入解析任务队列可中断渲染调度同步模式\",children:n(c.span,{className:\"icon icon-link\"})}),\"1. React Fiber架构：深入解析任务队列、可中断渲染、调度、同步模式\"]}),\"\\n\",e(c.p,{children:[\"在React Fiber架构中，任务队列是实现可中断渲染和优先级调度的核心组件。本文主要讲\",n(c.code,{children:\"React源码\"}),\"的\",n(c.code,{children:\"任务队列\"}),\"、\",n(c.code,{children:\"可中断渲染\"}),\"、\",n(c.code,{children:\"调度\"}),\"、\",n(c.code,{children:\"同步模式\"}),\"。\"]}),\"\\n\",e(c.p,{children:[\"理解了这一整节，几乎就把 \",n(c.code,{children:\"react\"}),\" 中最重要的东西和主线理解了，其余都是散散碎碎的小细节。\"]}),\"\\n\",e(c.h2,{id:\"2-任务队列的概念和作用\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2-任务队列的概念和作用\",children:n(c.span,{className:\"icon icon-link\"})}),\"2. 任务队列的概念和作用\"]}),\"\\n\",n(c.p,{children:\"在深入源码之前，我们需要先理解任务队列在React Fiber架构中的重要性。\"}),\"\\n\",e(c.h3,{id:\"21-什么是任务队列\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#21-什么是任务队列\",children:n(c.span,{className:\"icon icon-link\"})}),\"2.1 什么是任务队列？\"]}),\"\\n\",n(c.p,{children:\"任务队列是一种数据结构，用于存储和管理需要执行的任务。在React Fiber中，任务队列主要用于管理更新和渲染过程中的各种操作，如组件更新、DOM操作等。\"}),\"\\n\",e(c.h3,{id:\"22-任务队列的作用\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#22-任务队列的作用\",children:n(c.span,{className:\"icon icon-link\"})}),\"2.2 任务队列的作用\"]}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[n(c.strong,{children:\"任务调度\"}),\"：根据优先级对任务进行排序和调度。\"]}),\"\\n\",e(c.li,{children:[n(c.strong,{children:\"中断与恢复\"}),\"：支持任务的中断和恢复，实现可中断渲染。\"]}),\"\\n\",e(c.li,{children:[n(c.strong,{children:\"优先级管理\"}),\"：为不同类型的更新分配不同的优先级。\"]}),\"\\n\",e(c.li,{children:[n(c.strong,{children:\"性能优化\"}),\"：通过合理调度任务，提高渲染性能和用户体验。\"]}),\"\\n\"]}),\"\\n\",e(c.h2,{id:\"3-react源码中的任务队列实现\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3-react源码中的任务队列实现\",children:n(c.span,{className:\"icon icon-link\"})}),\"3. React源码中的任务队列实现\"]}),\"\\n\",n(c.p,{children:\"首先我们看任务队列是如何实现的。\"}),\"\\n\",e(c.h3,{id:\"31-数据结构\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#31-数据结构\",children:n(c.span,{className:\"icon icon-link\"})}),\"3.1 数据结构\"]}),\"\\n\",n(c.p,{children:\"React使用小顶堆（Min Heap）来实现任务队列。小顶堆是一种特殊的二叉树，其中每个节点的值都小于或等于其子节点的值。这种结构非常适合优先级队列的实现，因为它可以在O(log n)的时间复杂度内完成插入和删除操作。\"}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/scheduler/src/Scheduler.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = []\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" timerQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = []\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// ... 其他代码\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" push\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"length\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"push\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  siftUp\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" peek\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"length\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" :\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"]\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" pop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"length\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" first\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"]\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" last\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"pop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"last\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"first\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"last\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    siftDown\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"last\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" first\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:[\"在这段代码中，我们可以看到任务队列（\",n(c.code,{children:\"taskQueue\"}),\"）和定时器队列（\",n(c.code,{children:\"timerQueue\"}),\"）的定义，以及用于操作堆的基本函数：\",n(c.code,{children:\"push\"}),\"、\",n(c.code,{children:\"peek\"}),\"和\",n(c.code,{children:\"pop\"}),\"。\"]}),\"\\n\",e(c.h3,{id:\"32-任务的表示\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#32-任务的表示\",children:n(c.span,{className:\"icon icon-link\"})}),\"3.2 任务的表示\"]}),\"\\n\",n(c.p,{children:\"在React中，每个任务都被表示为一个对象，包含以下主要属性：\"}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/scheduler/src/Scheduler.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  id\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskIdCounter\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"++,\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  priorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  sortIndex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": -\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.ul,{children:[\"\\n\",e(c.li,{children:[n(c.code,{children:\"id\"}),\"：任务的唯一标识符。\"]}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"callback\"}),\"：任务的回调函数。\"]}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"priorityLevel\"}),\"：任务的优先级。\"]}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"startTime\"}),\"：任务的开始时间。\"]}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"expirationTime\"}),\"：任务的过期时间。\"]}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"sortIndex\"}),\"：用于在队列中排序的索引。\"]}),\"\\n\"]}),\"\\n\",e(c.h3,{id:\"33-优先级的定义\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#33-优先级的定义\",children:n(c.span,{className:\"icon icon-link\"})}),\"3.3 优先级的定义\"]}),\"\\n\",n(c.p,{children:\"React定义了多个优先级级别，用于区分不同类型的任务：\"}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/scheduler/src/SchedulerPriorities.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" NoPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" ImmediatePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" UserBlockingPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"2\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" NormalPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"3\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" LowPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"4\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" IdlePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"5\"})]})]})})}),\"\\n\",n(c.p,{children:\"这些优先级从高到低排列，用于决定任务的执行顺序。\"}),\"\\n\",e(c.h2,{id:\"4-任务队列的创建过程\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#4-任务队列的创建过程\",children:n(c.span,{className:\"icon icon-link\"})}),\"4. 任务队列的创建过程\"]}),\"\\n\",n(c.p,{children:\"任务队列的创建是React Fiber架构的基础。\"}),\"\\n\",e(c.h3,{id:\"41-初始化\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#41-初始化\",children:n(c.span,{className:\"icon icon-link\"})}),\"4.1 初始化\"]}),\"\\n\",e(c.p,{children:[\"任务队列在React初始化时就会被创建。在\",n(c.code,{children:\"Scheduler.js\"}),\"文件中，我们可以看到队列的初始化：\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = []\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" timerQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = []\"})]})]})})}),\"\\n\",n(c.p,{children:\"这里创建了两个队列：\"}),\"\\n\",e(c.ul,{children:[\"\\n\",e(c.li,{children:[n(c.code,{children:\"taskQueue\"}),\"用于存储准备执行的任务\"]}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"timerQueue\"}),\"用于存储延迟执行的任务\"]}),\"\\n\"]}),\"\\n\",e(c.h3,{id:\"42-添加任务\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#42-添加任务\",children:n(c.span,{className:\"icon icon-link\"})}),\"4.2 添加任务\"]}),\"\\n\",e(c.p,{children:[\"当需要添加新任务时，React会调用\",n(c.code,{children:\"unstable_scheduleCallback\"}),\"函数：\"]}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/scheduler/src/Scheduler.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" unstable_scheduleCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"priorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"options\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" startTime\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" options\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'object'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"options\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" delay\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"options\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"delay\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" delay\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'number'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"delay\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"delay\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" timeout\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  switch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"priorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" ImmediatePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"IMMEDIATE_PRIORITY_TIMEOUT\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" UserBlockingPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"USER_BLOCKING_PRIORITY_TIMEOUT\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" IdlePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"IDLE_PRIORITY_TIMEOUT\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" LowPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"LOW_PRIORITY_TIMEOUT\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" NormalPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    default\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NORMAL_PRIORITY_TIMEOUT\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timeout\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    id\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskIdCounter\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"++,\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    priorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    sortIndex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": -\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // This is a delayed task.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    newTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sortIndex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"startTime\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    push\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timerQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"peek\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"peek\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timerQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // All tasks are delayed, and this is the task with the earliest delay.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isHostTimeoutScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // Cancel an existing timeout.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        cancelHostTimeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        isHostTimeoutScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // Schedule a timeout.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      requestHostTimeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"handleTimeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" - \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    newTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sortIndex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expirationTime\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    push\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // Schedule a host callback, if needed. If we're already performing work,\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // wait until the next time we yield.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isHostCallbackScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && !\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isPerformingWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      isHostCallbackScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      requestHostCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flushWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newTask\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"这个函数完成了以下几个关键步骤：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:\"计算任务的开始时间和过期时间。\"}),\"\\n\",n(c.li,{children:\"根据优先级设置超时时间。\"}),\"\\n\",n(c.li,{children:\"创建新的任务对象。\"}),\"\\n\",e(c.li,{children:[\"将任务添加到适当的队列（\",n(c.code,{children:\"taskQueue\"}),\"或\",n(c.code,{children:\"timerQueue\"}),\"）。\"]}),\"\\n\",n(c.li,{children:\"如果需要，调度主机回调或超时。\"}),\"\\n\"]}),\"\\n\",e(c.h3,{id:\"43-任务排序\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#43-任务排序\",children:n(c.span,{className:\"icon icon-link\"})}),\"4.3 任务排序\"]}),\"\\n\",e(c.p,{children:[\"任务在添加到队列时会进行排序。排序的关键在于\",n(c.code,{children:\"sortIndex\"}),\"属性：\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",e(c.li,{children:[\"对于延迟任务（\",n(c.code,{children:\"timerQueue\"}),\"），\",n(c.code,{children:\"sortIndex\"}),\"是任务的开始时间。\"]}),\"\\n\",e(c.li,{children:[\"对于立即执行的任务（\",n(c.code,{children:\"taskQueue\"}),\"），\",n(c.code,{children:\"sortIndex\"}),\"是任务的过期时间。\"]}),\"\\n\"]}),\"\\n\",e(c.p,{children:[\"排序过程通过\",n(c.code,{children:\"push\"}),\"函数实现，该函数内部调用\",n(c.code,{children:\"siftUp\"}),\"来维护小顶堆的性质：\"]}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/scheduler/src/Scheduler.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" push\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"length\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"push\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  siftUp\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" siftUp\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"i\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"i\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" parentIndex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" - \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") >>> \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" parent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"parentIndex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"]\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"parent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"compare\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"parent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") > \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // The parent is larger. Swap positions.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"parentIndex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      heap\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"parent\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"parentIndex\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // The parent is smaller. Exit.\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"这个过程确保了队列中的任务始终按照正确的顺序排列，使得优先级最高的任务总是位于队列的顶部。\"}),\"\\n\",e(c.h2,{id:\"5-任务队列的调度过程\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#5-任务队列的调度过程\",children:n(c.span,{className:\"icon icon-link\"})}),\"5. 任务队列的调度过程\"]}),\"\\n\",n(c.p,{children:\"创建任务队列后，React需要有效地调度这些任务。\"}),\"\\n\",e(c.h3,{id:\"51-调度器的初始化\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#51-调度器的初始化\",children:n(c.span,{className:\"icon icon-link\"})}),\"5.1 调度器的初始化\"]}),\"\\n\",n(c.p,{children:\"React使用调度系统来管理任务的执行。这个系统的核心是Scheduler.js中的几个关键函数和机制。\"}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:\"调度器初始化:\"}),\"\\n\"]}),\"\\n\",e(c.p,{children:[\"当我们调用\",n(c.code,{children:\"requestHostCallback\"}),\"时,它会设置\",n(c.code,{children:\"scheduledHostCallback\"}),\"并通过\",n(c.code,{children:\"MessageChannel\"}),\"发送一个消息:\"]}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/scheduler/src/Scheduler.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 创建一个MessageChannel用于任务调度\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" channel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"new\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" MessageChannel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" port\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"channel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"port2\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 请求主机回调函数\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" requestHostCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 设置调度回调函数\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  scheduledHostCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callback\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isMessageLoopRunning\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    isMessageLoopRunning\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 通过MessageChannel发送消息,触发任务执行\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    port\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 消息事件处理函数\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"channel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"port1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"onmessage\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"performWorkUntilDeadline\"})]})]})})}),\"\\n\",n(c.p,{children:\"这段代码的工作原理如下:\"}),\"\\n\",e(c.ul,{children:[\"\\n\",e(c.li,{children:[\"创建一个\",n(c.code,{children:\"MessageChannel\"}),\"用于在主线程和调度器之间通信。\"]}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"requestHostCallback\"}),\"函数用于设置要执行的回调函数。\"]}),\"\\n\",n(c.li,{children:\"当设置了新的回调函数时,如果消息循环还没有运行,就发送一个消息来启动它。\"}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"channel.port1.onmessage\"}),\"设置为\",n(c.code,{children:\"performWorkUntilDeadline\"}),\"函数,这个函数将在收到消息时被调用。\"]}),\"\\n\"]}),\"\\n\",e(c.ol,{start:\"2\",children:[\"\\n\",n(c.li,{children:\"执行调度任务:\"}),\"\\n\"]}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"performWorkUntilDeadline\"}),\"函数是调度器的核心,它负责执行任务并管理时间:\"]}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/scheduler/src/Scheduler.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" scheduledHostCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" isMessageLoopRunning\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"false\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = -\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" performWorkUntilDeadline\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"scheduledHostCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 获取当前时间\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 计算截止时间\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    deadline\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"yieldInterval\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 标记开始时间\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" hasTimeRemaining\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    try\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 执行调度的回调函数\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" hasMoreWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"scheduledHostCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"hasTimeRemaining\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"hasMoreWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 如果没有更多工作,停止消息循环\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        isMessageLoopRunning\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"false\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        scheduledHostCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 如果还有更多工作,继续发送消息\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        port\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"error\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 如果发生错误,继续发送消息并抛出错误\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      port\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      throw\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" error\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    isMessageLoopRunning\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"false\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 重置开始时间\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = -\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"这个函数的工作流程如下:\"}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"检查是否有调度的回调函数。\"}),\"\\n\",n(c.li,{children:\"如果有,执行这个回调函数,并传入时间信息。\"}),\"\\n\",n(c.li,{children:\"根据回调函数的返回值决定是否继续循环。\"}),\"\\n\",n(c.li,{children:\"如果发生错误,确保继续发送消息以保持循环,然后抛出错误。\"}),\"\\n\",n(c.li,{children:\"如果没有回调函数,停止消息循环。\"}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"通过这种机制,React能够在主线程空闲时执行任务,并在需要时让出控制权,保证了页面的响应。\"}),\"\\n\",e(c.h3,{id:\"52-任务执行\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#52-任务执行\",children:n(c.span,{className:\"icon icon-link\"})}),\"5.2 任务执行\"]}),\"\\n\",e(c.p,{children:[\"任务的实际执行是在\",n(c.code,{children:\"workLoop\"}),\"函数中完成的。这个函数是React调度器的核心,负责循环执行队列中的任务。\"]}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/scheduler/src/Scheduler.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" workLoop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"hasTimeRemaining\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"initialTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"initialTime\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 更新定时器队列中的任务\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  advanceTimers\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 获取任务队列中的第一个任务\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"peek\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && !(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"enableSchedulerDebugging\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isSchedulerPaused\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 检查任务是否过期,或者是否需要让出执行权\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && (!\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"hasTimeRemaining\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"shouldYieldToHost\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"())) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 当前任务还没过期,但已经到达时间限制,需要中断执行\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callback\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'function'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 重置任务的回调,防止重复执行\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 设置当前优先级\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      currentPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"priorityLevel\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 检查任务是否已超时\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" didUserCallbackTimeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <= \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 执行任务回调\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" continuationCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"didUserCallbackTimeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 更新当前时间\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" continuationCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'function'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 如果回调返回一个函数,说明任务需要继续执行\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"continuationCallback\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 任务完成,将其从队列中移除\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"peek\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"          pop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 再次更新定时器队列\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      advanceTimers\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 如果回调不是函数,直接将任务从队列中移除\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      pop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 获取下一个任务\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"peek\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 检查是否还有更多工作要做\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" true\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 如果任务队列为空,检查定时器队列\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" firstTimer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"peek\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timerQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstTimer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 如果有延迟任务,安排一个新的超时回调\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      requestHostTimeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"handleTimeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstTimer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" - \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" false\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"这个函数的工作流程如下:\"}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[\"\\n\",n(c.p,{children:\"首先更新定时器队列,将到期的定时器任务移到主任务队列中。\"}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",n(c.p,{children:\"然后开始一个循环,不断从任务队列中取出任务执行:\"}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"检查任务是否过期或是否需要让出执行权。\"}),\"\\n\",n(c.li,{children:\"如果任务还没过期但已达到时间限制,就中断执行。\"}),\"\\n\",n(c.li,{children:\"执行任务的回调函数。\"}),\"\\n\",n(c.li,{children:\"如果回调返回一个新的函数,说明任务需要继续执行,就将这个新函数设置为任务的回调。\"}),\"\\n\",n(c.li,{children:\"如果任务执行完毕,就将其从队列中移除。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",n(c.p,{children:\"每执行完一个任务,都会再次更新定时器队列,确保及时处理到期的定时器任务。\"}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",n(c.p,{children:\"循环结束后,如果任务队列中还有任务,就返回true,表示还有工作要做。\"}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",n(c.p,{children:\"如果任务队列为空,但定时器队列中有任务,就安排一个新的超时回调,以便在定时器到期时继续执行。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.h3,{id:\"53-任务中断与恢复\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#53-任务中断与恢复\",children:n(c.span,{className:\"icon icon-link\"})}),\"5.3 任务中断与恢复\"]}),\"\\n\",e(c.p,{children:[\"React Fiber的一个核心特性是可中断渲染，这允许React在长时间运行的任务中途暂停，将控制权交还给浏览器，从而保持UI的响应。这个机制主要通过任务调度和时间切片来实现，其中\",n(c.code,{children:\"shouldYieldToHost\"}),\"函数扮演了关键角色。\"]}),\"\\n\",e(c.h4,{id:\"531-shouldyieldtohost-函数\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#531-shouldyieldtohost-函数\",children:n(c.span,{className:\"icon icon-link\"})}),\"5.3.1 shouldYieldToHost 函数\"]}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"shouldYieldToHost\"}),\"函数决定是否应该中断当前任务，将控制权交还给浏览器：\"]}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/scheduler/src/Scheduler.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" shouldYieldToHost\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 计算从任务开始到现在经过的时间\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" timeElapsed\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() - \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"startTime\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 如果经过的时间小于一帧的时间，继续执行任务\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timeElapsed\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"frameInterval\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 主线程被阻塞的时间很短，小于一帧的时间。\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 此时不需要让出控制权，继续执行当前任务。\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" false\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 检查是否启用了isInputPending API\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"enableIsInputPending\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 检查是否有待处理的绘制任务\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"needsPaint\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 有待处理的绘制任务，立即让出控制权\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" true\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 检查是否有待处理的离散输入事件（如点击）\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timeElapsed\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"continuousInputInterval\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 如果阻塞时间不长，只在有待处理的离散输入时让出控制权\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" isInputPending\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 检查是否有任何类型的待处理输入事件\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timeElapsed\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"maxInterval\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 已经阻塞了一段时间，但仍在可接受范围内\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 只在有待处理的输入（离散或连续）时让出控制权\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" isInputPending\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"continuousOptions\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 已经阻塞了很长时间，无条件让出控制权\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" true\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 如果isInputPending API不可用，总是让出控制权\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" true\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"这个函数有这几个因素来决定是否中断任务：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:\"任务执行时间\"}),\"\\n\",n(c.li,{children:\"是否有待处理的绘制任务\"}),\"\\n\",n(c.li,{children:\"是否有待处理的用户输入（区分离散输入和连续输入）\"}),\"\\n\",e(c.li,{children:[\"浏览器是否支持\",n(c.code,{children:\"isInputPending\"}),\" API\"]}),\"\\n\"]}),\"\\n\",e(c.h4,{id:\"532-任务中断和恢复的实现\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#532-任务中断和恢复的实现\",children:n(c.span,{className:\"icon icon-link\"})}),\"5.3.2 任务中断和恢复的实现\"]}),\"\\n\",n(c.p,{children:\"任务的中断和恢复主要在React的工作循环中实现：\"}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/react-reconciler/src/ReactFiberWorkLoop.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" workLoopConcurrent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && !\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"shouldYield\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    performUnitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:[\"在这个并发模式的工作循环中，React 会不断检查 \",n(c.code,{children:\"shouldYield()\"}),\" 函数（内部会调用 \",n(c.code,{children:\"shouldYieldToHost()\"}),\"）。如果需要让出控制权，React 会中断当前的渲染过程。\"]}),\"\\n\",n(c.p,{children:\"任务的恢复由React的调度器负责：\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" performConcurrentWorkOnRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"didTimeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // ...\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  do\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    try\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"didTimeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        renderRootSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        renderRootConcurrent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"thrownValue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      handleError\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"thrownValue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // ...\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"originalCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 如果当前执行的任务节点与调度的节点相同，\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 返回一个继续执行的回调函数\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" performConcurrentWorkOnRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"bind\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:[\"如果任务被中断，\",n(c.code,{children:\"performConcurrentWorkOnRoot\"}),\" 函数会返回一个继续执行的回调，允许调度器在之后恢复这个任务。\"]}),\"\\n\",e(c.h4,{id:\"533-优先级管理和任务切换\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#533-优先级管理和任务切换\",children:n(c.span,{className:\"icon icon-link\"})}),\"5.3.3 优先级管理和任务切换\"]}),\"\\n\",n(c.p,{children:\"React 还通过优先级管理来决定任务的执行顺序：\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" ensureRootIsScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // ...\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getHighestPriorityLane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" existingCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"existingCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 优先级没有变化，可以复用现有任务\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"existingCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" != \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 取消现有的回调，准备调度新的回调\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    cancelCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"existingCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 调度新的回调\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"SyncLane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 同步优先级使用特殊的内部队列\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"scheduleSyncCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      performSyncWorkOnRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"bind\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    );\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" schedulerPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"lanePriorityToSchedulerPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#4BF3C8\"},children:\"      newCallbackPriority\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    );\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"scheduleCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      schedulerPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      performConcurrentWorkOnRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"bind\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"这个函数确保根节点被正确调度，它会根据任务的优先级来决定是否中断当前任务并调度新的高优先级任务。\"}),\"\\n\",n(c.p,{children:\"通过这种复杂的任务中断、恢复和优先级管理机制，React能够在执行长时间任务时保持对用户输入的响应，提供流畅的用户体验。\"}),\"\\n\",e(c.p,{children:[\"在实际应用中，我们可以利用这一机制来优化性能，例如将大型计算任务拆分成小块，使用\",n(c.code,{children:\"React.useCallback\"}),\"和\",n(c.code,{children:\"React.useMemo\"}),\"来缓存计算结果，或者使用\",n(c.code,{children:\"React.lazy\"}),\"和\",n(c.code,{children:\"Suspense\"}),\"来延迟加载不急需的组件。\"]}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:\"React.useCallback 和 React.useMemo\"}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"这两个hooks都是用于性能优化，通过缓存计算结果来避免不必要的重新计算，从而减少渲染时间，他们的本质其实是让出更多时间给高优先级任务。\"}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/react-reconciler/src/ReactFiberHooks.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" updateMemo\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  nextCreate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" T\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  deps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | null,\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" hook\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"updateWorkInProgressHook\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" nextDeps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"deps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" :\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" deps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" prevState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"hook\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"prevState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" prevDeps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"> | null = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"prevState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"areHookInputsEqual\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"prevDeps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" prevState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" nextValue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"nextCreate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  hook\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = [\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextValue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" nextValue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:[\"这是\",n(c.code,{children:\"useMemo\"}),\"的实现。它会检查依赖是否变化，如果没有变化，直接返回缓存的值，避免重新计算。这样可以减少不必要的计算，为其他高优先级任务留出更多时间。\"]}),\"\\n\",e(c.ol,{start:\"2\",children:[\"\\n\",n(c.li,{children:\"React.lazy 和 Suspense\"}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"这两个API允许我们延迟加载组件，减少初始加载时间，并在加载过程中显示fallback内容。\"}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/react/src/ReactLazy.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" lazy\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  ctor\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" Thenable\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"default\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", ...}>,\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"LazyComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Payload\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">> {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" payload\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Payload\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"> = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    _status\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Uninitialized\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    _result\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"ctor\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" lazyType\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"LazyComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Payload\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">> = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    $$typeof\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"REACT_LAZY_TYPE\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    _payload\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"payload\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    _init\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lazyInitializer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" lazyType\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:[\"这是\",n(c.code,{children:\"React.lazy\"}),\"的实现。它创建一个特殊的组件类型，这个组件在渲染时会触发异步加载。\"]}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/react-reconciler/src/ReactFiberThrow.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" throwException\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  sourceFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  value\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  rootRenderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // ...\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" value\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'object'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" value\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"then\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'function'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // This is a wakeable.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" wakeable\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Wakeable\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"value\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // ...\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // Schedule the nearest Suspense to re-render the timed out view.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" suspenseBoundary\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getNearestSuspenseBoundaryToCapture\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"suspenseBoundary\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      suspenseBoundary\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" &=\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" ~\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"ForceClientRender\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      markSuspenseBoundaryShouldCapture\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        suspenseBoundary\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        sourceFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        rootRenderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // We only attach ping listeners in concurrent mode.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"suspenseBoundary\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"mode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"ConcurrentMode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        attachPingListener\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"wakeable\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"rootRenderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // ...\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // ...\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"当遇到一个Promise时，React会寻找最近的Suspense边界，并让它重新渲染。这允许React在异步内容加载时显示fallback内容，而不会阻塞整个应用的渲染。\"}),\"\\n\",n(c.p,{children:\"就是说\"}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.code,{children:\"useCallback\"}),\"和\",n(c.code,{children:\"useMemo\"}),\"通过减少不必要的计算和渲染，为其他可能被中断的高优先级任务留出更多时间。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.code,{children:\"React.lazy\"}),\"和\",n(c.code,{children:\"Suspense\"}),\"允许React在遇到尚未加载的组件时暂停渲染，显示fallback内容，然后在组件加载完成后恢复渲染。这整个过程都是可中断的，允许React在必要时处理更高优先级的任务。\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"例如，考虑以下场景：\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"jsx\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"jsx\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" HeavyComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"React\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"lazy\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'./HeavyComponent'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"))\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"showHeavy\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"setShowHeavy\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" heavyCalculation\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"useMemo\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" computeExpensiveValue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"a\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"b\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"), [\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"a\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"b\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"])\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"button\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onClick\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" setShowHeavy\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Load Heavy Component</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"button\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"p\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"heavyCalculation\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"p\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Suspense\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" fallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Loading...</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"showHeavy\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"HeavyComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Suspense\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"在这个例子中：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.code,{children:\"useMemo\"}),\"确保\",n(c.code,{children:\"heavyCalculation\"}),\"只在\",n(c.code,{children:\"a\"}),\"或\",n(c.code,{children:\"b\"}),\"改变时重新计算，避免在每次渲染时都进行昂贵的计算。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.code,{children:\"React.lazy\"}),\"和\",n(c.code,{children:\"Suspense\"}),\"允许\",n(c.code,{children:\"HeavyComponent\"}),\"延迟加载。当用户点击按钮时，React会开始加载组件，但不会阻塞UI，而是显示fallback内容。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",n(c.p,{children:\"整个过程中，如果有更高优先级的任务（如用户输入），React可以中断当前任务，处理高优先级任务，然后再恢复之前的渲染。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"这其实就是这些API如何与React的任务中断、恢复和优先级管理机制协同工作，也是我们真正在开发的时候会遇到的场景。\"}),\"\\n\",e(c.h3,{id:\"54-优先级管理和饥饿问题的解决\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#54-优先级管理和饥饿问题的解决\",children:n(c.span,{className:\"icon icon-link\"})}),\"5.4 优先级管理和饥饿问题的解决\"]}),\"\\n\",n(c.p,{children:\"React的调度系统不仅要处理任务的执行，还需要解决由于持续的高优先级任务导致的低优先级任务饥饿问题（一直不执行）。\"}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:n(c.strong,{children:\"标记饥饿车道\"})}),\"\\n\"]}),\"\\n\",e(c.p,{children:[\"在每次调度更新时，React都会调用\",n(c.code,{children:\"ensureRootIsScheduled\"}),\"函数，该函数会调用\",n(c.code,{children:\"markStarvedLanesAsExpired\"}),'来检查是否有被其他工作\"饿死\"的车道。']}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/react-reconciler/src/ReactFiberWorkLoop.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" ensureRootIsScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" existingCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 检查是否有任何车道被其他工作饿死。如果有，将它们标记为过期。\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  markStarvedLanesAsExpired\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // ... [rest of the function]\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.ol,{start:\"2\",children:[\"\\n\",n(c.li,{children:n(c.strong,{children:\"计算过期时间\"})}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"对于每个待处理的车道，React会计算一个过期时间。这个过期时间根据车道的优先级而不同。\"}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/react-reconciler/src/ReactFiberLane.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" computeExpirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"lane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Lane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  switch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" SyncLane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" InputContinuousLane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"250\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" DefaultLane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" TransitionLane1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" TransitionLane16\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"5000\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // ... [other cases]\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.ol,{start:\"3\",children:[\"\\n\",n(c.li,{children:n(c.strong,{children:\"标记过期车道\"})}),\"\\n\"]}),\"\\n\",e(c.p,{children:[\"在后续的调度更新中，React会检查每个车道是否已经过期。如果过期，会在\",n(c.code,{children:\"root.expiredLanes\"}),\"上标记该车道。\"]}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/react-reconciler/src/ReactFiberLane.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" markStarvedLanesAsExpired\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" pendingLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" expirationTimes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expirationTimes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"pickArbitraryLaneIndex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" lane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" << \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expirationTimes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoTimestamp\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      expirationTimes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"computeExpirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <= \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expiredLanes\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" |=\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" lane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    lanes\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" &=\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" ~\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.ol,{start:\"4\",children:[\"\\n\",n(c.li,{children:n(c.strong,{children:\"处理过期车道\"})}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"在执行更新时，React会检查是否有过期的车道。如果有，这些任务会被提升到同步优先级进行处理。\"}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/react-reconciler/src/ReactFiberWorkLoop.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" performConcurrentWorkOnRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // ...\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" shouldTimeSlice\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" =\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    !\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"includesBlockingLane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") &&\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    !\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"includesExpiredLane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") &&\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"disableSchedulerTimeoutInWorkLoop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" || !\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"didTimeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" exitStatus\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"shouldTimeSlice\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" renderRootConcurrent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\":\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" renderRootSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // ...\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"通过这种机制，React确保即使在有大量高优先级任务的情况下，低优先级任务最终也能得到执行，从而解决了饥饿问题。\"}),\"\\n\",e(c.h2,{id:\"6-任务队列与react的协调过程\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#6-任务队列与react的协调过程\",children:n(c.span,{className:\"icon icon-link\"})}),\"6. 任务队列与React的协调过程\"]}),\"\\n\",n(c.p,{children:\"任务队列不仅仅是一个独立的调度系统，它与React的协调过程紧密相连。在这个过程中，React的车道优先级（Lane Priority）和调度器的优先级（Scheduler Priority）扮演着重要角色。这两种优先级系统在实际应用中有着不同的作用和表现。\"}),\"\\n\",e(c.h3,{id:\"61-车道优先级lane-priority的实际应用\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#61-车道优先级lane-priority的实际应用\",children:n(c.span,{className:\"icon icon-link\"})}),\"6.1 车道优先级（Lane Priority）的实际应用\"]}),\"\\n\",n(c.p,{children:\"车道优先级主要用于React内部的更新调度。它允许React更细粒度地控制不同类型更新的优先级。例如：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[n(c.strong,{children:\"用户交互\"}),\"：如点击事件，通常被赋予高优先级车道。\"]}),\"\\n\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"jsx\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"jsx\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" Button\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"count\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"setCount\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" handleClick\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 这个更新会被分配高优先级车道\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    setCount\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"count\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"button\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onClick\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"handleClick\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Clicked \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"count\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" times</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"button\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.ol,{start:\"2\",children:[\"\\n\",e(c.li,{children:[n(c.strong,{children:\"数据获取\"}),\"：通常被赋予默认优先级车道。\"]}),\"\\n\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"jsx\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"jsx\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" DataFetcher\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"data\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"setData\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  useEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 这个更新会被分配默认优先级车道\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    fetchData\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"().\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"then\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"setData\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }, [])\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" data\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"data\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"> \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\":\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Loading...</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.ol,{start:\"3\",children:[\"\\n\",e(c.li,{children:[n(c.strong,{children:\"后台计算\"}),\"：可以使用低优先级车道。\"]}),\"\\n\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"jsx\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"jsx\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" ExpensiveComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"result\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"setResult\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  useEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 使用 startTransition 将更新标记为低优先级\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    startTransition\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" computedResult\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"expensiveComputation\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      setResult\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"computedResult\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    })\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }, [])\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" result\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"result\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"> \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\":\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Computing...</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.h3,{id:\"62-调度器优先级scheduler-priority的实际应用\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#62-调度器优先级scheduler-priority的实际应用\",children:n(c.span,{className:\"icon icon-link\"})}),\"6.2 调度器优先级（Scheduler Priority）的实际应用\"]}),\"\\n\",n(c.p,{children:\"调度器优先级主要用于决定任务在JavaScript运行时中的执行顺序。它直接影响到任务何时被执行，我写一下伪代码。\"}),\"\\n\",n(c.p,{children:\"例如：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[n(c.strong,{children:\"即时优先级\"}),\"：用于需要立即执行的任务，如动画或拖拽。\"]}),\"\\n\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"jsx\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"jsx\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" AnimatedComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"position\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"setPosition\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  useEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" animate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      Scheduler\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"unstable_runWithPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Scheduler\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unstable_ImmediatePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        setPosition\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"((\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"prev\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" prev\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      })\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      requestAnimationFrame\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"animate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    animate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }, [])\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"{ \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"transform\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"`translateX(\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"${\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"position\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"px)`\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" }\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.ol,{start:\"2\",children:[\"\\n\",e(c.li,{children:[n(c.strong,{children:\"用户阻塞优先级\"}),\"：用于需要快速响应但不需要立即执行的任务，如文本输入。\"]}),\"\\n\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"jsx\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"jsx\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" SearchInput\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"query\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"setQuery\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"''\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" handleChange\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"e\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    Scheduler\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"unstable_runWithPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Scheduler\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unstable_UserBlockingPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      setQuery\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"e\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"target\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    })\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"input\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" value\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"query\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onChange\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"handleChange\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.ol,{start:\"3\",children:[\"\\n\",e(c.li,{children:[n(c.strong,{children:\"普通优先级\"}),\"：用于不需要立即响应的更新，如网络请求。\"]}),\"\\n\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"jsx\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"jsx\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" DataFetcher\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"data\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"setData\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  useEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    Scheduler\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"unstable_runWithPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Scheduler\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unstable_NormalPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      fetchData\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"().\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"then\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"setData\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    })\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }, [])\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" data\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"data\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"> \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\":\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Loading...</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"优先级在任务调度过程中起着关键作用。高优先级的任务（如用户输入）会中断低优先级的任务（如数据获取）。这是通过比较当前执行任务的优先级和新到来任务的优先级来实现的。\"}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"File: packages/scheduler/src/Scheduler.js\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" unstable_runWithPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"priorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"eventHandler\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  switch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"priorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" ImmediatePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" UserBlockingPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" NormalPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" LowPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" IdlePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    default\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      priorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NormalPriority\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" previousPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentPriorityLevel\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  currentPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"priorityLevel\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  try\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" eventHandler\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"finally\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    currentPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"previousPriorityLevel\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"这个函数允许在特定优先级下运行一个事件处理器。它临时改变当前的优先级级别，执行处理器，然后恢复原来的优先级级别。这确保了高优先级的操作能够及时响应，而不会被低优先级的任务阻塞。\"}),\"\\n\",e(c.h3,{id:\"63-混合优先级\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#63-混合优先级\",children:n(c.span,{className:\"icon icon-link\"})}),\"6.3 混合优先级\"]}),\"\\n\",n(c.p,{children:\"例子：\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"jsx\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"jsx\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" ComplexComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"text\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"setText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"''\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"list\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"setList\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"([])\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"isPending\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"startTransition\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"useTransition\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" handleInputChange\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"e\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" newText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"e\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"target\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 高优先级更新：立即更新输入框\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    setText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 低优先级更新：在transition中更新列表\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    startTransition\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" newList\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"generateLargeList\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      setList\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newList\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    })\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"input\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" value\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"text\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onChange\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"handleInputChange\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      {\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isPending\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"p\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Updating list...</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"p\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"> \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\":\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"ul\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        {\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"list\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"map\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"((\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"item\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"li\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" key\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"item\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"id\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"item\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"text\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"li\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        ))\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"ul\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"在这个例子中：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"车道优先级\"}),\"：\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",e(c.li,{children:[\"输入框的更新（\",n(c.code,{children:\"setText\"}),\"）被赋予高优先级车道，因为它直接响应用户输入。\"]}),\"\\n\",e(c.li,{children:[\"列表的更新（\",n(c.code,{children:\"setList\"}),\"）被包裹在 \",n(c.code,{children:\"startTransition\"}),\" 中，被赋予低优先级车道，因为它是一个可能耗时的操作。\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"调度器优先级\"}),\"：\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",e(c.li,{children:[\"React 内部会将高优先级车道的更新（输入框）转换为调度器的高优先级（如 \",n(c.code,{children:\"UserBlockingPriority\"}),\"）。\"]}),\"\\n\",e(c.li,{children:[\"低优先级车道的更新（列表）会被转换为较低的调度器优先级（如 \",n(c.code,{children:\"NormalPriority\"}),\"）。\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"优先级协同工作\"}),\"：\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"当用户输入时，输入框会立即更新，提供即时反馈。\"}),\"\\n\",n(c.li,{children:\"同时，列表更新被标记为低优先级，允许 React 在主线程空闲时才进行处理。\"}),\"\\n\",n(c.li,{children:\"如果用户继续输入，新的高优先级更新（输入框）会中断正在进行的低优先级更新（列表），确保界面始终响应。\"}),\"\\n\",n(c.li,{children:\"当输入停止，React 会完成被中断的列表更新。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"状态管理\"}),\"：\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",e(c.li,{children:[n(c.code,{children:\"isPending\"}),\" 状态允许我们在低优先级更新进行时显示加载指示器，提升用户体验。\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.h3,{id:\"64-在源码实现中\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#64-在源码实现中\",children:n(c.span,{className:\"icon icon-link\"})}),\"6.4 在源码实现中\"]}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"车道优先级（Lane Priority）\"}),\":\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"在 React 的协调过程中使用。\"}),\"\\n\",n(c.li,{children:\"用于标记更新的紧急程度和重要性。\"}),\"\\n\",n(c.li,{children:\"决定了更新在 React 内部处理的顺序。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"调度器优先级（Scheduler Priority）\"}),\":\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"在 React 的调度器中使用。\"}),\"\\n\",n(c.li,{children:\"决定任务在 JavaScript 运行时中的执行顺序。\"}),\"\\n\",n(c.li,{children:\"控制任务何时被执行。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"任务管理\"}),\":\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"涉及车道优先级和调度器优先级。\"}),\"\\n\",n(c.li,{children:\"使用车道优先级来标记任务的重要性。\"}),\"\\n\",n(c.li,{children:\"将车道优先级转换为调度器优先级，以决定任务的执行顺序。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"协调过程\"}),\":\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"主要使用车道优先级。\"}),\"\\n\",n(c.li,{children:\"决定哪些更新应该被优先处理。\"}),\"\\n\",n(c.li,{children:\"在构建和比较 Fiber 树时考虑车道优先级。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"优先级转换\"}),\":\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"发生在任务被调度时。\"}),\"\\n\",n(c.li,{children:\"React 内部将车道优先级转换为调度器优先级。\"}),\"\\n\",n(c.li,{children:\"这个转换确保了 React 的内部优先级系统与调度器的优先级系统能够协同工作。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" ensureRootIsScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" existingCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 检查是否有任何车道被其他工作饿死。如果有，将它们标记为过期，以便我们知道下一步要处理它们。\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  markStarvedLanesAsExpired\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 确定下一个要处理的车道，以及它们的优先级。\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" nextLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getNextLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressRoot\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgressRootRenderLanes\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" :\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" NoLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 如果没有需要处理的车道，取消现有的回调并返回\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"existingCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      cancelCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"existingCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoLane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 使用最高优先级的车道来表示回调的优先级\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getHighestPriorityLane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 检查是否存在现有任务。我们可能可以重用它。\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" existingCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"existingCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 优先级没有改变。我们可以重用现有的任务。\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 如果存在现有的回调节点，取消它\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"existingCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" != \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    cancelCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"existingCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 调度一个新的回调\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"SyncLane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 特殊情况：同步React回调被调度在一个特殊的内部队列中\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"scheduleSyncCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      performSyncWorkOnRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"bind\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    );\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 将车道优先级转换为调度器优先级\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" schedulerPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"lanePriorityToSchedulerPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 使用调度器优先级调度新的回调\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"scheduleCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      schedulerPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      performConcurrentWorkOnRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"bind\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 更新根节点的回调优先级和回调节点\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"这个函数负责确保根Fiber节点被正确调度。它会检查是否有新的工作需要执行，并根据优先级创建或重用任务。\"}),\"\\n\",e(c.h3,{id:\"65-车道和优先级转换\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#65-车道和优先级转换\",children:n(c.span,{className:\"icon icon-link\"})}),\"6.5 车道和优先级转换\"]}),\"\\n\",e(c.p,{children:[\"在理解源码前，我们要再次加深这两种优先级的意义，\",n(c.code,{children:\"枯燥\"}),\"的理解源码\",n(c.code,{children:\"毫无意义\"}),\"。\"]}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[\"\\n\",n(c.p,{children:\"调度器优先级（Scheduler Priority）：\"}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"这是最终决定任务执行顺序的关键因素。\"}),\"\\n\",n(c.li,{children:\"它直接与 JavaScript 运行时交互，决定哪些任务应该先执行，哪些可以稍后执行。\"}),\"\\n\",n(c.li,{children:n(c.code,{children:'调度器优先级是 React 与底层 JavaScript 引擎通信的\"语言\"。'})}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",n(c.p,{children:\"车道优先级（Lane Priority）：\"}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"这是 React 内部使用的一个更细粒度的优先级系统。\"}),\"\\n\",n(c.li,{children:\"它允许 React 更精确地表达不同类型更新的重要性和紧急程度。\"}),\"\\n\",n(c.li,{children:n(c.code,{children:'车道优先级可以看作是 React 的内部\"思考过程\"，用于决定不同更新的相对重要性。'})}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",n(c.p,{children:\"优先级转换：\"}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"React 需要将其内部的车道优先级转换为调度器可以理解的优先级。\"}),\"\\n\",n(c.li,{children:n(c.code,{children:'这个转换过程可以看作是 React 的\"决策过程\"，将其内部的复杂优先级系统映射到调度器的相对简单的优先级系统上。'})}),\"\\n\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" lanePriorityToSchedulerPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"lanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"LanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"ReactPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  switch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" SyncLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" SyncBatchedLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" ImmediatePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" InputDiscreteHydrationLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" InputDiscreteLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" InputContinuousHydrationLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" InputContinuousLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" UserBlockingPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" DefaultHydrationLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" DefaultLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" TransitionHydrationPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" TransitionPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" SelectiveHydrationLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" RetryLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" NormalPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" IdleHydrationLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" IdleLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" OffscreenLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" IdlePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" NoLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" NoSchedulerPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    default\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      invariant\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#FFD493\"},children:\"        false\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#FFD493\"},children:\"        'Invalid update priority: %s. This is a bug in React.'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        lanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"这个函数负责将React的车道优先级转换为调度器的优先级。这种转换关系如下：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:\"同步优先级（Sync）对应调度器的立即优先级（Immediate）\"}),\"\\n\",n(c.li,{children:\"输入优先级（Input）对应用户阻塞优先级（UserBlocking）\"}),\"\\n\",n(c.li,{children:\"默认优先级（Default）和过渡优先级（Transition）对应普通优先级（Normal）\"}),\"\\n\",n(c.li,{children:\"空闲优先级（Idle）对应调度器的空闲优先级（Idle）\"}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"这种转换确保了React内部的优先级系统能够与调度器的优先级系统协同工作，从而实现更精细的任务调度。\"}),\"\\n\",e(c.h2,{id:\"7-任务队列与react并发模式\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#7-任务队列与react并发模式\",children:n(c.span,{className:\"icon icon-link\"})}),\"7. 任务队列与React并发模式\"]}),\"\\n\",e(c.p,{children:[\"在我们上述讲的所有内容都是达成 \",n(c.code,{children:\"并发模式\"}),\" 的拼图，首先我们需要抓住关键词 \",n(c.code,{children:\"并发模式\"}),\"，而不是实现 \",n(c.code,{children:\"并发\"}),\"，\",n(c.code,{children:\"JavaScript\"}),\" 是单线程的，传统意义上的并发（如多线程）是同时处理多个任务。\"]}),\"\\n\",e(c.h3,{id:\"71-并发本质\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#71-并发本质\",children:n(c.span,{className:\"icon icon-link\"})}),\"7.1 并发本质\"]}),\"\\n\",n(c.p,{children:\"它的本质是：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[n(c.strong,{children:\"交错执行\"}),\"：在单一线程上交错执行多个任务。\"]}),\"\\n\",e(c.li,{children:[n(c.strong,{children:\"优先级调度\"}),\"：根据任务的优先级决定执行顺序。\"]}),\"\\n\",e(c.li,{children:[n(c.strong,{children:\"可中断渲染\"}),\"：允许高优先级任务打断低优先级任务。\"]}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"想象你正在做一个大型拼图（低优先级任务，如渲染一个复杂列表），突然电话响了（高优先级任务，如用户输入）。在 React 的并发模式下：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",n(c.li,{children:\"你可以暂停拼图（中断渲染）。\"}),\"\\n\",n(c.li,{children:\"接听电话（处理高优先级任务）。\"}),\"\\n\",n(c.li,{children:\"通话结束后，继续拼图（恢复渲染）。\"}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"代码层面的实现：\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" workLoopConcurrent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && !\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"shouldYield\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"()) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    performUnitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" shouldYield\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    getCurrentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() >= \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"deadline\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 时间片用完\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    hasHigherPriorityWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 有更高优先级的工作\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:[\"这里的 \",n(c.code,{children:\"shouldYield()\"}),\" 函数检查是否应该让出控制权。如果时间片用完或有更高优先级的工作，React 就会暂停当前任务。\"]}),\"\\n\",e(c.h3,{id:\"72-为什么这也算是并发\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#72-为什么这也算是并发\",children:n(c.span,{className:\"icon icon-link\"})}),'7.2 为什么这也算是\"并发\"？']}),\"\\n\",n(c.p,{children:\"React的任务管理机制、任务中断恢复和车道协调共同构成了实现并发的核心框架。\"}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"多任务交错执行\"}),\"：尽管在任何给定时刻只有一个任务在执行，但从宏观角度看，多个任务是交错进行的。这种交错执行创造了任务并行的错觉，类似于操作系统的时间片轮转调度。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"非阻塞\"}),\"：低优先级任务不会阻塞高优先级任务的执行。这确保了重要的用户交互和更新能够及时响应，提高了应用的整体响应性。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"响应式\"}),\"：系统能够快速响应用户交互，即使在处理大量后台工作时也是如此。这种能力模拟了真正并发系统的行为，多个处理单元同时处理不同的任务。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"公平调度\"}),\"：所有任务最终都会得到处理，只是执行顺序根据优先级动态调整。这种调度策略确保了资源的公平分配，避免了任务饥饿问题。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"细粒度控制\"}),\"：通过车道优先级系统，React能够对任务进行更细粒度的控制，实现了类似于抢占式多任务处理的效果。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"异步渲染\"}),'：React的并发模式支持异步渲染，允许组件\"暂停\"渲染等待数据，这种能力进一步增强了并发的特性。']}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"资源利用优化\"}),\"：通过智能地分配CPU时间，React能够在保持UI响应性的同时，最大化利用可用的计算资源，这其实就是并发追求的东西。\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.p,{children:[\"总的来说，虽然React的 \",n(c.code,{children:\"并发模式\"}),\" 在技术实现上与传统的多线程并发有所不同，但它在功能和效果上实现了类似的目标：提高系统的响应性、优化资源利用、平衡多个任务的执行。\"]}),\"\\n\",e(c.p,{children:[\"这就是 \",n(c.code,{children:\"react\"}),\" 的核心。\"]}),\"\\n\",e(c.h2,{id:\"8-总结\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#8-总结\",children:n(c.span,{className:\"icon icon-link\"})}),\"8. 总结\"]}),\"\\n\",n(c.p,{children:\"React Fiber架构中的任务队列是实现可中断渲染和优先级调度的核心组件。通过深入分析其创建和调度过程，我们可以得出以下几点结论：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"灵活的优先级系统\"}),\"：React使用多级优先级系统，能够精确控制不同类型任务的执行顺序，确保重要的更新能够及时响应。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"高效的数据结构\"}),\"：使用小顶堆实现的优先级队列，保证了任务的快速插入和获取，时间复杂度为O(log n)。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"可中断的执行模型\"}),\"：通过时间切片和yield机制，React能够在长任务执行过程中适时让出主线程，保证页面的响应性。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"与React核心的紧密集成\"}),\"：任务队列与React的协调过程、Lanes系统等核心概念紧密结合，支持了并发模式等高级特性。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"性能优化\"}),\"：通过批量更新、延迟任务处理等机制，任务队列在保证功能的同时也兼顾了性能。\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"其实看这些源码，都是为了写出更高效、更流畅的React应用。\"}),\"\\n\",n(c.p,{children:\"平时大家是靠感觉来使用这些优化手段，那么在理解这个任务队列和调度之后，会让我们心里更有底，也是知其所也然了。\"})]})}return{default:function(l={}){const{wrapper:e}=l.components||{};return e?n(e,{...l,children:n(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "1. React Fiber架构：深入解析任务队列、可中断渲染、调度、同步模式",
          "url": "#1-react-fiber架构深入解析任务队列可中断渲染调度同步模式",
          "items": []
        },
        {
          "title": "2. 任务队列的概念和作用",
          "url": "#2-任务队列的概念和作用",
          "items": [
            {
              "title": "2.1 什么是任务队列？",
              "url": "#21-什么是任务队列",
              "items": []
            },
            {
              "title": "2.2 任务队列的作用",
              "url": "#22-任务队列的作用",
              "items": []
            }
          ]
        },
        {
          "title": "3. React源码中的任务队列实现",
          "url": "#3-react源码中的任务队列实现",
          "items": [
            {
              "title": "3.1 数据结构",
              "url": "#31-数据结构",
              "items": []
            },
            {
              "title": "3.2 任务的表示",
              "url": "#32-任务的表示",
              "items": []
            },
            {
              "title": "3.3 优先级的定义",
              "url": "#33-优先级的定义",
              "items": []
            }
          ]
        },
        {
          "title": "4. 任务队列的创建过程",
          "url": "#4-任务队列的创建过程",
          "items": [
            {
              "title": "4.1 初始化",
              "url": "#41-初始化",
              "items": []
            },
            {
              "title": "4.2 添加任务",
              "url": "#42-添加任务",
              "items": []
            },
            {
              "title": "4.3 任务排序",
              "url": "#43-任务排序",
              "items": []
            }
          ]
        },
        {
          "title": "5. 任务队列的调度过程",
          "url": "#5-任务队列的调度过程",
          "items": [
            {
              "title": "5.1 调度器的初始化",
              "url": "#51-调度器的初始化",
              "items": []
            },
            {
              "title": "5.2 任务执行",
              "url": "#52-任务执行",
              "items": []
            },
            {
              "title": "5.3 任务中断与恢复",
              "url": "#53-任务中断与恢复",
              "items": [
                {
                  "title": "5.3.1 shouldYieldToHost 函数",
                  "url": "#531-shouldyieldtohost-函数",
                  "items": []
                },
                {
                  "title": "5.3.2 任务中断和恢复的实现",
                  "url": "#532-任务中断和恢复的实现",
                  "items": []
                },
                {
                  "title": "5.3.3 优先级管理和任务切换",
                  "url": "#533-优先级管理和任务切换",
                  "items": []
                }
              ]
            },
            {
              "title": "5.4 优先级管理和饥饿问题的解决",
              "url": "#54-优先级管理和饥饿问题的解决",
              "items": []
            }
          ]
        },
        {
          "title": "6. 任务队列与React的协调过程",
          "url": "#6-任务队列与react的协调过程",
          "items": [
            {
              "title": "6.1 车道优先级（Lane Priority）的实际应用",
              "url": "#61-车道优先级lane-priority的实际应用",
              "items": []
            },
            {
              "title": "6.2 调度器优先级（Scheduler Priority）的实际应用",
              "url": "#62-调度器优先级scheduler-priority的实际应用",
              "items": []
            },
            {
              "title": "6.3 混合优先级",
              "url": "#63-混合优先级",
              "items": []
            },
            {
              "title": "6.4 在源码实现中",
              "url": "#64-在源码实现中",
              "items": []
            },
            {
              "title": "6.5 车道和优先级转换",
              "url": "#65-车道和优先级转换",
              "items": []
            }
          ]
        },
        {
          "title": "7. 任务队列与React并发模式",
          "url": "#7-任务队列与react并发模式",
          "items": [
            {
              "title": "7.1 并发本质",
              "url": "#71-并发本质",
              "items": []
            },
            {
              "title": "7.2 为什么这也算是\"并发\"？",
              "url": "#72-为什么这也算是并发",
              "items": []
            }
          ]
        },
        {
          "title": "8. 总结",
          "url": "#8-总结",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "10.react_task_queue"
  },
  {
    "slug": "/content/react-source-code/11.react_algorithm",
    "title": "11.React中的算法基础",
    "description": "文章先介绍链表的概念及特点，重点阐述了链表在 React 中的应用，如 fiber 中的链表属性、Hook 对象中的链表，还涉及链表合并、拆解、遍历等在 React 源码中的情况，强调其使用高频。",
    "published": true,
    "date": "2022-10-30T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(c){const r={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",h3:\"h3\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",...c.components};return n(l,{children:[n(r.h1,{id:\"react中的算法基础\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react中的算法基础\",children:e(r.span,{className:\"icon icon-link\"})}),\"React中的算法基础\"]}),\"\\n\",n(r.h1,{id:\"开篇\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#开篇\",children:e(r.span,{className:\"icon icon-link\"})}),\"开篇\"]}),\"\\n\",e(r.p,{children:\"我们在阅读React源码的过程中，实际上会遇到很多的算法，当你了解这些算法的时候才能更好也更快的去阅读理解源码中的细节，不然我们总是在雾里看花（就是知道一个大概流程，当可能有时候面试官问深一点就G的那种阶段），所以这里就简单介绍一下React里大篇使用的算法。\"}),\"\\n\",n(r.h1,{id:\"链表简介\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#链表简介\",children:e(r.span,{className:\"icon icon-link\"})}),\"链表简介\"]}),\"\\n\",n(r.p,{children:[e(r.strong,{children:\"链表\"}),\"（Linked list）是一种常见的基础数据结构, 是一种线性表, 但是并不会按线性的顺序存储数据, 而是在每一个节点里存到下一个节点的指针(Pointer).由于不必须按顺序存储，链表在插入的时候可以达到 O(1)的复杂度, 但是查找一个节点或者访问特定编号的节点则需要 O(n)的时间。\"]}),\"\\n\",n(r.p,{children:[e(r.strong,{children:\"节点\"}),\"：一个节点包含两个域，一个是数据域，数据域用来保存数据，一个是指针域，指针域代表当前节点的指向。\"]}),\"\\n\",n(r.p,{children:[e(r.strong,{children:\"特点总结\"}),\"：1.链表在指定位置插入删除不需要移动元素，只需要修改指针。 2.查找效率相对于数组低很多。 3.链表同时也相对于数组多了指针域的空间开销。\"]}),\"\\n\",n(r.p,{children:[e(r.strong,{children:\"链表分为\"}),\"：静态链表、动态链表。又向下\",e(r.strong,{children:\"细分\"}),\"为单向链表、双向链表、循环链表、单项循环链表、双向循环链表。\"]}),\"\\n\",n(r.p,{children:[e(r.strong,{children:\"单链表\"}),\"：其实没什么好说的就是由头节点next不停的向下指，然后尾部最终指向一个null表示链表结束。\"]}),\"\\n\",n(r.p,{children:[e(r.strong,{children:\"双链表\"}),\"：链表的向前是很容易的，而向后我们就可以定义一个prev属性的指针来指向于上个节点，去形成一个双向链表。\"]}),\"\\n\",n(r.h1,{id:\"简单双向链表实现\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#简单双向链表实现\",children:e(r.span,{className:\"icon icon-link\"})}),\"简单双向链表实现\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\" * @Description: 简单双向链表\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\" * @Date: 2022-10-30 18:57:05\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\" */\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"class\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" Node\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  constructor\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"data\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    //数据域\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#ACAFFF\"},children:\"    this\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"data\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"data\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    //表示节点域\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#ACAFFF\"},children:\"    this\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#ACAFFF\"},children:\"    this\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prev\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"class\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" LinkedList\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  head\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"new\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" Node\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#FFD493\"},children:'\"head\"'}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 显示链表\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"  display\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"this\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"head\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    while\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      console\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"log\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"data\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 查找节点\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * \"}),e(r.span,{style:{color:\"#54B9FF\",fontStyle:\"italic\"},children:\"@param\"}),e(r.span,{style:{color:\"#ACAFFF\",fontStyle:\"italic\"},children:\" {*}\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" item\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  给定节点\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"  find\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"item\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"this\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"head\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    while\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"data\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"item\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   *\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * \"}),e(r.span,{style:{color:\"#54B9FF\",fontStyle:\"italic\"},children:\"@param\"}),e(r.span,{style:{color:\"#ACAFFF\",fontStyle:\"italic\"},children:\" {*}\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" item\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\" 给定节点\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * \"}),e(r.span,{style:{color:\"#54B9FF\",fontStyle:\"italic\"},children:\"@param\"}),e(r.span,{style:{color:\"#ACAFFF\",fontStyle:\"italic\"},children:\" {*}\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" newdata\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\" 插入的新节点\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"  insert\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"item\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"newData\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" newNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"new\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" Node\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"newData\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"this\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"find\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"item\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    newNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    newNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prev\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prev\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"newNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"newNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 查找前一个节点\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * \"}),e(r.span,{style:{color:\"#54B9FF\",fontStyle:\"italic\"},children:\"@param\"}),e(r.span,{style:{color:\"#ACAFFF\",fontStyle:\"italic\"},children:\" {*}\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" item\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  给定节点\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"  findPrev\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"item\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"this\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"head\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    while\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"data\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"item\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" currentNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 删除节点\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * \"}),e(r.span,{style:{color:\"#54B9FF\",fontStyle:\"italic\"},children:\"@param\"}),e(r.span,{style:{color:\"#ACAFFF\",fontStyle:\"italic\"},children:\" {*}\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" item\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"  remove\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"item\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"this\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"find\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"item\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prev\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prev\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prev\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prev\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    currNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prev\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h1,{id:\"react与链表\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react与链表\",children:e(r.span,{className:\"icon icon-link\"})}),\"react与链表\"]}),\"\\n\",n(r.h2,{id:\"fiber中的链表属性\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#fiber中的链表属性\",children:e(r.span,{className:\"icon icon-link\"})}),\"fiber中的链表属性\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"effect\"}),\"链表(链式队列): 存储有副作用的子节点, 构成该队列的元素是\",e(r.code,{children:\"fiber\"}),\"对象。\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //下一个副作用链表中的fiber节点\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"  nextEffect: \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //副作用指针指向第一个副作用链表的fiber节点\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"  lastEffect: \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //副作用指针指向最后副作用链表的fiber节点\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"  firstEffect: \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h3,{id:\"completeunitofwork回溯阶段\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#completeunitofwork回溯阶段\",children:e(r.span,{className:\"icon icon-link\"})}),\"completeUnitOfWork回溯阶段\"]}),\"\\n\",e(r.p,{children:\"好这里我们看看源码的实现\"}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" completeUnitOfWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"unitOfWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //忽略代码\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"   if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"        returnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"        (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Incomplete\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") === \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"NoFlags\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      ) {\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        //只有父节点的firstEffect不存在时，才能将父节点的firstEffect指向当前节点的副作用单向链表头\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        //让父节点的firstEffect指向当前节点的firstEffect\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"          returnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        //当前节点不存在副作用链表才加\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"          if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"            returnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"          }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 将当前节点加到副作用链表中\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"          returnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" flags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"PerformedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"          if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          //将当前节点添加到其副作用链表末尾\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"            returnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"          } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"            returnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"          }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"          returnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(r.p,{children:\"这就是自底而上向父节点提交副作用链表，构建完整的副作用链表。但真的挺难理解的，所以后面18就直接抛弃洛。\"}),\"\\n\",n(r.h2,{id:\"hook-对象\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#hook-对象\",children:e(r.span,{className:\"icon icon-link\"})}),\"Hook 对象\"]}),\"\\n\",n(r.p,{children:[\"在\",e(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F7kms%2Freact-illustration-series%2Fblob%2Fmain%2Fdocs%2Fmain%2Fobject-structure.md%23Hook\",title:\"https://github.com/7kms/react-illustration-series/blob/main/docs/main/object-structure.md#Hook\",children:\"react 高频对象\"}),\"中对\",e(r.code,{children:\"Hook\"}),\"对象的属性做了说明, \",e(r.code,{children:\"Hook\"}),\"对象具备\",e(r.code,{children:\".next\"}),\"属性, 所以\",e(r.code,{children:\"Hook\"}),\"对象本身就是链表中的一个节点。\"]}),\"\\n\",n(r.p,{children:[\"此外\",e(r.code,{children:\"hook.queue.pending\"}),\"也构成了一个链表。\"]}),\"\\n\",n(r.p,{children:[\"在\",e(r.code,{children:\"react\"}),\"中, 发起更新之后, 会通过\",e(r.code,{children:\"链表合并\"}),\"的方式把等待(\",e(r.code,{children:\"pending\"}),\"状态)更新的队列(\",e(r.code,{children:\"updateQueue\"}),\")合并到基础队列(\",e(r.code,{children:\"class\"}),\"组件:\",e(r.code,{children:\"fiber.updateQueue.firstBaseUpdate\"}),\";\",e(r.code,{children:\"function\"}),\"组件: \",e(r.code,{children:\"hook.baseQueue\"}),\"), 最后通过遍历\",e(r.code,{children:\"baseQueue\"}),\"筛选出优先级足够的\",e(r.code,{children:\"update\"}),\"对象, 组合成最终的组件状态(\",e(r.code,{children:\"state\"}),\"). 这个过程发生在\",e(r.code,{children:\"reconciler\"}),\"阶段, 分别涉及到\",e(r.code,{children:\"class\"}),\"组件和\",e(r.code,{children:\"function\"}),\"组件。\"]}),\"\\n\",e(r.p,{children:\"具体场景:\"}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"class\"}),\"组件中\"]}),\"\\n\",n(r.p,{children:[\"在\",e(r.code,{children:\"class\"}),\"组件中调用\",e(r.code,{children:\"setState\"}),\", 会创建\",e(r.code,{children:\"update\"}),\"对象并添加到\",e(r.code,{children:\"fiber.updateQueue.shared.pending\"}),\"链式队列(\",e(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactUpdateQueue.old.js%23L198-L230\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactUpdateQueue.old.js#L198-L230\",children:\"源码地址\"}),\")。\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"   export\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" enqueueUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">) {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"     const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"     // ...\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"     const\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" sharedQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"SharedQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"> = (\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\").shared;\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"     // 将新的update对象添加到fiber.updateQueue.shared.pending链表上\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"     const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"sharedQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"     if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"       update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"     } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"       update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"       pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"     }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"     sharedQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"   }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[\"由于\",e(r.code,{children:\"fiber.updateQueue.shared.pending\"}),\"是一个环形链表, 所以\",e(r.code,{children:\"fiber.updateQueue.shared.pending\"}),\"永远指向末尾元素(保证快速添加新元素)在\",e(r.code,{children:\"fiber\"}),\"树构建阶段(或\",e(r.code,{children:\"reconciler\"}),\"阶段), 会把\",e(r.code,{children:\"fiber.updateQueue.shared.pending\"}),\"合并到\",e(r.code,{children:\"fiber.updateQueue.firstBaseUpdate\"}),\"队列上(\",e(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactUpdateQueue.old.js%23L394-L572\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactUpdateQueue.old.js#L394-L572\",children:\"源码地址\"}),\")。\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    export\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" processUpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      workInProgress\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      props\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      instance\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      renderLanes\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Lanes\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    ): \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // This is always non-null on a ClassComponent or HostRoot\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" queue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"UpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"> = (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" firstBaseUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstBaseUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" lastBaseUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastBaseUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // Check if there are pending updates. If so, transfer them to the base queue.\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" pendingQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"shared\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pendingQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"        queue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"shared\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // The pending queue is circular. Disconnect the pointer between first\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // and last so that it's non-circular.\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" lastPendingUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pendingQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" firstPendingUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastPendingUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"        lastPendingUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // Append pending updates to base queue\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastBaseUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"          firstBaseUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstPendingUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"        } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"          lastBaseUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstPendingUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"        lastBaseUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastPendingUpdate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"function\"}),\"组件中\"]}),\"\\n\",n(r.p,{children:[\"在\",e(r.code,{children:\"function\"}),\"组件中使用\",e(r.code,{children:\"Hook\"}),\"对象(\",e(r.code,{children:\"useState\"}),\"), 并改变\",e(r.code,{children:\"Hook\"}),\"对象的值(内部会调用\",e(r.code,{children:\"dispatchAction\"}),\"), 此时也会创建\",e(r.code,{children:\"update(hook)\"}),\"对象并添加到\",e(r.code,{children:\"hook.queue.pending\"}),\"链式队列(\",e(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiberHooks.old.js%23L1645-L1682\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L1645-L1682\",children:\"源码地址\"}),\")。\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"hook.queue.pending\"}),\"也是一个环形链表(与\",e(r.code,{children:\"fiber.updateQueue.shared.pending\"}),\"的结构很相似)\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" dispatchAction\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      queue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"UpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">,\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      action\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    ) {\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // ... 省略部分代码\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // This is the first update. Create a circular list.\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"        update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"        update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"        pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      queue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[\"在\",e(r.code,{children:\"fiber\"}),\"树构建阶段(或\",e(r.code,{children:\"reconciler\"}),\"阶段), 会将\",e(r.code,{children:\"hook.queue.pending\"}),\"合并到\",e(r.code,{children:\"hook.baseQueue\"}),\"队列上(\",e(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiberHooks.old.js%23L672-L694\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L672-L694\",children:\"源码地址\"}),\").\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" updateReducer\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"I\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"    reducer\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": (\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"S\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"A\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" S\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"    initialArg\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"I\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"    init\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"?\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"I\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" S\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"  ): [\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Dispatch\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">] {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // ... 省略部分代码\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pendingQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 在这里进行队列的合并\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" baseFirst\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" pendingFirst\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pendingQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"        baseQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pendingFirst\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"        pendingQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"baseFirst\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pendingQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      queue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h1,{id:\"总结\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#总结\",children:e(r.span,{className:\"icon icon-link\"})}),\"总结\"]}),\"\\n\",n(r.p,{children:[\"主要介绍了\",e(r.code,{children:\"链表\"}),\"的概念和它在\",e(r.code,{children:\"react\"}),\"源码中的使用情况. \",e(r.code,{children:\"react\"}),\"链表使用非常高频。源码中\",e(r.code,{children:\"链表合并\"}),\", \",e(r.code,{children:\"环形链表拆解\"}),\", \",e(r.code,{children:\"链表遍历\"}),\"的代码篇幅很多，大家可以多看看。\"]})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "React中的算法基础",
          "url": "#react中的算法基础",
          "items": []
        },
        {
          "title": "开篇",
          "url": "#开篇",
          "items": []
        },
        {
          "title": "链表简介",
          "url": "#链表简介",
          "items": []
        },
        {
          "title": "简单双向链表实现",
          "url": "#简单双向链表实现",
          "items": []
        },
        {
          "title": "react与链表",
          "url": "#react与链表",
          "items": [
            {
              "title": "fiber中的链表属性",
              "url": "#fiber中的链表属性",
              "items": [
                {
                  "title": "completeUnitOfWork回溯阶段",
                  "url": "#completeunitofwork回溯阶段",
                  "items": []
                }
              ]
            },
            {
              "title": "Hook 对象",
              "url": "#hook-对象",
              "items": []
            }
          ]
        },
        {
          "title": "总结",
          "url": "#总结",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "11.react_algorithm"
  },
  {
    "slug": "/content/react-source-code/12.read_react_source_code",
    "title": "12. React源码阅读必知",
    "description": "React源码阅读必知",
    "published": true,
    "date": "2022-12-02T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(c){const r={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",h3:\"h3\",img:\"img\",p:\"p\",pre:\"pre\",span:\"span\",table:\"table\",tbody:\"tbody\",td:\"td\",th:\"th\",thead:\"thead\",tr:\"tr\",...c.components};return n(l,{children:[n(r.h1,{id:\"react源码阅读必知\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react源码阅读必知\",children:e(r.span,{className:\"icon icon-link\"})}),\"React源码阅读必知\"]}),\"\\n\",e(r.p,{children:\"专栏： \"}),\"\\n\",e(r.p,{children:\"React源码学习笔记杂记\"}),\"\\n\",e(r.p,{children:\"智能总结\"}),\"\\n\",e(r.p,{children:\"复制\"}),\"\\n\",e(r.p,{children:\"重新生成\"}),\"\\n\",e(r.p,{children:\"这篇文章是关于 React 源码阅读的必知内容，介绍了三个代表性版本的重大变动和关注重点，分析了基础结构中的核心包，包括 react、react-dom、react-reconciler、scheduler 及其功能。还讲解了输入输出，如 scheduleUpdateOnFiber 是输入必经之路，commitRootImpl 是输出的三个阶段。最后推荐了学习源码的顺序和交流方式。\"}),\"\\n\",e(r.p,{children:\"关联问题: 17版本有何特点 怎样理解调度器 react-dom如何工作\"}),\"\\n\",n(r.h1,{id:\"开篇\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#开篇\",children:e(r.span,{className:\"icon icon-link\"})}),\"开篇\"]}),\"\\n\",e(r.p,{children:\"最近写了一下React源码理解和手写，但兄弟萌总是说看不懂，我自己也看了一下，如果没一些基础知识确实看不懂啊，这里就想了一下写一个React阅读必知来先给兄弟萌get一下react阅读源码前的必知知识点，来减少大家的阅读难度。\"}),\"\\n\",n(r.h1,{id:\"版本\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#版本\",children:e(r.span,{className:\"icon icon-link\"})}),\"版本\"]}),\"\\n\",e(r.p,{children:\"这里就只讲3个现在的代表性版本，17以前的16主版本，17主版本，18主版本。这只是我的理解，有不同的看法可以指出。\"}),\"\\n\",n(r.table,{children:[e(r.thead,{children:n(r.tr,{children:[e(r.th,{children:\"版本号\"}),e(r.th,{children:\"重大变动\"}),e(r.th,{children:\"关注重点\"})]})}),n(r.tbody,{children:[n(r.tr,{children:[e(r.td,{children:\"16\"}),e(r.td,{children:\"生命周期的更新变动，Hooks，context API不需要向下传递，createRef/forwordRef，Memo，Lazy、suspense等\"}),e(r.td,{children:\"提升优化react性能，fiber核心算法的实现，以及解决hooks状态逻辑复用问题、组件嵌套地狱。\"})]}),n(r.tr,{children:[e(r.td,{children:\"17\"}),e(r.td,{children:\"JSX的编译方式，重构expirationTime，引入车道算法（lanes），事件代理节点从document变为root，调度性能统计埋点\"}),e(r.td,{children:\"解决16的expirationTimes算法缺陷，引入一个连续优先级算法车道模型\"})]}),n(r.tr,{children:[e(r.td,{children:\"18\"}),e(r.td,{children:\"将默认的legcy模式变为concurrent模式，重构批处理，suspense，startTransition、usetransition、useDeferredValue\"}),e(r.td,{children:\"并发模式的支持（其实17中就已经有了大量的内容了），服务端渲染内容。\"})]})]})]}),\"\\n\",n(r.h1,{id:\"分析版本\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#分析版本\",children:e(r.span,{className:\"icon icon-link\"})}),\"分析版本\"]}),\"\\n\",e(r.p,{children:\"这里我就直接以17.02这个版本来分析源码，因为我感觉这个版本相对来说比较让我们能够渐进式又不算太慢的去理解源码。\"}),\"\\n\",n(r.h1,{id:\"基础结构\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#基础结构\",children:e(r.span,{className:\"icon icon-link\"})}),\"基础结构\"]}),\"\\n\",n(r.p,{children:[\"我们可以看到react有这么多的包，其实我们是很难下手的，所以我先帮大家解决这个问题，我们web开发只需要关心核心的4个包：\",e(r.code,{children:\"react\"}),\"、\",e(r.code,{children:\"react-dom\"}),\"、\",e(r.code,{children:\"react-reconciler\"}),\"、\",e(r.code,{children:\"scheduler\"}),\"。\"]}),\"\\n\",n(r.p,{children:[e(r.img,{src:\"https://ik.imagekit.io/leiakito/Vue3+ELLnput/read_reac_source_code.webp\",alt:\"image.png\"}),\"\\n\",e(r.code,{children:\"react\"}),\"：react基础包，api向外的抛出者，我们应用层大部分调用的api都是来自这个包。\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"react-dom\"}),\"：react的渲染器，通常我们的入口函数就是来自这里render()，他负责把内存的fiber树渲染到页面上。\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"react-reconciler\"}),\":react的协调器，简单来说就是一个桥梁，连接3个包之间的配合和调用。\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"scheduler\"}),\": react的\",e(r.code,{children:\"调度器\"}),\"，他主要就是控制回调的时机。以及实现时间切片，渲染可中断，本质上来说它的出现是为了解决cpu瓶颈。\"]}),\"\\n\",n(r.h1,{id:\"关注重点\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#关注重点\",children:e(r.span,{className:\"icon icon-link\"})}),\"关注重点\"]}),\"\\n\",e(r.p,{children:\"我觉得我自己比较容易去学习源码的思路是这样的\"}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"react-reconciler\"}),\" => \",e(r.code,{children:\"scheduler\"}),\" => \",e(r.code,{children:\"react-reconciler\"}),\" => \",e(r.code,{children:\"react-dom\"}),\" => \",e(r.code,{children:\"react\"})]}),\"\\n\",e(r.p,{children:\"简单的说就是先关注协调器做了哪些事情，在关心他把哪些事情交给调度中心，调度中心调度的时机，再回到协调器，交给渲染器渲染，最后给react基础包抛出的事件。\"}),\"\\n\",n(r.h1,{id:\"回到源码正题\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#回到源码正题\",children:e(r.span,{className:\"icon icon-link\"})}),\"回到源码正题\"]}),\"\\n\",e(r.p,{children:\"想了一下，我觉得可以这样，我们先去关心输入，和输出，然后在不停的拆解中间的过程，最终达成我们阅读源码的目的，那这里我就直接去把各个包主流程的输入和输出先拿出来去节约大家的事件。\"}),\"\\n\",n(r.h2,{id:\"1react-reconciler\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1react-reconciler\",children:e(r.span,{className:\"icon icon-link\"})}),\"1.react-reconciler\"]}),\"\\n\",n(r.h3,{id:\"11输入\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#11输入\",children:e(r.span,{className:\"icon icon-link\"})}),\"1.1输入\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"scheduleUpdateOnFiber\"}),e(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiberWorkLoop.old.js%23L517-L619\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L517-L619\",children:\"源码地址\"}),\"，在\",e(r.code,{children:\"react-reconciler\"}),\"对外暴露的 api 函数中, 只要涉及到需要改变 fiber 的操作(无论是\",e(r.code,{children:\"首次渲染\"}),\"或\",e(r.code,{children:\"后续更新\"}),\"操作), 最后都会间接调用\",e(r.code,{children:\"scheduleUpdateOnFiber\"}),\", 所以\",e(r.code,{children:\"scheduleUpdateOnFiber\"}),\"函数是输入中的\",e(r.code,{children:\"必经之路\"}),\".\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 唯一接收输入信号的函数\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" scheduleUpdateOnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  lane\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Lane\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  eventTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // ... 省略部分无关代码\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"markUpdateLaneFromFiberToRoot\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lane\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lane\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"SyncLane\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"      (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"executionContext\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"LegacyUnbatchedContext\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") !== \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"NoContext\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"      (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"executionContext\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" & (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"RenderContext\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"CommitContext\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\")) === \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"NoContext\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    ) {\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 直接进行`fiber构造`\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"      performSyncWorkOnRoot\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 注册调度任务, 经过`Scheduler`包的调度, 间接进行`fiber构造`\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"      ensureRootIsScheduled\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"eventTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 注册调度任务, 经过`Scheduler`包的调度, 间接进行`fiber构造`\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"    ensureRootIsScheduled\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"eventTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h3,{id:\"12输出\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#12输出\",children:e(r.span,{className:\"icon icon-link\"})}),\"1.2输出\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"commitRootImpl\"}),\"源码里就是三个循环，分别代表提交的三个子阶段，执行dom前（\",e(r.code,{children:\"before mutation\"}),\"），执行dom操作（\",e(r.code,{children:\"mutation\"}),\"），执行dom（\",e(r.code,{children:\"layout阶段\"}),\"）后\",e(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiberWorkLoop.old.js%23L1888-L2254\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L1888-L2254\",children:\"源码地址\"})]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// ... 省略部分无关代码\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" commitRootImpl\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"renderPriorityLevel\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 设置局部变量\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" lanes\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedLanes\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 清空FiberRoot对象上的属性\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedLanes\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"NoLanes\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"callbackNode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 提交阶段\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" prevExecutionContext\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"executionContext\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    executionContext\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" |=\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" CommitContext\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 阶段1: dom突变之前\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    do\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"      commitBeforeMutationEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"while\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 阶段2: dom突变, 界面发生改变\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    do\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"      commitMutationEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"renderPriorityLevel\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"while\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 阶段3: layout阶段, 调用生命周期componentDidUpdate和回调函数等\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    do\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"      commitLayoutEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"while\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    executionContext\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevExecutionContext\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"  ensureRootIsScheduled\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"now\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"());\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h2,{id:\"2scheduler\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2scheduler\",children:e(r.span,{className:\"icon icon-link\"})}),\"2.scheduler\"]}),\"\\n\",n(r.h3,{id:\"21输入\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#21输入\",children:e(r.span,{className:\"icon icon-link\"})}),\"2.1.输入\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"scheduleCallback\"}),\"简单的说就是交给这个函数，去注册回调，后面分析提到了\",e(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Fscheduler%2Fsrc%2FScheduler.js%23L279-L359\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/scheduler/src/Scheduler.js#L279-L359\",children:\"源码地址\"})]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 省略部分无关代码\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" unstable_scheduleCallback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"priorityLevel\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"options\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 1. 获取当前时间\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" currentTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" startTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" options\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"'object'\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"options\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 从函数调用关系来看, 在v17.0.2中,所有调用 unstable_scheduleCallback 都未传入options\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 所以省略延时任务相关的代码\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    startTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 2. 根据传入的优先级, 设置任务的过期时间 expirationTime\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" timeout\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  switch\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"priorityLevel\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" ImmediatePriority\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"IMMEDIATE_PRIORITY_TIMEOUT\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      break\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" UserBlockingPriority\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"USER_BLOCKING_PRIORITY_TIMEOUT\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      break\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" IdlePriority\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"IDLE_PRIORITY_TIMEOUT\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      break\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" LowPriority\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"LOW_PRIORITY_TIMEOUT\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      break\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" NormalPriority\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    default\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"NORMAL_PRIORITY_TIMEOUT\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      break\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" expirationTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"startTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"timeout\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 3. 创建新任务\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" newTask\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    id\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"taskIdCounter\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"++,\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    callback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    priorityLevel\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    startTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    expirationTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    sortIndex\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": -\"}),e(r.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"startTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 省略无关代码 v17.0.2中不会使用\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    newTask\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"sortIndex\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"expirationTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 4. 加入任务队列\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"    push\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"newTask\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 5. 请求调度\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"isHostCallbackScheduled\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" && !\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"isPerformingWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      isHostCallbackScheduled\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"true\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"      requestHostCallback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"flushWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" newTask\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h3,{id:\"22执行回调\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#22执行回调\",children:e(r.span,{className:\"icon icon-link\"})}),\"2.2.执行回调\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"performWorkUntilDeadline\"}),\"这个函数是在调度核心里去执行的，\",e(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Fscheduler%2Fsrc%2Fforks%2FSchedulerHostConfig.default.js%23L185-L218\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/scheduler/src/forks/SchedulerHostConfig.default.js#L185-L218\",children:\"源码地址\"})]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" performWorkUntilDeadline\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = () \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 有执行任务\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"scheduledHostCallback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" currentTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 计算一帧的过期时间点\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      deadline\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"yieldInterval\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" hasTimeRemaining\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"true\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      try\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 执行c回调\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" hasMoreWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"scheduledHostCallback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"          hasTimeRemaining\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"          currentTime\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"        );\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 执行完该回调后, 判断后续是否还有其他任务\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"hasMoreWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"          isMessageLoopRunning\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"false\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"          scheduledHostCallback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"        } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 还有其他任务, 推进进入下一个宏任务队列中\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"          port\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"error\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // If a scheduler task throws, exit the current browser task so the\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // error can be observed.\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"        port\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        throw\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" error\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"        \"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      isMessageLoopRunning\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"false\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // Yielding to the browser will give it a chance to paint, so we can\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // reset this.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 重置状态\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    needsPaint\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"false\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h2,{id:\"3react-dom和react基础包\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3react-dom和react基础包\",children:e(r.span,{className:\"icon icon-link\"})}),\"3.react-dom和react基础包\"]}),\"\\n\",e(r.p,{children:\"这两块确实感觉只讲输入和输出不是很合适,因为这两块的重点不是在输入和输出上，感觉前面两个包看懂了再来看这两个包自然就看懂了。\"}),\"\\n\",n(r.h1,{id:\"总结\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#总结\",children:e(r.span,{className:\"icon icon-link\"})}),\"总结\"]}),\"\\n\",n(r.p,{children:[\"学源码确实是一个很枯燥的事情，但是其实挺锻炼逻辑能力和写代码能力的，就感觉每次看完一个框架的源码都是对自己能力的一个大提升，推荐一个渐进顺序vue源码=>react源码=>node交互层源码和一个长期一些我们常用包源码比如p-limit,axios,ajax等之类的。有问题可以+\",e(r.a,{href:\"https://juejin.cn/pin/7172471008291455013\",children:\"联系方式\"}),\"我们一起交流，一起卷，老生常谈一下，不是为了面试去学习，希望大家保持一颗学习去心，和写代码的热情。\"]})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "React源码阅读必知",
          "url": "#react源码阅读必知",
          "items": []
        },
        {
          "title": "开篇",
          "url": "#开篇",
          "items": []
        },
        {
          "title": "版本",
          "url": "#版本",
          "items": []
        },
        {
          "title": "分析版本",
          "url": "#分析版本",
          "items": []
        },
        {
          "title": "基础结构",
          "url": "#基础结构",
          "items": []
        },
        {
          "title": "关注重点",
          "url": "#关注重点",
          "items": []
        },
        {
          "title": "回到源码正题",
          "url": "#回到源码正题",
          "items": [
            {
              "title": "1.react-reconciler",
              "url": "#1react-reconciler",
              "items": [
                {
                  "title": "1.1输入",
                  "url": "#11输入",
                  "items": []
                },
                {
                  "title": "1.2输出",
                  "url": "#12输出",
                  "items": []
                }
              ]
            },
            {
              "title": "2.scheduler",
              "url": "#2scheduler",
              "items": [
                {
                  "title": "2.1.输入",
                  "url": "#21输入",
                  "items": []
                },
                {
                  "title": "2.2.执行回调",
                  "url": "#22执行回调",
                  "items": []
                }
              ]
            },
            {
              "title": "3.react-dom和react基础包",
              "url": "#3react-dom和react基础包",
              "items": []
            }
          ]
        },
        {
          "title": "总结",
          "url": "#总结",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "12.read_react_source_code"
  },
  {
    "slug": "/content/react-source-code/13.react_source_reading(3)",
    "title": "13. React源码阅读(3)-任务调度原理",
    "description": "React源码阅读(3)-任务调度原理",
    "published": true,
    "date": "2022-12-04T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:n,jsxs:e}=arguments[0];function _createMdxContent(r){const c={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",img:\"img\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",...r.components};return e(l,{children:[e(c.h1,{id:\"react源码阅读3-任务调度原理\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react源码阅读3-任务调度原理\",children:n(c.span,{className:\"icon icon-link\"})}),\"React源码阅读(3)-任务调度原理\"]}),\"\\n\",e(c.h1,{id:\"开篇\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#开篇\",children:n(c.span,{className:\"icon icon-link\"})}),\"开篇\"]}),\"\\n\",e(c.p,{children:[n(c.a,{href:\"https://juejin.cn/post/7171454753228980261\",children:\"上一篇文章\"}),\"讲的是\",n(c.code,{children:\"react-reconciler\"}),\"核心fiber构建逻辑，然后这一节就分析一下在注册任务之后的\",n(c.code,{children:\"scheduler\"}),\"调度逻辑，如果你对一个整体框架源码的阅读逻辑有所疑问可以去看看\",n(c.a,{href:\"https://juejin.cn/post/7172468177450827790\",children:\"第一篇文章\"}),\"。然后我们一边去分析源码的时候一边去收集问题，等到最后对源码有个大致的概括了之后，我们再一一去找出问题的答案。\"]}),\"\\n\",e(c.h1,{id:\"思考\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#思考\",children:n(c.span,{className:\"icon icon-link\"})}),\"思考\"]}),\"\\n\",e(c.p,{children:[\"昨天听了一下\",n(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchokcoco\",title:\"https://github.com/chokcoco\",children:\"coco\"}),\"大佬的会，我觉得很值得反思，就是你说看源码把其实只是一个最简单的一部分，很多时候把源码拿过来写点注释他是做什么的并不难，重要的是你思考的过程和到底为什么源码这么做，源码以前的实现方案可能会有什么问题等，我觉得这是一个难能可贵的事情，就前面的文章都是大篇描绘源码在做什么，可能后面的源码理解会更多的带有一些个人感情的思考过程。\"]}),\"\\n\",e(c.h1,{id:\"源码分析\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#源码分析\",children:n(c.span,{className:\"icon icon-link\"})}),\"源码分析\"]}),\"\\n\",e(c.p,{children:[\"首先是调度原理核心这里\",n(c.a,{href:\"https://juejin.cn/post/7167769587054805000\",children:\"可以看\"}),\"这里,感觉这部分其实是完全可以当做一个单独的包来看的，这里我们就不用去讲它了，我们现在去看源码任务调度的实现。\"]}),\"\\n\",e(c.h2,{id:\"1任务队列的管理\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1任务队列的管理\",children:n(c.span,{className:\"icon icon-link\"})}),\"1.任务队列的管理\"]}),\"\\n\",e(c.p,{children:[\"在开始的时候我们定义了两个数组，一个最小顶堆数组，一个延时任务数组。这里我们可以去收集2个问题，\",n(c.strong,{children:\"1\"}),\"：为什么要定义小顶堆数组。\",n(c.strong,{children:\"2\"}),\"：这个延时队列数组是用来干啥的。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// Tasks are stored on a min heap\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = [];\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" timerQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = [];\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"接下来我们书接上文注册任务中\",n(c.code,{children:\"ensureRootIsScheduled\"}),\"的\",n(c.code,{children:\"scheduleCallback\"}),\",这个函数是用来注册回调任务，它接收一个优先级，回调函数（珂里化之后的），以及第三个参数延时回调相关（但实际上我们可以暂时在17里不分析它，因为没用到）。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 省略代码\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" unstable_scheduleCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"priorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"options\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 当前时间\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" options\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'object'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"options\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 忽略代码，延时相关\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //  根据传入的优先级, 设置任务的过期时间expirationTime，这个过期时间指的是超过了这个时间这个回调就必须去执行了，他不能被一直打断。\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" timeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  switch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"priorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" ImmediatePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"IMMEDIATE_PRIORITY_TIMEOUT\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" UserBlockingPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"USER_BLOCKING_PRIORITY_TIMEOUT\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" IdlePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"IDLE_PRIORITY_TIMEOUT\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" LowPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"LOW_PRIORITY_TIMEOUT\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" NormalPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    default\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      timeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NORMAL_PRIORITY_TIMEOUT\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //  创建新任务\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  var\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    id\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskIdCounter\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"++,\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    priorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    sortIndex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": -\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 延时队列相关\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 好这句代码很关键，这有助于帮我们去解决问题1\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    newTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sortIndex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 加入任务队列\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    push\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 请求调度\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isHostCallbackScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && !\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isPerformingWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      isHostCallbackScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      requestHostCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flushWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"紧接着我们就可以走到\",n(c.code,{children:\"requestHostCallback(flushWork)\"}),\",这里那就已经走到那个单独的包里了，注册包里的任务\",n(c.code,{children:\"scheduledHostCallback\"}),\" = \",n(c.code,{children:\"flushWork\"}),\"，那么我们最后执行的实际就是\",n(c.code,{children:\"flushWork\"}),\"，我们就直接去看\",n(c.code,{children:\"flushWork\"}),\"做了些什么。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" flushWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"hasTimeRemaining\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"initialTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 忽略性能统计\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 全局标记已经进入调度阶段了\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  isHostCallbackScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 17.02忽略延迟队列处理\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  isPerformingWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" previousPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  try\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"enableProfiling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      try\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" workLoop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"hasTimeRemaining\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"initialTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"error\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"          const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"          markTaskErrored\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"          currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isQueued\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        throw\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" error\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 消费队列\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" workLoop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"hasTimeRemaining\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"initialTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"finally\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 还原\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    currentPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"previousPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    isPerformingWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 忽略性能统计\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"这整段代码的重点就是控制全局的状态，以及去消费队列，我们可以直接可以看消费队列\",n(c.code,{children:\"workLoop\"}),\"那里。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" workLoop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"hasTimeRemaining\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"initialTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"initialTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 保存当前时间, 用于判断任务是否过期\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"peek\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"); \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 获取队列中的第一个任务\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      (!\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"hasTimeRemaining\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"shouldYieldToHost\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"())\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    ) {\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 虽然currentTask没有过期, 但是执行时间超过了限制，停止继续执行, 让出主线程\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'function'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      currentPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"priorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" didUserCallbackTimeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <= \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 执行回调，我觉得这里的入参是没有上装的功能，因为callback已经强制把root绑定了，这里实际传参数进去挤到第二个去了\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" continuationCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"didUserCallbackTimeout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 回调完成, 判断是否还有连续回调\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" continuationCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'function'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 保留currentTask\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"continuationCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 把currentTask移出队列\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"peek\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"          pop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 如果任务被取消(这时currentTask.callback = null), 将其移出队列\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      pop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 更新currentTask\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"peek\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" true\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 如果task队列没有清空, 返回true. 等待调度中心下一次回调\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" false\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// task队列已经清空, 返回false.\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:\"这里我们需要关注的是有一个点和收集到了一个问题：\"}),\"\\n\",e(c.p,{children:[\"1：循坏中断的条件：每次执行call前会以task来检测是否超时，否则就打断，数组完全被清空的时候也会被打断。 问题\",n(c.strong,{children:\"3\"}),\"： callback的传参问题。\"]}),\"\\n\",n(c.p,{children:\"到这我们已经可以暂时的告于段落了。接下来我们分析问题。\"}),\"\\n\",e(c.h1,{id:\"问题\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#问题\",children:n(c.span,{className:\"icon icon-link\"})}),\"问题\"]}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"问题1\"}),\"：为什么要定义小顶堆数组？\"]}),\"\\n\",e(c.p,{children:[\"先看最小堆的实现 \",n(c.img,{src:\"https://ik.imagekit.io/leiakito/Vue3+ELLnput/React%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%20%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%8E%9F%E7%90%86.webp?updatedAt=1739719076973\",alt:\"image.png\"}),\"首先是选择堆这个不用多说\",n(c.code,{children:\"O(1)\"}),\"的时间复杂度并且任务也确实是一个先进后出的过程，接下来是最小看到代码他每次\",n(c.code,{children:\"push\"}),\"和\",n(c.code,{children:\"pop\"}),\"（实际就是向上和向下的调整）的时候都会以一个过期时间从小到大的顺序（其实没看懂>>>运算符，但应该是一个\",n(c.code,{children:\"O(n)\"}),\"的排序顺算，可以看看\",n(c.a,{href:\"https://juejin.cn/post/7168283003037155359\",children:\"这个\"}),\"）,调整整个堆（\",n(c.code,{children:\"scheduleCallback\"}),\"中去定义了了顺序实际就是时间）的顺序。最后那这其实是为了取出优先级最高的任务，任务中的\",n(c.code,{children:\"expirationTime\"}),\"越小就表示过期时间越近，该任务的优先级就越高。\"]}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"问题2\"}),\"：字面意思，延时队列，时间到了就把任务扔到最小堆队列里面去。但17的源码里应该并不会往延时队列里扔东西进去。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" advanceTimers\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // Check for tasks that are no longer delayed and add them to the queue.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" timer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"peek\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timerQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // Timer was cancelled.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      pop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timerQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"startTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <= \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // Timer fired. Transfer to the task queue.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      pop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timerQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      timer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sortIndex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expirationTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      push\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"taskQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // Remaining timers are pending.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    timer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"peek\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"timerQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"问题3\"}),\"：\",n(c.code,{children:\"callback\"}),\"的传参问题,这个地方我确实没看明白，他传了一个布尔值的参数过去，但实际上这边已经被\",n(c.code,{children:\"bind\"}),\"了一个fiber了~\"]}),\"\\n\",e(c.p,{children:[n(c.img,{src:\"https://ik.imagekit.io/leiakito/Vue3+ELLnput/235158733c9547f99aa8ef6c352a1e2e~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp\",alt:\"image.png\"}),\"\\n\",n(c.img,{src:\"https://ik.imagekit.io/leiakito/Vue3+ELLnput/React%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%20%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%8E%9F%E7%90%86%20(1).webp\",alt:\"image.png\"})]}),\"\\n\",n(c.p,{children:n(c.img,{src:\"https://ik.imagekit.io/leiakito/Vue3+ELLnput/314d8f7facb544ff9cf769d8aee03317~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp\",alt:\"image.png\"})}),\"\\n\",e(c.h1,{id:\"总结\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#总结\",children:n(c.span,{className:\"icon icon-link\"})}),\"总结\"]}),\"\\n\",e(c.p,{children:[\"学源码确实是一个很枯燥的事情，但是其实挺锻炼逻辑能力和写代码能力的，就感觉每次看完一个框架的源码和写完一个都是对自己能力的一个大提升，推荐一个渐进顺序vue源码=>react源码=>node交互层源码和一个长期一些我们常用包源码比如p-limit,axios,ajax等之类的。有问题可以+\",n(c.a,{href:\"https://juejin.cn/pin/7172471008291455013\",children:\"联系方式\"}),\"我们一起交流，一起卷，老生常谈一下，不是为了面试去学习，希望大家保持一颗学习的心，和写代码的热情。\"]})]})}return{default:function(l={}){const{wrapper:e}=l.components||{};return e?n(e,{...l,children:n(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "React源码阅读(3)-任务调度原理",
          "url": "#react源码阅读3-任务调度原理",
          "items": []
        },
        {
          "title": "开篇",
          "url": "#开篇",
          "items": []
        },
        {
          "title": "思考",
          "url": "#思考",
          "items": []
        },
        {
          "title": "源码分析",
          "url": "#源码分析",
          "items": [
            {
              "title": "1.任务队列的管理",
              "url": "#1任务队列的管理",
              "items": []
            }
          ]
        },
        {
          "title": "问题",
          "url": "#问题",
          "items": []
        },
        {
          "title": "总结",
          "url": "#总结",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "13.react_source_reading(3)"
  },
  {
    "slug": "/content/react-source-code/14.react_source_reading(4)_top",
    "title": "14. React源码阅读(4)-支线(函数式组件)-构建细节以及更新（上）",
    "description": "React源码阅读(4)-支线(函数式组件)-构建细节以及更新（上）",
    "published": true,
    "date": "2022-12-05T00:00:00.000Z",
    "body": "const{Fragment:n,jsx:l,jsxs:e}=arguments[0];function _createMdxContent(r){const c={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",img:\"img\",p:\"p\",pre:\"pre\",span:\"span\",...r.components};return e(n,{children:[e(c.h1,{id:\"react源码阅读4-支线函数式组件-构建细节以及更新上\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react源码阅读4-支线函数式组件-构建细节以及更新上\",children:l(c.span,{className:\"icon icon-link\"})}),\"React源码阅读(4)-支线(函数式组件)-构建细节以及更新（上）\"]}),\"\\n\",e(c.p,{children:[\"本文主要围绕 React 源码中函数式组件的构建和更新展开。先介绍了 \",l(c.code,{children:\"beginWork\"}),\" 中设置是否更新的状态，接着讲解 \",l(c.code,{children:\"updateFunctionComponent\"}),\" 的相关操作，包括处理 \",l(c.code,{children:\"hooks\"}),\" 前的准备、判断是否更新等。还提到 \",l(c.code,{children:\"hooks\"}),\" 的三个阶段及执行过程，下一篇将深入函数内部实现等内容。\"]}),\"\\n\",l(c.p,{children:\"关联问题: 函数式组件更新细节？ hooks 如何影响更新？ fiber 构建后续怎样？\"}),\"\\n\",l(c.p,{children:\"AI智能总结首次生成速度较慢, 请耐心等待\"}),\"\\n\",e(c.h1,{id:\"开篇\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#开篇\",children:l(c.span,{className:\"icon icon-link\"})}),\"开篇\"]}),\"\\n\",e(c.p,{children:[\"好了，前面我们已经分析了主流程上fiber的构建和调度，这时候我们就可以去接下来关注更新了，题目谈到了支线，为什么这么说，因为当我们走到\",l(c.code,{children:\"beginWork\"}),\"时组件更新和构建有特别多的分支在\",l(c.code,{children:\"beginWork\"}),\"中，我们只关注一些主流的分支，就先讲讲我们最常用的函数式组件的更新和构建。\",l(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiberBeginWork.old.js%23L3083-L3494\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberBeginWork.old.js#L3083-L3494\",children:\"源码地址\"})]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"switch\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 忽略代码\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 函数式组件的子节点构建\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" FunctionComponent\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" Component\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" unresolvedProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" resolvedProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" =\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"        workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"elementType\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"Component\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"          ?\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" unresolvedProps\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"          :\"}),l(c.span,{style:{color:\"#00DAEF\"},children:\" resolveDefaultProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"Component\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"unresolvedProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),l(c.span,{style:{color:\"#00DAEF\"},children:\" updateFunctionComponent\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"        current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"        workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"        Component\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"        resolvedProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"        renderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 忽略代码\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.h1,{id:\"更新分析\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#更新分析\",children:l(c.span,{className:\"icon icon-link\"})}),\"更新分析\"]}),\"\\n\",e(c.p,{children:[\"我们跟着源码\",l(c.code,{children:\"beginWork\"}),\"的逻辑走，\",l(c.code,{children:\"beginWork\"}),\"探寻阶段在进入的时候，就主要会做一件事件，设置是否需要更新的状态，而这个状态是我们后面许多代码判断的基础。\"]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"if\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 双缓存机制\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" oldProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" newProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 不相等就进入对比\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"      oldProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"newProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" ||\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#00DAEF\"},children:\"      hasLegacyContextChanged\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"() ||\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"      (\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"__DEV__\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" :\"}),l(c.span,{style:{color:\"#FFD493\"},children:\" false\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"    ) {\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 状态标记需要更新这个状态，记住这个状态后续很多工作都与之相关\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"      didReceiveUpdate\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 如果渲染车道内不包含更新就不需要更新\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" if\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),l(c.span,{style:{color:\"#00DAEF\"},children:\"includesSomeLane\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"      didReceiveUpdate\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 上下文特殊处理，优化\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"      switch\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") {}\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 循坏子节点需要更新不\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),l(c.span,{style:{color:\"#00DAEF\"},children:\" bailoutOnAlreadyFinishedWork\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" ((\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"ForceUpdateForLegacySuspense\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") !== \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"NoFlags\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 处理Suspense组件不会Context更新时更新的问题强制将标记变为true。\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"        didReceiveUpdate\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // An update was scheduled on this fiber, but there are no new props\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // nor legacy context. Set this to false. If an update queue or context\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // consumer produces a changed value, it will set this to true. Otherwise,\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // the component will assume the children have not changed and bail out.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"        didReceiveUpdate\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 剩下的就是都不需要更新\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"    didReceiveUpdate\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"可以看到上面做的许多事情都是为了设置一个状态，之后剩下的逻辑就走到了上一张图，也就是我们可以知道一件事情，就是实际上更新和初次构建大多数情况下是复用一套的。再讲下一步\",l(c.code,{children:\"updateFunctionComponent\"}),\"前我们先回顾一下前面的知识也就是\",l(c.code,{children:\"beginwork\"}),\"是去进行一个\",l(c.code,{children:\"reactElement\"}),\"子节点的构建和\",l(c.code,{children:\"fiber\"}),\"子节点构建并返回\",l(c.code,{children:\"fiber\"}),\"子节点，也就是\",l(c.code,{children:\"updateXXX\"}),\"基本都会做的事情，这里的\",l(c.code,{children:\"updateFunctionComponent\"}),\"也做了这样的操作。\"]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),l(c.span,{style:{color:\"#00DAEF\"},children:\" updateFunctionComponent\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  Component\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  nextProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  renderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 忽略代码\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" context\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" nextChildren\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 这里和useContext有关，hooks分支中我们去讲一下\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#00DAEF\"},children:\"  prepareToReadContext\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"__DEV__\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    //忽略代码\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 这里就直接进入了hooks相关逻辑，最后返回下级ReactElement对象\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextChildren\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#00DAEF\"},children:\"renderWithHooks\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"      current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"      workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"      Component\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"      nextProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"      context\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"      renderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"    );\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 老规矩，如果didReceiveUpdate这个状态也就是前面提到的不需要更新，向下查找子节\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" && !\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"didReceiveUpdate\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#00DAEF\"},children:\"    bailoutHooks\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),l(c.span,{style:{color:\"#00DAEF\"},children:\" bailoutOnAlreadyFinishedWork\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // React DevTools reads this flag.我们暂时都略过performance的东西\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" |=\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" PerformedWork\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 向下生成子fiber节点\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#00DAEF\"},children:\"  reconcileChildren\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"nextChildren\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.h2,{id:\"hook分支\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#hook分支\",children:l(c.span,{className:\"icon icon-link\"})}),\"hook分支\"]}),\"\\n\",e(c.p,{children:[\"当我们看到这的时候，就已经不知不觉要讲到\",l(c.code,{children:\"hooks\"}),\"，我先谈谈的我的思考和理解把：其实去对比了一下其他组件，函数式组件应该算是比较特殊的一种组件，在这里我犹豫了很久要不要把\",l(c.code,{children:\"hooks\"}),\"单独拉出去再写一篇文章因为这一块确实用个成语说是浓墨重彩,很多的面试题以及我们的使用都是围绕\",l(c.code,{children:\"hooks\"}),\"，但我觉得不！！！我觉得我应该把它放平，它本质仅仅只是一个为了控制\",l(c.code,{children:\"fiber\"}),\"节点以及\",l(c.code,{children:\"副作用\"}),\"提交时提供的一套\",l(c.code,{children:\"维护机制或者说控制机制模块\"}),\"（我这抽象概念是真不行啊）,它本来也就只是属于整个\",l(c.code,{children:\"fiber\"}),\"构建流程的一个\",l(c.code,{children:\"部分或者分支\"}),\"而已。这里先把一些数据结构和变量的东西放在\",l(c.a,{href:\"https://juejin.cn/editor/drafts/7168235835324628999\",children:\"fiber的强相关总结中\"}),\"，可以对照着看有助于理解接下来的部分（其实我也是一边看总结的变量和数据结构一边分析源码，变量太多了记不住）,当然我们的视角还是以fiber为主。\"]}),\"\\n\",e(c.p,{children:[\"好我们步入正题，进入到\",l(c.code,{children:\"hooks\"}),\"的开始\",l(c.code,{children:\"renderWithHooks\"})]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),l(c.span,{style:{color:\"#00DAEF\"},children:\" renderWithHooks\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Props\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"SecondArg\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null,\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#00DAEF\"},children:\"  Component\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": (\"}),l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"p\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Props\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"arg\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"SecondArg\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  props\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Props\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  secondArg\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"SecondArg\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  nextRenderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Lanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 1阶段：去设置全局的状态\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  renderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"nextRenderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 当前渲染优先级\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  currentlyRenderingFiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 当前fiber节点, 也就是function组件对应的fiber节点\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"__DEV__\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    //忽略代码\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 清除当前fiber的遗留状态\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"NoLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"   if\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"__DEV__\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    //忽略代码\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"   } \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 2阶段：生成ReactElement子节点\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // ReactCurrentDispatcher来自react-dom中的全局变量，确认是初始化还是更新\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"      ReactCurrentDispatcher\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" =\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"        current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"          ?\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" HooksDispatcherOnMount\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"          :\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" HooksDispatcherOnUpdate\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 执行function函数\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"      let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" children\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#00DAEF\"},children:\"Component\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"secondArg\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"   }\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 重置全局变量,并返回\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 执行function之后, 还原被修改的全局变量, 不影响下一次调用\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  renderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"NoLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#00DAEF\"},children:\"  currentlyRenderingFiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"  currentHook = null;\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"  workInProgressHook = null;\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"  didScheduleRenderPhaseUpdate = false;\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"  return children;\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",l(c.p,{children:\"这里就是分为了3个阶段：\"}),\"\\n\",e(c.p,{children:[\"第一个阶段：设置全局变量，让\",l(c.code,{children:\"currentlyRenderingFiber\"}),\"的指针暂时指向于当前任务，然后清除那里我们可以思考一下，我的答案是如果后面在其实地方给例如：\",l(c.code,{children:\"useState\"}),\"中的\",l(c.code,{children:\"updateState\"}),\"这些属性设置了值，那么我们就需要在下一次更新或者构建的时候先清除这些状态，再去重新赋值。\"]}),\"\\n\",e(c.p,{children:[\"第二个阶段：确定了到底是调用更新方法还是初始化方法，然后这里的\",l(c.code,{children:\"Component\"}),\"函数实际上就是，我们在写代码里的函数式组件，然后这个可以提一下(在前面的传参中type，实际上是在react-dom中，把函数存储在type属性上，这仅仅只是\",l(c.code,{children:\"function\"}),\", \",l(c.code,{children:\"class\"}),\", \",l(c.code,{children:\"ForwardRef\"}),\"的特殊处理)。\"]}),\"\\n\",l(c.p,{children:\"第三个阶段：重置变量。\"}),\"\\n\",e(c.p,{children:[l(c.code,{children:\"执行过程\"}),\"：\",l(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fcodesandbox.io%2Fs%2Fjovial-hill-idlc7g%3Ffile%3D%2Fsrc%2FApp.tsx\",title:\"https://codesandbox.io/s/jovial-hill-idlc7g?file=/src/App.tsx\",children:\"在线尝试\"})]}),\"\\n\",e(c.p,{children:[\"打了一下打断点,简单说一下整个的调用过程，首先当我们的组件初始化进入到\",l(c.code,{children:\"beginWork\"}),\"的时候,对于第一次执行的函数组件，react不知道他是函数组件还是普通函数，统统转为\",l(c.code,{children:\"indeterminateComponent\"}),\"，即不清楚的\",l(c.code,{children:\"component\"}),\",然后这里会执行\",l(c.code,{children:\"renderWithHooks\"}),\"，执行完这之后才会打上\",l(c.code,{children:\"Fucntion\"}),\"的标记然后在我们\",l(c.code,{children:\"Update\"}),\"更新的时候就不会走\",l(c.code,{children:\"indeterminateComponent\"}),\"的逻辑了，而是会走到\",l(c.code,{children:\"updateFunctionComponent\"}),\"的逻辑。\"]}),\"\\n\",e(c.p,{children:[l(c.img,{src:\"https://ik.imagekit.io/leiakito/Vue3+ELLnput/React%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%20%E6%94%AF%E7%BA%BF%20%E7%BB%84%E4%BB%B6%20%E6%9E%84%E5%BB%BA%E7%BB%86%E8%8A%82.webp?updatedAt=1739720712530\",alt:\"image.png\"}),\"\\n\",l(c.img,{src:\"https://ik.imagekit.io/leiakito/Vue3+ELLnput/923c00657040409ba6031935d913a946~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp?updatedAt=1739720711840\",alt:\"image.png\"})]}),\"\\n\",e(c.h1,{id:\"总结\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#总结\",children:l(c.span,{className:\"icon icon-link\"})}),\"总结\"]}),\"\\n\",e(c.p,{children:[\"这一篇就暂时先只讲到调用\",l(c.code,{children:\"Component\"}),\"也就是调用函数，而下一篇会讲到进入\",l(c.code,{children:\"Component\"}),\"函数中具体API的实现，以及是如何控制fiber的，以及算法。\"]})]})}return{default:function(n={}){const{wrapper:e}=n.components||{};return e?l(e,{...n,children:l(_createMdxContent,{...n})}):_createMdxContent(n)}};",
    "toc": {
      "content": [
        {
          "title": "React源码阅读(4)-支线(函数式组件)-构建细节以及更新（上）",
          "url": "#react源码阅读4-支线函数式组件-构建细节以及更新上",
          "items": []
        },
        {
          "title": "开篇",
          "url": "#开篇",
          "items": []
        },
        {
          "title": "更新分析",
          "url": "#更新分析",
          "items": [
            {
              "title": "hook分支",
              "url": "#hook分支",
              "items": []
            }
          ]
        },
        {
          "title": "总结",
          "url": "#总结",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "14.react_source_reading(4)_top"
  },
  {
    "slug": "/content/react-source-code/15.react_source_reading(4)_middle",
    "title": "15.React源码阅读(4)-支线(函数式组件)-构建细节以及更新（中）",
    "description": "React源码阅读(4)-支线(函数式组件)-构建细节以及更新（中））",
    "published": true,
    "date": "2022-12-06T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(r){const c={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",h3:\"h3\",img:\"img\",p:\"p\",pre:\"pre\",span:\"span\",...r.components};return n(l,{children:[n(c.h1,{id:\"react源码阅读4-支线函数式组件-构建细节以及更新中\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react源码阅读4-支线函数式组件-构建细节以及更新中\",children:e(c.span,{className:\"icon icon-link\"})}),\"React源码阅读(4)-支线(函数式组件)-构建细节以及更新（中）\"]}),\"\\n\",e(c.p,{children:\"文章主要介绍了 React 函数式组件中 State Hook 的构建细节和更新。包括 useState 和 useReducer 两个 API，讲解了它们的初始化、更新函数及相关流程，如 mountState、updateState、mountReducer 等，还提及了 hook 作为链表节点、链表的构建及相关操作，最后指出搞懂 State Hook 对后续理解 effect hook 和 ref hook 有帮助。\"}),\"\\n\",e(c.p,{children:\"关联问题: useReducer如何优化 State Hook更新原理 hooks链表如何运作\"}),\"\\n\",e(c.p,{children:\"AI智能总结首次生成速度较慢, 请耐心等待\"}),\"\\n\",n(c.h1,{id:\"开篇\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#开篇\",children:e(c.span,{className:\"icon icon-link\"})}),\"开篇\"]}),\"\\n\",n(c.p,{children:[\"回顾一下，在构建细节和更新（上）中我们已经到了进入函数式组件\",e(c.code,{children:\"Component\"}),\",接下来我们就可以展开\",e(c.code,{children:\"hooks\"}),\"讲，去看一下\",e(c.code,{children:\"hooks\"}),\"是怎样处理更新操作。首先我们探讨一下，\",e(c.code,{children:\"hooks\"}),\"在官网的定义中其实分为了两类，状态\",e(c.code,{children:\"State Hook\"}),\"和副作用\",e(c.code,{children:\"Effect Hook\"}),\"但我觉得可以再加一类那就是\",e(c.code,{children:\"Ref hook\"}),\"，我们其实可以从\",e(c.code,{children:\"fiber\"}),\"中定义的属性来分析\",e(c.a,{href:\"https://juejin.cn/post/7168243099670413320\",children:\"对照链接-3.fiber中Hooks强相关\"}),\"，\",e(c.code,{children:\"State Hook\"}),\"其实很好理解就是能实现一个数据持久化且不会有副作用的\",e(c.code,{children:\"hook\"}),\"。而\",e(c.code,{children:\"Effect Hook\"}),\"指的就是，影响fiber节点副作用属性，会直接影响到最后\",e(c.code,{children:\"commit\"}),\"操作的函数。总的来说\",e(c.code,{children:\"api\"}),\"的最终指向是修改\",e(c.code,{children:\"fiber\"}),\"中的状态和副作用，从而改变整个渲染的过程和结果。\"]}),\"\\n\",n(c.p,{children:[\"我们这里理清一个概念，为了方便理解把，这里我们讲到的\",e(c.code,{children:\"hook\"}),\"指的链表上的一个节点，\",e(c.code,{children:\"fiber.memoizedState\"}),\"是一整个链表,\",e(c.code,{children:\"hooks\"}),\"是函数式组件的维护器控制器。\"]}),\"\\n\",n(c.h1,{id:\"state-hook\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#state-hook\",children:e(c.span,{className:\"icon icon-link\"})}),\"State Hook\"]}),\"\\n\",n(c.p,{children:[\"我们先讲状态\",e(c.code,{children:\"hook\"}),\"打开\",e(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fcodesandbox.io%2Fs%2Fjovial-hill-idlc7g%3Ffile%3D%2Fsrc%2FApp.tsx\",title:\"https://codesandbox.io/s/jovial-hill-idlc7g?file=/src/App.tsx\",children:\"在线调试\"}),\"（需要科学上网），再对照着我们的\",e(c.a,{href:\"https://juejin.cn/editor/drafts/7168235835324628999\",children:\"属性总结对照表\"}),\"先讲一下数据结构，\",e(c.code,{children:\"fiber\"}),\"上的\",e(c.code,{children:\"memoizedState\"}),\"存储的是\",e(c.code,{children:\"hook\"}),\"形成的链表，\",e(c.code,{children:\"hook\"}),\"本身代表节点，\",e(c.code,{children:\"hook\"}),\"中有一个更新队列\",e(c.code,{children:\"queue\"}),\"和基队列\",e(c.code,{children:\"baseQuene\"}),\"这2个队列通常是\",e(c.code,{children:\"queue\"}),\" => \",e(c.code,{children:\"baseQuene\"}),\",而\",e(c.code,{children:\"queue\"}),\"中的\",e(c.code,{children:\"pending\"}),\"又是一个环形链表\",e(c.code,{children:\"update\"}),\"是属于\",e(c.code,{children:\"pending\"}),\"的节点,而这里我先讲2个状态\",e(c.code,{children:\"hook\"}),\"，\",e(c.code,{children:\"useState\"}),\"和\",e(c.code,{children:\"useReducer\"}),\"。\"]}),\"\\n\",n(c.h2,{id:\"1usestate\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1usestate\",children:e(c.span,{className:\"icon icon-link\"})}),\"1、useState\"]}),\"\\n\",n(c.p,{children:[\"这个api实际上也被分为了2个函数\",e(c.code,{children:\"mountState\"}),\"和\",e(c.code,{children:\"updateState\"}),\"，会在初始化和对比更新分别调用，可以看上一篇文章。\"]}),\"\\n\",n(c.h3,{id:\"11-mountstate\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#11-mountstate\",children:e(c.span,{className:\"icon icon-link\"})}),\"1.1 mountState\"]}),\"\\n\",n(c.p,{children:[\"通过调试当我们走到\",e(c.code,{children:\"reconciler\"}),\"初次构建是使用的\",e(c.code,{children:\"mountState\"}),\",更新是\",e(c.code,{children:\"updateState\"}),\",可以关注前文里讲到的在\",e(c.code,{children:\"renderWithHooks\"}),\"函数中确定更新和初始化的\",e(c.code,{children:\"ReactCurrentDispatcher\"}),\"。\",e(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiberHooks.old.js%23L1113-L1136\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L1113-L1136\",children:\"源码链接\"})]}),\"\\n\",n(c.p,{children:[e(c.img,{src:\"https://ik.imagekit.io/leiakito/Vue3+ELLnput/50f16ef5110c4d4db89b11517ef60c44~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp?updatedAt=1739721309869\",alt:\"image.png\"}),\"\\n我们进入到\",e(c.code,{children:\"mountState\"}),\"，有一个很重要的函数\",e(c.code,{children:\"mountWorkInProgressHook\"}),\"，因为在初始化一系列api中都会走到\",e(c.code,{children:\"mountWorkInProgressHook\"}),\"这个函数去创建\",e(c.code,{children:\"hook\"}),\"并挂载到\",e(c.code,{children:\"Fiber\"}),\"上的\",e(c.code,{children:\"memoizedState\"}),\"上，不管是\",e(c.code,{children:\"State Hook\"}),\"还是\",e(c.code,{children:\"Effect Hook\"}),\"或者\",e(c.code,{children:\"Ref hook\"}),\"，都会按照调用顺序，来构建出一个个\",e(c.code,{children:\"hook\"}),\"存储在\",e(c.code,{children:\"memoizedState\"}),\"链表中，这也是我们无法去在\",e(c.code,{children:\"hooks\"}),\"上写判断的原因。中间有一个初始化\",e(c.code,{children:\"baseState\"}),\"和\",e(c.code,{children:\"hook.memoizedState\"}),\"的操作\",e(c.code,{children:\"memoizedState\"}),\"在状态\",e(c.code,{children:\"hook\"}),\"中就是表示当前的状态，\",e(c.code,{children:\"baseState\"}),\"是用来合并链表操作使用的,最终返回了\",e(c.code,{children:\"hook\"}),\"中的\",e(c.code,{children:\"memoizedState\"}),\"初始值和\",e(c.code,{children:\"dispatch\"}),\"提交函数。接下来我们就分析一下\",e(c.code,{children:\"dispatchAction\"}),\"这个函数的调用。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" mountState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": (() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") | \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"): [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"BasicStateAction\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">>] {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 创建链表和里面的属性\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"mountWorkInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'function'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 值\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 刚创建里面的属性都为Null，这时候进行初始化，设置hook.memoizedState/hook.baseState\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 设置更新队列\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    lastRenderedReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"basicStateReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//这是内置Reducer\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"    lastRenderedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  });\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 设置hook dispatch函数，实际就是调用dispatchAction，在开始就珂里化一下\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  const\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    BasicStateAction\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">,\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  > = (queue.\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"dispatchAction\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"bind\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#FFD493\"},children:\"    null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    currentlyRenderingFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  ): \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"));\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 返回当前状态以及dispatch修改状态的函数\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  return [\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"hook.memoizedState, dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"]\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#4BF3C8\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 创建hook\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"function mountWorkInProgressHook()\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  const \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    memoizedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    baseState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 链首的hook\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    currentlyRenderingFiber.\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 将hook指向链尾\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  return\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"dispatchAction\"}),\"更新，我们关注4个阶段\"]}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"阶段1\"}),\"：初始化环形链表的\",e(c.code,{children:\"update\"}),\"节点。\"]}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"阶段2\"}),\"：创建\",e(c.code,{children:\"queue.pending\"}),\"环形链表，设置节点的指向。\"]}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"阶段3\"}),\"：性能优化，这里调用了上个函数传来的\",e(c.code,{children:\"lastRenderedReducer\"}),\"最终的调用是在\",e(c.code,{children:\"basicStateReducer\"}),\"，这只是一个内置的处理函数返回值或者返回回调函数处理的值。\"]}),\"\\n\",n(c.p,{children:[e(c.img,{src:\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/adceeda00c254069aab06dc2b08b4c4b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?\",alt:\"image.png\"}),\" \",e(c.code,{children:\"阶段4\"}),\"：进入调度。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" dispatchAction\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  fiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"UpdateQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">,\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  action\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 1、 创建update节点\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" eventTime\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"requestEventTime\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" lane\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"requestUpdateLane\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"); \"}),e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// Legacy模式返回SyncLane\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"> = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    lane\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    action\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    eagerReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    eagerState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"    next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 2. 确定环形链表的指向\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  const\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 头节点\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    update.\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    update.\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    pending.\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  const\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" alternate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    fiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentlyRenderingFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" ||\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentlyRenderingFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  ) {\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 改变全局状态\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    didScheduleRenderPhaseUpdateDuringThisPass\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"didScheduleRenderPhaseUpdate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 3.性能优化\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 判断是否为第一个update\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"    if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      fiber.lanes === \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"NoLanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"alternate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" || alternate.lanes === \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"NoLanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    ) {\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" lastRenderedReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"lastRenderedReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"lastRenderedReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"        let\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" prevDispatcher\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"        try\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"         // 临时变量得到更新前的state\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"          const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" currentState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"lastRenderedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 得到更新后的state\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"          const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" eagerState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"lastRenderedReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"action\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 将当前更新节点的最新提交函数和状态指向改变，也是一个优化，是在render阶段的优化，会判断\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // reducer update.eagerReducer相等就不用计算\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"eagerReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"lastRenderedReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"eagerState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"eagerState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"          if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"is\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"eagerState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"            // 如果更新前合后的值是相等的就不需要调度了\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"            return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"          }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"error\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // Suppress the error. It will throw again in the render phase.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"        } \"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 4.发起调度更新, 进入reconciler运作流程中的输入阶段.\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"    scheduleUpdateOnFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"lane\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"eventTime\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.h3,{id:\"12updatestate\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#12updatestate\",children:e(c.span,{className:\"icon icon-link\"})}),\"1.2.updateState\"]}),\"\\n\",n(c.p,{children:[\"当我们组件更新的时候会走到\",e(c.code,{children:\"updateState\"})]}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/Vue3+ELLnput/React%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%20%E6%94%AF%E7%BA%BF%20%E7%BB%86%E8%8A%82%E6%9B%B4%E6%96%B0%20(1).webp?updatedAt=1739720984167\",alt:\"image.png\"})}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" updateState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": (() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") | \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"): [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"BasicStateAction\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">>] {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" updateReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"basicStateReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"));\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"我们前面文章分析了一下调用过程，就是第一次初始化此时并不是走的函数式组件的\",e(c.code,{children:\"case\"}),\",而是走的\",e(c.code,{children:\"IndetermiateComponent\"}),\"不确定组件，他调用\",e(c.code,{children:\"useState\"}),\"的时候初始化对应的是\",e(c.code,{children:\"mountState\"}),\"，而我们第二次去更新的时候因为\",e(c.code,{children:\"tag\"}),\"已经被打上标记了，我们此时就会走到\",e(c.code,{children:\"函数式组件\"}),\"更新，此时\",e(c.code,{children:\"useState\"}),\"对应的则是\",e(c.code,{children:\"updateState\"}),\"，然后我们的更新的函数\",e(c.code,{children:\"updateState\"}),\"的返回值是\",e(c.code,{children:\"updateReducer\"}),\"将更新的值和内置的提交函数传进去。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" updateReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"I\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"  reducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  initialArg\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"I\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  init\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"?\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"I\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"): [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">] {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 1. 通过next指针拿到hook对象，每进来一次就拿下一个\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"updateWorkInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 更新提交函数\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"lastRenderedReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"reducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 渲染数上的hook\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" current\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"currentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 被打断的情况下，上次还没有完成的update\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 2. 链表拼接: 将 hook.queue.pending 拼接到 current.baseQueue\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //待执行的update\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" pendingQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //下面的整个过程都是链表拼接\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" baseFirst\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" pendingFirst\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingFirst\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      pendingQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseFirst\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 可能发生一个更高优先级任务打断当前任务的执行 \"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 所以要将 baseQueue 也赋值给 current fiber\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    current\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 3. 状态计算\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" first\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" newState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" newBaseState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" newBaseQueueFirst\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" newBaseQueueLast\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"first\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 计算state\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    do\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" updateLane\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"lane\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 优先级提取update\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"isSubsetOfLanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"updateLane\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 优先级不够: 加入到baseQueue中, 等待下一次render再执行这次的update\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" clone\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"> = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          lane\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"updateLane\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          action\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"action\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          eagerReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"eagerReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          eagerState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"eagerState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"          next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"        };\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 把update放到下一次执行\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        if (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"newBaseQueueLast\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          newBaseQueueFirst\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newBaseQueueLast\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"clone\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          newBaseState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        } \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          newBaseQueueLast\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newBaseQueueLast\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"clone\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 更新优先级（mergeLanes优先级转换）\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"        currentlyRenderingFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"mergeLanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          currentlyRenderingFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          updateLane\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"        );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 优先级足够: 状态合并\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"        if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"newBaseQueueLast\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 更新baseQueue\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // update\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"          const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" clone\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"> = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"            lane\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"NoLane\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"            action\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"action\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"            eagerReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"eagerReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"            eagerState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"eagerState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"            next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"          };\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"          newBaseQueueLast = newBaseQueueLast.next = clone;\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 执行这次的update,计算新state\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        if (update.eagerReducer === \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"reducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 性能优化: 相等直接取算出来的state\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          newState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = ((\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"eagerState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        } \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 计算新的\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"          const \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"action\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"action\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 调用reducer获取最新状态\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"          newState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"reducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"action\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    } while (update !== null && update !== first);\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 更新属性\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"    if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"newBaseQueueLast\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // newBaseQueueLast已经为空，更新baseState\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      newBaseState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    } else {\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 未处理完下次执行\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      newBaseQueueLast\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"newBaseQueueFirst\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    if (!\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"is\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"newState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", hook.memoizedState)) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"      markWorkInProgressReceivedUpdate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 把计算之后的结果更新\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newBaseState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newBaseQueueLast\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"lastRenderedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  const \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"> = (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:\"这整个函数有三个阶段\"}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"一阶段\"}),\"：\",e(c.code,{children:\"updateWorkInProgressHook\"}),\" 的作用主要是取出页面fiber树中的 hooks 链表中对应的 hook 节点，挂载到 workInProgress fiber 上的 hooks 链表。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" updateWorkInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(): \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" nextCurrentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": null | \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 页面fiber树的Hook\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 若 current 为 null，从 currentlyRenderingFiber.alternate 取 current\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" current\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentlyRenderingFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      nextCurrentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      nextCurrentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 否则从 current fiber 中取下一个 hook\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextCurrentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 迭代 workInProgress fiber 链表\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" nextWorkInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": null | \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // workInProgressHook 说明是首次创建\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextWorkInProgressHook\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" 为\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentlyRenderingFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 取下一个 workInProgress Hook\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextWorkInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"nextWorkInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 只有 re-render 的情况下，nextWorkInProgressHook 不为 null，因为在之前的 render 过程中已经创建过 workInProgress hook了\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"nextWorkInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextWorkInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    currentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"nextCurrentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 正常情况下，currentlyRenderingFiber.memoizedState 为 null，需要到从 current fiber 中克隆一个新的创建\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"    invariant\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      nextCurrentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#FFD493\"},children:\"      'Rendered more hooks than during the previous render.'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    currentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"nextCurrentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" newHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      memoizedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      baseState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"baseQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    };\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 若 workInProgressHook 为 null，作为首节点赋值给 memoizedState\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      currentlyRenderingFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 将 workInProgressHook 添加到链表尾\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"      workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"二阶段：\"}),\"链表拼接，将\",e(c.code,{children:\"queue.pending\"}),\"拼接到\",e(c.code,{children:\"current.baseQueue\"})]}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"三阶段\"}),\": 状态计算优化。\"]}),\"\\n\",n(c.h2,{id:\"2usereducer\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2usereducer\",children:e(c.span,{className:\"icon icon-link\"})}),\"2、useReducer\"]}),\"\\n\",n(c.p,{children:[\"它和useState的实现几乎是完全一样的，都是负责创建\",e(c.code,{children:\"hook\"}),\"初始化等，但唯一的不同就是它的\",e(c.code,{children:\"reducer\"}),\"是由外部传入的，刚刚我们看到的\",e(c.code,{children:\"useState\"}),\"的\",e(c.code,{children:\"reducer\"}),\"是一个内置的\",e(c.code,{children:\"reducer\"}),\"。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" mountReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"I\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"  reducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  initialArg\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"I\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  init\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"?\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"I\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"): [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">] {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"mountWorkInProgressHook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"init\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"init\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"initialArg\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = ((\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"initialArg\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#FFD493\"},children:\"  hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"memoizedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"baseState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  const\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    lastRenderedReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"reducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"    lastRenderedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"initialState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  });\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  const\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"> = (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"dispatchAction\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"bind\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#FFD493\"},children:\"    null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    currentlyRenderingFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    queue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  ): \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"));\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"hook\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"他们两个也都是可以互相转换的，看个例子,这两者是等价的，只是说提交的时候只能通过\",e(c.code,{children:\"type\"}),\"提交\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"state\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"count\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" })\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"state\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"dispatch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useReducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" reducer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"state\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"action\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    switch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"action\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"      case\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'increment'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"count\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"state\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"count\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" };\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"      case\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'decrement'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"count\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"state\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"count\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" - \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" };\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"      default\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"        throw\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" new\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" Error\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"count\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.h1,{id:\"总结\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#总结\",children:e(c.span,{className:\"icon icon-link\"})}),\"总结\"]}),\"\\n\",n(c.p,{children:[\"到这里基本的\",e(c.code,{children:\"State Hook\"}),\",就已经告一段落了，这一节搞懂了，后面的\",e(c.code,{children:\"effect hook\"}),\"以及\",e(c.code,{children:\"ref hook\"}),\"都会非常轻松。看不懂有问题可以+\",e(c.a,{href:\"https://juejin.cn/pin/7172471008291455013\",children:\"联系方式\"}),\"我们一起交流，一起卷，或者觉得文章有哪些地方可以改进的欢迎交流。\"]})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "React源码阅读(4)-支线(函数式组件)-构建细节以及更新（中）",
          "url": "#react源码阅读4-支线函数式组件-构建细节以及更新中",
          "items": []
        },
        {
          "title": "开篇",
          "url": "#开篇",
          "items": []
        },
        {
          "title": "State Hook",
          "url": "#state-hook",
          "items": [
            {
              "title": "1、useState",
              "url": "#1usestate",
              "items": [
                {
                  "title": "1.1 mountState",
                  "url": "#11-mountstate",
                  "items": []
                },
                {
                  "title": "1.2.updateState",
                  "url": "#12updatestate",
                  "items": []
                }
              ]
            },
            {
              "title": "2、useReducer",
              "url": "#2usereducer",
              "items": []
            }
          ]
        },
        {
          "title": "总结",
          "url": "#总结",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "15.react_source_reading(4)_middle"
  },
  {
    "slug": "/content/react-source-code/16.react_source_reading(4)_down",
    "title": "16.React源码阅读(4)-支线(函数式组件)-构建细节以及更新（下）",
    "description": "React源码阅读(4)-支线(函数式组件)-构建细节以及更新（下）",
    "published": true,
    "date": "2022-12-08T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(c){const r={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",p:\"p\",pre:\"pre\",span:\"span\",...c.components};return n(l,{children:[n(r.h1,{id:\"react源码阅读4-支线函数式组件-构建细节以及更新下\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react源码阅读4-支线函数式组件-构建细节以及更新下\",children:e(r.span,{className:\"icon icon-link\"})}),\"React源码阅读(4)-支线(函数式组件)-构建细节以及更新（下）\"]}),\"\\n\",n(r.p,{children:[\"文章主要围绕 React 源码中函数式组件的支线内容展开，详细分析了 Effect Hook 的构建细节及更新，包括 \",e(r.code,{children:\"useEffect\"}),\" 和 \",e(r.code,{children:\"useLayoutEffect\"}),\" 的入参、创建与更新逻辑，以及在提交阶段的处理。还介绍了 \",e(r.code,{children:\"ref hook\"}),\"、\",e(r.code,{children:\"useMemo\"}),\" 和 \",e(r.code,{children:\"useCallback\"}),\" 的挂载与更新，最后作者表示对 \",e(r.code,{children:\"hook\"}),\" 的研究还不够深入，需进一步分析。\"]}),\"\\n\",e(r.p,{children:\"关联问题: useEffect更新如何实现 ref hook的作用是什么 useMemo的性能优势在哪\"}),\"\\n\",e(r.p,{children:\"AI智能总结首次生成速度较慢, 请耐心等待\"}),\"\\n\",n(r.h1,{id:\"开篇\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#开篇\",children:e(r.span,{className:\"icon icon-link\"})}),\"开篇\"]}),\"\\n\",n(r.p,{children:[\"上一节中我们讲到了两个标准的\",e(r.code,{children:\"State Hook\"}),\"(状态Hook),而这一节我们就去详细分析一下\",e(r.code,{children:\"Effect Hook\"}),\"(副作用hook)\"]}),\"\\n\",n(r.h1,{id:\"effect-hook\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#effect-hook\",children:e(r.span,{className:\"icon icon-link\"})}),\"Effect Hook\"]}),\"\\n\",n(r.p,{children:[\"前面我们已经对状态\",e(r.code,{children:\"hook\"}),\"有了一定的了解，而对于\",e(r.code,{children:\"effect hook\"}),\"最标准的就是\",e(r.code,{children:\"useEffect\"}),\"和\",e(r.code,{children:\"useLayoutEffect\"}),\"。\"]}),\"\\n\",n(r.h2,{id:\"1useeffect和uselayouteffect\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1useeffect和uselayouteffect\",children:e(r.span,{className:\"icon icon-link\"})}),\"1.useEffect和useLayoutEffect\"]}),\"\\n\",n(r.p,{children:[\"我们先简单分析\",e(r.code,{children:\"useEffect\"}),\"和\",e(r.code,{children:\"useLayoutEffect\"}),\"的入参,他们基本是相同的唯一的不同仅有\",e(r.code,{children:\"hook\"}),\"标示符\",e(r.code,{children:\"HookPassive\"}),\"和\",e(r.code,{children:\"HookLayout\"}),\",最后都是调用\",e(r.code,{children:\"mountEffectImpl\"}),\"。\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"create\"}),\"：传入\",e(r.code,{children:\"useEffect\"}),\"函数，即回调函数。\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"deps\"}),\"：依赖项，用来控制该Effect包裹的函数执不执行。如果依赖项为空数组\",e(r.code,{children:\"[]\"}),\"，则该Effect在每次组件挂载时执行，且仅执行一次,没有第二个参数则一直执行。\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" mountEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"  create\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": () \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (() \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") | \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | null,\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" mountEffectImpl\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    UpdateEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"PassiveEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    HookPassive\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    create\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  );\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" mountLayoutEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"  create\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": () \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (() \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") | \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | null,\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" mountEffectImpl\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    UpdateEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    HookLayout\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    create\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  );\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// Represents the phase in which the effect (not the clean-up) fires.\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" Layout\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*    */\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" 0b010\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" Passive\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*   */\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" 0b100\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[\"关于创建\",e(r.code,{children:\"hook\"}),\"我们前面有提到，状态\",e(r.code,{children:\"hook.memoizedState\"}),\"绑定的是状态，而副作用\",e(r.code,{children:\"hook.memoizedState\"}),\"绑定的则是一个\",e(r.a,{href:\"https://juejin.cn/editor/drafts/7168235835324628999\",children:\"effect对象\"}),\"。这里去确立\",e(r.code,{children:\"fiber\"}),\"的\",e(r.code,{children:\"flag\"}),\"是为了后续渲染\",e(r.code,{children:\"fiber树\"}),\"使用的。\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" mountEffectImpl\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fiberFlags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"hookFlags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"create\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 创建hook，确定在fiber.memoizedState链表中的位置\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"mountWorkInProgressHook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" null\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" :\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 确定fiber的flag\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  currentlyRenderingFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" |=\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" fiberFlags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 挂载在hook.memoizedState上，state hook中挂载的是state状态，而effect hook中挂载的是effect链表\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"pushEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    HookHasEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"hookFlags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    create\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#FFD493\"},children:\"    undefined\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  );\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[\"在这个\",e(r.code,{children:\"effect hook\"}),\"中，我们以一个\",e(r.code,{children:\"hook\"}),\"的视角讲一下指向,\",e(r.code,{children:\"hook.memoizedState\"}),\"指向\",e(r.code,{children:\"effct\"}),\",\",e(r.code,{children:\"effct\"}),\"是一个环形链表，他同时被挂载在\",e(r.code,{children:\"fiber.updateQueue.lastEffect\"}),\"和\",e(r.code,{children:\"hook.memoizedState\"}),\"上。这里的逻辑也很简单就是处理创建\",e(r.code,{children:\"effct\"}),\"，指向\",e(r.code,{children:\"effct\"}),\"到链尾，返回\",e(r.code,{children:\"effct\"}),\"。\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" pushEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"tag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"create\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //  创建effect节点\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    tag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    create\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"    next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": (\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 把effect节点指向链尾\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" componentUpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"FunctionComponentUpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentlyRenderingFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"componentUpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 新建 currentlyRenderingFiber.updateQueue = workInProgress.updateQueue 用于挂载effect对象\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    componentUpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"createFunctionComponentUpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    currentlyRenderingFiber.\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"componentUpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // updateQueue.lastEffect是一个环形链表\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    componentUpdateQueue.lastEffect = effect.next = effect;\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  } else {\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    const \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"componentUpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      componentUpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    } else {\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      componentUpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 返回effect\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  return effect;\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[\"紧接着我们就应该是去处理\",e(r.code,{children:\"Effect\"}),\"的回调了，而\",e(r.code,{children:\"Effect\"}),\"的回调是在\",e(r.code,{children:\"commitRootImpl\"}),\"中的\",e(r.code,{children:\"提交阶段\"}),\"去执行的，我们回顾一下一下提交阶段的三个子阶段：\",e(r.code,{children:\"dom\"}),\"更新前\",e(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiberWorkLoop.old.js%23L2256-L2300\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L2256-L2300\",children:\"commitBeforeMutationEffects\"}),\"、\",e(r.code,{children:\"dom\"}),\"更新 \",e(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiberWorkLoop.old.js%23L2302-L2383\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L2302-L2383\",children:\"commitMutationEffects\"}),\"、\",e(r.code,{children:\"dom\"}),\"变更后 \",e(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiberWorkLoop.old.js%23L2385-L2432\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L2385-L2432\",children:\"commitLayoutEffects\"}),\"。\",e(r.code,{children:\"fiber\"}),\"的提交我们可以回顾一下\",e(r.a,{href:\"https://juejin.cn/editor/drafts/7171426580060160030\",children:\"前文\"}),\",我们这里只关注对\",e(r.code,{children:\"hook\"}),\"的处理。\"]}),\"\\n\",n(r.h2,{id:\"11dom更新之前\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#11dom更新之前\",children:e(r.span,{className:\"icon icon-link\"})}),\"1.1.dom更新之前\"]}),\"\\n\",n(r.p,{children:[e(r.a,{href:\"https://juejin.cn/editor/drafts/7171426580060160030\",children:\"提交子阶段1\"}),\"中有提到,在这我们以一个\",e(r.code,{children:\"effct hook\"}),\"视角来观察这个过程，在这里我们只关心一件事情，就是在变更之前将\",e(r.code,{children:\"flushPassiveEffects\"}),\"交给了调度中心，去异步调用，而我们的整个\",e(r.code,{children:\"commit\"}),\"在17.2中是同步的，而\",e(r.code,{children:\"flushPassiveEffects\"}),\"是处理\",e(r.code,{children:\"useEffect\"}),\"的，我们的后面几个阶段会为\",e(r.code,{children:\"flushPassiveEffects\"}),\"处理\",e(r.code,{children:\"useEffect\"}),\"先做一些准备工作，当准备工作做完后，我们再来分析\",e(r.code,{children:\"flushPassiveEffects\"}),\"。\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" commitBeforeMutationEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" ((\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Passive\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") !== \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"NoFlags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"rootDoesHavePassiveEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"        rootDoesHavePassiveEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"true\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"        scheduleCallback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"NormalSchedulerPriority\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", () \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"          flushPassiveEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"          return\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"        });\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h2,{id:\"12dom变更\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#12dom变更\",children:e(r.span,{className:\"icon icon-link\"})}),\"1.2.dom变更\"]}),\"\\n\",n(r.p,{children:[\"在前文中我们提到了，如果需要更新节点，会执行\",e(r.code,{children:\"commitWork\"}),\"，运算后\",e(r.code,{children:\"useEffect\"}),\",\",e(r.code,{children:\"useLayoutEffect\"}),\"的值为\",e(r.code,{children:\"Update\"}),\"，进去\",e(r.code,{children:\"Update\"}),\"将内存中的\",e(r.code,{children:\"fiber\"}),\"用于提交操作\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" commitMutationEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  renderPriorityLevel\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"ReactPriorityLevel\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" flags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 运算后实际useEffect,useLayoutEffect的值为Update\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" primaryFlags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" & (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Placement\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Deletion\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Hydrating\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    switch\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"primaryFlags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      case\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" Update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 将内存的中的fiber指向当前，进行更新节点操作\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"        commitWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        break\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"commitWork\"}),\"在\",e(r.code,{children:\"dom\"}),\"变更阶段对于\",e(r.code,{children:\"effect hook\"}),\"会处理销毁处理上一次的\",e(r.code,{children:\"effectLayout\"}),\"来保证这一次阶段\",e(r.code,{children:\"dom\"}),\"变更之后\",e(r.code,{children:\"effectLayout\"}),\"的执行。\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" commitWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | null, \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    switch\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        case\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" FunctionComponent\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        case\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" ForwardRef\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        case\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" MemoComponent\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        case\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" SimpleMemoComponent\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        case\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" Block\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"          if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"            enableProfilerTimer\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"            enableProfilerCommitHooks\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"            finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"mode\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"ProfileMode\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"          ) {\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"            try\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"              startLayoutEffectTimer\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"              // 销毁effectLayout函数\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"              commitHookEffectListUnmount\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"HookLayout\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"HookHasEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"            } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"finally\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"              recordLayoutEffectDuration\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"            }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"          } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"            commitHookEffectListUnmount\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"HookLayout\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"HookHasEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"          }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"          return\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        case\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" ClassComponent\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"          return\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\" }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" commitHookEffectListUnmount\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"tag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"FunctionComponentUpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | null = (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" :\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    do\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 这里只销毁effectLayout，对比的时候effct.tag如果为0不变更即不执行\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" ((\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") === \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // Unmount\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"        effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"          destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"while\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h2,{id:\"13-变更后\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#13-变更后\",children:e(r.span,{className:\"icon icon-link\"})}),\"1.3 变更后\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"commitLayoutEffects\"}),\"这里我们在前面的构建章已经讲过，我们回顾一下，在这里的\",e(r.code,{children:\"schedulePassiveEffects\"}),\",为我们\",e(r.code,{children:\"flushPassiveEffects\"}),\"提供了能够脱离\",e(r.code,{children:\"fiber节点\"}),\"直接去访问\",e(r.code,{children:\"effects\"}),\"的条件，因为它为我们保存了两个全局\",e(r.code,{children:\"销毁挂载useEffect\"}),\"的数组。。\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" schedulePassiveEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"FunctionComponentUpdateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | null = (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" updateQueue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" :\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    do\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"tag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" } = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      //  筛选出由useEffect()创建的effect\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"        (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"HookPassive\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") !== \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"NoHookEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"        (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"HookHasEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") !== \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"NoHookEffect\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      ) {\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 把effect添加到全局数组, 等待flushPassiveEffectsImpl处理\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"        enqueuePendingPassiveHookEffectUnmount\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"        enqueuePendingPassiveHookEffectMount\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"      effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"while\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[\"此时我们的准备工作已经做好了，来到处理\",e(r.code,{children:\"useEffect\"}),\"的阶段。\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"arduino\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"arduino\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"export function flushPassiveEffects(): boolean {\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"  // Returns whether passive effects were flushed.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"  if (pendingPassiveEffectsRenderPriority !== NoSchedulerPriority) {\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"    const priorityLevel =\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"      pendingPassiveEffectsRenderPriority > NormalSchedulerPriority\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"        ? NormalSchedulerPriority\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"        : pendingPassiveEffectsRenderPriority;\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"    pendingPassiveEffectsRenderPriority = NoSchedulerPriority;\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"    // `runWithPriority`设置Schedule中的调度优先级, 如果在flushPassiveEffectsImpl中处理effect时又发起了新的更新, 那么新的update.lane将会受到这个priorityLevel影响.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"    return runWithPriority(priorityLevel, flushPassiveEffectsImpl);\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"  return false;\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" flushPassiveEffectsImpl\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"rootWithPendingPassiveEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" false\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  rootWithPendingPassiveEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  pendingPassiveEffectsLanes\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"NoLanes\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 执行所有的useEffect销毁函数，调用useEffect在上一次的渲染的销毁函数\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" unmountEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pendingPassiveHookEffectsUnmount\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  pendingPassiveHookEffectsUnmount\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = [];\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  for\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"unmountEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"length\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" += \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"2\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = ((\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"unmountEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"]: \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"HookEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = ((\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"unmountEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"]: \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"'function'\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"      destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 执行所有的useEffect回调函数, 调用useEffect这次render的回调函数，重新赋值到 effect.destroy\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" mountEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"pendingPassiveHookEffectsMount\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  pendingPassiveHookEffectsMount\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = [];\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  for\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"mountEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"length\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" += \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"2\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = ((\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"mountEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"]: \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"HookEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = ((\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"mountEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"]: \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    effect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"create\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[\"到这我们分析\",e(r.code,{children:\"mount Effct\"}),\"的过程已经告于段落。\"]}),\"\\n\",n(r.h2,{id:\"14-更新effect\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#14-更新effect\",children:e(r.span,{className:\"icon icon-link\"})}),\"1.4 更新effect\"]}),\"\\n\",n(r.p,{children:[\"这里的逻辑和前面挂载effect几乎一样，多了最主要的内容是依赖比较（浅比较），如果依赖相同传\",e(r.code,{children:\"hookFlags\"}),\"保证顺序，如果不同传\",e(r.code,{children:\"HookHasEffect | hookFlags\"}),\"，\",e(r.code,{children:\"HookHasEffect\"}),\"表示commit阶段需要重新执行。\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" updateEffectImpl\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fiberFlags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"hookFlags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"create\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"updateWorkInProgressHook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" null\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" :\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentHook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" prevEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"currentHook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 继续使用先前effect.destroy\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" prevDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"areHookInputsEqual\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"        pushEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"hookFlags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"create\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  currentlyRenderingFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" |=\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" fiberFlags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"pushEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    HookHasEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"hookFlags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    create\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    destroy\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  );\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 浅比较\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" areHookInputsEqual\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">,\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  prevDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"> | null,\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" false\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  \"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  for\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"length\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"length\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"++) {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"is\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"], \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"])) {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      continue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" false\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  \"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" true\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" is\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"x\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"y\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"x\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"y\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" && (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"x\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" / \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"x\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" / \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"y\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\")) || (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"x\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"x\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"y\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"y\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") \"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// eslint-disable-line no-self-compare\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  );\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[\"然后剩下的就和前面逻辑保持一致,\",e(r.code,{children:\"commit\"}),\"会判断\",e(r.code,{children:\"effect.tag\"}),\"决定是否执行。\"]}),\"\\n\",n(r.h1,{id:\"ref-hook\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#ref-hook\",children:e(r.span,{className:\"icon icon-link\"})}),\"ref hook\"]}),\"\\n\",n(r.p,{children:[\"这里\",e(r.code,{children:\"ref hook\"}),\"确实比较简单，相信如果有能力读懂上面写的，几乎\",e(r.code,{children:\"ref\"}),\"是一看就懂的\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" useRef\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"initialValue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"): {|\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"|} {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#ACAFFF\"},children:\"  const\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" dispatcher\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"resolveDispatcher\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#ACAFFF\"},children:\"  return\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" dispatcher\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"useRef\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"initialValue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" mountRef\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"initialValue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"): {|\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"|} {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#ACAFFF\"},children:\"  const\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"mountWorkInProgressHook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//获取useRef\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#ACAFFF\"},children:\"  const\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" ref\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = {\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"initialValue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"};\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//ref初始化\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#FFD493\"},children:\"  hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"ref\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#ACAFFF\"},children:\"  return\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" ref\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// update时调用updateRef获取获取当前useRef，然后返回hook链表\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" updateRef\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"initialValue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"): {|\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"|} {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#ACAFFF\"},children:\"  const\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"updateWorkInProgressHook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#ACAFFF\"},children:\"  return\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[\"构建\",e(r.code,{children:\"fiber\"}),\"阶段探寻，回溯处理\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//beginWork中\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" markRef\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | null, \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"workInProgress\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" ref\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"ref\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"ref\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") ||\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"    (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"ref\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"ref\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  ) {\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    workInProgress\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effectTag\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" |=\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" Ref\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//completeWork中\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" markRef\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"workInProgress\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  workInProgress\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effectTag\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" |=\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" Ref\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[\"提交阶段二，子阶段二\",e(r.code,{children:\"commitMutationEffects\"}),\"dom变更，如果ref改变了，先删除.\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" commitMutationEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"renderPriorityLevel\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" effectTag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effectTag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // ...\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    \"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"effectTag\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Ref\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"        commitDetachRef\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//移除ref\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[\"提交阶段二，子阶段三\",e(r.code,{children:\"commitLayoutEffect\"}),\"，重新设置\",e(r.code,{children:\"ref\"})]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" commitLayoutEffects\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"committedLanes\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Lanes\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 忽略代码\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"   \"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" flags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 处理标记\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" & (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Update\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Callback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"      commitLayoutEffectOnFiber\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"committedLanes\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    \"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"Ref\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 重新设置ref\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"      commitAttachRef\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 忽略代码\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 忽略代码\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h1,{id:\"usememo和usecallback\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#usememo和usecallback\",children:e(r.span,{className:\"icon icon-link\"})}),\"useMemo和useCallback\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"mount\"}),\"挂载\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" mountMemo\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"  nextCreate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": () \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | null,\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"mountWorkInProgressHook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//创建hook\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" null\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" :\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" nextValue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"nextCreate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//计算value\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = [\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextValue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"];\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//把value和依赖保存在memoizedState中\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" nextValue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" mountCallback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | null): \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"mountWorkInProgressHook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//创建hook\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" null\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" :\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = [\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"callback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"];\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//把callback和依赖保存在memoizedState中\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" callback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"update\"}),\"更新\"]}),\"\\n\",e(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" updateMemo\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#00DAEF\"},children:\"  nextCreate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": () \"}),e(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | null,\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"updateWorkInProgressHook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//获取hook\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" null\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" :\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" prevState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" prevDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"> | null = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),e(r.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"areHookInputsEqual\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\")) {\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//浅比较依赖\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" prevState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),e(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"];\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//没变 返回之前的状态\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" nextValue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"nextCreate\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//有变化重新调用callback\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = [\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextValue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" nextValue\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\" updateCallback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\">(\"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" | null): \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"T\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"updateWorkInProgressHook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//获取hook\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),e(r.span,{style:{color:\"#FFD493\"},children:\" null\"}),e(r.span,{style:{color:\"#54B9FF\"},children:\" :\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" deps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" prevState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\" prevDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(r.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"> | null = \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),e(r.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(r.span,{style:{color:\"#00DAEF\"},children:\"areHookInputsEqual\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"prevDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\")) {\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//浅比较依赖\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" prevState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),e(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"];\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//没变 返回之前的状态\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#4BF3C8\"},children:\"  hook\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\" = [\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"callback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\"];\"}),e(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//变了重新将[callback, nextDeps]赋值给memoizedState\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[e(r.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(r.span,{style:{color:\"#4BF3C8\"},children:\" callback\"}),e(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:e(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h1,{id:\"总结\",children:[e(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#总结\",children:e(r.span,{className:\"icon icon-link\"})}),\"总结\"]}),\"\\n\",n(r.p,{children:[e(r.code,{children:\"hook\"}),\"这一块这几天，感觉还是不够深入，这段时间先打打断点，深入分析一下，调用时机，算法，再重新修一下这整个大章节。\"]})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "React源码阅读(4)-支线(函数式组件)-构建细节以及更新（下）",
          "url": "#react源码阅读4-支线函数式组件-构建细节以及更新下",
          "items": []
        },
        {
          "title": "开篇",
          "url": "#开篇",
          "items": []
        },
        {
          "title": "Effect Hook",
          "url": "#effect-hook",
          "items": [
            {
              "title": "1.useEffect和useLayoutEffect",
              "url": "#1useeffect和uselayouteffect",
              "items": []
            },
            {
              "title": "1.1.dom更新之前",
              "url": "#11dom更新之前",
              "items": []
            },
            {
              "title": "1.2.dom变更",
              "url": "#12dom变更",
              "items": []
            },
            {
              "title": "1.3 变更后",
              "url": "#13-变更后",
              "items": []
            },
            {
              "title": "1.4 更新effect",
              "url": "#14-更新effect",
              "items": []
            }
          ]
        },
        {
          "title": "ref hook",
          "url": "#ref-hook",
          "items": []
        },
        {
          "title": "useMemo和useCallback",
          "url": "#usememo和usecallback",
          "items": []
        },
        {
          "title": "总结",
          "url": "#总结",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "16.react_source_reading(4)_down"
  },
  {
    "slug": "/content/react-source-code/17.react_side_effect",
    "title": "17. react中的副作用？",
    "description": "react中的副作用？",
    "published": true,
    "date": "2022-12-11T00:00:00.000Z",
    "body": "const{Fragment:e,jsx:l,jsxs:n}=arguments[0];function _createMdxContent(c){const r={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",p:\"p\",pre:\"pre\",span:\"span\",...c.components};return n(e,{children:[n(r.h1,{id:\"react中的副作用\",children:[l(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react中的副作用\",children:l(r.span,{className:\"icon icon-link\"})}),\"react中的副作用？\"]}),\"\\n\",n(r.h1,{id:\"开篇\",children:[l(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#开篇\",children:l(r.span,{className:\"icon icon-link\"})}),\"开篇\"]}),\"\\n\",n(r.p,{children:[\"最近在研究\",l(r.code,{children:\"react源码\"}),\"嘛，当正好我研究到\",l(r.code,{children:\"hooks\"}),\"的时候，脑海就忍不住想了有关\",l(r.code,{children:\"react副作用\"}),\"的连续问题，这这篇文章我们只少量的分析源码，主要是描述一个思考的思路。先玩点抽象的概念，\",l(r.code,{children:\"react\"}),\"就像个女孩，她不是很纯洁\",l(r.code,{children:\"effect\"}),\"，但她很尽力的表现得她很\",l(r.code,{children:\"纯洁\"}),\"，当我们去使用\",l(r.code,{children:\"useEffect\"}),\"可以从中窥得她的一部分\",l(r.code,{children:\"不纯洁\"}),\"。\"]}),\"\\n\",n(r.h1,{id:\"思考过程\",children:[l(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#思考过程\",children:l(r.span,{className:\"icon icon-link\"})}),\"思考过程\"]}),\"\\n\",l(r.p,{children:\"什么是副作用 -> React中的副作用，以及怎么做副作用分离 -> 简单的看看实现\"}),\"\\n\",n(r.h2,{id:\"副作用\",children:[l(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#副作用\",children:l(r.span,{className:\"icon icon-link\"})}),\"副作用\"]}),\"\\n\",n(r.p,{children:[\"先想想我们平常如果在\",l(r.code,{children:\"日常\"}),\"会怎么理解\",l(r.code,{children:\"副作用\"}),\"，这个词经常会用在我们日常生活中的\",l(r.code,{children:\"吃药\"}),\"，\",l(r.code,{children:\"比如:\"}),\"我原本要吃一片感冒药为了治好我的\",l(r.code,{children:\"感冒\"}),\"，但是这药，在\",l(r.code,{children:\"治好的感冒\"}),\"的同时可能还造成了\",l(r.code,{children:\"我的拉肚子\"}),\"。\"]}),\"\\n\",n(r.p,{children:[\"我们可以把这个例子反馈到我们的函数中，\",l(r.code,{children:\"治好感冒\"}),\"是我们的目的是我们\",l(r.code,{children:\"函数返回值\"}),\"，而\",l(r.code,{children:\"拉肚子\"}),\"是在\",l(r.code,{children:\"我们获得这个函数返回值\"}),\"的过程中的\",l(r.code,{children:\"副作用\"}),\"，这个描述可能不太准确，比较准确的说法\",l(r.code,{children:\"是函数在执行过程中对外部造成的影响称之为副作用\"}),\"。\"]}),\"\\n\",n(r.p,{children:[\"我们可以举一个最简单的例子：下述代码，除了返回了我们的\",l(r.code,{children:\"6\"}),\"，还同时产生了\",l(r.code,{children:\"附加的影响\"}),\"，将\",l(r.code,{children:\"arr\"}),\"数组删除了最后一项。而这个\",l(r.code,{children:\"附加的影响\"}),\"就可以被称之为副作用。（有关\",l(r.code,{children:\"纯函数，非纯函数，引用透明\"}),\"这些概念性编程范式的东西，可以去看看其他博主的，网上有挺多的。）\"]}),\"\\n\",l(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\" arr\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" = [\"}),l(r.span,{style:{color:\"#FFD493\"},children:\"1\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\",\"}),l(r.span,{style:{color:\"#FFD493\"},children:\"2\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\",\"}),l(r.span,{style:{color:\"#FFD493\"},children:\"3\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\",\"}),l(r.span,{style:{color:\"#FFD493\"},children:\"4\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\",\"}),l(r.span,{style:{color:\"#FFD493\"},children:\"5\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\",\"}),l(r.span,{style:{color:\"#FFD493\"},children:\"6\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\" lastOne\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"arr\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(r.span,{style:{color:\"#00DAEF\"},children:\"pop\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h2,{id:\"react副作用分离\",children:[l(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react副作用分离\",children:l(r.span,{className:\"icon icon-link\"})}),\"React副作用分离\"]}),\"\\n\",n(r.p,{children:[\"这里就涉及一个知识点，代数效应（算了这东西有很多解释大家可以去看看，强抓八股文并不利于我们思考）。简单的说就是在\",l(r.code,{children:\"React hook\"}),\"中以这个理念，去实现了一套让我们在\",l(r.code,{children:\"api\"}),\"使用层面可以去不关注\",l(r.code,{children:\"副作用\"}),\"，将\",l(r.code,{children:\"副作用\"}),\"分离出来，交给内部处理，举个例子：\",l(r.code,{children:\"本质上useState是一个有副作用的api但是react内部帮你抽离了让你在使用层面上看起来像一个纯函数\"}),\"。\"]}),\"\\n\",n(r.p,{children:[\"下述例子，\",l(r.code,{children:\"useEffect\"}),\"函数中我们可以不用去关心可能它在\",l(r.code,{children:\"count\"}),\"改变后，对\",l(r.code,{children:\"fiber\"}),\"渲染所做的事情，他在内部已经给你处理了。其实到这不关心源码的朋友们已经可以结束了。\"]}),\"\\n\",l(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),l(r.span,{style:{color:\"#ACAFFF\"},children:\"count\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(r.span,{style:{color:\"#ACAFFF\"},children:\"setCount\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),l(r.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#00DAEF\"},children:\"useEffect\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),l(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 随便做点啥\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#EEF0F9\"},children:\"}, [\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"count\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"])\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h2,{id:\"是如何分离的又拿副作用做了什么\",children:[l(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#是如何分离的又拿副作用做了什么\",children:l(r.span,{className:\"icon icon-link\"})}),\"是如何分离的，又拿副作用做了什么？\"]}),\"\\n\",n(r.p,{children:[\"因为实际上这个问题太大了，\",l(r.code,{children:\"react\"}),\"的内部处处是副作用，但我们可以单独从一个小点\",l(r.code,{children:\"useEffect\"}),\"去分析，因为我们翻译一下就可以知道这个\",l(r.code,{children:\"hook\"}),\"就是抛出的最直观的去\",l(r.code,{children:\"使用副作用\"}),\"的地方， \",l(r.code,{children:\"useEffect\"}),\"的调用时机是在\",l(r.code,{children:\"fiber\"}),\"树渲染的过程中，他可以改变状态，发起新的一轮的\",l(r.code,{children:\"fiber\"}),\"构造等去引发一个连续的\",l(r.code,{children:\"副作用\"}),\"，其实本质上感觉\",l(r.code,{children:\"hook\"}),\"或者说后续回调函数完成后的\",l(r.code,{children:\"修改了状态，对函数以外的东西产生了影响\"}),\"都可以视为\",l(r.code,{children:\"副作用\"}),\"。\"]}),\"\\n\",n(r.p,{children:[\"简单说说把，\",l(r.code,{children:\"useEffect\"}),\"会创建一个\",l(r.code,{children:\"effect\"}),\"环形链表并保存在\",l(r.code,{children:\"fiber.updateQueue\"}),\"和\",l(r.code,{children:\"hook.memoizedState\"}),\"中，当我们渲染开始的时候会将\",l(r.code,{children:\"useEffect\"}),\"放入调度中，等到\",l(r.code,{children:\"flushPassiveEffectsImpl\"}),\"去异步执行它。此时会有一些副作用留存到\",l(r.code,{children:\"fiber\"}),\"上。\"]}),\"\\n\",l(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\" try\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),l(r.span,{style:{color:\"#ACAFFF\"},children:\" create\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"create\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"      enableProfilerTimer\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"      enableProfilerCommitHooks\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"      fiber\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"mode\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"ProfileMode\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F9\"},children:\"    ) {\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"      try\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#00DAEF\"},children:\"        startPassiveEffectTimer\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"        effect\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(r.span,{style:{color:\"#00DAEF\"},children:\"create\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),l(r.span,{style:{color:\"#54B9FF\"},children:\"finally\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#00DAEF\"},children:\"        recordPassiveEffectDuration\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),l(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 执行\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"      effect\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(r.span,{style:{color:\"#00DAEF\"},children:\"create\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),l(r.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"error\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#00DAEF\"},children:\"    invariant\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),l(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(r.span,{style:{color:\"#FFD493\"},children:\"'Should be working on an effect.'\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#00DAEF\"},children:\"    captureCommitPhaseError\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"error\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",l(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:[\"等到我们更新的时候，这些\",l(r.code,{children:\"副作用\"}),\"又会派上用场，依次循坏。\"]}),\"\\n\",l(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),l(r.span,{style:{color:\"#00DAEF\"},children:\" updateEffectImpl\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fiberFlags\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"hookFlags\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"create\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"deps\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),l(r.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 获取当前hook\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),l(r.span,{style:{color:\"#ACAFFF\"},children:\" hook\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(r.span,{style:{color:\"#00DAEF\"},children:\"updateWorkInProgressHook\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),l(r.span,{style:{color:\"#ACAFFF\"},children:\" nextDeps\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"deps\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),l(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),l(r.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),l(r.span,{style:{color:\"#FFD493\"},children:\" null\"}),l(r.span,{style:{color:\"#54B9FF\"},children:\" :\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\" deps\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\" destroy\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 分析依赖\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"currentHook\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),l(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 留存下来的`effect`链表\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),l(r.span,{style:{color:\"#ACAFFF\"},children:\" prevEffect\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"currentHook\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 继续使用先前effect.destroy\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"    destroy\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"prevEffect\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),l(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),l(r.span,{style:{color:\"#ACAFFF\"},children:\" prevDeps\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"prevEffect\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"deps\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 浅比较依赖是否变化\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),l(r.span,{style:{color:\"#00DAEF\"},children:\"areHookInputsEqual\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"prevDeps\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"        如果依赖不变\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(r.span,{style:{color:\"#00DAEF\"},children:\"新建effect\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"tag不含HookHasEffect\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#00DAEF\"},children:\"        pushEffect\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"hookFlags\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"create\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"nextDeps\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 如果依赖改变, 更改fiber.flag, 新建effect\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"  currentlyRenderingFiber\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),l(r.span,{style:{color:\"#54B9FF\"},children:\" |=\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\" fiberFlags\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"  hook\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(r.span,{style:{color:\"#00DAEF\"},children:\"pushEffect\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"    HookHasEffect\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(r.span,{style:{color:\"#4BF3C8\"},children:\"hookFlags\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"    create\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"    destroy\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#4BF3C8\"},children:\"    nextDeps\"}),l(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F9\"},children:\"  );\"})}),\"\\n\",l(r.span,{\"data-line\":\"\",children:l(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",l(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.h2,{id:\"总结\",children:[l(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#总结\",children:l(r.span,{className:\"icon icon-link\"})}),\"总结\"]}),\"\\n\",l(r.p,{children:\"以上的都是自己的一些思考，并不能完全的代表是正确的，欢迎纠错。没用的知识又增加洛！\"})]})}return{default:function(e={}){const{wrapper:n}=e.components||{};return n?l(n,{...e,children:l(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "toc": {
      "content": [
        {
          "title": "react中的副作用？",
          "url": "#react中的副作用",
          "items": []
        },
        {
          "title": "开篇",
          "url": "#开篇",
          "items": []
        },
        {
          "title": "思考过程",
          "url": "#思考过程",
          "items": [
            {
              "title": "副作用",
              "url": "#副作用",
              "items": []
            },
            {
              "title": "React副作用分离",
              "url": "#react副作用分离",
              "items": []
            },
            {
              "title": "是如何分离的，又拿副作用做了什么？",
              "url": "#是如何分离的又拿副作用做了什么",
              "items": []
            },
            {
              "title": "总结",
              "url": "#总结",
              "items": []
            }
          ]
        }
      ],
      "visible": true
    },
    "slugAsParams": "17.react_side_effect"
  },
  {
    "slug": "/content/react-source-code/18.why_choose_react_native",
    "title": "18. 为什么选择React-native",
    "description": "因为它牛逼🐮",
    "published": true,
    "date": "2023-04-18T00:00:00.000Z",
    "body": "const{Fragment:e,jsx:c,jsxs:n}=arguments[0];function _createMdxContent(d){const i={a:\"a\",code:\"code\",em:\"em\",h1:\"h1\",hr:\"hr\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",span:\"span\",strong:\"strong\",ul:\"ul\",...d.components};return n(e,{children:[n(i.h1,{id:\"为什么选择react-native\",children:[c(i.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#为什么选择react-native\",children:c(i.span,{className:\"icon icon-link\"})}),\"为什么选择React-native\"]}),\"\\n\",c(i.p,{children:\"文章主要介绍了 React-native，包括其背景、定义、运行机制、优势、哲学以及在产品和 app 选择中的考虑。讲述了它由 Facebook 创建，是基于 JavaScript 的跨端框架，有两个线程通过桥通信，具有满足需求、学习成本低等优势，其处理 native 重叠部分，并非完全跨平台，还探讨了产品选择平台的相关问题。\"}),\"\\n\",c(i.p,{children:\"关联问题: RN优势还有哪些 RN如何优化性能 RN开发难度怎样\"}),\"\\n\",c(i.p,{children:\"AI智能总结首次生成速度较慢, 请耐心等待\"}),\"\\n\",n(i.p,{children:[\"“ \",c(i.em,{children:n(i.strong,{children:[\"本文正在参加\",c(i.a,{href:\"https://juejin.cn/post/7207698564641996856/\",children:\"「金石计划」\"})]})}),\" ”\"]}),\"\\n\",n(i.h1,{id:\"1react-native的背景\",children:[c(i.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1react-native的背景\",children:c(i.span,{className:\"icon icon-link\"})}),\"1、React-native的背景\"]}),\"\\n\",n(i.p,{children:[c(i.code,{children:\"Facebook\"}),\" 创建了 \",c(i.code,{children:\"React-Native（RN）\"}),\"来构建 \",c(i.code,{children:\"app\"}),\"。它最初是在2013年的夏天在 \",c(i.code,{children:\"Facebook\"}),\" 内部的一个项目，2015年成为开源项目，是因为当时 \",c(i.code,{children:\"React\"}),\" 在社区的呼声很高，他们就觉得 \",c(i.code,{children:\"React\"}),\" 是一个很好的\",c(i.code,{children:\"UI\"}),\" 框架，那么如果你想构建一个 \",c(i.code,{children:\"native-app\"}),\"，为什么不直接让在 \",c(i.code,{children:\"React\"}),\" 跑在移动端的操作系统上那！\"]}),\"\\n\",n(i.p,{children:[\"因此，在同一年，\",c(i.code,{children:\"Facebook\"}),\" 将 \",c(i.code,{children:\"React\"}),\"分为两个独立的库，也就是 \",c(i.code,{children:\"React\"}),\"和 \",c(i.code,{children:\"React-dom\"}),\"，可能大伙对这个概念还挺模糊的，我简单解释一下。\"]}),\"\\n\",n(i.p,{children:[c(i.code,{children:\"React\"}),\"： \",c(i.code,{children:\"React\"}),\" 是一种用于构建用户界面的 \",c(i.code,{children:\"JavaScript\"}),\" 库。它是一个核心库，用来创建 \",c(i.code,{children:\"React\"}),\" 元素 (\",c(i.code,{children:\"elements\"}),\")、组件 (\",c(i.code,{children:\"components\"}),\") 和虚拟 \",c(i.code,{children:\"DOM\"}),\" (\",c(i.code,{children:\"Virtual DOM\"}),\")，并在应用程序中管理组件的状态和生命周期。\",c(i.code,{children:\"React\"}),\" 可以在客户端和服务器端使用也包括了\",c(i.code,{children:\"React Native\"}),\"。\"]}),\"\\n\",n(i.p,{children:[c(i.code,{children:\"React-dom\"}),\": \",c(i.code,{children:\"React-DOM\"}),\" 是 \",c(i.code,{children:\"React\"}),\" 库针对浏览器的针对 \",c(i.code,{children:\"DOM\"}),\" 操作的补充。\",c(i.code,{children:\"React-DOM\"}),\" 提供了与 \",c(i.code,{children:\"DOM\"}),\" 相关的功能，比如把 \",c(i.code,{children:\"React\"}),\" 组件渲染到 \",c(i.code,{children:\"DOM\"}),\" 中，处理用户交互等事件。\"]}),\"\\n\",n(i.p,{children:[\"简单来说，\",c(i.code,{children:\"React\"}),\" 库提供了一个基础构建组件树的库，而 \",c(i.code,{children:\"React-DOM\"}),\" 则为你提供了一些针对 \",c(i.code,{children:\"Web\"}),\" 页面的工具，如将组件渲染到网页中，并支持通过事件响应来进行交互。\"]}),\"\\n\",n(i.p,{children:[\"从那时起，\",c(i.code,{children:\"React\"}),\" 就不用关心组件的渲染在哪个平台上。\",c(i.code,{children:\"Web\"}),\" 平台的渲染由 \",c(i.code,{children:\"ReactDOM\"}),\" 承担，而移动平台的渲染由 \",c(i.code,{children:\"RN\"}),\" 承担。\"]}),\"\\n\",n(i.h1,{id:\"2什么是react-native\",children:[c(i.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2什么是react-native\",children:c(i.span,{className:\"icon icon-link\"})}),\"2、什么是React-native\"]}),\"\\n\",n(i.p,{children:[c(i.code,{children:\"RN\"}),\" 是一个基于 \",c(i.code,{children:\"javascript\"}),\" 的跨端框架，\",c(i.code,{children:\"RN\"}),\"提供了一套代码多个平台运行的能力。\"]}),\"\\n\",n(i.p,{children:[\"它最开始解决的问题是，在安卓上，开发者需要实现一套\",c(i.code,{children:\"Java app\"}),\",又在ios, 需要实现\",c(i.code,{children:\"Swift\"}),\"，我们就需要学习两门语言，去实现一个完整的\",c(i.code,{children:\"app\"}),\"。\"]}),\"\\n\",c(i.p,{children:c(i.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/React%20Native%20%E8%83%8C%E6%99%AF%20(3).webp?updatedAt=1739808679072\",alt:\"image.png\"})}),\"\\n\",c(i.p,{children:\"那时候就感觉像是这样的。\"}),\"\\n\",n(i.ul,{children:[\"\\n\",n(i.li,{children:[c(i.code,{children:\"web\"}),\"开发者要了解\",c(i.code,{children:\"HTML\"}),\",\",c(i.code,{children:\"CSS\"}),\",\",c(i.code,{children:\"JS\"}),\",\",c(i.code,{children:\"React\"})]}),\"\\n\",n(i.li,{children:[c(i.code,{children:\"安卓\"}),\"开发者要了解\",c(i.code,{children:\"Java\"}),\",\",c(i.code,{children:\"Kotlin SDK\"})]}),\"\\n\",n(i.li,{children:[c(i.code,{children:\"ios\"}),\"开发者要了解\",c(i.code,{children:\"Object-c\"}),\",\",c(i.code,{children:\"Swift\"}),\",\",c(i.code,{children:\"CocoaPods\"}),\".\"]}),\"\\n\"]}),\"\\n\",n(i.p,{children:[\"而在R系大家庭中，\",c(i.code,{children:\"React-native\"}),\"应运而生，引入一个新的\",c(i.code,{children:\"platform\"}),\"去\",c(i.code,{children:\"平替\"}),\"上者后2。\"]}),\"\\n\",c(i.p,{children:\"它现在看起来是这样的\"}),\"\\n\",c(i.p,{children:c(i.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/React%20Native%20%E8%83%8C%E6%99%AF%20(1).webp?updatedAt=1739808641575\",alt:\"image.png\"})}),\"\\n\",n(i.p,{children:[\"这就是我前面讲到的，\",c(i.code,{children:\"React\"}),\"仅仅是管理\",c(i.code,{children:\"Fiber树，em或者说组件树\"}),\"，而渲染交给了\",c(i.code,{children:\"react-dom\"}),\"或者\",c(i.code,{children:\"react-native\"}),\"。\"]}),\"\\n\",c(i.hr,{}),\"\\n\",n(i.p,{children:[\"我们进一步研究一下，究竟是如何在我们的\",c(i.code,{children:\"app\"}),\"上跑的，\",c(i.code,{children:\"rn\"}),\"其实是用\",c(i.code,{children:\"React\"}),\"、\",c(i.code,{children:\"Js\"}),\"去调用\",c(i.code,{children:\"native组件\"}),\"然后构建\",c(i.code,{children:\"app\"}),\"。例如，\",c(i.code,{children:\"<Image/>\"}),\"组件代表了另外两个本地组件， 安卓的\",c(i.code,{children:\"ImageView\"}),\"、iOS的\",c(i.code,{children:\"UIImageView\"}),\"。在这\",c(i.code,{children:\"rn\"}),\"的架构中是由两个线程控制的，一个\",c(i.code,{children:\"js\"}),\"线程、一个\",c(i.code,{children:\"native\"}),\"线程。\"]}),\"\\n\",c(i.p,{children:c(i.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/a589cb6bdcb749b2aeb1a02a9ceccda0~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp?updatedAt=1739808642406\",alt:\"image.png\"})}),\"\\n\",n(i.ol,{children:[\"\\n\",n(i.li,{children:[\"首先我先讲一下\",c(i.code,{children:\"js\"}),\"线程的东西，我们先有个概念，举个例子：我们的浏览器用虚拟引擎去执行\",c(i.code,{children:\"js\"}),\"代码就像是\",c(i.code,{children:\"v8\"}),\"。意思就是我们的代码如果要跑在\",c(i.code,{children:\"rn\"}),\"上同样需要一个\",c(i.code,{children:\"虚拟引擎\"}),\"，去执行我们的\",c(i.code,{children:\"api\"}),\"、处理我们的事件。在最开始就是\",c(i.code,{children:\"ios\"}),\"内置的\",c(i.code,{children:\"JScore\"}),\"这个引擎，但这个引擎在打包安卓的时候会把包搞大，又用不上，所以就在0.6这个版本后采用\",c(i.code,{children:\"Hermes\"}),\"这个新引擎，在0.64后ios也采用这个引擎了,毕竟它确实更好，如下它的优势。\"]}),\"\\n\"]}),\"\\n\",n(i.ul,{children:[\"\\n\",n(i.li,{children:[\"\\n\",c(i.p,{children:\"更快的启动速度。\"}),\"\\n\"]}),\"\\n\",n(i.li,{children:[\"\\n\",c(i.p,{children:\"更小的包。\"}),\"\\n\"]}),\"\\n\",n(i.li,{children:[\"\\n\",c(i.p,{children:c(i.code,{children:\"内存使用更小。\"})}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(i.p,{children:[\"与浏览器中一样，\",c(i.code,{children:\"rn\"}),\"中的\",c(i.code,{children:\"JS\"}),\"是在单个线程中实现的。该线程负责执行\",c(i.code,{children:\"JS\"}),\"。我们正在编写的业务逻辑将在这个线程中执行。这意味着我们所有的\",c(i.code,{children:\"通用代码\"}),\"，如组件、状态、钩子和\",c(i.code,{children:\"REST API\"}),\"调用，将在应用程序的JS部分中处理。\"]}),\"\\n\",n(i.ol,{start:\"2\",children:[\"\\n\",n(i.li,{children:[\"那么\",c(i.code,{children:\"native\"}),\"线程是做啥那，其实就是执行\",c(i.code,{children:\"native\"}),\"代码的地方，\",c(i.code,{children:\"rn\"}),\"它在每个平台(\",c(i.code,{children:\"java\"}),\"、\",c(i.code,{children:\"oc\"}),\"、\",c(i.code,{children:\"ios\"}),\")上都去实现了这一部分,这个线程绝大部分的内容都是与\",c(i.code,{children:\"安卓ios\"}),\"通信的\",c(i.code,{children:\"sdk\"}),\",同时为我们提供统一的\",c(i.code,{children:\"api\"}),\"。举个例子：就是比如我调用一个\",c(i.code,{children:\"alert\"}),\"弹窗，\",c(i.code,{children:\"native\"}),\"层就整合了2个平台提供了一个统一的\",c(i.code,{children:\"api\"}),\"，然后我们在\",c(i.code,{children:\"js\"}),\"线程中去调用他。实际上这是线程的交互，在\",c(i.code,{children:\"native\"}),\"线程的角度来看，就我们要弹出个警告，他其实是两个部分，\",c(i.code,{children:\"Native ui\"}),\"去更新页面，\",c(i.code,{children:\"Native Moudles\"}),\"去访问平台特有的功能。\"]}),\"\\n\"]}),\"\\n\",c(i.hr,{}),\"\\n\",n(i.p,{children:[\"上面我们说了一下两个线程分别是干啥的，紧接着就肯定离不开线程之间的\",c(i.code,{children:\"通信\"}),\",而这两个线程之间的通信是通过\",c(i.code,{children:\"桥（就这么理解吧）\"}),\"，这个\",c(i.code,{children:\"桥\"}),\"是用\",c(i.code,{children:\"C++\"}),\"写的，并基于一个异步队列。当\",c(i.code,{children:\"桥\"}),\"从其中一方接收数据时，它将其序列化，将其转换为JSON字符串,然后把它排在队列中。在到达目的地后，数据就被反序列化。\"]}),\"\\n\",n(i.p,{children:[\"就以上面的\",c(i.code,{children:\"alert\"}),\"为例，\",c(i.code,{children:\"native\"}),\"接受来自\",c(i.code,{children:\"JS\"}),\"的回调并显示该对话框。实际上，\",c(i.code,{children:\"JS\"}),\"方法在被调用时，向桥发送消息，并接收到到消息时，\",c(i.code,{children:\"native\"}),\"执行指令。本机消息也可以被转发到\",c(i.code,{children:\"JS\"}),\"。例如，单击该按钮时，\",c(i.code,{children:\"native\"}),\"向\",c(i.code,{children:\"js\"}),\"发送一个单击事件消息。就大概像这样：\"]}),\"\\n\",c(i.p,{children:c(i.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/bf8565998e704904ab1f01e551ea150b~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp?updatedAt=1739808641491\",alt:\"image.png\"})}),\"\\n\",n(i.p,{children:[\"大家应该很容易发现问题，就是因为所有的事件都依赖于异步的桥去完成通信，那可能会面临就是说队列负载过高，就导致的性能问题，但确实也存在，只能说有利有弊了，我们先留下这个悬念，后面再看看\",c(i.code,{children:\"RN\"}),\"的架构中是如何处理这个问题的（下一篇再讲新架构内容太多了）。\"]}),\"\\n\",c(i.hr,{}),\"\\n\",n(i.p,{children:[\"其实\",c(i.code,{children:\"RN\"}),\" 使用就是使用异步回调去操作底层的移动端操作系统，也就是调用原生的\",c(i.code,{children:\"api\"}),\"。\",c(i.code,{children:\"rn\"}),\"有一个\",c(i.code,{children:\"JavaScript\"}),\"引擎，并且\",c(i.code,{children:\"RN API\"}),\"与\",c(i.code,{children:\"Web\"}),\"的\",c(i.code,{children:\"React\"}),\"基本相同，区别在于原生端；\",c(i.code,{children:\"Rn\"}),\"是异步调用的原生API，而不是DOM。如图所示：\"]}),\"\\n\",c(i.p,{children:c(i.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/React%20Native%20%E8%83%8C%E6%99%AF%20(2).webp?updatedAt=1739808641476\",alt:\"image.png\"})}),\"\\n\",n(i.ul,{children:[\"\\n\",n(i.li,{children:[c(i.code,{children:\"RN\"}),\" 使用与\",c(i.code,{children:\"web\"}),\"上使用的相同\",c(i.code,{children:\"React\"}),\"库（也就是前面提到的\",c(i.code,{children:\"React\"}),\"核心库），并在 \",c(i.code,{children:\"JavaScriptCore\"}),\"中运行。\"]}),\"\\n\",n(i.li,{children:[\"发送到\",c(i.code,{children:\"Native api\"}),\"的消息是异步和批处理的。\"]}),\"\\n\",n(i.li,{children:[c(i.code,{children:\"RN\"}),\"附带了为移动平台实现的组件，而不是HTML元素的组件.\"]}),\"\\n\",n(i.li,{children:[c(i.code,{children:\"RN\"}),\"其实代表的是通过\",c(i.code,{children:\"iOS\"}),\"和\",c(i.code,{children:\"Android\"}),\" api渲染组件的方法。它可以用同样的概念来在\",c(i.code,{children:\"tvOS\"}),\"、电视、Windows、macOS，甚至是Web上渲染。\"]}),\"\\n\"]}),\"\\n\",n(i.h1,{id:\"3使用react-native的优势\",children:[c(i.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3使用react-native的优势\",children:c(i.span,{className:\"icon icon-link\"})}),\"3、使用React-native的优势\"]}),\"\\n\",n(i.p,{children:[\"为\",c(i.code,{children:\"React\"}),\"去实现一个新的渲染其实还挺难的，就大伙想象一下这就像发明一个可以运行在\",c(i.code,{children:\"ios\"}),\"和\",c(i.code,{children:\"Android\"}),\"的新的\",c(i.code,{children:\"dom\"}),\"难度，但跨端应用还是不得不做，就我想了一下有这几个原因吧。\"]}),\"\\n\",n(i.ol,{children:[\"\\n\",n(i.li,{children:[\"最重要是还是需求催生了技术，因为移动端的巨大需求，而H5性能的不近人意（就是用户体验差），而\",c(i.code,{children:\"rn\"}),\"这种其实算是变相调用原生的\",c(i.code,{children:\"api\"}),\"会好很多。\"]}),\"\\n\",n(i.li,{children:[\"然后就是\",c(i.code,{children:\"jsx\"}),\"，可能我对\",c(i.code,{children:\"flutter\"}),\"的好感不如\",c(i.code,{children:\"rn\"}),\"的原因就是因为这个吧，学习成本低了。\"]}),\"\\n\",c(i.li,{children:\"商业价值洛，这些年客户端混成啥样不用我多说了吧（但从另外方面来说还是得要人做一些桥接的东西）。\"}),\"\\n\"]}),\"\\n\",n(i.h1,{id:\"4自我感觉rn的哲学\",children:[c(i.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#4自我感觉rn的哲学\",children:c(i.span,{className:\"icon icon-link\"})}),\"4、自我感觉Rn的哲学\"]}),\"\\n\",n(i.p,{children:[\"就这里只谈谈自己对\",c(i.code,{children:\"RN\"}),\"的感觉。\"]}),\"\\n\",n(i.p,{children:[\"怎么说那？就是可能大家觉得\",c(i.code,{children:\"rn\"}),\"，应该就是你可以用\",c(i.code,{children:\"react\"}),\"的语法写一个跑在任何原生设备上的应用。\"]}),\"\\n\",n(i.p,{children:[\"但不行，因为\",c(i.code,{children:\"ios\"}),\"和\",c(i.code,{children:\"安卓\"}),\"在许多最基本的层面就是不一样的，甚至它们的\",c(i.code,{children:\"UX\"}),\"哲学完全不同（这其实也是ios好很多的原因），所以其实想写一个不处理两种情况的\",c(i.code,{children:\"单一app\"}),\"其实还真不行。\"]}),\"\\n\",n(i.p,{children:[\"简单的说就是，\",c(i.code,{children:\"rn\"}),\"不是实现一个组件库让你在任何地方跑，它处理的只是\",c(i.code,{children:\"native\"}),\"重叠的地方。\",c(i.code,{children:\"rn\"}),\"不是写一次，就可以在任何地方跑（除非你完全不在意用户体验），它应该说是学习一次，写在任务地方。你需要在某些情况，用特定\",c(i.code,{children:\"ios\"}),\"/\",c(i.code,{children:\"安卓\"}),\"组件，去提供更好的\",c(i.code,{children:\"UX\"}),\"(但其实\",c(i.code,{children:\"rn\"}),\"已经帮你处理很多差异和提供很多通用基础组件了，只是你可能需要脑子里对平台差异有个类似于红线认知的东西)\"]}),\"\\n\",n(i.h1,{id:\"5谈谈产品与app\",children:[c(i.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#5谈谈产品与app\",children:c(i.span,{className:\"icon icon-link\"})}),\"5、谈谈产品与app\"]}),\"\\n\",n(i.p,{children:[\"其实对于用户来说， \",c(i.code,{children:\"web应用\"}),\" 的门槛是远远低于 \",c(i.code,{children:\"app\"}),\" 的，如果没有强需求大伙是并不愿意安装一个发灰的 \",c(i.code,{children:\"app\"}),\",大伙应该更喜欢一个浏览器去看一些东西，尽管没\",c(i.code,{children:\"app体验好\"}),\"。\"]}),\"\\n\",n(i.p,{children:[\"假设这时候我有一个\",c(i.code,{children:\"c端产品\"}),\"，我们该怎么去选择它的平台那？\"]}),\"\\n\",c(i.p,{children:\"1、Pc web。\"}),\"\\n\",c(i.p,{children:\"2、移动端 web（平板、手机）。\"}),\"\\n\",c(i.p,{children:\"3、移动端app。\"}),\"\\n\",n(i.p,{children:[\"如果是一个功能复杂的大\",c(i.code,{children:\"产品\"}),\"一定要选择\",c(i.code,{children:\"app\"}),\"，而如果是一下小巧功能单一的产品就可以选择移动端\",c(i.code,{children:\"web\"}),\"。我从技术的角度谈谈为什么 移动端浏览器是缺乏移动应用程序许多功能的。这是因为浏览器的HTML元素不能与原生的组件\",c(i.code,{children:\"保持一个UI和交互的同频\"}),\"。虽然我们可以试着去还原，但太麻烦了。\"]}),\"\\n\",n(i.p,{children:[\"然后就是移动设备上的用户交互与通常与h5的交互有根本的不同。例如：web的点击事件，点击一个按钮上的事件只是一个阶段。然而，当用户使用手指与屏幕交互时，人是一直滑啊（你要算各种touch x y什么的）。原生有一个专门的手势系统让它来处理这个问题。而\",c(i.code,{children:\"web\"}),\"会让这事异常复杂。\"]}),\"\\n\",c(i.p,{children:\"简单的总结一下\"}),\"\\n\",c(i.p,{children:\"1、移动端浏览器，UI和交互与原生的不统一，甚至有的设计会提出在移动端上写表格这种事情，但说实话这完全不该是移动端体验的一部分。\"}),\"\\n\",c(i.p,{children:\"2、web应用缺乏很多原生能力，就像上面举到的手势系统等。\"}),\"\\n\",n(i.h1,{id:\"6结束\",children:[c(i.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#6结束\",children:c(i.span,{className:\"icon icon-link\"})}),\"6、结束\"]}),\"\\n\",n(i.p,{children:[\"因为最近业务在写\",c(i.code,{children:\"Rn\"}),\",就正好巩固一下一些知识，也增强大伙的竞争力，后面估计这个部分会出很多章，想这种概念的东西还挺重要的，大伙可以吸收一下。呜！就你想成为强者吗！那就来一起学习吧，->\",c(i.a,{href:\"https://juejin.cn/user/400646714977431/pins\",children:\"看这里沸点\"}),\"。\"]})]})}return{default:function(e={}){const{wrapper:n}=e.components||{};return n?c(n,{...e,children:c(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "toc": {
      "content": [
        {
          "title": "为什么选择React-native",
          "url": "#为什么选择react-native",
          "items": []
        },
        {
          "title": "1、React-native的背景",
          "url": "#1react-native的背景",
          "items": []
        },
        {
          "title": "2、什么是React-native",
          "url": "#2什么是react-native",
          "items": []
        },
        {
          "title": "3、使用React-native的优势",
          "url": "#3使用react-native的优势",
          "items": []
        },
        {
          "title": "4、自我感觉Rn的哲学",
          "url": "#4自我感觉rn的哲学",
          "items": []
        },
        {
          "title": "5、谈谈产品与app",
          "url": "#5谈谈产品与app",
          "items": []
        },
        {
          "title": "6、结束",
          "url": "#6结束",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "18.why_choose_react_native"
  },
  {
    "slug": "/content/react-source-code/19.react_native_new_architecture",
    "title": "19. React-native新架构",
    "description": "抹平 ios 和安卓样式差异的方式",
    "published": true,
    "date": "2023-04-19T00:00:00.000Z",
    "body": "const{Fragment:e,jsx:n,jsxs:l}=arguments[0];function _createMdxContent(c){const r={a:\"a\",code:\"code\",em:\"em\",figure:\"figure\",h1:\"h1\",h2:\"h2\",img:\"img\",li:\"li\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...c.components};return l(e,{children:[l(r.h1,{id:\"react-native新架构\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react-native新架构\",children:n(r.span,{className:\"icon icon-link\"})}),\"React-native新架构\"]}),\"\\n\",n(r.p,{children:\"文章主要介绍了 React-native 的新架构，包括抹平 ios 和安卓样式差异的方式，老架构存在的问题，新架构中如 JSI 中间层带来的诸多变化，如不再强依赖 JavaScriptCore 引擎、可直接在 js 层调用 native 方法等，还讲解了 RN 的渲染阶段、基本库如 React Navigation 等，以及异常捕捉、包更新等内容。\"}),\"\\n\",n(r.p,{children:\"关联问题: 新架构优势是什么 Fabric如何优化渲染 Turbo Modules怎样加速\"}),\"\\n\",n(r.p,{children:\"AI智能总结首次生成速度较慢, 请耐心等待\"}),\"\\n\",l(r.p,{children:[\"“ \",n(r.em,{children:l(r.strong,{children:[\"本文正在参加\",n(r.a,{href:\"https://juejin.cn/post/7207698564641996856/\",children:\"「金石计划」\"})]})}),\" ”\"]}),\"\\n\",l(r.h1,{id:\"1react-native的style\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1react-native的style\",children:n(r.span,{className:\"icon icon-link\"})}),\"1、React-native的style\"]}),\"\\n\",l(r.p,{children:[\"上一篇文章，我们应该已经对跨平台有了一定的概念，但这里其实有一个问题并没有解决，就是其实在\",n(r.code,{children:\"ios和安卓\"}),\"上的样式是有差异的，那么我们的\",n(r.code,{children:\"Rn\"}),\"就需要去抹平这种差异化，\",n(r.code,{children:\"rn\"}),\"中采用的是\",n(r.code,{children:\"css-in-js\"}),\"。\"]}),\"\\n\",l(r.p,{children:[\"我们在\",n(r.code,{children:\"js\"}),\"中写的\",n(r.code,{children:\"style\"}),\"对象，将由单独的一个线程去处理，也就是\",n(r.code,{children:\"Shadow thread\"}),\"。在这个线程中由\",n(r.code,{children:\"Yoga\"}),\"引擎（这也是facebook开发的）重新去计算\",n(r.code,{children:\"app\"}),\"的布局，这个引擎在计算了有关\",n(r.code,{children:\"app\"}),\"的东西后，将结果又反馈至\",n(r.code,{children:\"UI\"}),\"线程，最终呈现出来。\"]}),\"\\n\",n(r.p,{children:\"那么一个完整的老版本的架构是这样的：\"}),\"\\n\",n(r.p,{children:n(r.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/1.jpeg?updatedAt=1739809404405\",alt:\"image.png\"})}),\"\\n\",l(r.p,{children:[\"然后我们现在把整个流程理一下： 假设我们现在有一段\",n(r.code,{children:\"react\"}),\"的代码\"]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:l(r.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"{\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"width\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"200\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"height\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"200\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"/> \"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",l(r.p,{children:[\"下一步就是\",n(r.code,{children:\"js\"}),\"线程将其序列化\"]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"arduino\",\"data-theme\":\"houston\",children:l(r.code,{\"data-language\":\"arduino\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:n(r.span,{children:'UIManager.createView([352,\"RCTView\",191,{width\":200,\"height\":200}])'})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",l(r.p,{children:[\"而此时这个\",n(r.code,{children:\"task\"}),\"进入到了桥前的异步队列中，它的目的地是\",n(r.code,{children:\"ShadowThread\"}),\",\",n(r.code,{children:\"ShadowTread\"}),\"接收到这条信息后，先反序列化，形成\",n(r.code,{children:\"Shadow tree\"}),\"，然后传给\",n(r.code,{children:\"Yoga\"}),\"，形成原生布局信息。\"]}),\"\\n\",l(r.p,{children:[\"下一步又先序列化把信息传给\",n(r.code,{children:\"native\"}),\"线程，然后拿到后反序列化根据\",n(r.code,{children:\"布局信息\"}),\"去进行渲染和绘制。\"]}),\"\\n\",l(r.p,{children:[\"大伙现在应该已经对一个\",n(r.code,{children:\"rn\"}),\"的整体架构有了基本的了解，还记得上篇文章的问题吗？\",n(r.code,{children:\"桥\"}),\"的\",n(r.code,{children:\"负载和异步\"}),\"会导致性能问题和不确定性。\"]}),\"\\n\",l(r.ul,{children:[\"\\n\",l(r.li,{children:[\"\\n\",n(r.p,{children:\"线程信息的传递因为要减小开销每次都需要反复序列化，但序列化又是一个消耗很大的事情。\"}),\"\\n\"]}),\"\\n\",l(r.li,{children:[\"\\n\",n(r.p,{children:\"异步队列的不确定性，你并不能保证一个事件的顺序。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",l(r.p,{children:[\"因此\",n(r.code,{children:\"rn\"}),\"的新架构就是要去解决这些问题，也就是现在的中间层。\"]}),\"\\n\",l(r.h1,{id:\"2react-native新架构\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2react-native新架构\",children:n(r.span,{className:\"icon icon-link\"})}),\"2、React-native新架构\"]}),\"\\n\",n(r.p,{children:\"关于新架构的内容很多，可能有些地方我自己也有理解不当的地方欢迎指正。\"}),\"\\n\",l(r.p,{children:[\"我们先讲讲最大的改动，就\",n(r.code,{children:\"rn\"}),\"在新架构中直接把老的桥干掉了，直接换成了一个新的\",n(r.code,{children:\"中间层或者说通用层\"}),\"，也就是 \",n(r.code,{children:\"JS Interface (JSI)\"}),\"。在这个通用层里面有很多的新内容我们可以先看一下这个架构图。\\n\",n(r.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/2.jpeg?updatedAt=1739809404461\",alt:\"image.png\"})]}),\"\\n\",l(r.p,{children:[\"So，我们来看看有哪些变化，上面的图中间部分，就是\",n(r.code,{children:\"JSI\"}),\"。（解释一下为啥这个图是这样的，因为就\",n(r.code,{children:\"Turbo Modules\"}),\"我其实认为是\",n(r.code,{children:\"Native Moudles\"}),\"的加强，而\",n(r.code,{children:\"Fabric\"}),\"是\",n(r.code,{children:\"Renderer\"}),\"的加强，他们是原本就存在的）。\"]}),\"\\n\",l(r.p,{children:[\"1、\",n(r.code,{children:\"JS-bundle\"}),\"不再\",n(r.code,{children:\"强依赖\"}),\"于\",n(r.code,{children:\"JavaScriptCore\"}),\"引擎了。我们现在可以很方便用更好的引擎去替换了，性能更好了。比如\",n(r.code,{children:\"Hermes\"}),\"。\"]}),\"\\n\",l(r.p,{children:[\"2、\",n(r.code,{children:\"JSI\"}),\"让我们可以直接在\",n(r.code,{children:\"js\"}),\"层调用\",n(r.code,{children:\"native\"}),\"的方法了。由\",n(r.code,{children:\"HostObject C++ object\"}),\"实现,它直接存储了\",n(r.code,{children:\"native\"}),\"层方法和属性的引用放在了一个全局对象上，然后我们\",n(r.code,{children:\"js\"}),\"就可以直接调用\",n(r.code,{children:\"java/oc的api\"}),\"。\"]}),\"\\n\",l(r.p,{children:[\"3、\",n(r.code,{children:\"Turbo Modules\"}),\"的出现（上图中的Native Moudles），在之前的架构中 \",n(r.code,{children:\"JS\"}),\" 使用的所有 \",n(r.code,{children:\"Native Modules\"}),\"（例如蓝牙、地理位置、文件存储等）都必须在应用程序打开之前进行初始化，这意味着即使用户不需要某些模块，但是它仍然必须在启动时进行初始化。\"]}),\"\\n\",l(r.p,{children:[n(r.code,{children:\"Turbo Modules\"}),\" 基本上是对这些旧的 Native 模块的增强，正如在前面介绍的那样，现在 JS 将能够持有这些模块的引用，所以 \",n(r.code,{children:\"JS\"}),\" 代码可以仅在需要时才加载对应模块，这样可以将显着缩短 \",n(r.code,{children:\"RN\"}),\" 应用的启动时间。\"]}),\"\\n\",l(r.p,{children:[\"4、\",n(r.code,{children:\"Fabric\"}),\"也就是上图中的\",n(r.code,{children:\"renderer\"}),\"（以前shadow层是在native层实现的），一个新的\",n(r.code,{children:\"UI渲染器\"}),\"，它就相当于在c++中，可以直接创建一个 \",n(r.code,{children:\"ShadowTree\"}),\"，一个就是快，同时也减少了渲染元素的步骤。\"]}),\"\\n\",l(r.p,{children:[\"可能大家没懂，举个例子：当 \",n(r.code,{children:\"App\"}),\" 运行时，\",n(r.code,{children:\"React\"}),\" 会执行你的代码并在 \",n(r.code,{children:\"JS\"}),\" 中创建一个 \",n(r.code,{children:\"ReactElementTree\"}),\" ，基于这棵树渲染器会在 \",n(r.code,{children:\"C++\"}),\" 中创建一个 \",n(r.code,{children:\"ReactShadowTree\"}),\"。\",n(r.code,{children:\"Fabric\"}),\" 会使用 \",n(r.code,{children:\"Shadow Tree\"}),\" 来计算 \",n(r.code,{children:\"UI\"}),\" 元素的位置，而一旦 \",n(r.code,{children:\"Layout\"}),\" 完成，\",n(r.code,{children:\"Shadow Tree\"}),\" 就会被转换为由 \",n(r.code,{children:\"Native Elements\"}),\" 组成的 \",n(r.code,{children:\"HostViewTree\"}),\"（例如：RN 里的 会变成 Android 中的 ViewGroup 和 iOS 中的 UIView）。\"]}),\"\\n\",l(r.p,{children:[\"5、 \",n(r.code,{children:\"codegen\"}),\"其实就是一个静态类型检查器，\",n(r.code,{children:\"CodeGen\"}),\"使用类型确定后的 \",n(r.code,{children:\"JavaScript\"}),\" 来为\",n(r.code,{children:\"Turbo Modules\"}),\"和 \",n(r.code,{children:\"Fabric\"}),\"定义供他们使用的接口元素，并且它会在编译时生成更多的\",n(r.code,{children:\"native\"}),\"代码，而非运行时。\"]}),\"\\n\",l(r.h1,{id:\"3rn的渲染\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3rn的渲染\",children:n(r.span,{className:\"icon icon-link\"})}),\"3、RN的渲染\"]}),\"\\n\",n(r.p,{children:\"将 React 代码渲染到宿主平台，我们称为渲染流水线，可大致分为三个阶段：\"}),\"\\n\",l(r.ul,{children:[\"\\n\",l(r.li,{children:[\"渲染（\",n(r.code,{children:\"Render\"}),\"）：在 \",n(r.code,{children:\"JavaScript\"}),\" 中，\",n(r.code,{children:\"React\"}),\" 执行那些业务逻辑代码创建 \",n(r.code,{children:\"React\"}),\" 元素树（React Element Trees）。然后在 \",n(r.code,{children:\"C++\"}),\" 中，用 \",n(r.code,{children:\"React\"}),\" 元素树创建 \",n(r.code,{children:\"React\"}),\" 影子树（React Shadow Tree）。\"]}),\"\\n\",l(r.li,{children:[\"提交（\",n(r.code,{children:\"Commit\"}),\"）：在 \",n(r.code,{children:\"React\"}),\" 影子树完全创建后，渲染器会触发一次提交。这会将 \",n(r.code,{children:\"React\"}),\" 元素树和新创建的 \",n(r.code,{children:\"React\"}),\" 影子树的提升为“下一棵要挂载的树”。 这个过程中也包括了布局信息计算。\"]}),\"\\n\",l(r.li,{children:[\"挂载（\",n(r.code,{children:\"Mount\"}),\"）：\",n(r.code,{children:\"React\"}),\" 影子树有了布局计算结果后，它会被转化为一个宿主视图树（\",n(r.code,{children:\"Host View Tree\"}),\"）。\"]}),\"\\n\"]}),\"\\n\",l(r.h1,{id:\"4一些基本的库\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#4一些基本的库\",children:n(r.span,{className:\"icon icon-link\"})}),\"4、一些基本的库\"]}),\"\\n\",n(r.p,{children:\"Ok，上面都是框架的架构设计，我们先有一个大体的概念，那么现在我们稍微走近实战去了解一些必要的包，因为后面不会怎么讲。\"}),\"\\n\",l(r.p,{children:[n(r.code,{children:\"React-native\"}),\"只内置了一些必要的包，但为了尽可能的减小包的大小，许多的包需要你自己去配置，例如:\",n(r.code,{children:\"asyncStorage\"}),\"，这种\",n(r.code,{children:\"sdk\"}),\"你需要一点点依赖相关的原生知识，但问题不大，一般都会有模版去教你，照着模版就行了（但也不一定，绝大数情况是）。那么我们现在就看看一些常用的包。\"]}),\"\\n\",l(r.h2,{id:\"31react-navigation\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#31react-navigation\",children:n(r.span,{className:\"icon icon-link\"})}),\"3.1、React Navigation\"]}),\"\\n\",l(r.p,{children:[\"这个应该几乎是每个用\",n(r.code,{children:\"rn\"}),\"的同学都该了解的东西了，原生\",n(r.code,{children:\"app\"}),\"和\",n(r.code,{children:\"web\"}),\"的路由是不同的，在\",n(r.code,{children:\"app\"}),\"里其实是没有\",n(r.code,{children:\"url\"}),\"这种概念，在原生里要理解\",n(r.code,{children:\"screen\"}),\"，也就是说控制用户所见屏幕。在老版本\",n(r.code,{children:\"rn\"}),\"有一些原始导航组件去控制屏幕,但很复杂，所以就现在一般都会用到\",n(r.code,{children:\"react-navigation\"}),\"这个库。\"]}),\"\\n\",n(r.p,{children:\"我直接上实战吧，\"}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:l(r.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(r.span,{style:{color:\"#FFD493\"},children:\" *\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\" as\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" React\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(r.span,{style:{color:\"#FFD493\"},children:' \"react\"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"NavigationContainer\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(r.span,{style:{color:\"#FFD493\"},children:' \"@react-navigation/native\"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"createNativeStackNavigator\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(r.span,{style:{color:\"#FFD493\"},children:' \"@react-navigation/native-stack\"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" Home\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(r.span,{style:{color:\"#FFD493\"},children:' \"./Home\"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" Settings\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(r.span,{style:{color:\"#FFD493\"},children:' \"./Settings\"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" Stack\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"createNativeStackNavigator\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" App\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"return\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"NavigationContainer\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"Stack.Navigator\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"            <\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"Stack.Screen\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" name\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(r.span,{style:{color:\"#FFD493\"},children:'\"Home\"'}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" component\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"Home\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"            <\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"Stack.Screen\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" name\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(r.span,{style:{color:\"#FFD493\"},children:'\"Settings\"'}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" component\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"Settings\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"/>\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"        </\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"Stack.Navigator\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"NavigationContainer\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",l(r.p,{children:[n(r.code,{children:\"createNativeStackNavigator\"}),\"是创建你的导航组件的一个方法，它返回一个对象，里面有\",n(r.code,{children:\"Screen\"}),\"和\",n(r.code,{children:\"Navigator\"}),\"2个组件，他们用来配置导航\"]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:l(r.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" React\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(r.span,{style:{color:\"#FFD493\"},children:' \"react\"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"Button\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"StatusBar\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(r.span,{style:{color:\"#FFD493\"},children:' \"react-native\"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(r.span,{style:{color:\"#FFD493\"},children:' \"./styles\"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" Home\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"navigation\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"return\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"StatusBar\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" barStyle\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(r.span,{style:{color:\"#FFD493\"},children:'\"dark-content\"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\">Home Screen</\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"Button\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"title\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(r.span,{style:{color:\"#FFD493\"},children:'\"Settings\"'})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"onPress\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" navigation\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"navigate\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:'\"Settings\"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"/>\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",l(r.p,{children:[\"就看到\",n(r.code,{children:\"home\"}),\"组件，当你按下的时候就跳转到\",n(r.code,{children:\"settings\"}),\"这个屏幕上去，更多的内容我们后面实战的时候再讲吧，只是做个简单的演示。\"]}),\"\\n\",l(r.h2,{id:\"32-rn组件库\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#32-rn组件库\",children:n(r.span,{className:\"icon icon-link\"})}),\"3.2 RN组件库\"]}),\"\\n\",l(r.p,{children:[n(r.code,{children:\"antd mobile\"}),\"估计国内我们基本用的都这个或者就是自己封装的组件库，推荐几个其他的\",n(r.code,{children:\"NativeBase\"}),\"、\",n(r.code,{children:\"React Native Element\"}),\"、 \",n(r.code,{children:\"UI Kittern\"}),\"、 \",n(r.code,{children:\"React-native-paper\"})]}),\"\\n\",l(r.h2,{id:\"33-启动页\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#33-启动页\",children:n(r.span,{className:\"icon icon-link\"})}),\"3.3 启动页\"]}),\"\\n\",l(r.p,{children:[\"其实启动页就是你\",n(r.code,{children:\"js\"}),\"线程启动前展示的过度页面，\",n(r.code,{children:\"React-native-bootsplash\"}),\"。\"]}),\"\\n\",l(r.h2,{id:\"34-icon\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#34-icon\",children:n(r.span,{className:\"icon icon-link\"})}),\"3.4 Icon\"]}),\"\\n\",l(r.p,{children:[n(r.code,{children:\"react-native-vector-icons\"}),\"、 \",n(r.code,{children:\"react-native-svg\"}),\"。\"]}),\"\\n\",l(r.h2,{id:\"35-异常捕捉\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#35-异常捕捉\",children:n(r.span,{className:\"icon icon-link\"})}),\"3.5 异常捕捉\"]}),\"\\n\",l(r.p,{children:[\"通常，当我们开发一个web应用时，我们很好处理错误，因为它们不会超出\",n(r.code,{children:\"JS\"}),\"的范围。简单的说我们前端就是\",n(r.code,{children:\"web\"}),\"的王（掌控力），我们可以很容易地看到原因，并在\",n(r.code,{children:\"DevTools\"}),\"中打开日志。\"]}),\"\\n\",l(r.p,{children:[\"但\",n(r.code,{children:\"Rn\"}),\"因为除了环境的JS之外，我们还有\",n(r.code,{children:\"native\"}),\"组件，这也可能导致\",n(r.code,{children:\"app\"}),\"执行中的错误。因此，当发生错误时，我们的应用程序将关闭立即我们很难弄清楚原因，因此\",n(r.code,{children:\"React-native-exception-handler\"}),\"也正是解决这个问题的包。\"]}),\"\\n\",n(r.p,{children:\"就像这样：\"}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:l(r.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"setJSExceptionHandler\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"setNativeExceptionHandler\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(r.span,{style:{color:\"#FFD493\"},children:' \"react-native-exception-handler\"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"setJSExceptionHandler\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"((\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"error\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"isFatal\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// …\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"});\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" exceptionhandler\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"exceptionString\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 处理异常代码\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"};\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"setNativeExceptionHandler\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"exceptionhandler\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"forceAppQuit\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#4BF3C8\"},children:\"executeDefaultHandler\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",l(r.h2,{id:\"36-包更新\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#36-包更新\",children:n(r.span,{className:\"icon icon-link\"})}),\"3.6 包更新\"]}),\"\\n\",l(r.p,{children:[\"其实如果是ios我们要更新应用上传到商店，有这么个技术\",n(r.code,{children:\"OAT\"}),\"可以替换js包,就可以看看微软的\",n(r.code,{children:\"Codepush\"})]}),\"\\n\",l(r.h1,{id:\"4结束\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#4结束\",children:n(r.span,{className:\"icon icon-link\"})}),\"4、结束\"]}),\"\\n\",l(r.p,{children:[n(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Freactnative.cn%2F\",title:\"https://reactnative.cn/\",children:\"rn中文文档地址\"}),\"，就这2篇文章都是在理一些基础理论的东西，对于一些组件api大伙可以看看文档。呜！就你想成为强者吗！那就来一起学习吧，->\",n(r.a,{href:\"https://juejin.cn/user/400646714977431/pins\",children:\"看这里沸点\"}),\"。\"]})]})}return{default:function(e={}){const{wrapper:l}=e.components||{};return l?n(l,{...e,children:n(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "toc": {
      "content": [
        {
          "title": "React-native新架构",
          "url": "#react-native新架构",
          "items": []
        },
        {
          "title": "1、React-native的style",
          "url": "#1react-native的style",
          "items": []
        },
        {
          "title": "2、React-native新架构",
          "url": "#2react-native新架构",
          "items": []
        },
        {
          "title": "3、RN的渲染",
          "url": "#3rn的渲染",
          "items": []
        },
        {
          "title": "4、一些基本的库",
          "url": "#4一些基本的库",
          "items": [
            {
              "title": "3.1、React Navigation",
              "url": "#31react-navigation",
              "items": []
            },
            {
              "title": "3.2 RN组件库",
              "url": "#32-rn组件库",
              "items": []
            },
            {
              "title": "3.3 启动页",
              "url": "#33-启动页",
              "items": []
            },
            {
              "title": "3.4 Icon",
              "url": "#34-icon",
              "items": []
            },
            {
              "title": "3.5 异常捕捉",
              "url": "#35-异常捕捉",
              "items": []
            },
            {
              "title": "3.6 包更新",
              "url": "#36-包更新",
              "items": []
            }
          ]
        },
        {
          "title": "4、结束",
          "url": "#4结束",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "19.react_native_new_architecture"
  },
  {
    "slug": "/content/react-source-code/2.react_source_code_reading_fiber_construction_principle",
    "title": "2.React源码阅读-fiber核心构建原理",
    "description": "文章主要介绍了 React 源码中 fiber 核心的构建原理",
    "published": true,
    "date": "2022-11-29T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:n,jsxs:e}=arguments[0];function _createMdxContent(r){const c={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",h3:\"h3\",h4:\"h4\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",...r.components};return e(l,{children:[e(c.h1,{id:\"react源码阅读2-fiber核心构建原理\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react源码阅读2-fiber核心构建原理\",children:n(c.span,{className:\"icon icon-link\"})}),\"React源码阅读(2)-fiber核心构建原理\"]}),\"\\n\",e(c.p,{children:[\"文章主要介绍了 React 源码中 fiber 核心的构建原理，包括执行上下文、入口函数、构建阶段（如 \",n(c.code,{children:\"performSyncWorkOnRoot\"}),\" 中的树构建和提交）、提交阶段（准备、提交的三个子阶段、渲染完成后的操作）以及调度注册等，还展示了手写 fiber-dom 的部分代码。\"]}),\"\\n\",n(c.p,{children:\"关联问题: Fiber 构建如何优化 手写代码能扩展吗 调度细节如何理解\"}),\"\\n\",n(c.p,{children:\"AI智能总结首次生成速度较慢, 请耐心等待\"}),\"\\n\",e(c.h1,{id:\"react-reconciler核心逻辑理解并手写\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react-reconciler核心逻辑理解并手写\",children:n(c.span,{className:\"icon icon-link\"})}),\"react-reconciler核心逻辑理解并手写\"]}),\"\\n\",n(c.p,{children:\"想了很久该怎么写，才能写出来让大家看懂，就我们先抛开复杂的车道优先级和调度优先级以及调度等级以及react大量的时间操作等到后面分析18源码的时候一起讲。就从最简单的开始手写fiber-dom。\"}),\"\\n\",e(c.h2,{id:\"1react构建fiber核心代码\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1react构建fiber核心代码\",children:n(c.span,{className:\"icon icon-link\"})}),\"1.react构建fiber核心代码\"]}),\"\\n\",e(c.p,{children:[\"对应源码位于\",n(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiberWorkLoop.old.js\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js\",children:\"ReactFiberWorkLoop.js\"}),\"，\\n我们先大致了解一下整体的走向图。 \",n(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/reactFiberWorkLoop.jpeg\",alt:\"image.png\"})]}),\"\\n\",e(c.h3,{id:\"11-入口\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#11-入口\",children:n(c.span,{className:\"icon icon-link\"})}),\"1.1 入口\"]}),\"\\n\",e(c.p,{children:[\"在全局变量中有\",n(c.code,{children:\"executionContext\"}),\", 代表\",n(c.code,{children:\"渲染期间\"}),\"的\",n(c.code,{children:\"执行上下文\"}),\", 它也是一个二进制表示的变量, 通过位运算进行操作. 在源码中一共定义了 8 种执行栈:\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"type\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" ExecutionContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" NoContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*             */\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 0b0000000\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" BatchedContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*               */\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 0b0000001\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" EventContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*                 */\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 0b0000010\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" DiscreteEventContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*         */\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 0b0000100\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" LegacyUnbatchedContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*       */\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 0b0001000\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" RenderContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*                */\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 0b0010000\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" CommitContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*                */\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 0b0100000\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"这里我们只分析\",n(c.code,{children:\"Legacy\"}),\"模式（对启动模式不清楚的可以看看\",n(c.a,{href:\"https://juejin.cn/post/7167837278784454664\",children:\"开篇\"}),\"）, \",n(c.code,{children:\"Legacy\"}),\"模式下的首次更新, 会直接进行构建，然后经过提交到页面上，并不会进入去注册调度任务。\"]}),\"\\n\",e(c.p,{children:[\"接下来从输入(\",n(c.a,{href:\"https://juejin.cn/post/7172468177450827790\",children:\"阅读须知\"}),\")开始我们看核心的输入源码\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" scheduleUpdateOnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  lane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Lane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  eventTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"SyncLane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // legacy模式\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 首次无上下文也无渲染上下文\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"executionContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"LegacyUnbatchedContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"executionContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"RenderContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"CommitContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")) === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoContext\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    ) {\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 初次更新\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      performSyncWorkOnRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 后续的更新，注册调度任务\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      ensureRootIsScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"eventTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"在 render 过程中, 每一个阶段都会改变\",n(c.code,{children:\"executionContext\"}),\"(render 之前, 会设置\",n(c.code,{children:\"executionContext |= RenderContext\"}),\"; commit 之前, 会设置\",n(c.code,{children:\"executionContext |= CommitContext\"}),\"), 假设在\",n(c.code,{children:\"render\"}),\"过程中再次发起更新(如在\",n(c.code,{children:\"UNSAFE_componentWillReceiveProps\"}),\"生命周期中调用\",n(c.code,{children:\"setState\"}),\")则可通过\",n(c.code,{children:\"executionContext\"}),\"来判断当前的\",n(c.code,{children:\"render\"}),\"状态。上面我们已经看到了入口的函数\",n(c.code,{children:\"scheduleUpdateOnFiber\"}),\",接下来我们分析入口函数中的2个关键的函数\",n(c.code,{children:\"performSyncWorkOnRoot\"}),\"和\",n(c.code,{children:\"ensureRootIsScheduled\"}),\"。\"]}),\"\\n\",e(c.h3,{id:\"12-performsyncworkonroot\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#12-performsyncworkonroot\",children:n(c.span,{className:\"icon icon-link\"})}),\"1.2 performSyncWorkOnRoot\"]}),\"\\n\",e(c.p,{children:[\"首先我们来分析\",n(c.code,{children:\"performSyncWorkOnRoot\"}),\",里面的主要做的事情就是做\",n(c.code,{children:\"fiber树\"}),\"的构建以及最后的提交\",n(c.code,{children:\"commitRoot\"}),\"。在这个函数中我们也可以分为2个阶段，一个阶段是\",n(c.code,{children:\"fiber树\"}),\"的构建，另一个阶段是\",n(c.code,{children:\"commitRoot\"}),\"的提交（输出）。\"]}),\"\\n\",e(c.h4,{id:\"阶段1fiber树的构建\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#阶段1fiber树的构建\",children:n(c.span,{className:\"icon icon-link\"})}),\"阶段1.fiber树的构建\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" performSyncWorkOnRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" exitStatus\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // workInProgressRoot当前构建的任务\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    includesSomeLane\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"expiredLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressRootRenderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  ) {\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 初次构建的时候从root节点开始, 形成一个完成的fiberdom树\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressRootRenderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    exitStatus\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"renderRootSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 1. 获取本次render的优先级, 初次构造返回 NoLanes\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getNextLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 2. 从root节点开始, 至上而下更新，形成一个完成的fiberdom树\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    exitStatus\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"renderRootSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 将最新的fiber树挂载到root.finishedWork节点上\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 进入commit阶段，渲染到页面上\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  commitRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"实际我们看到不管是初次构建还是后续更新都会走到\",n(c.code,{children:\"renderRootSync\"}),\"上去构建fiber树，那它又做了什么那\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" renderRootSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" prevExecutionContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"executionContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  executionContext\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" |=\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" RenderContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 如果fiberRoot变动, 或者update.lane变动,update(链表我们后面讲)\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressRootRenderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 刷新栈帧\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    prepareFreshStack\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  do\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    try\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 核心代码循环构建fiber\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      workLoopSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      break\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"thrownValue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      handleError\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"thrownValue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  executionContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"prevExecutionContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 重置全局变量, 表明render结束\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  workInProgressRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  workInProgressRootRenderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgressRootExitStatus\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"如果是初读源码我们可以只关心一个地方那就是\",n(c.code,{children:\"workLoopSync\"}),\",当然这是在\",n(c.code,{children:\"legacy\"}),\"模式下，\",n(c.code,{children:\"concurrent\"}),\"模式下走的是\",n(c.code,{children:\"workLoopConcurrent\"}),\"去实现时间分片和循环可中断。下一步我们就可以看\",n(c.code,{children:\"workLoopSync\"})]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" workLoopSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    performUnitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"这里就相当于把循坏构建fiberDom树了,而前面备注中也写到了workInProgress指向当前构建的任务或者说节点更适合一些，来到构建fiberDom树的\",n(c.code,{children:\"performUnitOfWork\"}),\".\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" performUnitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"unitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 指向当前页面的`fiber`节点. 初次构造时, 页面还未渲染, 就是空的\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"enableProfilerTimer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"mode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"ProfileMode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoMode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    startProfilerTimer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"beginWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"subtreeRenderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    stopProfilerTimerIfRunningAndRecordDelta\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    //构建出最终的fiberDom,并且返回dom结构的chilrden处理之后的child\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"beginWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"subtreeRenderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  unitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 没新节点的时候就可以准备回溯洛\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    completeUnitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  ReactCurrentOwner\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"进入\",n(c.code,{children:\"beginWork\"}),\",这里主要做的事情是通过ReactElement去完成fiber树的更新和构建，他的细节是在在于针对每一个fiber类型分别有不同的\",n(c.code,{children:\"update\"}),\"函数去做处理，值得一提的是这里基本完成了fiber本身基础状态的一些设置，我觉得我们这个阅读阶段我们先关注主流程的事情，也就是\",n(c.code,{children:\"updateXXX\"}),\"的处理。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" beginWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | null,\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  renderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | null {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 忽略代码\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 这里是对于所有fiber类型的不同处理，我们关心不同tag怎么处理的就行了，等下手写的时候写简单一点\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  switch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" IndeterminateComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" mountIndeterminateComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        renderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" LazyComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" elementType\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"elementType\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" mountLazyComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        elementType\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        updateLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        renderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" FunctionComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" Component\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" unresolvedProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" resolvedProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" =\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"elementType\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Component\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"          ?\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" unresolvedProps\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"          :\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" resolveDefaultProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Component\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unresolvedProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" updateFunctionComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        Component\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        resolvedProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        renderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" ClassComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" Component\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" unresolvedProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" resolvedProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" =\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"elementType\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Component\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"          ?\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" unresolvedProps\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"          :\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" resolveDefaultProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Component\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unresolvedProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" updateClassComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        Component\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        resolvedProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        renderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" HostRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" updateHostRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" HostComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" updateHostComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" HostText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" updateHostText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   //忽略代码\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"举个例子\",n(c.code,{children:\"updateHostRoot\"}),\"，这里我就可以看到一些具体的fiber构建的细节了。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" updateHostRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"renderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 1. 状态计算, 更新整合到 workInProgress.memoizedState中来\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" updateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" nextProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" prevState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" prevChildren\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"prevState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" prevState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" :\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  cloneUpdateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 遍历updateQueue.shared.pending, 提取有足够优先级的update对象, 计算出最终的状态 workInProgress.memoizedState\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  processUpdateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" nextState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"memoizedState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 2. 获取下级`ReactElement`对象\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" nextChildren\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"stateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"hydrate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"enterHydrationState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // ...服务端渲染相关, 此处省略\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 3. 根据`ReactElement`对象, 调用`reconcileChildren`生成`Fiber`子节点(只生成`次级子节点`)\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    reconcileChildren\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextChildren\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 返回child进行下一次循坏\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"而在此之后那我们就进去一个由下往上的回溯阶段（递归中的归），也就是\",n(c.code,{children:\"completeUnitOfWork\"}),\"（\",n(c.code,{children:\"performUnitOfWork\"}),\"中的方法），同样我们关注在当前阅读这个主流程上函数做了什么，首先他给\",n(c.code,{children:\"stateNode\"}),\"去指向了一个Dom实例，设置属性绑定事件，设置flag标记，紧接着处理副作用链表队列(\",n(c.a,{href:\"https://juejin.cn/post/7172172144388866055\",children:\"就是更新头尾指针\"}),\"，emm有数据结构算法基础的可以看看)，然后有一些兄弟节点子节点的判断。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" completeUnitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"unitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"unitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 外层循环控制并移动指针(`workInProgress`,`completedWork`等)\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  do\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" ((\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Incomplete\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoFlags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 1. 处理Fiber节点, 关联Fiber节点和dom对象, 绑定事件\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"completeWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"subtreeRenderLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"); \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 处理单个节点\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 子节点, 则回到beginWork阶段进行处理\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 重置子节点的优先级\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      resetChildLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Incomplete\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoFlags\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      ) {\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 2. 收集当前Fiber节点以及其子树的副作用effects\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 2.1 把子节点的副作用队列添加到父节点上，只有父节点的firstEffect不存在时\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 才能将父节点的firstEffect指向当前节点的副作用单向链表头\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          //让父节点的firstEffect指向当前节点的firstEffect\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"          returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        //当前节点不存在副作用链表才加\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"          if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"            returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"          }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 将当前节点加到副作用链表中\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"          returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 2.2 如果当前fiber节点有副作用, 将其添加到子节点的副作用队列之后.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"PerformedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 忽略PerformedWork\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 将当前节点添加到副作用链表尾部\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"          if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"            returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"            returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"          }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"          returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" siblingFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"siblingFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 如果有兄弟节点, 返回之后再次进入beginWork阶段\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"siblingFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 移动指针, 指向下一个节点\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"completedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 已回溯到根节点, 设置workInProgressRootExitStatus = RootCompleted\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressRootExitStatus\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"RootIncomplete\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    workInProgressRootExitStatus\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"RootCompleted\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"到这那我们已经就可以走到上面的\",n(c.code,{children:\"commitRoot\"}),\"将内存里的\",n(c.code,{children:\"fiber树\"}),\"输出到\",n(c.code,{children:\"react-dom\"}),\"了。\"]}),\"\\n\",e(c.h4,{id:\"阶段2fiber树的输出\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#阶段2fiber树的输出\",children:n(c.span,{className:\"icon icon-link\"})}),\"阶段2.fiber树的输出\"]}),\"\\n\",e(c.p,{children:[\"在我们的构建阶段结束后，会在\",n(c.code,{children:\"performSyncWorkOnRoot\"}),\"、\",n(c.code,{children:\"finishConcurrentRender\"}),\"中的\",n(c.code,{children:\"fiberRoot\"}),\"传给\",n(c.code,{children:\"commitRoot\"}),\"，去开始\",n(c.code,{children:\"commit\"}),\"提交阶段，此时已经到了\",n(c.code,{children:\"fiber\"}),\"的最终输出阶段，经过了一系列优先级转换，最终会执行\",n(c.code,{children:\"commitRootImpl\"}),\"。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" commitRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 渲染等级\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" renderPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getCurrentPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 调度等级\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  runWithPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    ImmediateSchedulerPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    commitRootImpl\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"bind\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"renderPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  );\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"commitRootImpl\"}),\"主要工作就是遍历\",n(c.code,{children:\"effect\"}),\"数组去添加对应的标记，最终交给\",n(c.code,{children:\"react-dom\"}),\"执行，\",n(c.code,{children:\"commit\"}),\"有三个大阶段：1.提交\",n(c.code,{children:\"准备阶段\"}),\"。2.\",n(c.code,{children:\"提交阶段\"}),\",而提交阶段中的三个\",n(c.code,{children:\"while\"}),\"循坏下分别又对应3个子阶段：\",n(c.code,{children:\"before mutation\"}),\"阶段。\",n(c.code,{children:\"mutation\"}),\"阶段。\",n(c.code,{children:\"layout\"}),\"阶段。3.\",n(c.code,{children:\"提交后\"}),\"。代码较长我们分成3部分解释。\"]}),\"\\n\",e(c.h4,{id:\"1准备阶段\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1准备阶段\",children:n(c.span,{className:\"icon icon-link\"})}),\"1:准备阶段。\"]}),\"\\n\",n(c.p,{children:\"我们大概做了这几个操作：\"}),\"\\n\",e(c.p,{children:[\"1.判断是否有未执行的\",n(c.code,{children:\"useEffect\"}),\"，如果有先执行，等待我们上一轮的\",n(c.code,{children:\"useEffect\"}),\"执行完后才继续我们\",n(c.code,{children:\"commit\"}),\"。\"]}),\"\\n\",e(c.p,{children:[\"2.更新副作用队列，将根节点加到尾部,取出 \",n(c.code,{children:\"firstEffect\"}),\"，也就是第一个需要被处理的 fiber 节点。\"]}),\"\\n\",e(c.p,{children:[\"3.接着判断如果存在 \",n(c.code,{children:\"firstEffect\"}),\"，会将 \",n(c.code,{children:\"firstEffect\"}),\" 指向 \",n(c.code,{children:\"nextEffect\"}),\"，开始三个子阶段。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" commitRootImpl\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"renderPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 准备提交阶段\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 判断rootWithPendingPassiveEffects，就是说先判断是否有未执行的useEffect，如果有先执行，等待我们上一轮的useEffect执行完后才继续我们commit。\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  do\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // \"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    flushPassiveEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"rootWithPendingPassiveEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 忽略代码\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 再次更新副作用队列，在前面的函数式组件更新阶段后，`effct list`这条链表只有子节点，没有挂载到根节点上，默认情况下fiber节点的副作用队列是不包括自身的,如果根节点也存在 `effectTag`，那么就需要把根节点拼接到链表的末尾，形成一条完整的 `effect list`，取出第一个需要处理的fiber节点\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"PerformedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // There is no effect on the root.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 忽略代码\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 进入第二阶段\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // beforeMutation 子阶段：\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 执行 commitBeforeMutationEffects\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    \"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // mutation 子阶段：\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 执行 commitMutationEffects\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    \"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // layout 子阶段：\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 执行 commitLayoutEffects\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 忽略代码\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.h4,{id:\"2提交阶段\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2提交阶段\",children:n(c.span,{className:\"icon icon-link\"})}),\"2:提交阶段。\"]}),\"\\n\",e(c.p,{children:[\"这里我们有三个子阶段，对应的是三个函数 \",n(c.code,{children:\"commitBeforeMutationEffects\"}),\",\",n(c.code,{children:\"commitMutationEffects\"}),\",\",n(c.code,{children:\"commitLayoutEffects\"})]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" prevExecutionContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"executionContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    executionContext\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" |=\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" CommitContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 阶段1: dom改变之前\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    do\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      commitBeforeMutationEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 阶段2: dom改变, 界面发生改变\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    do\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      commitMutationEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"renderPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 恢复界面状态\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    resetAfterCommit\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"containerInfo\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 切换current指针\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 阶段3: layout阶段, 调用生命周期componentDidUpdate和回调函数等\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    do\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      commitLayoutEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    executionContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"prevExecutionContext\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[n(c.strong,{children:\"子阶段1\"}),\"：在dom变化前,\",n(c.code,{children:\"commitBeforeMutationEffects\"}),\"会主要做两件事。1、执行\",n(c.code,{children:\"getSnapshowBeforeUpdate\"}),\"（\",n(c.code,{children:\"commitBeforeMutationEffectOnFiber\"}),\"）生命周期方法。2、调度\",n(c.code,{children:\"useEffect\"})]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" commitBeforeMutationEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 忽略代码\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    \"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" effectTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effectTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" ((\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effectTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Snapshot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 忽略代码\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      commitBeforeMutationEffectOnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\" \"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 忽略代码\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 省略代码\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" commitBeforeMutationEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 处理Snapshot标记\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" ((\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Snapshot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoFlags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 这里实际就是处理2个节点，对于ClassComponent类型节点, 调用instance.getSnapshotBeforeUpdate生命周期函数，对于HostRoot类型节点, 调用clearContainer清空了容器节点(即`div#root`这个 dom 节点).\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      commitBeforeMutationEffectOnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 处理Passive标记\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" ((\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Passive\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoFlags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 处理useEffect\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 用于执行useEffect的回调函数，不立即执行，放在scheduleCallBack的回调中，异步根据优先级执行这个回调函数，如果说存在Passive effect，就将rootDoesHavePassiveEffects置为true，并且加入调度，而我们整个commit是一个同步执行操作，所以useEffect会在commit完成后去异步执行。这就跟上面的对上了。\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"rootDoesHavePassiveEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        rootDoesHavePassiveEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        scheduleCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NormalSchedulerPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"          flushPassiveEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"          return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        });\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[n(c.strong,{children:\"子阶段2\"}),\"：dom 变更, 界面得到更新. 处理副作用队列中带有\",n(c.code,{children:\"ContentReset\"}),\", \",n(c.code,{children:\"Ref\"}),\", \",n(c.code,{children:\"Placement\"}),\", \",n(c.code,{children:\"Update\"}),\", \",n(c.code,{children:\"Deletion\"}),\", \",n(c.code,{children:\"Hydrating\"}),\"标记的\",n(c.code,{children:\"fiber\"}),\"节点. 调用栈：\"]}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[n(c.code,{children:\"新增\"}),\": 函数调用栈 \",n(c.code,{children:\"commitPlacement\"}),\" -> \",n(c.code,{children:\"insertOrAppendPlacementNode\"}),\"或者\",n(c.code,{children:\"insertOrAppendPlacementNode\"}),\"-> \",n(c.code,{children:\"appendChild\"}),\"或者\",n(c.code,{children:\"insertBefore\"})]}),\"\\n\"]}),\"\\n\",e(c.p,{children:[\"为什么会有或那，因为实际上我们的\",n(c.code,{children:\"fiber\"}),\"树和\",n(c.code,{children:\"dom\"}),\"数并不表现一致，后面单独写一篇文章讲一下。\"]}),\"\\n\",e(c.ol,{start:\"2\",children:[\"\\n\",e(c.li,{children:[n(c.code,{children:\"更新\"}),\": 函数调用栈 \",n(c.code,{children:\"commitWork\"}),\" -> \",n(c.code,{children:\"commitUpdate\"})]}),\"\\n\"]}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"commitWork\"}),\"，会根据\",n(c.code,{children:\"fiber\"}),\"节点的不同做不同的更新操作\"]}),\"\\n\",e(c.ol,{start:\"3\",children:[\"\\n\",e(c.li,{children:[n(c.code,{children:\"删除\"}),\": 函数调用栈 \",n(c.code,{children:\"commitDeletion\"}),\" -> \",n(c.code,{children:\"unmountHostComponents\"}),\" -> \",n(c.code,{children:\"removeChild\"})]}),\"\\n\"]}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"commitDeletion\"}),\"其实是调用\",n(c.code,{children:\"unmountHostComponents\"}),\"，对不同的节点类型做销毁操作。\"]}),\"\\n\",e(c.p,{children:[\"我们最终就会调用\",n(c.code,{children:\"react-dom\"}),\"里面的api，去让页面实现更新\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" commitMutationEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"renderPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" effectTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effectTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    \"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 如果有 ContentReset，会重置文本节点\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effectTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"ContentReset\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      commitResetTextContent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    \"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 如果有 Ref，会执行 ref 相关的更新\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Ref\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 先清空ref, 在commitRoot的第三阶段(dom变更后), 再重新赋值\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"          commitDetachRef\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"     }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 处理dom的变化\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" primaryEffectTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" =\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      effectTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Placement\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Update\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Deletion\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Hydrating\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    switch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"primaryEffectTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 如果需要插入节点，会执行 commitPlacement\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" Placement\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        commitPlacement\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effectTag\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" &=\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" ~\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Placement\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        break\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 如果需要更新节点，会执行 commitWork\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" Update\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        commitWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        break\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 如果需要删除节点，会执行 commitDeletion\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" Deletion\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        commitDeletion\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"renderPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        break\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 忽略代码\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    \"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 取出下一个 fiber 节点，进入下一次循环\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[n(c.strong,{children:\"子阶段3\"}),\"：\",n(c.code,{children:\"layout\"}),\"，\",n(c.code,{children:\"commitLayoutEffects\"}),\"核心是执行\",n(c.code,{children:\"commitLayoutEffectOnFiber\"}),\"这个阶段会根据\",n(c.code,{children:\"fiber\"}),\"节点的类型执行不同的处理。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" commitLayoutEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"committedLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 忽略代码\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"   \"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 处理标记\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Update\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      commitLayoutEffectOnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"committedLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    \"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Ref\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 重新设置ref\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      commitAttachRef\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 忽略代码\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 忽略代码\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"commitLayoutEffectOnFiber\"}),\"是引入\",n(c.code,{children:\"commitLifeCycles\"}),\"设置的别名，我们先针对于 \",n(c.code,{children:\"FunctionComponent\"}),\"这个\",n(c.code,{children:\"case\"}),\"来分析后面的调用逻辑（因为函数式组件是现在的主流嘛），这里会把 \",n(c.code,{children:\"HookLayout\"}),\" 这个 \",n(c.code,{children:\"tag\"}),\" 类型传给 \",n(c.code,{children:\"commitHookEffectListMount\"}),\" 方法，也就是说接下来的\",n(c.code,{children:\"commitHookEffectListMount\"}),\"会执行 \",n(c.code,{children:\"useLayoutEffect\"}),\" 的回调函数。接着执行\",n(c.code,{children:\"schedulePassiveEffects\"}),\"，就是把带有\",n(c.code,{children:\"Passive\"}),\"标记的\",n(c.code,{children:\"effect\"}),\"筛选出来(由\",n(c.code,{children:\"useEffect\"}),\"创建), 添加到一个全局数组(\",n(c.code,{children:\"pendingPassiveHookEffectsUnmount\"}),\"和\",n(c.code,{children:\"pendingPassiveHookEffectsMount\"}),\").。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" commitLifeCycles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  finishedRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | null,\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  committedLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  switch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" FunctionComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" ForwardRef\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" SimpleMemoComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    case\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" Block\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        {\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        try\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"          startLayoutEffectTimer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 执行useLayoutEffect回调函数\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"          commitHookEffectListMount\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"HookLayout\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"HookHasEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"finally\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"          recordLayoutEffectDuration\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // finishedWork指的是正在被遍历的有副作用的fiber，放入调度中\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      schedulePassiveEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"对于\",n(c.code,{children:\"FunctionComponent\"}),\",\",n(c.code,{children:\"commitHookEffectListMount\"}),\"方法会执行我们的\",n(c.code,{children:\"effect.creat\"}),\"并指向\",n(c.code,{children:\"destory\"}),\"销毁，接着执行\",n(c.code,{children:\"schedulePassiveEffects\"}),\"方法,在这里会分别注册 \",n(c.code,{children:\"useEffect\"}),\" ,推进 \",n(c.code,{children:\"pendingPassiveHookEffectsUnmount\"}),\" 和 \",n(c.code,{children:\"pendingPassiveHookEffectsMount\"}),\" 这两个数组中，用于后续\",n(c.code,{children:\"flushPassveEffects\"}),\"执行。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" commitHookEffectListMount\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" updateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FunctionComponentUpdateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | null = (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" updateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" :\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    do\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" ((\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" create\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"create\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        //执行effect回调,调用effect.create()之后, 将返回值赋值到effect.destroy.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"destroy\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"create\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" schedulePassiveEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 1. 获取 fiber.updateQueue\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" updateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FunctionComponentUpdateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | null = (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 2. 获取 effect环形队列\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" updateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" :\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lastEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    do\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      //  筛选出由useEffect()创建的effect\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"HookPassive\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoHookEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"HookHasEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"NoHookEffect\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      ) {\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 把effect添加到全局数组, 等待flushPassiveEffectsImpl处理\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        enqueuePendingPassiveHookEffectUnmount\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        enqueuePendingPassiveHookEffectMount\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" enqueuePendingPassiveHookEffectUnmount\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"HookEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // unmount effects 数组\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  pendingPassiveHookEffectsUnmount\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"push\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" enqueuePendingPassiveHookEffectMount\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"  effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"HookEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"): \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // mount effects 数组\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  pendingPassiveHookEffectsMount\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"push\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"到此时第三子阶段就可以告于段落了，紧接着就是\",n(c.code,{children:\"commit\"}),\"的第三个阶段\"]}),\"\\n\",e(c.h4,{id:\"3渲染完成后\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3渲染完成后\",children:n(c.span,{className:\"icon icon-link\"})}),\"3:渲染完成后\"]}),\"\\n\",e(c.p,{children:[\"渲染后主要是做一些\",n(c.code,{children:\"清理\"}),\"、\",n(c.code,{children:\"检测更新\"}),\"操作，当然我们这里还是以函数式组件为例。\"]}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"清理\"}),\"：清理有两个地方，一个是链表拆解的清理，因为gc没法回收，就得手动把链表拆开。第二个地方，因为我们前面保存了2个数组\",n(c.code,{children:\"unmount effect\"}),\"和\",n(c.code,{children:\"mount effects\"}),\",\",n(c.code,{children:\"useEffect\"}),\"会留置到 \",n(c.code,{children:\"flushPassiveEffects\"}),\"()监测更新后再去清理。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\" nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"firstEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" nextNextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" & \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Deletion\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        detachFiberAfterEffects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      nextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"nextNextEffect\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"监测更新\"}),\":重点是在这个地方，在渲染后的更新我们只说2个必定会调用的监测函数\",n(c.code,{children:\"ensureRootIsScheduled\"}),\"和\",n(c.code,{children:\"flushSyncCallbackQueue\"}),\",\",n(c.code,{children:\"ensureRootIsScheduled\"}),\"这是用来处理异步任务的(走到我们前文说的流程)，\",n(c.code,{children:\"flushSyncCallbackQueue\"}),\"处理同步任务，如果有就直接调用，再次进入fiber树构造，\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" flushSyncCallbackQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"immediateQueueCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"immediateQueueCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    immediateQueueCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    Scheduler_cancelCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  flushSyncCallbackQueueImpl\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:\"到这里就很简单了循坏去执行同步任务，再次构建。\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" flushSyncCallbackQueueImpl\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isFlushingSyncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"syncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // Prevent re-entrancy.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    isFlushingSyncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" i\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"decoupleUpdatePriorityFromScheduler\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" previousLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getCurrentUpdateLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      try\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" isSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" queue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"syncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        setCurrentUpdateLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"SyncLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        runWithPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"ImmediatePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"          for\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (; \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"length\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"++) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"            let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"            do\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"              //循坏执行同步任务\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"              callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"            } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"          }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        });\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        syncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"error\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // If something throws, leave the remaining callbacks on the queue.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"syncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"          syncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"syncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"slice\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // Resume flushing in the next tick\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        Scheduler_scheduleCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"          Scheduler_ImmediatePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"          flushSyncCallbackQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        );\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        throw\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" error\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"finally\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        setCurrentUpdateLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"previousLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        isFlushingSyncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      try\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" isSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" queue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"syncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        runWithPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"ImmediatePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"          for\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (; \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"length\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"++) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"            let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"queue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"            do\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"              callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"            } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"          }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        });\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        syncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"error\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // If something throws, leave the remaining callbacks on the queue.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"syncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"          syncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"syncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"slice\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // Resume flushing in the next tick\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"        Scheduler_scheduleCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"          Scheduler_ImmediatePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"          flushSyncCallbackQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        );\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        throw\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" error\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"finally\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        isFlushingSyncQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.h3,{id:\"13-ensurerootisscheduled\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#13-ensurerootisscheduled\",children:n(c.span,{className:\"icon icon-link\"})}),\"1.3 ensureRootIsScheduled\"]}),\"\\n\",n(c.p,{children:\"注册调度就非常的简单了\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" ensureRootIsScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"currentTime\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //判断是否注册新的调度\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" existingCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" nextLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getNextLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgressRoot\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgressRootRenderLanes\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" :\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" NoLanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  );\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"returnNextLanesPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // Schedule a new callback.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"SyncLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 注册调度走到scheduler去\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"scheduleSyncCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      performSyncWorkOnRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"bind\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    );\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"SyncBatchedLanePriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 批处理注册调度走到scheduler去\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"scheduleCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      ImmediateSchedulerPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      performSyncWorkOnRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"bind\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    );\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 并发注册调度走到scheduler去\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" schedulerPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"lanePriorityToSchedulerPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    );\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"scheduleCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      schedulerPriorityLevel\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      performConcurrentWorkOnRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"bind\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newCallbackPriority\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"callbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"说来说去我们就只关心一个事情\",n(c.code,{children:\"newCallbackNode = scheduleCallback( ImmediateSchedulerPriority, performSyncWorkOnRoot.bind(null, root), );\"}),\"他这里把回调函数给到调度中心并绑定节点，等待调度执行之后重复上面1.2的所有操作，我们下一节分析调度是怎么做的。\"]}),\"\\n\",e(c.h1,{id:\"2手写\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2手写\",children:n(c.span,{className:\"icon icon-link\"})}),\"2.手写\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\" * @Description:\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\" * @Date: 2022-11-23 22:44:29\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\" */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"arrified\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"getRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"getTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"createStateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" '../until'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"commitAllWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './commit'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"scheduleCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" '../scheduler'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" first\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" subTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" pendingCommit\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 构建最外层的fiber对象\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" createOutFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"jsx\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" task\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    props\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      children\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"jsx\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" outFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"task\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"from\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'class_component'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"task\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"instance\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    task\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"instance\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"__fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"partialState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"task\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"partialState\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    outFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      props\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      stateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"stateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'host_root'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      effects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": [],\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    };\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" outFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  outFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    props\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"task\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    stateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"task\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'host_root'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    effects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": [],\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"task\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"__rootFiberContainer\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" outFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" reconcileChildren\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"children\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * children 可能对象 也可能是数组\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 将children 转换成数组\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" arrifiedChildren\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"arrified\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"children\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 循环 children 使用的索引\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * children 数组中元素的个数\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" numberOfElements\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"arrifiedChildren\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"length\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 循环过程中的循环项 就是子节点的 virtualDOM 对象\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 子级 fiber 对象\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 上一个兄弟 fiber 对象\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" prevFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  console\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"log\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"arrifiedChildren\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"numberOfElements\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"     * 子级 virtualDOM 对象\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"     */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"arrifiedChildren\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"];\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"       * 删除操作\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"       */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effectTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'delete'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"push\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"       * 更新\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"       */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        props\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        effects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": [],\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        effectTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'update'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        parent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#4BF3C8\"},children:\"        alternate\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      };\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"         * 类型相同\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"         */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"stateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"stateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"         * 类型不同\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"         */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"stateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"createStateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && !\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"       * 初始渲染\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"       */\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"       * 子级 fiber 对象\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"       */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        props\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        effects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": [],\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        effectTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'placement'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        parent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      };\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"       * 为fiber节点添加DOM对象或组件实例对象\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"       */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"stateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"createStateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"stateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"createStateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      prevFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      alternate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 更新\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    prevFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    index\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"++; \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//保存构建fiber节点的索引，等待事件后通过索引再次进行构建\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" workLoopSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"subTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    subTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"performUnitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"subTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingCommit\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    first\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"++;\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    commitAllWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingCommit\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 构建子集的fiber对象的任务单元\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" performUnitOfWork\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  reconcileChildren\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"children\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 如果子级存在 返回子级\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 将这个子级当做父级 构建这个父级下的子级\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  /**\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 如果存在同级 返回同级 构建同级的子级\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   * 如果同级不存在 返回到父级 看父级是否有同级\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"   */\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" currentExecutelyFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentExecutelyFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"parent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    currentExecutelyFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"parent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" =\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      currentExecutelyFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"parent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"concat\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        currentExecutelyFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"effects\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"concat\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"([\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentExecutelyFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"])\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentExecutelyFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" currentExecutelyFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    currentExecutelyFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentExecutelyFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"parent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  pendingCommit\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentExecutelyFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  console\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"log\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingCommit\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 源码地址 https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L674-L736\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" ensureRootIsScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //这里我们可以直接走到注册调度任务,暂时我们分析的是Legacy模式，Concurrent模式实现的performConcurrentWorkOnRoot实现的可中断渲染可以以后实现\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //接下来就可以直接走到调度中心去\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  newCallbackNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"scheduleCallback\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workLoopSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 源码地址 https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L517-L619\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" scheduleUpdateOnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  subTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"first\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    //对应暂无render上下文\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 对于初次构建来说我们直接进行`fiber构造`.\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    workLoopSync\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    //对于后续更新以及操作都选择去注册调度任务\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    ensureRootIsScheduled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"subTask\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" render\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"jsx\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" outFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"createOutFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"jsx\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  scheduleUpdateOnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"outFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:\"然后我们就快乐的简单实现了fiberDom的过程~~~\"}),\"\\n\",e(c.h1,{id:\"总结\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#总结\",children:n(c.span,{className:\"icon icon-link\"})}),\"总结\"]}),\"\\n\",e(c.p,{children:[\"比较多工程化和基础的东西，还没完善，有兴趣的可以\",n(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F19981008%2Freact-fibertest\",title:\"https://github.com/19981008/react-fibertest\",children:\"gitbub\"}),\"拉下来试试\"]})]})}return{default:function(l={}){const{wrapper:e}=l.components||{};return e?n(e,{...l,children:n(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "React源码阅读(2)-fiber核心构建原理",
          "url": "#react源码阅读2-fiber核心构建原理",
          "items": []
        },
        {
          "title": "react-reconciler核心逻辑理解并手写",
          "url": "#react-reconciler核心逻辑理解并手写",
          "items": [
            {
              "title": "1.react构建fiber核心代码",
              "url": "#1react构建fiber核心代码",
              "items": [
                {
                  "title": "1.1 入口",
                  "url": "#11-入口",
                  "items": []
                },
                {
                  "title": "1.2 performSyncWorkOnRoot",
                  "url": "#12-performsyncworkonroot",
                  "items": [
                    {
                      "title": "阶段1.fiber树的构建",
                      "url": "#阶段1fiber树的构建",
                      "items": []
                    },
                    {
                      "title": "阶段2.fiber树的输出",
                      "url": "#阶段2fiber树的输出",
                      "items": []
                    },
                    {
                      "title": "1:准备阶段。",
                      "url": "#1准备阶段",
                      "items": []
                    },
                    {
                      "title": "2:提交阶段。",
                      "url": "#2提交阶段",
                      "items": []
                    },
                    {
                      "title": "3:渲染完成后",
                      "url": "#3渲染完成后",
                      "items": []
                    }
                  ]
                },
                {
                  "title": "1.3 ensureRootIsScheduled",
                  "url": "#13-ensurerootisscheduled",
                  "items": []
                }
              ]
            }
          ]
        },
        {
          "title": "2.手写",
          "url": "#2手写",
          "items": []
        },
        {
          "title": "总结",
          "url": "#总结",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "2.react_source_code_reading_fiber_construction_principle"
  },
  {
    "slug": "/content/react-source-code/20.react_native_scaffold",
    "title": "20. React-native脚手架探索",
    "description": "React-native脚手架探索",
    "published": true,
    "date": "2023-04-20T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(r){const c={a:\"a\",code:\"code\",em:\"em\",figure:\"figure\",h1:\"h1\",img:\"img\",li:\"li\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...r.components};return n(l,{children:[n(c.h1,{id:\"react-native脚手架探索\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react-native脚手架探索\",children:e(c.span,{className:\"icon icon-link\"})}),\"React-native脚手架探索\"]}),\"\\n\",e(c.p,{children:\"本文主要探讨了 React-native 脚手架，介绍了两种主流脚手架 React Native CLI 和 Expo Cli 的特点，包括优缺点、组成部分等。还通过实战详细讲解了项目运行、使用外部依赖包、配置导航（如传参、配置 navigation header 等）以及 tabbar 和 drawer 的使用。最后总结这节是 RN 入门的脚手架和路由导航学习。\"}),\"\\n\",e(c.p,{children:\"关联问题: Expo CLI 优势在哪 如何选合适脚手架 RN 后续怎么深入\"}),\"\\n\",n(c.p,{children:[\"“ \",e(c.em,{children:n(c.strong,{children:[\"本文正在参加\",e(c.a,{href:\"https://juejin.cn/post/7207698564641996856/\",children:\"「金石计划」\"})]})}),\" ”\"]}),\"\\n\",n(c.h1,{id:\"1rn脚手架的选择\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1rn脚手架的选择\",children:e(c.span,{className:\"icon icon-link\"})}),\"1、Rn脚手架的选择\"]}),\"\\n\",n(c.p,{children:[\"前两章我们探索了\",e(c.code,{children:\"rn\"}),\"的一些基础理论架构知识，那么现在让我们去进入正题。\"]}),\"\\n\",n(c.p,{children:[\"现在主流的脚手架有两种\",e(c.code,{children:\"React Native CLI\"}),\"和\",e(c.code,{children:\"Expo Cli\"})]}),\"\\n\",n(c.p,{children:[e(c.strong,{children:\"React Native CLI\"}),\"是由 \",e(c.code,{children:\"Facebook\"}),\" 创建的。这个脚手架有三个部分：原生iOS和Android，以及JavaScript。用这个的话你需要下载 \",e(c.code,{children:\"Xcode\"}),\" 和 \",e(c.code,{children:\"Android Studio\"}),\"。它主要优点之一是它的灵活性。我们可以在原生模块上下载依赖或者写一些代码。但是，它其实对我们的原生开发能力是有一些要求的。\"]}),\"\\n\",n(c.p,{children:[e(c.strong,{children:\"Expo Cli\"}),\"的话其实是一套整体（Expo）架构的一部分。\",e(c.code,{children:\"expo\"}),\"其实是一个\",e(c.code,{children:\"react app\"}),\"的框架和平台，它集成了打包、发布、测试，当然最重要的是它对于原生能力要求会低一些，我们通常只用在\",e(c.code,{children:\"js\"}),\"中就能快速开发和迭代。\"]}),\"\\n\",n(c.p,{children:[\"那么\",e(c.code,{children:\"Expo\"}),\"框架包含了哪些部分那？\"]}),\"\\n\",n(c.ul,{children:[\"\\n\",n(c.li,{children:[e(c.strong,{children:\"Expo CLI\"}),\": 一个命令行工具，可以创建项目模版，然后运行、构建和更新它们。\"]}),\"\\n\",n(c.li,{children:[e(c.strong,{children:\"Expo Go\"}),\": 一个\",e(c.code,{children:\"Android\"}),\"和\",e(c.code,{children:\"iOS\"}),\"应用程序，可以直接在设备上运行你的项目（无需编译和签名），并且可以整个团队中一起共享你的项目开发。\"]}),\"\\n\",n(c.li,{children:[e(c.strong,{children:\"Expo Snack\"}),\": 浏览器上的\",e(c.code,{children:\"playground\"}),\",就在线玩点小功能。\"]}),\"\\n\",n(c.li,{children:[e(c.strong,{children:\"Expo App Servieces(ESA)\"}),\": \",e(c.code,{children:\"Expo\"}),\"的云服务。\"]}),\"\\n\"]}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"Expo\"}),\"有很多的现成的功能，但是它也对项目施加了限制。我们不能手动连接自定义库到\",e(c.code,{children:\"native\"}),\"上，我们通常都直接使用\",e(c.code,{children:\"Expo cli\"}),\"提供的库就可以了。其实这就是为了一个版本的兼容性和降低门槛（就是不想调原生），\",e(c.code,{children:\"Expo\"}),\"强制帮我们节约这个时间。\"]}),\"\\n\",e(c.p,{children:\"简单的说，就是它对没原生能力的同学比较友好。\"}),\"\\n\",n(c.h1,{id:\"2实战\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2实战\",children:e(c.span,{className:\"icon icon-link\"})}),\"2、实战\"]}),\"\\n\",n(c.h1,{id:\"21简单跑一下项目\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#21简单跑一下项目\",children:e(c.span,{className:\"icon icon-link\"})}),\"2.1、简单跑一下项目\"]}),\"\\n\",n(c.p,{children:[\"先下脚手架 \",e(c.code,{children:\"npm install -g expo-cli\"})]}),\"\\n\",n(c.p,{children:[\"然后在你的目录下，跑\",e(c.code,{children:\"expo init projectName\"}),\"，选第一个就行。 \",e(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react_scaffold/1.jpeg?updatedAt=1739873901197\",alt:\"image.png\"})]}),\"\\n\",e(c.p,{children:\"命令行要科学上下网不然项目下载会很慢。\"}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react_scaffold/2.jpeg?updatedAt=1739873904369\",alt:\"image.png\"})}),\"\\n\",e(c.p,{children:\"然后我们就可以开始我们的项目实战了。\"}),\"\\n\",e(c.p,{children:e(c.code,{children:\"yarn start\"})}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react_scaffold/3.jpeg?updatedAt=1739873904378\",alt:\"image.png\"})}),\"\\n\",n(c.p,{children:[\"紧接着就轮到\",e(c.code,{children:\"Expo Go\"}),\"，它是一个移动端的\",e(c.code,{children:\"app\"}),\",安卓和ios都可以直接下。\"]}),\"\\n\",n(c.p,{children:[\"我就以\",e(c.code,{children:\"ios为例\"}),\"，当你注册账号后，用你\",e(c.code,{children:\"ios\"}),\"的相机直接扫这个二维码，然后会在\",e(c.code,{children:\"expo go\"}),\"中打开项目，就像这样。\"]}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react_scaffold/4.jpeg?updatedAt=1739873901206\",alt:\"image.png\"})}),\"\\n\",n(c.p,{children:[\"然后打开项目看到已经启动了 \",e(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react_scaffold/5.jpeg?updatedAt=1739873901141\",alt:\"image.png\"}),\" 并且当我们在编辑器中修改了代码也是可以热更新的，可以看到它其实并不像我们传统\",e(c.code,{children:\"rn\"}),\"项目中，还有\",e(c.code,{children:\"android\"}),\"和\",e(c.code,{children:\"ios\"}),\"目录，他完全就是我们的\",e(c.code,{children:\"js\"}),\"代码。\"]}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react_scaffold/6.jpeg?updatedAt=1739873901368\",alt:\"part3-4.png\"})}),\"\\n\",n(c.h1,{id:\"22如何使用外部依赖包\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#22如何使用外部依赖包\",children:e(c.span,{className:\"icon icon-link\"})}),\"2.2、如何使用外部依赖包\"]}),\"\\n\",n(c.p,{children:[\"因为后面的所有文章都会有关于\",e(c.code,{children:\"raact-navigation\"}),\"导航的内容，所以我们先来尝试下载它。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"sh\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"sh\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"yarn\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" add\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" @react-navigation/native\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" @react-navigation/native-stack\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"然后我们用\",e(c.code,{children:\"expo\"}),\"来下载依赖\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"java\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"java\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"expo install react\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"native\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"screens react\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"native\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"safe\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"area\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"context\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"我们看到这是不是很迷，就科普一下其实这里就是\",e(c.code,{children:\"expo\"}),\"帮你处理了一些\",e(c.code,{children:\"rn\"}),\"的常用包，你的一些三方依赖是在\",e(c.code,{children:\"expo-go\"}),\"里，但很多时候我们并不知道三方包到底能不能用，我们直接去\",e(c.code,{children:\"rn\"}),\"的三方包\",e(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Freactnative.directory%2F\",title:\"https://reactnative.directory/\",children:\"网站\"}),\"去搜索，然后筛选一下，可以看到还是挺多的。而\",e(c.code,{children:\"expo\"}),\"其实不仅可以加载三方包，本身也为你提供了很多不错的\",e(c.code,{children:\"sdk\"}),\",比如\",e(c.code,{children:\"相机\"}),\"、\",e(c.code,{children:\"音频\"}),\"、\",e(c.code,{children:\"推送\"}),\"、\",e(c.code,{children:\"人脸识别\"}),\"等（但我们其实现在这种开发模式是\",e(c.code,{children:\"expo\"}),\"的\",e(c.code,{children:\"dev\"}),\"模式，如果你想引入一些并不支持\",e(c.code,{children:\"expo\"}),\"的包可以到\",e(c.code,{children:\"dev build\"}),\"的模式，就也可以定制化的原生操作）。\"]}),\"\\n\",n(c.p,{children:[e(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react_scaffold/7.jpeg?updatedAt=1739873902203\",alt:\"image.png\"}),\"。\"]}),\"\\n\",n(c.p,{children:[\"那么我们直接来看一下\",e(c.code,{children:\"react-navigation\"}),\"的使用。\"]}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"app.js\"}),\"是这样的\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"NavigationContainer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" '@react-navigation/native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"createNativeStackNavigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" '@react-navigation/native-stack'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" Home\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './src/pages/Home'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" Settings\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './src/pages/Settings'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" Stack\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"createNativeStackNavigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" App\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"NavigationContainer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Stack.Navigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Stack.Screen\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" name\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Home\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" component\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Home\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Stack.Screen\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" name\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Settings\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" component\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Settings\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Stack.Navigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"NavigationContainer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"createNativeStackNavigator()\"}),\"是一个设置你的导航的函数。它返回一个具有两个属性的对象，即屏幕组件和导航器组件，它们用于配置我们的导航。\"]}),\"\\n\",n(c.p,{children:[\"对于\",e(c.code,{children:\"screen\"}),\"这个组件，它的\",e(c.code,{children:\"name\"}),\"可以理解为这个组件的\",e(c.code,{children:\"key\"}),\"或者说组件的映射，然后\",e(c.code,{children:\"compenent\"}),\"则是要渲染的\",e(c.code,{children:\"组件\"}),\"，而在上述的代码中会默认渲染\",e(c.code,{children:\"Home\"}),\"当打开\",e(c.code,{children:\"app\"}),\"的时候。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Button\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"StatusBar\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" Home\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"navigation\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"StatusBar\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" barStyle\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"dark-content\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">首页</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Button\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" title\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Settings\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onPress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" navigation\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"navigate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'Settings'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"Home\"}),\" \",e(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react_scaffold/8.jpeg?updatedAt=1739873901678\",alt:\"image.png\"})]}),\"\\n\",n(c.p,{children:[\"而当按\",e(c.code,{children:\"settings\"}),\"的时候,会定向到\",e(c.code,{children:\"Settings\"}),\"这个屏幕，而\",e(c.code,{children:\"navigation\"}),\"这个函数是通过\",e(c.code,{children:\"screen\"}),\"传递给我们的。\"]}),\"\\n\",n(c.p,{children:[e(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react_scaffold/10.jpeg?updatedAt=1739873902187\",alt:\"image.png\"}),\" 而我们看到\",e(c.code,{children:\"Settings\"}),\"这个组件,发现它是不是跟\",e(c.code,{children:\"Home\"}),\"有些许不同，没错他上面有个导航栏，这里显示了组件名称和返回上一级的按钮，而它其实是\",e(c.code,{children:\"react-navigation\"}),\"所提供的\",e(c.code,{children:\"navigation bar\"}),\"。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Button\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"StatusBar\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" Settings\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"navigation\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"StatusBar\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" barStyle\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"dark-content\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">设置</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Button\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" title\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Home\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onPress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" navigation\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"navigate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'Home'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:\"接下来我们看一下如何传参，如下\"}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Button\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"StatusBar\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" Settings\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"navigation\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"StatusBar\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" barStyle\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"dark-content\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">设置</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Button\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" title\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Home\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onPress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" navigation\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"navigate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'Home'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"title\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"我好烦\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"})\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"其实就只是第二个参数，带过去就可以，而同样接受的地方，也可以从\",e(c.code,{children:\"props\"}),\"中把\",e(c.code,{children:\"route\"}),\"解构出来，直接去使用。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Button\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"StatusBar\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" Home\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"navigation\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"， \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"route\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"title\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"route\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"params\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"StatusBar\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" barStyle\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"dark-content\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">首页</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Button\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" title\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Settings\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onPress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" navigation\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"navigate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'Settings'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"那么我们如果有时候要配置\",e(c.code,{children:\"navigation header\"}),\"那,就需要再配置下\",e(c.code,{children:\"option\"}),\"。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"NavigationContainer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" '@react-navigation/native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"createNativeStackNavigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" '@react-navigation/native-stack'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Button\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" Home\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './src/pages/Home'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" Settings\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './src/pages/Settings'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" Stack\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"createNativeStackNavigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" App\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"NavigationContainer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Stack.Navigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Stack.Screen\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" name\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Home\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" component\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Home\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Stack.Screen\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"          name\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Settings\"'})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"          component\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Settings\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"          options\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"route\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" ({\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"            headerRight\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": () \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Button\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" title\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"test\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />,\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"          })\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"        />\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Stack.Navigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"NavigationContainer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react_scaffold/9.jpeg?updatedAt=1739873901589\",alt:\"image.png\"})}),\"\\n\",n(c.p,{children:[\"最后我们来试一下，\",e(c.code,{children:\"tabbar\"}),\"和\",e(c.code,{children:\"drawer\"}),\"。需要先下载\",e(c.code,{children:\"npm\"}),\"依赖和\",e(c.code,{children:\"expo\"}),\"依赖。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"java\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"java\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"yarn add \"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"@\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"react\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"navigation\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"/\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"bottom\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"tabs \"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"@\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"react\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"navigation\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"/\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"drawer\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"expo install react\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"native\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"gesture\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"handler react\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"native\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"reanimated\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"然后再\",e(c.code,{children:\"babel.config.js\"}),\"里，加入插件配置。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"ini\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"ini\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"module.exports\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" =\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" function (api) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#FFD493\"},children:\"    api.cache(true)\"}),e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#FFD493\"},children:\"    return {\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#FFD493\"},children:\"    presets: [\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"babel-preset-expo\"'}),e(c.span,{style:{color:\"#FFD493\"},children:\"],\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#FFD493\"},children:\"    plugins: [\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"react-native-reanimated/plugin\"'}),e(c.span,{style:{color:\"#FFD493\"},children:\"],\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#FFD493\"},children:\"    }\"}),e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#FFD493\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"此时我们的\",e(c.code,{children:\"App.js\"}),\"文件是这样的\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"NavigationContainer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" '@react-navigation/native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"createDrawerNavigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" '@react-navigation/drawer'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"createBottomTabNavigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" '@react-navigation/bottom-tabs'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Platform\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" Home\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './Home'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" News\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './News'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" Settings\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './Settings'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" Tab\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"createBottomTabNavigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" Drawer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"createDrawerNavigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" App\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"NavigationContainer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"      {\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Platform\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"OS\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'ios'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" && (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Tab.Navigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Tab.Screen\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" name\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Home\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" component\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Home\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Tab.Screen\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" name\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"News\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" component\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"News\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Tab.Screen\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" name\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Settings\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" component\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Settings\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Tab.Navigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      )\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"      {\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Platform\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"OS\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" == \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'android'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" && (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Drawer.Navigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Drawer.Screen\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" name\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Home\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" component\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Home\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Drawer.Screen\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" name\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"News\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" component\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"News\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Drawer.Screen\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" name\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Settings\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" component\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Settings\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Drawer.Navigator\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      )\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"NavigationContainer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"你使用的现在是\",e(c.code,{children:\"tabbar\"}),\"和\",e(c.code,{children:\"drwaer\"}),\"的导航了，而不是由\",e(c.code,{children:\"createNativeStack\"}),\"创建的。然后其中的\",e(c.code,{children:\"Platform\"}),\"是用来区别\",e(c.code,{children:\"安卓ios\"}),\"的。\"]}),\"\\n\",e(c.p,{children:e(c.code,{children:\"Home\"})}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" React\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" Home\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">Home Content</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"ios\"}),\" \",e(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react_scaffold/11.jpeg?updatedAt=1739873901258\",alt:\"image.png\"}),e(c.code,{children:\"安卓\"})]}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react_scaffold/12.jpeg?updatedAt=1739873901673\",alt:\"image.png\"})}),\"\\n\",n(c.h1,{id:\"3结束\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3结束\",children:e(c.span,{className:\"icon icon-link\"})}),\"3、结束\"]}),\"\\n\",n(c.p,{children:[\"这一节主要讲一下\",e(c.code,{children:\"RN\"}),\"入门的脚手架学习，和关于路由导航，比较简单一点，em如果大家有问题，或者想学点更深入的东西直接看\",e(c.a,{href:\"https://juejin.cn/user/400646714977431/pins\",children:\"沸点\"}),\"加我就好，免费课就是为了让大家学懂跨端框架。\"]})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "React-native脚手架探索",
          "url": "#react-native脚手架探索",
          "items": []
        },
        {
          "title": "1、Rn脚手架的选择",
          "url": "#1rn脚手架的选择",
          "items": []
        },
        {
          "title": "2、实战",
          "url": "#2实战",
          "items": []
        },
        {
          "title": "2.1、简单跑一下项目",
          "url": "#21简单跑一下项目",
          "items": []
        },
        {
          "title": "2.2、如何使用外部依赖包",
          "url": "#22如何使用外部依赖包",
          "items": []
        },
        {
          "title": "3、结束",
          "url": "#3结束",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "20.react_native_scaffold"
  },
  {
    "slug": "/content/react-source-code/21.react_native_flexbox",
    "title": "21. React-native之Flexbox",
    "description": "React-native之Flexbox",
    "published": true,
    "date": "2023-04-21T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:n,jsxs:e}=arguments[0];function _createMdxContent(r){const c={a:\"a\",code:\"code\",em:\"em\",figure:\"figure\",h1:\"h1\",h2:\"h2\",img:\"img\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",...r.components};return e(l,{children:[e(c.h1,{id:\"react-native之flexbox\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react-native之flexbox\",children:n(c.span,{className:\"icon icon-link\"})}),\"React-native之Flexbox\"]}),\"\\n\",e(c.p,{children:[\"“ \",n(c.em,{children:e(c.strong,{children:[\"本文正在参加\",n(c.a,{href:\"https://juejin.cn/post/7207698564641996856/\",children:\"「金石计划」\"})]})}),\" ”\"]}),\"\\n\",e(c.h1,{id:\"1关于flexbox\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1关于flexbox\",children:n(c.span,{className:\"icon icon-link\"})}),\"1、关于Flexbox\"]}),\"\\n\",e(c.p,{children:[\"在将\",n(c.code,{children:\"flexbox\"}),\"引入\",n(c.code,{children:\"css\"}),\"前，构建布局的各种\",n(c.code,{children:\"css\"}),\"属性都比较粗糙，而且很容易出错。而\",n(c.code,{children:\"flexbox\"}),\"通过抽象了很多属性来解决问题。字如其名\",n(c.code,{children:\"flexbox\"}),\"的意思就是一个具有弹性的盒子模型。我们画个图：假设你有一个容器和它的子元素，它看起来可以是这样的。\"]}),\"\\n\",n(c.p,{children:n(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react-native-flexbox/React%20Native%20Flexbox.webp?updatedAt=1739875780865\",alt:\"image.png\"})}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"Flexbox\"}),\"容器有二个轴，即\",n(c.code,{children:\"列\"}),\"（向上/向下）或\",n(c.code,{children:\"行\"}),\"（左/右）。\"]}),\"\\n\",e(c.h1,{id:\"2实操\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2实操\",children:n(c.span,{className:\"icon icon-link\"})}),\"2、实操\"]}),\"\\n\",e(c.p,{children:[\"我们直接上代码吧,这是一个\",n(c.code,{children:\"js\"}),\"模块，而不是\",n(c.code,{children:\"css\"}),\"模块。如果我们要声明\",n(c.code,{children:\"rn\"}),\"的样式，我们需要去定义一个对象然后调用\",n(c.code,{children:\"StyleSheet.create()\"}),\"最后抛出它在你的模块中。但是我们需要注意的是\",n(c.code,{children:\"rn\"}),\"只支持\",n(c.code,{children:\"驼峰命名\"}),\"。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Platform\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"StyleSheet\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"StatusBar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" StyleSheet\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"create\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  container\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    flex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    justifyContent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    alignItems\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    backgroundColor\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'ghostwhite'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    ...\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Platform\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"select\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      ios\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"paddingTop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"20\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      android\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"paddingTop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"StatusBar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentHeight\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }),\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    width\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"100\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    height\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"100\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    justifyContent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    alignItems\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    backgroundColor\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'lightgray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  boxText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    color\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'darkslategray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    fontWeight\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'bold'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"})\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:\"然后我们看到刚才我写了这样一段代码,这里其实就是根据你的移动端去选择样式。\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"...\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Platform\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"select\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  ios\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"paddingTop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"20\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  android\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"paddingTop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"StatusBar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentHeight\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}),\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[\"ok，我们看一下在\",n(c.code,{children:\"rn\"}),\"组件中如何使用\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"box\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"boxText\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">I'm in a box</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:\"这些样式将通过样式属性分配给每个组件。我们来看看它的表现。\"}),\"\\n\",n(c.p,{children:n(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react-native-flexbox/React%20Native%20Flexbox%20(1).webp?updatedAt=1739875781432\",alt:\"image.png\"})}),\"\\n\",e(c.h1,{id:\"3styled-components样式组件库使用\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3styled-components样式组件库使用\",children:n(c.span,{className:\"icon icon-link\"})}),\"3、Styled-components样式组件库使用\"]}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"Styled-components\"}),\"是一个\",n(c.code,{children:\"css-in-js\"}),\"的库为我们的组件去提供样式，如我们去直接看看怎么使用吧。当然只是介绍一下，我们还是使用\",n(c.code,{children:\"styleSheet\"}),\"。\"]}),\"\\n\",n(c.p,{children:\"首先下载依赖\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"sh\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"sh\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"yarn\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" add\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" styled-components\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:\"然后我们写点代码\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" styled\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:' \"styled-components/native\"'}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#FFD493\"},children:\"    width: 100px\"}),n(c.span,{style:{color:\"#FFFFFF\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    height: 100\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"px\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    justify\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"-content: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"center\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    align\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"-items: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"center\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    background\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"-color: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lightgray\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#FFD493\"},children:\"'\"}),n(c.span,{style:{color:\"#FFFFFF\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" BoxText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styled\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#FFD493\"},children:\"    color: darkslategray\"}),n(c.span,{style:{color:\"#FFFFFF\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    font\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"-weight: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"bold\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#FFD493\"},children:\"'\"}),n(c.span,{style:{color:\"#FFFFFF\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:\"使用\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"BoxText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">I'm in a box</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"BoxText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"};\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.h1,{id:\"4基础flexbox\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#4基础flexbox\",children:n(c.span,{className:\"icon icon-link\"})}),\"4、基础Flexbox\"]}),\"\\n\",e(c.p,{children:[\"接下来主要讲一下\",n(c.code,{children:\"rn\"}),\"中的几种常见布局和\",n(c.code,{children:\"flexbox\"}),\"的实战\"]}),\"\\n\",e(c.h2,{id:\"41三栏布局\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#41三栏布局\",children:n(c.span,{className:\"icon icon-link\"})}),\"4.1、三栏布局\"]}),\"\\n\",n(c.p,{children:\"普通的从上到下的三栏布局。\"}),\"\\n\",e(c.p,{children:[n(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react-native-flexbox/React%20Native%20Flexbox%20(3).webp?updatedAt=1739875781734\",alt:\"image.png\"}),\"‘\"]}),\"\\n\",e(c.p,{children:[\"你可以把\",n(c.code,{children:\"view\"}),\"理解成\",n(c.code,{children:\"div\"}),\",\",n(c.code,{children:\"text\"}),\"理解成\",n(c.code,{children:\"p\"}),\"。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"box\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"boxText\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#1</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"box\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"boxText\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#2</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"box\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"boxText\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#3</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"flexDirection\"}),\"属性是决定了主轴的方向，上到下或者左到右，而\",n(c.code,{children:\"alignItem\"}),\"和\",n(c.code,{children:\"justifyContent\"}),\"属性决定了元素的排列和间隔。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"php\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"php\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#FFD493\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"Platform\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"StyleSheet\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"StatusBar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#FFD493\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" StyleSheet\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"create\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  container: \"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"{\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    flex: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    flexDirection: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'column'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    alignItems: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    justifyContent: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'space-around'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    backgroundColor: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'ghostwhite'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    ...\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"Platform\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"select\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      ios: \"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"{\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" paddingTop\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"20\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      android: \"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"{\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" paddingTop\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"StatusBar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"currentHeight\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }),\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  box: \"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"{\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    width: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"300\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    height: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"100\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    justifyContent: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    alignItems: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    backgroundColor: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'lightgray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    borderWidth: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    borderStyle: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'dashed'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    borderColor: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'darkslategray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  boxText: \"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"{\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    color: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'darkslategray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    fontWeight: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'bold'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"})\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:\"而如果我们想让它左右两边填满那？就像这样\"}),\"\\n\",n(c.p,{children:n(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react-native-flexbox/React%20Native%20Flexbox%20(3).webp?updatedAt=1739875781734\",alt:\"image.png\"})}),\"\\n\",e(c.p,{children:[\"我们可以加入\",n(c.code,{children:\"alignSelf\"}),\"这个属性，这个属性的意思是根据主轴\",n(c.code,{children:\"flexDirection\"}),\"的方向，改变宽度或者高度（column改变的就是宽度，row改变的就是高度）去填充空白，动态计算高度或宽度。像这样就是会填满你屏幕的宽度。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  box: {\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    height: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"100\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    justifyContent: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // \"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    alignSelf: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'stretch'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    alignItems: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    backgroundColor: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'lightgray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    borderWidth: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    borderStyle: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'dashed'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    borderColor: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'darkslategray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:\"当我们把手机横过去\"}),\"\\n\",n(c.p,{children:n(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react-native-flexbox/React%20Native%20Flexbox%20(4).webp?updatedAt=1739875781712\",alt:\"image.png\"})}),\"\\n\",e(c.p,{children:[\"我们稍微优化一下，正好也写一下横向的布局，上面的样式太\",n(c.code,{children:\"抽象\"}),\"了写得。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"StatusBar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" Box\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './Box'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\" return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"   <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"     <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#1</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"     <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#2</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"   </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\" )\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'prop-types'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"children\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\" return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"   <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"box\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"     <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"boxText\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"children\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"   </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\" )\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"propTypes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\" children\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:\"这个就是会拉伸至整个屏幕高度的横向布局\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"php\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"php\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#FFD493\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"Platform\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"StyleSheet\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"StatusBar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#FFD493\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" StyleSheet\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"create\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  container: \"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"{\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    flex: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    flexDirection: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'row'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    backgroundColor: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'ghostwhite'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    alignItems: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    justifyContent: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'space-around'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    ...\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"Platform\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"select\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      ios: \"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"{\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" paddingTop\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"20\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      android: \"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"{\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" paddingTop\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"StatusBar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"currentHeight\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }),\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  box: \"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"{\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    width: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"100\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    justifyContent: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    alignSelf: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'stretch'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    alignItems: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    backgroundColor: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'lightgray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    borderWidth: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    borderStyle: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'dashed'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    borderColor: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'darkslategray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"  boxText: \"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"{\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    color: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'darkslategray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"    fontWeight: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'bold'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"})\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:\"我们来看看它的表现\"}),\"\\n\",n(c.p,{children:n(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react-native-flexbox/1b7f4a002d1045a882faf4b2a2ea521a~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp?updatedAt=1739875782894\",alt:\"image.png\"})}),\"\\n\",n(c.p,{children:\"当我们把手机横过去\"}),\"\\n\",n(c.p,{children:n(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react-native-flexbox/4bf95f1a6db64d708edd014bbab07159~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp?updatedAt=1739875782855\",alt:\"image.png\"})}),\"\\n\",e(c.h1,{id:\"5稍微复杂一点的flexbox\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#5稍微复杂一点的flexbox\",children:n(c.span,{className:\"icon icon-link\"})}),\"5、稍微复杂一点的flexBox\"]}),\"\\n\",n(c.p,{children:\"假设我们要实现这样一个效果,我们该如何实现？\"}),\"\\n\",n(c.p,{children:n(c.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/react-native-flexbox/4da8595a2c834d6ba5bdabc8e1dd8882~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp?updatedAt=1739875781677\",alt:\"image.png\"})}),\"\\n\",e(c.p,{children:[\"在我们的意识中，整个布局有\",n(c.code,{children:\"行\"}),\"、\",n(c.code,{children:\"列\"}),\"。那我们同样也可以抽象出\",n(c.code,{children:\"col\"}),\"、\",n(c.code,{children:\"row\"}),\"组件分别代表行列。我们直接上代码吧。\"]}),\"\\n\",e(c.p,{children:[\"可以看到我们分别确定了\",n(c.code,{children:\"col\"}),\"、\",n(c.code,{children:\"row\"}),\"的方向和排列。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Platform\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"StyleSheet\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"StatusBar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" StyleSheet\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"create\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  container\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    flex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    flexDirection\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'column'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    backgroundColor\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'ghostwhite'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    alignItems\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    justifyContent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'space-around'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    ...\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Platform\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"select\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      ios\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"paddingTop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"40\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      android\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"paddingTop\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"StatusBar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentHeight\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }),\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    height\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"100\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    width\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"100\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    justifyContent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    alignItems\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    borderWidth\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    borderStyle\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'dashed'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    borderColor\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'darkslategray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    backgroundColor\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'lightgray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  boxText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    color\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'darkslategray'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    fontWeight\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'bold'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  row\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    flex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    flexDirection\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'row'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    justifyContent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'space-around'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    alignSelf\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'stretch'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  column\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    flex\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    flexDirection\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'column'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    alignItems\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    justifyContent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'space-around'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    alignSelf\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'stretch'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"})\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"组件部分\"})}),\"\\n\",n(c.p,{children:n(c.code,{children:\"app\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"StatusBar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" Row\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './Row'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" Col\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './Col'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" Box\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './Box'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"StatusBar\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" hidden\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Row\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Col\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#1</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#2</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Col\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Col\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#3</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#4</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Col\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Row\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Row\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Col\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#5</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#6</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Col\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Col\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#7</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#8</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Col\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Row\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Row\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Col\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#9</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#10</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Col\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Col\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#11</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">#12</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Col\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Row\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:n(c.code,{children:\"col\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" PropTypes\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'prop-types'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" Column\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"children\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"column\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"children\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"Column\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"propTypes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  children\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:n(c.code,{children:\"row\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" PropTypes\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'prop-types'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" Row\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"children\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"row\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"children\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"Row\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"propTypes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  children\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:n(c.code,{children:\"box\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" React\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" PropTypes\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'prop-types'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"children\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"box\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"boxText\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"children\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"Box\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"propTypes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  children\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.h1,{id:\"6总结\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#6总结\",children:n(c.span,{className:\"icon icon-link\"})}),\"6、总结\"]}),\"\\n\",e(c.p,{children:[\"我们在这节里知道了\",n(c.code,{children:\"rn\"}),\"中最常见的布局方式，需要同学们自己下去多练一下，还是比较简单的，有问题可以问我。加学习群看\",n(c.a,{href:\"https://juejin.cn/user/400646714977431/pins\",children:\"沸点\"}),\".\"]})]})}return{default:function(l={}){const{wrapper:e}=l.components||{};return e?n(e,{...l,children:n(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "React-native之Flexbox",
          "url": "#react-native之flexbox",
          "items": []
        },
        {
          "title": "1、关于Flexbox",
          "url": "#1关于flexbox",
          "items": []
        },
        {
          "title": "2、实操",
          "url": "#2实操",
          "items": []
        },
        {
          "title": "3、Styled-components样式组件库使用",
          "url": "#3styled-components样式组件库使用",
          "items": []
        },
        {
          "title": "4、基础Flexbox",
          "url": "#4基础flexbox",
          "items": [
            {
              "title": "4.1、三栏布局",
              "url": "#41三栏布局",
              "items": []
            }
          ]
        },
        {
          "title": "5、稍微复杂一点的flexBox",
          "url": "#5稍微复杂一点的flexbox",
          "items": []
        },
        {
          "title": "6、总结",
          "url": "#6总结",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "21.react_native_flexbox"
  },
  {
    "slug": "/content/react-source-code/22.react_native_actual_combat",
    "title": "22. React-native实战系列",
    "description": "本文是关于 React-native 实战的系列内容，包括表单组件的封装",
    "published": true,
    "date": "2023-04-21T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(r){const c={a:\"a\",code:\"code\",em:\"em\",figure:\"figure\",h1:\"h1\",h2:\"h2\",img:\"img\",li:\"li\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...r.components};return n(l,{children:[n(c.h1,{id:\"react-native实战系列\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react-native实战系列\",children:e(c.span,{className:\"icon icon-link\"})}),\"React-native实战系列\"]}),\"\\n\",e(c.p,{children:\"本文是关于 React-native 实战的系列内容，包括表单组件的封装（如 input、select、Toggling、DateTimePicker 等）和懒加载列表的实现。懒加载列表通过定义数据源、绘制组件图，运用相关 API 实现功能，并处理了搜索排序等逻辑。最后提到若有问题可通过[沸点]联系作者。\"}),\"\\n\",e(c.p,{children:\"关联问题: 如何优化懒加载效果 表单样式能自定义吗 安卓日期选择器难点\"}),\"\\n\",e(c.p,{children:\"AI智能总结首次生成速度较慢, 请耐心等待\"}),\"\\n\",n(c.p,{children:[\"“ \",e(c.em,{children:n(c.strong,{children:[\"本文正在参加\",e(c.a,{href:\"https://juejin.cn/post/7207698564641996856/\",children:\"「金石计划」\"})]})}),\" ”\"]}),\"\\n\",n(c.h1,{id:\"1组件的使用\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1组件的使用\",children:e(c.span,{className:\"icon icon-link\"})}),\"1、组件的使用\"]}),\"\\n\",e(c.p,{children:\"移动端也有表单，表单也是我经常接触的一个场景，那么让我们就实现一些表单组件吧。\"}),\"\\n\",n(c.h1,{id:\"11封装一个input\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#11封装一个input\",children:e(c.span,{className:\"icon icon-link\"})}),\"1.1、封装一个input\"]}),\"\\n\",n(c.p,{children:[\"我们先从\",e(c.code,{children:\"rn\"}),\"的\",e(c.code,{children:\"TextInput\"}),\"输入框开始\"]}),\"\\n\",e(c.p,{children:e(c.code,{children:\"input\"})}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" React\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" PropTypes\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'prop-types'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"TextInput\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" Input\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"props\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"textInputContainer\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"textInputLabel\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"TextInput\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"textInput\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" {\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"...\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"Input\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"propTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"string\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" CollectingTextInput\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"changedText\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"setChangedText\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"''\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"submittedText\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"setSubmittedText\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"''\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Input\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Basic Text Input:\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Input\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Password Input:\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" secureTextEntry\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Input\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Return Key:\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" returnKeyType\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"search\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Input\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Placeholder Text:\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" placeholder\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Search\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Input\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"        label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Input Events:\"'})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"        onChangeText\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"e\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"          setChangedText\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"e\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"        onSubmitEditing\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"e\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"          setSubmittedText\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"e\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"nativeEvent\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"        onFocus\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"          setChangedText\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"''\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"          setSubmittedText\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"''\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"      />\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">Changed: \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"changedText\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">Submitted: \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"submittedText\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:\"让我们先看看在屏幕上这些输入框是这样的。\"}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/Actual%20Combat/React%20Native%20%E5%AE%9E%E6%88%98%E7%B3%BB%E5%88%97.webp?updatedAt=1739878232546\",alt:\"image.png\"})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"secureTextEntry\"}),\"密码输入盘，你的输入会被\",e(c.code,{children:\"***\"}),\"挡住。\"]}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"Return key\"}),\"，这个值决定你的\",e(c.code,{children:\"小键盘\"}),\"右下角的值。\"]}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/Actual%20Combat/3d03e17cc9aa4a9790fc24adcd73510b~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp?updatedAt=1739878232497\",alt:\"image.png\"})}),\"\\n\",n(c.p,{children:[\"我们也可以通过\",e(c.code,{children:\"keyboardType\"}),\"去控制弹出的\",e(c.code,{children:\"小键盘类型\"}),\"，比如\",e(c.code,{children:\"numeric\"})]}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/Actual%20Combat/78ac56c393e84ec29e81b5b8a844f9bc~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp?updatedAt=1739878232305\",alt:\"image.png\"})}),\"\\n\",n(c.h2,{id:\"12封装一个select\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#12封装一个select\",children:e(c.span,{className:\"icon icon-link\"})}),\"1.2、封装一个\",e(c.code,{children:\"select\"})]}),\"\\n\",e(c.p,{children:\"首先\"}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"sh\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"sh\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"expo\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" install\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" @react-native-picker/picker\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"然后我们可以用\",e(c.code,{children:\"Picker\"}),\"实现一个选择器。 \",e(c.code,{children:\"Select\"})]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Picker\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" '@react-native-picker/picker'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" Select\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"props\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pickerLabel\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Picker\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" {\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"...\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"        {\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"items\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"map\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"i\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Picker.Item\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" key\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" {\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"...\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        ))\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Picker\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:e(c.code,{children:\"样式\"})}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"StyleSheet\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" StyleSheet\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"create\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  container\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    flex\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    flexDirection\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'column'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    backgroundColor\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'ghostwhite'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    justifyContent\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  pickersBlock\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    flex\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"2\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    flexDirection\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'row'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    justifyContent\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'space-around'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    alignItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  pickerHeight\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    height\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"250\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  pickerContainer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    flex\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    flexDirection\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'column'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    alignItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    backgroundColor\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'white'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    padding\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"6\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    height\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"240\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  pickerLabel\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    fontSize\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"14\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    fontWeight\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'bold'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  picker\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    width\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"150\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    backgroundColor\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'white'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  selection\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    flex\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    textAlign\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'center'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  },\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"})\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:e(c.code,{children:\"app.js\"})}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" React\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:' \"react\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:' \"react-native\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:' \"./styles\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" Select\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:' \"./Select\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" sizes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = [\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"S\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"S\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"M\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"M\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"L\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"L\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"XL\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"XL\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" },\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"];\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" garments\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = [\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"sizes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": [\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"S\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"M\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"L\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"XL\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Socks\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"sizes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": [\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"S\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"L\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Shirt\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"2\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"sizes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": [\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"M\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"XL\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Pants\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"3\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"sizes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": [\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"S\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"L\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] },\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Hat\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"4\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"sizes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": [\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"M\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"XL\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] },\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"];\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" SelectingOptions\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"availableGarments\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"setAvailableGarments\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"([]);\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"selectedSize\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"setSelectedSize\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"selectedGarment\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"setSelectedGarment\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"selection\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"setSelection\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"\"'}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pickersBlock\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Select\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"          label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Size\"'})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"          items\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"sizes\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"          selectedValue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"selectedSize\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"          onValueChange\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"size\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"            setSelectedSize\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"size\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"            setSelectedGarment\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"            setAvailableGarments\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"              garments\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"filter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"((\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"i\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" i\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"sizes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"includes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"size\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"))\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"            );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"          }\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"        />\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Select\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"          label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Garment\"'})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"          items\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"availableGarments\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"          selectedValue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"selectedGarment\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"          onValueChange\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"garment\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"            setSelectedGarment\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"garment\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"            setSelection\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#FFD493\"},children:\"              `\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"${\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"selectedSize\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" ${\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"                garments\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"find\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"((\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"i\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" i\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"garment\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\").\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"              }\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"`\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"            );\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"          }\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"        />\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"selection\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"selection\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  );\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"最终效果如下： \",e(c.img,{src:\"https://ik.imagekit.io/leiakito/Actual%20Combat/React%20Native%20%E5%AE%9E%E6%88%98%E7%B3%BB%E5%88%97%20(1).webp?updatedAt=1739878232354\",alt:\"image.png\"})]}),\"\\n\",n(c.h1,{id:\"13封装一个toggling\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#13封装一个toggling\",children:e(c.span,{className:\"icon icon-link\"})}),\"1.3、封装一个Toggling\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Switch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" CustomSwitch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"props\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"customSwitch\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Switch\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" {\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"...\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" React\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" Switch\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './Switch'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" TogglingOnAndOff\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"first\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"setFirst\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"second\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"setSecond\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"container\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Switch\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Disable Next Switch\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"first\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" disabled\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"second\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onValueChange\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"setFirst\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Switch\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Disable Previous Switch\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"second\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" disabled\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"first\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onValueChange\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"setSecond\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"效果如下： \",e(c.img,{src:\"https://ik.imagekit.io/leiakito/Actual%20Combat/319e922f8adb4c71a2e20efef46b1673~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp?updatedAt=1739878232523\",alt:\"image.png\"})]}),\"\\n\",n(c.h2,{id:\"13实现一个datetimepicker\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#13实现一个datetimepicker\",children:e(c.span,{className:\"icon icon-link\"})}),\"1.3、实现一个DateTimePicker\"]}),\"\\n\",e(c.p,{children:\"首先下载依赖\"}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"expo\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" install\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" @\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"react\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"native\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"-\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"community\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"/\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"datetimepicker\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"然后我们开发一个\",e(c.code,{children:\"ios\"}),\"的\",e(c.code,{children:\"DateTimePicker\"}),\"组件\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" React\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" DateTimePicker\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" '@react-native-community/datetimepicker'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" DatePicker\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"props\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"datePickerContainer\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"datePickerLabel\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"DateTimePicker\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" mode\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"date\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" display\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"spinner\"'}),e(c.span,{style:{color:\"#54B9FF\"},children:\" {\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"...\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"ios\"}),\"上的表现 \",e(c.img,{src:\"https://ik.imagekit.io/leiakito/Actual%20Combat/React%20Native%20%E5%AE%9E%E6%88%98%E7%B3%BB%E5%88%97%20(2).webp?updatedAt=1739878232504\",alt:\"image.png\"}),\" 安卓会稍微麻烦一些\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" DateTimePicker\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" '@react-native-community/datetimepicker'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" pickDate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"options\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"onDateChange\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  DateTimePicker\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"open\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"options\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\").\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"then\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"date\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" onDateChange\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"new\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" Date\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"date\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"year\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"date\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"month\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"date\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"day\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")))\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" DatePicker\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"label\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"date\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"onDateChange\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"datePickerContainer\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"datePickerLabel\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"label\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onPress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" pickDate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"date\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }, \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"onDateChange\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"date\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"toLocaleDateString\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:e(c.code,{children:\"安卓上的表现\"})}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/Actual%20Combat/React%20Native%20%E5%AE%9E%E6%88%98%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8.webp?updatedAt=1739878231929\",alt:\"image.png\"})}),\"\\n\",n(c.h1,{id:\"2如何实现一个懒加载列表\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2如何实现一个懒加载列表\",children:e(c.span,{className:\"icon icon-link\"})}),\"2、如何实现一个懒加载列表\"]}),\"\\n\",n(c.p,{children:[\"假设现在有一个需求需要我们实现一个\",e(c.code,{children:\"懒加载\"}),\"的列表，它还可以\",e(c.code,{children:\"过滤\"}),\"、\",e(c.code,{children:\"排序\"}),\"、\",e(c.code,{children:\"下拉刷新\"}),\"。\"]}),\"\\n\",n(c.p,{children:[\"首先我们需要一个手动定义一个数据源，我们可以通过\",e(c.code,{children:\"迭代器\"}),\",实现一个无线调用递增的\",e(c.code,{children:\"promise\"}),\"去模拟\",e(c.code,{children:\"api\"}),\"的调用，当每次调用\",e(c.code,{children:\"fetchItems\"}),\"的时候，我们的\",e(c.code,{children:\"cnt\"}),\"都会增加30。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function*\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" genItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" cnt\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"0\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    yield\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" `Item \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"${\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"cnt\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"++\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"`\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" items\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"genItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" fetchItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" Promise\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"resolve\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"    json\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": () \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#ACAFFF\"},children:\"      Promise\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"resolve\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"        items\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"new\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" Array\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"30\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\").\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"fill\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\").\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"map\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" items\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"().\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"      }),\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  })\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:\"当我们定义了数据源后我们画一张整体的组件图吧。\"}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/Actual%20Combat/React%20Native%20%E5%AE%9E%E6%88%98%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8%20(1).webp?updatedAt=1739878232807\",alt:\"image.png\"})}),\"\\n\",e(c.p,{children:\"我们先看一下我有哪些组件\"}),\"\\n\",e(c.p,{children:e(c.img,{src:\"https://ik.imagekit.io/leiakito/Actual%20Combat/React%20Native%20%E5%AE%9E%E6%88%98%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8%20(2).webp?updatedAt=1739878232830\",alt:\"image.png\"})}),\"\\n\",n(c.p,{children:[\"这是我们最后想要的一个效果 \",e(c.img,{src:\"https://ik.imagekit.io/leiakito/Actual%20Combat/04a21ff6c19544f4a71c2af6a643eb20~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp?updatedAt=1739878232177\",alt:\"image.png\"})]}),\"\\n\",e(c.p,{children:\"ok,理论来说我们在写组件是应该跟随数据流，自上而下的写，但因为自下而上比较好让大家理解一点，我们就从里面往外面写。\"}),\"\\n\",n(c.p,{children:[\"我们先从\",e(c.code,{children:\"FlatList\"}),\"开始，大家应该对它很陌生，它是一个\",e(c.code,{children:\"rn\"}),\"的内置组件，那么要实现我们的功能需要哪些\",e(c.code,{children:\"api\"}),\"那。\"]}),\"\\n\",n(c.ul,{children:[\"\\n\",n(c.li,{children:[\"\\n\",n(c.p,{children:[\"首先是懒加载我们需要使用\",e(c.code,{children:\"onEndReached\"}),\"如果我们不指定距离，它会在滑动到内容最底部的距离为当前列表可见长度的一半时触发，接受一个函数。\"]}),\"\\n\"]}),\"\\n\",n(c.li,{children:[\"\\n\",n(c.p,{children:[\"要实现下拉刷新，我们用\",e(c.code,{children:\"onRefresh\"}),\"这个\",e(c.code,{children:\"api\"}),\"我们需要传一个回调函数进去。\"]}),\"\\n\"]}),\"\\n\",n(c.li,{children:[\"\\n\",n(c.p,{children:[\"而数据源是由\",e(c.code,{children:\"data\"}),\"指定。\"]}),\"\\n\"]}),\"\\n\",n(c.li,{children:[\"\\n\",n(c.p,{children:[\"而\",e(c.code,{children:\"ListHeaderComponent\"}),\"就是一个表头。\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(c.p,{children:[\"当我们已经知道需要哪些\",e(c.code,{children:\"api\"}),\"了，就可以尝试写一下一个最基础的\",e(c.code,{children:\"list\"}),\"组件\"]}),\"\\n\",e(c.p,{children:e(c.code,{children:\"List\"})}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" PropTypes\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'prop-types'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"FlatList\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" ListControls\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './ListControls'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" List\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"data\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fetchItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"refreshItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"isRefreshing\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"onFilter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"onSort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"FlatList\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      data\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"data\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      renderItem\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"item\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }) \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"item\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"item\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      ListHeaderComponent\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"ListControls\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" {\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"...{ \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"onFilter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"onSort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      onEndReached\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"fetchItems\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      onRefresh\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"refreshItems\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      refreshing\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"isRefreshing\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    />\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"List\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"propTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  fetchItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"func\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  refreshItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"func\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  isRefreshing\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"bool\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"紧接着我们就需要去实现\",e(c.code,{children:\"ListControls\"}),\"和\",e(c.code,{children:\"ListContainer\"}),\"。\"]}),\"\\n\",e(c.p,{children:e(c.code,{children:\"ListControls\"})}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" PropTypes\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'prop-types'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" ListFilter\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './ListFilter'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" ListSort\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './ListSort'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" ListControls\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"onFilter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"onSort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"controls\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"ListFilter\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onFilter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"onFilter\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"ListSort\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onSort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"onSort\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"asc\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"ListControls\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"propTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  onFilter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"func\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  onSort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"func\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"bool\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(c.p,{children:e(c.code,{children:\"ListSort\"})}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" PropTypes\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'prop-types'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" arrows\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"new\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" Map\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"([\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  [\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'▼'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"],\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  [\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'▲'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"],\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"])\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" ListSort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"onSort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onPress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"onSort\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"arrows\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"get\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"Text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"ListSort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"propTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  onSort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"func\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"bool\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"ListFilter\"}),\"，这里\",e(c.code,{children:\"autoFocus\"}),\"是进来就自动聚焦调出小键盘。\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" PropTypes\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'prop-types'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"TextInput\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react-native'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" styles\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './styles'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" ListFilter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"onFilter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"TextInput\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" autoFocus\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" placeholder\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#FFD493\"},children:'\"Search\"'}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" style\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"styles\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"filter\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\" onChangeText\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"onFilter\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"View\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"ListFilter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"propTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  onFilter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"PropTypes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"func\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"isRequired\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[\"可以看到在这三个部分并没有太多的逻辑代码，都是一些用于展示的代码。我把所有的逻辑代码都放在来\",e(c.code,{children:\"container\"}),\"中。\"]}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"container\"}),\",此时想想我们需要在外层容器提供哪些状态。\"]}),\"\\n\",n(c.ul,{children:[\"\\n\",n(c.li,{children:[\"一个控制排序的状态\",e(c.code,{children:\"asc\"})]}),\"\\n\",n(c.li,{children:[\"一个控制\",e(c.code,{children:\"loading\"}),\"的状态\",e(c.code,{children:\"isRefreshing\"})]}),\"\\n\",n(c.li,{children:[\"一个数据源\",e(c.code,{children:\"pdata\"})]}),\"\\n\",n(c.li,{children:[\"一个控制搜索过滤框的状态\",e(c.code,{children:\"filter\"})]}),\"\\n\"]}),\"\\n\",e(c.p,{children:\"然后我们需要处理哪些逻辑\"}),\"\\n\",n(c.ul,{children:[\"\\n\",n(c.li,{children:[\"搜索排序后的列表展示 \",e(c.code,{children:\"fetchItem\"}),\" -> \",e(c.code,{children:\"data\"}),\" -> \",e(c.code,{children:\"filterAndSort(data)\"}),\" -> \",e(c.code,{children:\"pdata=useMemo(data)\"})]}),\"\\n\",n(c.li,{children:[\"每次往下拉的数据获取 \",e(c.code,{children:\"fetchItems\"})]}),\"\\n\",n(c.li,{children:[\"刷新后拉取新数据 \",e(c.code,{children:\"refreshItems\"})]}),\"\\n\"]}),\"\\n\",n(c.p,{children:[\"那么到这里我们就完成了一个\",e(c.code,{children:\"懒加载\"}),\"、\",e(c.code,{children:\"搜索\"}),\"、\",e(c.code,{children:\"排序\"}),\"、\",e(c.code,{children:\"下拉刷新\"}),\"的列表\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" React\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", { \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"useEffect\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"useMemo\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" 'react'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" *\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" as\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" api\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './api'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"import\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" List\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" from\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" './List'\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" filterAndSort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"array\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"array\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"length\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" array\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      .\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"filter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"i\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"length\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"includes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"))\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      .\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"sort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"asc\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" ?\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"a\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"b\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" a\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" - \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"b\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" :\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"a\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"b\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" b\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" - \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"a\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"index\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" ListContainer\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = () \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"data\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"setData\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"([])\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"isRefreshing\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"setIsRefreshing\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"setAsc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" [\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"filter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"setFilter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"] = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useState\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"''\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" fetchItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" api\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      .\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"fetchItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      .\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"then\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"resp\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" resp\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"json\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"())\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      .\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"then\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(({ \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"items\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }) \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"        setData\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"([...\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"data\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", ...\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"items\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"])\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"      })\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  //我这的刷新模拟的是拉取新数据的过程\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" refreshItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"    setIsRefreshing\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" api\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      .\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"fetchItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"({ \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"refresh\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"true\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" })\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      .\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"then\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"resp\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" resp\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"json\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"())\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      .\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"then\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(({ \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"items\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" }) \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"        setData\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"items\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"      })\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      .\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"finally\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"        setIsRefreshing\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"      })\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"  useEffect\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"    fetchItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }, [])\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" pdata\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"useMemo\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" filterAndSort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"filter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"data\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }, [\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"filter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"data\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"])\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\"List\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      data\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pdata\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      fetchItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"fetchItems\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      refreshItems\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"refreshItems\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      isRefreshing\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"isRefreshing\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"asc\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      onFilter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"text\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"        setFilter\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"text\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"      onSort\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"=\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"{\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"        setAsc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(!\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"asc\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"}\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    />\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\" default\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" ListContainer\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.h1,{id:\"3结束\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3结束\",children:e(c.span,{className:\"icon icon-link\"})}),\"3、结束\"]}),\"\\n\",n(c.p,{children:[\"到这里我们已经了解了最基本的两种场景表单和列表，，em如果大家有问题，或者想学点更深入的东西直接看\",e(c.a,{href:\"https://juejin.cn/user/400646714977431/pins\",children:\"沸点\"}),\"加我就好，免费课就是为了让大家学懂跨端框架。\"]})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "React-native实战系列",
          "url": "#react-native实战系列",
          "items": []
        },
        {
          "title": "1、组件的使用",
          "url": "#1组件的使用",
          "items": []
        },
        {
          "title": "1.1、封装一个input",
          "url": "#11封装一个input",
          "items": [
            {
              "title": "1.2、封装一个select",
              "url": "#12封装一个select",
              "items": []
            }
          ]
        },
        {
          "title": "1.3、封装一个Toggling",
          "url": "#13封装一个toggling",
          "items": [
            {
              "title": "1.3、实现一个DateTimePicker",
              "url": "#13实现一个datetimepicker",
              "items": []
            }
          ]
        },
        {
          "title": "2、如何实现一个懒加载列表",
          "url": "#2如何实现一个懒加载列表",
          "items": []
        },
        {
          "title": "3、结束",
          "url": "#3结束",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "22.react_native_actual_combat"
  },
  {
    "slug": "/content/react-source-code/3.schedule",
    "title": "3.React调度核心原理（补）",
    "description": "深入探讨React的调度机制，解析其核心原理，并与requestIdleCallback API进行对比，揭示React如何实现高效的任务调度。",
    "published": true,
    "date": "2023-01-10T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:n,jsxs:e}=arguments[0];function _createMdxContent(c){const r={a:\"a\",blockquote:\"blockquote\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",h3:\"h3\",h4:\"h4\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...c.components};return e(l,{children:[e(r.h1,{id:\"react调度核心原理及其与requestidlecallback的关系\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react调度核心原理及其与requestidlecallback的关系\",children:n(r.span,{className:\"icon icon-link\"})}),\"React调度核心原理及其与requestIdleCallback的关系\"]}),\"\\n\",e(r.p,{children:[\"在深入探讨 React 的 Fiber 架构之前，我们需要先了解 \",n(r.code,{children:\"requestIdleCallback\"}),' 这个 API。它允许我们在浏览器空闲时执行低优先级的任务，从而不影响高优先级任务的执行。这个 API 帮助我们理解\"空闲时间\"和\"让出主线程\"的概念。']}),\"\\n\",e(r.blockquote,{children:[\"\\n\",n(r.p,{children:\"25年1月31日穿越发言: 这文章我稍微修了一下，发现了个大问题就是只看这一段调度机制单独拿出来几乎是看不懂的，但不会大修了，而且现在react19了，它的调度机制加入了非常多的内容，可能在很长一段时间我也等着别人分析投喂我一下，有看到好的文章的小伙伴可以滴我一下。\"}),\"\\n\"]}),\"\\n\",e(r.h2,{id:\"1-requestidlecallback-简介\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1-requestidlecallback-简介\",children:n(r.span,{className:\"icon icon-link\"})}),\"1. requestIdleCallback 简介\"]}),\"\\n\",e(r.p,{children:[n(r.strong,{children:\"空闲时间\"}),\"：页面渲染是以帧为单位的，流畅的页面通常保持 60 帧/秒，即每帧约 16ms。如果每帧的执行时间少于 16ms，剩余的时间就是空闲时间。\"]}),\"\\n\",e(r.p,{children:[n(r.strong,{children:\"API 介绍\"}),\"：\"]}),\"\\n\",n(r.p,{children:n(r.img,{src:\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f056b718c9f485e92119ad1ea1666a5~tplv-k3u1fbpfcp-watermark.image?\",alt:\"requestIdleCallback API\"})}),\"\\n\",e(r.ul,{children:[\"\\n\",e(r.li,{children:[\"返回值 \",n(r.code,{children:\"2\"}),\" 是回调的 ID，可用于 \",n(r.code,{children:\"Window.cancelIdleCallback()\"}),\" 方法来取消回调。\"]}),\"\\n\",e(r.li,{children:[n(r.code,{children:\"didTimeout\"}),\" 是一个布尔值，当为 \",n(r.code,{children:\"true\"}),\" 时表示回调正在执行。\"]}),\"\\n\",e(r.li,{children:[n(r.code,{children:\"timeRemaining()\"}),\" 方法返回当前帧剩余的空闲时间。\"]}),\"\\n\"]}),\"\\n\",e(r.h2,{id:\"2-requestidlecallback-实战示例\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2-requestidlecallback-实战示例\",children:n(r.span,{className:\"icon icon-link\"})}),\"2. requestIdleCallback 实战示例\"]}),\"\\n\",e(r.p,{children:[\"让我们通过两个对比示例来理解 \",n(r.code,{children:\"requestIdleCallback\"}),\" 的实际应用。\"]}),\"\\n\",e(r.h3,{id:\"21-不使用-requestidlecallback\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#21-不使用-requestidlecallback\",children:n(r.span,{className:\"icon icon-link\"})}),\"2.1 不使用 requestIdleCallback\"]}),\"\\n\",n(r.p,{children:\"在这个例子中，我们先模拟一个耗时的计算任务，同时尝试响应用户输入：\"}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(r.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" button\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"document\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getElementById\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'button'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" input\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"document\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getElementById\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'input'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" isPrimeNumber\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"button\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"addEventListener\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'click'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", () \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 模拟耗时计算\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  for\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" i\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"2\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"1000000000\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"++) {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    isPrimeNumber\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    for\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" j\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"2\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"j\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"j\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"++) {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" % \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"j\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"        isPrimeNumber\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#54B9FF\"},children:\"        break\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  console\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"log\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'计算完成'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"})\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"input\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"addEventListener\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'input'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", () \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  console\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"log\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'输入值：'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"input\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"})\"})})]})})}),\"\\n\",n(r.p,{children:\"在这个例子中，当用户点击按钮时，会启动一个耗时的计算。在计算过程中，如果用户尝试在输入框中输入内容，会发现输入非常卡顿，甚至完全无响应，直到计算完成。\"}),\"\\n\",e(r.h3,{id:\"22-使用-requestidlecallback\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#22-使用-requestidlecallback\",children:n(r.span,{className:\"icon icon-link\"})}),\"2.2 使用 requestIdleCallback\"]}),\"\\n\",e(r.p,{children:[\"现在，让我们使用 \",n(r.code,{children:\"requestIdleCallback\"}),\" 来改进这个例子：\"]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(r.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" button\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"document\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getElementById\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'button'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" input\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"document\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getElementById\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'input'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" isPrimeNumber\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" i\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"2\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"button\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"addEventListener\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'click'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", () \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  function\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" doWork\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"deadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    while\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"1000000000\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"deadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"timeRemaining\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() > \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      isPrimeNumber\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      for\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" j\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"2\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"j\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"j\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"++) {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" % \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"j\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"          isPrimeNumber\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#54B9FF\"},children:\"          break\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      i\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"++\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"i\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"1000000000\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"      requestIdleCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"doWork\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      console\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"log\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'计算完成'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  requestIdleCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"doWork\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"})\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"input\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"addEventListener\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'input'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", () \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  console\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"log\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'输入值：'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"input\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"value\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"})\"})})]})})}),\"\\n\",e(r.p,{children:[\"在这个改进的版本中，我们将耗时的计算任务分割成多个小任务，并使用 \",n(r.code,{children:\"requestIdleCallback\"}),\" 在浏览器空闲时执行这些任务。这样，即使在进行大量计算的同时，用户仍然可以流畅地在输入框中输入内容，因为浏览器有机会在计算任务之间处理用户输入。\"]}),\"\\n\",e(r.p,{children:[\"这个例子更好地展示了 \",n(r.code,{children:\"requestIdleCallback\"}),\" 的核心优势：它允许我们在不阻塞主线程的情况下执行耗时的任务，从而提高应用的响应性和用户体验。\"]}),\"\\n\",e(r.p,{children:[\"通过这种方式，我们可以更清楚地看到 \",n(r.code,{children:\"requestIdleCallback\"}),\" 如何帮助我们在执行耗时任务的同时保持应用的响应性，这正是 React 在其调度系统中试图实现的目标。\"]}),\"\\n\",e(r.h2,{id:\"3-react-中的调度实现\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3-react-中的调度实现\",children:n(r.span,{className:\"icon icon-link\"})}),\"3. React 中的调度实现\"]}),\"\\n\",e(r.p,{children:[\"虽然 \",n(r.code,{children:\"requestIdleCallback\"}),\" 展示了空闲时间和让出主线程的概念，但 React 实际上并不使用它来实现调度。关于 React 为什么不使用 \",n(r.code,{children:\"requestIdleCallback\"}),\"，可以参考\",n(r.a,{href:\"https://juejin.cn/post/7170095557443551246\",children:\"这篇文章\"}),\"。而完整的调度实现分为了两个部分。\"]}),\"\\n\",e(r.h3,{id:\"31-react-调度源码实现\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#31-react-调度源码实现\",children:n(r.span,{className:\"icon icon-link\"})}),\"3.1 React 调度源码实现\"]}),\"\\n\",e(r.p,{children:[\"React 使用 \",n(r.code,{children:\"MessageChannel\"}),\" 来实现消息的发送和接收，从而实现调度。这种实现可以分为两个核心部分：调度和时间切片。\"]}),\"\\n\",n(r.p,{children:n(r.img,{src:\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8378f03e4c04475391ddb76895a8b505~tplv-k3u1fbpfcp-zoom-1.image\",alt:\"React Scheduling Implementation\"})}),\"\\n\",n(r.p,{children:\"在我们开始之前先粗略的阅读这段源码：\"}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(r.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" taskTimeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = -\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"1\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" yieldInterval\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"5\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" deadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// TODO: Make this configurable\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// TODO: Adjust this based on priority?\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" maxYieldInterval\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"300\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" needsPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  enableIsInputPending\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  navigator\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  navigator\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"scheduling\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  navigator\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"scheduling\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"isInputPending\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" scheduling\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"navigator\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"scheduling\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 17.02的源码这里比较简单，其实这都不用看直接看false,因为enableIsInputPending为false,就而且17.2里面isInputPending是不可以用的，我们直接看18把，然后我就发现18里面好像依然没解决这个问题\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  shouldYieldToHost\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" () {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" >= \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"deadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 简单的说就是长时间阻塞主线程的东西就给它打断了，绘制（交互）和用户输入之类的东西就给他打断了，都不是我们可以在最大延时里再看看\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"needsPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"scheduling\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"isInputPending\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"()) {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // There is either a pending paint or a pending input.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),n(r.span,{style:{color:\"#FFD493\"},children:\" true\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 300ms最大延时打断\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" >= \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"maxYieldInterval\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 不需要打断\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(r.span,{style:{color:\"#FFD493\"},children:\" false\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  requestPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" () {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    needsPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"} \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 直接看这里这个deadline是在performWorkUntilDeadline执行任务的时候去设置的\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  shouldYieldToHost\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" () {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" getCurrentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() >= \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"deadline\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // Since we yield every frame regardless, `requestPaint` has no effect.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  requestPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" () {}\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 强制设置检测时间，源码没用到调试的时候可以设置,电脑越好，fps越高分片时间越短\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"forceFrameRate\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fps\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"fps\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"fps\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"125\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // Using console['error'] to evade Babel and ESLint\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    console\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'error'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"](\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:\"      'forceFrameRate takes a positive int between 0 and 125, '\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" +\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#FFD493\"},children:\"        'forcing frame rates higher than 125 fps is not supported'\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    )\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#54B9FF\"},children:\"    return\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"fps\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    yieldInterval\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"Math\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"floor\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"1000\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" / \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"fps\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // reset the framerate\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    yieldInterval\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"5\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" performWorkUntilDeadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = () \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 有执行任务\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 计算一帧的打断检测时间\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    deadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"yieldInterval\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" hasTimeRemaining\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    try\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 执行c回调\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" hasMoreWork\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"hasTimeRemaining\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 执行完该回调后, 判断后续是否还有其他任务\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"hasMoreWork\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"        isMessageLoopRunning\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"        scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 还有其他任务, 推进进入下一个宏任务队列中\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"        port\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"error\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // If a scheduler task throws, exit the current browser task so the\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // error can be observed.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      port\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      throw\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" error\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    isMessageLoopRunning\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // Yielding to the browser will give it a chance to paint, so we can\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // reset this.\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 重置状态\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  needsPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" channel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"new\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" MessageChannel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// port2 发送\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" port\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"channel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"port2\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// port1 接收\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"channel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"port1\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"onmessage\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"performWorkUntilDeadline\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 在每一帧中执行任务\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"requestHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 回调注册\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"callback\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"isMessageLoopRunning\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    isMessageLoopRunning\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 进入宏任务队列\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    port\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 取消回调\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"cancelHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" () {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 设置超时回调\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"requestHostTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"ms\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  taskTimeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"    callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"())\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }, \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"ms\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 取消超时\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"cancelHostTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" () {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  clearTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"taskTimeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  taskTimeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = -\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"1\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(r.h4,{id:\"1-调度机制\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1-调度机制\",children:n(r.span,{className:\"icon icon-link\"})}),\"1. 调度机制\"]}),\"\\n\",e(r.p,{children:[\"React 通过 \",n(r.code,{children:\"MessageChannel\"}),\" 建立通道，一个端口发送消息，另一个接收消息。主要代码如下：\"]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(r.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" channel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"new\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" MessageChannel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" port\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"channel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"port2\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"channel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"port1\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"onmessage\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"performWorkUntilDeadline\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"requestHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"callback\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"isMessageLoopRunning\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    isMessageLoopRunning\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    port\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(r.p,{children:[\"这里，\",n(r.code,{children:\"performWorkUntilDeadline\"}),\" 函数在接收消息时被调用，它负责设置空闲时间 \",n(r.code,{children:\"deadline\"}),\" 并执行回调函数。\"]}),\"\\n\",e(r.h4,{id:\"2-时间切片\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2-时间切片\",children:n(r.span,{className:\"icon icon-link\"})}),\"2. 时间切片\"]}),\"\\n\",e(r.p,{children:[\"React 通过 \",n(r.code,{children:\"shouldYieldToHost\"}),\" 函数根据 \",n(r.code,{children:\"deadline\"}),\" 决定是否中断构建，实现时间切片：\"]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(r.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"shouldYieldToHost\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" () {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" getCurrentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() >= \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"deadline\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" performWorkUntilDeadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = () \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    deadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"yieldInterval\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" hasTimeRemaining\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    try\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" hasMoreWork\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"hasTimeRemaining\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"hasMoreWork\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"        isMessageLoopRunning\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"        scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"        port\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"error\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      port\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      throw\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" error\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    isMessageLoopRunning\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  needsPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(r.p,{children:\"这种实现允许 React 在执行任务时能够及时响应用户交互，提高应用的性能和用户体验。\"}),\"\\n\",n(r.p,{children:\"通过这种方式，React 实现了高效的任务调度和时间切片，使得复杂的渲染过程能够被分割成小块，在不同的时间片段内执行，从而避免长时间阻塞主线程。\"}),\"\\n\",e(r.h3,{id:\"32-settimeout-降级实现\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#32-settimeout-降级实现\",children:n(r.span,{className:\"icon icon-link\"})}),\"3.2 setTimeout 降级实现\"]}),\"\\n\",e(r.p,{children:[\"React 的调度系统设计考虑了不同的运行环境，包括非浏览器环境。React使用了降级策略，使用 \",n(r.code,{children:\"setTimeout\"}),\" 来模拟类似的调度行为。\"]}),\"\\n\",n(r.p,{children:\"降级实现：\"}),\"\\n\",e(r.ol,{children:[\"\\n\",e(r.li,{children:[\"\\n\",e(r.p,{children:[n(r.strong,{children:\"环境检测\"}),\"：\\nReact 首先检查当前环境是否支持 \",n(r.code,{children:\"window\"}),\" 对象和 \",n(r.code,{children:\"MessageChannel\"}),\"。如果不支持，就会启用降级策略。\"]}),\"\\n\"]}),\"\\n\",e(r.li,{children:[\"\\n\",e(r.p,{children:[n(r.strong,{children:\"核心功能模拟\"}),\"：\"]}),\"\\n\",e(r.ul,{children:[\"\\n\",e(r.li,{children:[n(r.code,{children:\"_flushCallback\"}),\": 模拟了主要的调度逻辑，执行回调并处理异常。\"]}),\"\\n\",e(r.li,{children:[n(r.code,{children:\"requestHostCallback\"}),\": 安排回调的执行，防止重入。\"]}),\"\\n\",e(r.li,{children:[n(r.code,{children:\"cancelHostCallback\"}),\": 取消已安排的回调。\"]}),\"\\n\",e(r.li,{children:[n(r.code,{children:\"requestHostTimeout\"}),\" 和 \",n(r.code,{children:\"cancelHostTimeout\"}),\": 处理超时逻辑。\"]}),\"\\n\",e(r.li,{children:[n(r.code,{children:\"shouldYieldToHost\"}),\": 在降级模式下始终返回 \",n(r.code,{children:\"false\"}),\"，意味着任务不会主动让出控制权。\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(r.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  typeof\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" window\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'undefined'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" ||\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // Check if MessageChannel is supported, too.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  typeof\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" MessageChannel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'function'\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // If this accidentally gets imported in a non-browser environment, e.g. JavaScriptCore,\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // fallback to a naive implementation.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" _callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" _timeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" _flushCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"_callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      try\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" hasRemainingTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"        _callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"hasRemainingTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"        _callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"e\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"        setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"_flushCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        throw\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" e\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  requestHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"cb\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"_callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // Protect against re-entrancy.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"      setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"requestHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"cb\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      _callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"cb\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"      setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"_flushCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  cancelHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    _callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  requestHostTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"cb\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"ms\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    _timeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"cb\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"ms\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  cancelHostTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"    clearTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"_timeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  shouldYieldToHost\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(r.span,{style:{color:\"#FFD493\"},children:\" false\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  requestPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"forceFrameRate\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {};\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"} \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // Capture local references to native APIs, in case a polyfill overrides them.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"window\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" clearTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"window\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"clearTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" console\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'undefined'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // TODO: Scheduler no longer requires these methods to be polyfilled. But\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // maybe we want to continue warning if they don't exist, to preserve the\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // option to rely on it in the future?\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" requestAnimationFrame\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"window\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"requestAnimationFrame\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" cancelAnimationFrame\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"window\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"cancelAnimationFrame\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" requestAnimationFrame\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'function'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // Using console['error'] to evade Babel and ESLint\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      console\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'error'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"](\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:'        \"This browser doesn\\'t support requestAnimationFrame. \"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" +\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:\"          'Make sure that you load a '\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" +\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:\"          'polyfill in older browsers. https://reactjs.org/link/react-polyfills'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" cancelAnimationFrame\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'function'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // Using console['error'] to evade Babel and ESLint\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      console\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'error'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"](\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:'        \"This browser doesn\\'t support cancelAnimationFrame. \"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" +\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:\"          'Make sure that you load a '\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" +\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:\"          'polyfill in older browsers. https://reactjs.org/link/react-polyfills'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})})]})})})]})}return{default:function(l={}){const{wrapper:e}=l.components||{};return e?n(e,{...l,children:n(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "React调度核心原理及其与requestIdleCallback的关系",
          "url": "#react调度核心原理及其与requestidlecallback的关系",
          "items": [
            {
              "title": "1. requestIdleCallback 简介",
              "url": "#1-requestidlecallback-简介",
              "items": []
            },
            {
              "title": "2. requestIdleCallback 实战示例",
              "url": "#2-requestidlecallback-实战示例",
              "items": [
                {
                  "title": "2.1 不使用 requestIdleCallback",
                  "url": "#21-不使用-requestidlecallback",
                  "items": []
                },
                {
                  "title": "2.2 使用 requestIdleCallback",
                  "url": "#22-使用-requestidlecallback",
                  "items": []
                }
              ]
            },
            {
              "title": "3. React 中的调度实现",
              "url": "#3-react-中的调度实现",
              "items": [
                {
                  "title": "3.1 React 调度源码实现",
                  "url": "#31-react-调度源码实现",
                  "items": [
                    {
                      "title": "1. 调度机制",
                      "url": "#1-调度机制",
                      "items": []
                    },
                    {
                      "title": "2. 时间切片",
                      "url": "#2-时间切片",
                      "items": []
                    }
                  ]
                },
                {
                  "title": "3.2 setTimeout 降级实现",
                  "url": "#32-settimeout-降级实现",
                  "items": []
                }
              ]
            }
          ]
        }
      ],
      "visible": true
    },
    "slugAsParams": "3.schedule"
  },
  {
    "slug": "/content/react-source-code/4.fiber-structure",
    "title": "4. React Fiber链表结构深度解析",
    "description": "Fiber是React的核心架构，它使用链表结构来组织和管理组件树。",
    "published": true,
    "date": "2023-03-05T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:n,jsxs:e}=arguments[0];function _createMdxContent(r){const c={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",h3:\"h3\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...r.components};return e(l,{children:[e(c.h1,{id:\"react-fiber链表结构深度解析\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react-fiber链表结构深度解析\",children:n(c.span,{className:\"icon icon-link\"})}),\"React Fiber链表结构深度解析\"]}),\"\\n\",e(c.h2,{id:\"1-fiber结构深入剖析\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1-fiber结构深入剖析\",children:n(c.span,{className:\"icon icon-link\"})}),\"1. Fiber结构深入剖析\"]}),\"\\n\",n(c.p,{children:\"Fiber是React的核心架构，它使用链表结构来组织和管理组件树。\"}),\"\\n\",e(c.h3,{id:\"11-fiber节点的结构\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#11-fiber节点的结构\",children:n(c.span,{className:\"icon icon-link\"})}),\"1.1 Fiber节点的结构\"]}),\"\\n\",n(c.p,{children:\"每个Fiber节点都是一个复杂的JavaScript对象，包含了组件的各种信息及其与其他节点的关系。以下是Fiber节点的详细结构：\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"{\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 标记组件类型\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  tag: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"WorkTag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 唯一标识，用于优化更新过程\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  key: \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"string\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 组件的类型（函数组件、类组件等）\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  type: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 对应的DOM节点或组件实例\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  stateNode: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 链表结构\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  child: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  sibling: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 更新相关\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  pendingProps: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  memoizedProps: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  updateQueue: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"UpdateQueue\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  memoizedState: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"any\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 副作用相关\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  flags: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  subtreeFlags: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Flags\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  deletions: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Array\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 调度优先级相关\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  lanes: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  childLanes: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 替身（用于并发模式）\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  alternate: \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 开发工具使用\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  _debugOwner\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"?:\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" Fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  _debugIsCurrentlyTiming\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"?:\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" boolean\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  _debugNeedsRemount\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"?:\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" boolean\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 其他属性...\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"它主要包含了组件的基本信息，还包括了更新、副作用和调度优先级等重要信息。\"}),\"\\n\",e(c.h3,{id:\"12-fiber的链表结构\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#12-fiber的链表结构\",children:n(c.span,{className:\"icon icon-link\"})}),\"1.2 Fiber的链表结构\"]}),\"\\n\",n(c.p,{children:\"Fiber树使用三个主要指针构建链表结构：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[n(c.code,{children:\"child\"}),\": 指向第一个子节点\"]}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"sibling\"}),\": 指向下一个兄弟节点\"]}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"return\"}),\": 指向父节点\"]}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"我们可以假设我们有以下的React组件结构：\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"jsx\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"jsx\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Header\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Main\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Article\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Sidebar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Main\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Footer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]})]})})}),\"\\n\",n(c.p,{children:\"这个结构可以用Fiber链表表示如下：\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'ClassComponent'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Header\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" Header\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'FunctionComponent'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Header\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Main\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"App\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" Main\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'FunctionComponent'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Main\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Article\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Footer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"App\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" Article\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'FunctionComponent'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Article\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Sidebar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Main\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" Sidebar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'FunctionComponent'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Sidebar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Main\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" Footer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'FunctionComponent'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Footer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"App\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"在这个例子中：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[n(c.code,{children:\"App\"}),\"的\",n(c.code,{children:\"child\"}),\"指向\",n(c.code,{children:\"Header\"}),\"，因为\",n(c.code,{children:\"Header\"}),\"是\",n(c.code,{children:\"App\"}),\"的第一个子节点。\"]}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"Header\"}),\"的\",n(c.code,{children:\"sibling\"}),\"指向\",n(c.code,{children:\"Main\"}),\"，因为\",n(c.code,{children:\"Main\"}),\"是\",n(c.code,{children:\"Header\"}),\"的下一个兄弟节点。\"]}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"Main\"}),\"的\",n(c.code,{children:\"child\"}),\"指向\",n(c.code,{children:\"Article\"}),\"，因为\",n(c.code,{children:\"Article\"}),\"是\",n(c.code,{children:\"Main\"}),\"的第一个子节点。\"]}),\"\\n\",e(c.li,{children:[n(c.code,{children:\"Article\"}),\"的\",n(c.code,{children:\"sibling\"}),\"指向\",n(c.code,{children:\"Sidebar\"}),\"，因为\",n(c.code,{children:\"Sidebar\"}),\"是\",n(c.code,{children:\"Article\"}),\"的下一个兄弟节点。\"]}),\"\\n\",e(c.li,{children:[\"所有节点的\",n(c.code,{children:\"return\"}),\"都指向它们的父节点。例如，\",n(c.code,{children:\"Header\"}),\"、\",n(c.code,{children:\"Main\"}),\"和\",n(c.code,{children:\"Footer\"}),\"的\",n(c.code,{children:\"return\"}),\"都指向\",n(c.code,{children:\"App\"}),\"。\"]}),\"\\n\"]}),\"\\n\",e(c.p,{children:[\"这种结构允许React在树中高效地向上、向下和横向移动，无论是在渲染过程中还是在进行更新时。例如，当React需要更新\",n(c.code,{children:\"Main\"}),\"组件时，它可以轻松地访问其子组件（通过\",n(c.code,{children:\"child\"}),\"指针）和兄弟组件（通过\",n(c.code,{children:\"sibling\"}),\"指针），同时也可以回到父组件（通过\",n(c.code,{children:\"return\"}),\"指针）。\"]}),\"\\n\",e(c.h2,{id:\"2-fiber树的构建和更新机制\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2-fiber树的构建和更新机制\",children:n(c.span,{className:\"icon icon-link\"})}),\"2. Fiber树的构建和更新机制\"]}),\"\\n\",e(c.h3,{id:\"21-创建fiber节点的过程\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#21-创建fiber节点的过程\",children:n(c.span,{className:\"icon icon-link\"})}),\"2.1 创建Fiber节点的过程\"]}),\"\\n\",e(c.p,{children:[\"React使用\",n(c.code,{children:\"createFiberFromElement\"}),\"函数创建单个Fiber节点:\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" createFiberFromElement\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"mode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" owner\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"__DEV__\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    owner\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"_owner\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" key\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"key\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" pendingProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"createFiberFromTypeAndProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"key\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingProps\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"owner\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"mode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"__DEV__\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"_debugSource\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"_source\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"_debugOwner\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"_owner\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" fiber\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:[\"这个函数创建了Fiber节点。它调用了\",n(c.code,{children:\"createFiberFromTypeAndProps\"}),\"来实际创建Fiber对象，这个函数会根据组件的类型（如函数组件、类组件、宿主组件等）创建不同的Fiber节点。\"]}),\"\\n\",e(c.h3,{id:\"22-构建fiber树的过程\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#22-构建fiber树的过程\",children:n(c.span,{className:\"icon icon-link\"})}),\"2.2 构建Fiber树的过程\"]}),\"\\n\",e(c.p,{children:[n(c.code,{children:\"reconcileChildFibers\"}),\"函数是构建和更新Fiber树的核心:\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" reconcileChildFibers\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"currentFirstChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 处理不同类型的子节点（单个元素、数组等）\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'object'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    switch\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"$$typeof\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      case\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" REACT_ELEMENT_TYPE\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" placeSingleChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"reconcileSingleElement\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentFirstChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"))\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      case\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" REACT_PORTAL_TYPE\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" placeSingleChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"reconcileSinglePortal\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentFirstChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"))\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      case\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" REACT_LAZY_TYPE\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" payload\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"_payload\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" init\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"_init\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" reconcileChildFibers\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentFirstChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"init\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"payload\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"), \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"isArray\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" reconcileChildrenArray\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentFirstChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getIteratorFn\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" reconcileChildrenIterator\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentFirstChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 处理文本节点\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'string'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'number'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" placeSingleChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"reconcileSingleTextNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentFirstChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"''\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"))\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 处理其他情况（如null，undefined等）\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" deleteRemainingChildren\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentFirstChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"这个函数主要是处理不同类型的子节点，包括单个元素、数组、迭代器、文本节点等。\"}),\"\\n\",e(c.h3,{id:\"23-链接fiber节点的详细过程\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#23-链接fiber节点的详细过程\",children:n(c.span,{className:\"icon icon-link\"})}),\"2.3 链接Fiber节点的详细过程\"]}),\"\\n\",e(c.p,{children:[\"在构建过程中，React通过设置\",n(c.code,{children:\"child\"}),\"、\",n(c.code,{children:\"sibling\"}),\"和\",n(c.code,{children:\"return\"}),\"属性来链接Fiber节点。\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" appendAllChildren\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"parent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"HostComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"HostText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"      appendInitialChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"parent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"stateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"stateNode\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"HostPortal\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 不要遍历到portal的子节点\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"      continue\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"        return\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"return\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"return\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"node\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:\"这个函数展示了React如何深度优先遍历Fiber树，并在过程中建立正确的父子和兄弟关系。它还处理了特殊情况，如portal组件。\"}),\"\\n\",e(c.h3,{id:\"24-实际例子\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#24-实际例子\",children:n(c.span,{className:\"icon icon-link\"})}),\"2.4 实际例子\"]}),\"\\n\",n(c.p,{children:\"让我们以一个简单的React组件树为例:\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"jsx\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"jsx\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Header\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Main\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Article\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Sidebar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Main\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Footer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  )\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:[\"现在,我们来看看React如何使用\",n(c.code,{children:\"reconcileChildFibers\"}),\"函数来构建这个组件树的Fiber结构:\"]}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[\"首先,React会为\",n(c.code,{children:\"App\"}),\"组件创建一个Fiber节点。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[\"然后,React会调用\",n(c.code,{children:\"reconcileChildFibers\"}),\"来处理\",n(c.code,{children:\"App\"}),\"的子元素(即\",n(c.code,{children:\"div\"}),\"):\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"reconcileChildFibers\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"appFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">...</\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">, \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]})})})}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[\"在\",n(c.code,{children:\"reconcileChildFibers\"}),\"中,React会识别出这是一个\",n(c.code,{children:\"REACT_ELEMENT_TYPE\"}),\",然后调用\",n(c.code,{children:\"reconcileSingleElement\"}),\":\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"case\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" REACT_ELEMENT_TYPE:\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" placeSingleChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"reconcileSingleElement\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentFirstChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"))\"})]})]})})}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.code,{children:\"reconcileSingleElement\"}),\"会创建一个新的Fiber节点表示\",n(c.code,{children:\"div\"}),\",并将其设置为\",n(c.code,{children:\"App\"}),\" Fiber的child。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[\"接下来,React会再次调用\",n(c.code,{children:\"reconcileChildFibers\"}),\"来处理\",n(c.code,{children:\"div\"}),\"的子元素:\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"reconcileChildFibers\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"divFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", [<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Header\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />, <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Main\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">...</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Main\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">, <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Footer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />], \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]})})})}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[\"这次,因为子元素是一个数组,React会进入\",n(c.code,{children:\"isArray(newChild)\"}),\"的分支:\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"isArray\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" reconcileChildrenArray\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"currentFirstChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[\"在\",n(c.code,{children:\"reconcileChildrenArray\"}),\"中,React会为\",n(c.code,{children:\"Header\"}),\"、\",n(c.code,{children:\"Main\"}),\"和\",n(c.code,{children:\"Footer\"}),\"各创建一个Fiber节点,并将它们链接起来形成一个兄弟链表。\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[\"对于\",n(c.code,{children:\"Main\"}),\"组件,React会再次调用\",n(c.code,{children:\"reconcileChildFibers\"}),\"来处理其子元素:\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#00DAEF\"},children:\"reconcileChildFibers\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"mainFiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", [<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Article\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />, <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Sidebar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />], \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]})})})}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[\"同样,这会创建\",n(c.code,{children:\"Article\"}),\"和\",n(c.code,{children:\"Sidebar\"}),\"的Fiber节点,并将它们链接为兄弟节点。\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(c.p,{children:\"通过这个过程,React最终会构建出如下的Fiber树结构:\"}),\"\\n\",n(c.pre,{children:n(c.code,{children:\"App\\n |\\n +-- div\\n      |\\n      +-- Header\\n      |\\n      +-- Main\\n      |    |\\n      |    +-- Article\\n      |    |\\n      |    +-- Sidebar\\n      |\\n      +-- Footer\\n\"})}),\"\\n\",n(c.p,{children:\"在这个结构中:\"}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"每个节点都是一个Fiber对象\"}),\"\\n\",e(c.li,{children:[\"父子关系通过\",n(c.code,{children:\"child\"}),\"和\",n(c.code,{children:\"return\"}),\"指针维护\"]}),\"\\n\",e(c.li,{children:[\"兄弟关系通过\",n(c.code,{children:\"sibling\"}),\"指针维护\"]}),\"\\n\"]}),\"\\n\",e(c.h2,{id:\"3-fiber链表查找\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3-fiber链表查找\",children:n(c.span,{className:\"icon icon-link\"})}),\"3. Fiber链表查找\"]}),\"\\n\",n(c.p,{children:\"这一节主要讲链表查找，然后我思考了一下时间复杂度和传统树算法差不多，但空间复杂度大大减小了且对于gc回收的话只需要断裂链表。\"}),\"\\n\",n(c.p,{children:\"然后另外一个考虑应该就是，链表结构使得遍历可以在任意点暂停和恢复，这其实是React实现时间切片的基础。\"}),\"\\n\",e(c.h3,{id:\"31-向下查找特定类型的子节点\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#31-向下查找特定类型的子节点\",children:n(c.span,{className:\"icon icon-link\"})}),\"3.1 向下查找特定类型的子节点\"]}),\"\\n\",n(c.p,{children:\"有时我们需要查找特定类型的子节点，例如查找第一个类组件：\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" findFirstClassComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"ClassComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" child\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"HostComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"HostText\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 跳过宿主组件\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 继续向下查找\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" result\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"findFirstClassComponent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"result\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" result\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.h3,{id:\"32-向上查找特定条件的祖先节点\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#32-向上查找特定条件的祖先节点\",children:n(c.span,{className:\"icon icon-link\"})}),\"3.2 向上查找特定条件的祖先节点\"]}),\"\\n\",n(c.p,{children:\"在某些情况下，我们需要向上查找满足特定条件的祖先节点，例如查找最近的Provider组件：\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" findNearestProvider\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"contextType\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"return\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"Provider\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"_context\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"contextType\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" current\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"    current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"return\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.h3,{id:\"33-复杂的树遍历操作\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#33-复杂的树遍历操作\",children:n(c.span,{className:\"icon icon-link\"})}),\"3.3 复杂的树遍历操作\"]}),\"\\n\",n(c.p,{children:\"有时我们需要进行更复杂的树遍历操作，例如同时向上和向下查找：\"}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" findNodeBetween\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"start\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"end\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"predicate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"start\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"end\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"predicate\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\")) {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\" current\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"      current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"      while\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"end\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"          current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"sibling\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#54B9FF\"},children:\"          break\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"        current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"return\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),n(c.span,{style:{color:\"#FFD493\"},children:\" null\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.h2,{id:\"4-实际意义\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#4-实际意义\",children:n(c.span,{className:\"icon icon-link\"})}),\"4. 实际意义\"]}),\"\\n\",n(c.p,{children:\"理解fiber的结构能帮助我们去理解上层组件结构、避免嵌套、以及思考怎样的组件设计是最优解的性能这种问题，而不是漫无目的的有组件就套就写就好了。\"}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"示例 1：深度嵌套的结构\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"jsx\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"jsx\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" DeeplyNestedPage\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Header\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Navigation\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NavItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Home</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NavItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NavItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">About</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NavItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NavItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Contact</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NavItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Navigation\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Header\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Content\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Sidebar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"SidebarItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Item 1</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"SidebarItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"SidebarItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Item 2</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"SidebarItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Sidebar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"MainContent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Article\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Title\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Welcome</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Title\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"          <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Paragraph\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">This is the main content.</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Paragraph\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"        </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Article\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"MainContent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Content\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Footer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"      <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Copyright\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">© 2023</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Copyright\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    </\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Footer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  </\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})})]})})}),\"\\n\",n(c.p,{children:n(c.strong,{children:\"示例 2：扁平化的结构\"})}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"jsx\",\"data-theme\":\"houston\",children:e(c.code,{\"data-language\":\"jsx\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\" FlatPage\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = () \"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  <\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Header\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Navigation\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NavItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Home</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NavItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NavItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">About</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NavItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NavItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Contact</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"NavItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Content\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Sidebar\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"SidebarItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Item 1</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"SidebarItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"SidebarItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Item 2</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"SidebarItem\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"MainContent\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Article\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Title\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">Welcome</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Title\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Paragraph\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">This is the main content.</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Paragraph\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Footer\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"    <\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Copyright\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">© 2023</\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"Copyright\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#EEF0F9\"},children:\"  </\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\"div\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\">\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})})]})})}),\"\\n\",n(c.p,{children:\"这两个例子最终都能达成相同的功能，但实现结构是不同的，我们可以分析一下这两种结构对 Fiber 树和性能的影响：\"}),\"\\n\",e(c.ol,{children:[\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"Fiber 树的深度\"}),\"：\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"深度嵌套的结构会创建一个更深的 Fiber 树。每一层嵌套都会在 Fiber 树中增加一个层级。\"}),\"\\n\",n(c.li,{children:\"扁平化的结构创建的 Fiber 树更浅，大多数组件都是直接的子组件。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"更新效率\"}),\"：\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",e(c.li,{children:[\"在深度嵌套的结构中，如果顶层组件（如 \",n(c.code,{children:\"Header\"}),\"）发生变化，React 需要遍历更多的 Fiber 节点来确定需要更新的内容。\"]}),\"\\n\",n(c.li,{children:\"扁平化的结构使得 React 可以更快地定位到需要更新的组件，因为它们大多处于同一层级。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"组件复用和状态管理\"}),\"：\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",e(c.li,{children:[\"深度嵌套的结构其实经常会导致不必要的组件重渲染。例如，如果 \",n(c.code,{children:\"Content\"}),\" 组件的状态改变，它可能会导致 \",n(c.code,{children:\"Sidebar\"}),\" 和 \",n(c.code,{children:\"MainContent\"}),\" 都重新渲染。\"]}),\"\\n\",n(c.li,{children:\"而扁平化的结构允许更精确的控制哪些组件需要重新渲染。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"代码可维护性\"}),\"：\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"显然扁平化的结构通常更容易维护和重构，因为组件之间的依赖关系更清晰。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(c.li,{children:[\"\\n\",e(c.p,{children:[n(c.strong,{children:\"性能优化空间\"}),\"：\"]}),\"\\n\",e(c.ul,{children:[\"\\n\",n(c.li,{children:\"扁平化的结构也更好优化。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\"]})]})}return{default:function(l={}){const{wrapper:e}=l.components||{};return e?n(e,{...l,children:n(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "React Fiber链表结构深度解析",
          "url": "#react-fiber链表结构深度解析",
          "items": [
            {
              "title": "1. Fiber结构深入剖析",
              "url": "#1-fiber结构深入剖析",
              "items": [
                {
                  "title": "1.1 Fiber节点的结构",
                  "url": "#11-fiber节点的结构",
                  "items": []
                },
                {
                  "title": "1.2 Fiber的链表结构",
                  "url": "#12-fiber的链表结构",
                  "items": []
                }
              ]
            },
            {
              "title": "2. Fiber树的构建和更新机制",
              "url": "#2-fiber树的构建和更新机制",
              "items": [
                {
                  "title": "2.1 创建Fiber节点的过程",
                  "url": "#21-创建fiber节点的过程",
                  "items": []
                },
                {
                  "title": "2.2 构建Fiber树的过程",
                  "url": "#22-构建fiber树的过程",
                  "items": []
                },
                {
                  "title": "2.3 链接Fiber节点的详细过程",
                  "url": "#23-链接fiber节点的详细过程",
                  "items": []
                },
                {
                  "title": "2.4 实际例子",
                  "url": "#24-实际例子",
                  "items": []
                }
              ]
            },
            {
              "title": "3. Fiber链表查找",
              "url": "#3-fiber链表查找",
              "items": [
                {
                  "title": "3.1 向下查找特定类型的子节点",
                  "url": "#31-向下查找特定类型的子节点",
                  "items": []
                },
                {
                  "title": "3.2 向上查找特定条件的祖先节点",
                  "url": "#32-向上查找特定条件的祖先节点",
                  "items": []
                },
                {
                  "title": "3.3 复杂的树遍历操作",
                  "url": "#33-复杂的树遍历操作",
                  "items": []
                }
              ]
            },
            {
              "title": "4. 实际意义",
              "url": "#4-实际意义",
              "items": []
            }
          ]
        }
      ],
      "visible": true
    },
    "slugAsParams": "4.fiber-structure"
  },
  {
    "slug": "/content/react-source-code/5.fiber-commit",
    "title": "5.React Fiber对象的创建与更新",
    "description": "深入探讨React Fiber架构中Fiber对象的创建过程、初始化提交以及Fiber树的更新机制,揭示React内部工作原理。",
    "published": true,
    "date": "2023-03-09T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:e,jsxs:n}=arguments[0];function _createMdxContent(r){const c={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",h3:\"h3\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",...r.components};return n(l,{children:[n(c.h1,{id:\"react-fiber对象的创建与更新机制\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react-fiber对象的创建与更新机制\",children:e(c.span,{className:\"icon icon-link\"})}),\"React Fiber对象的创建与更新机制\"]}),\"\\n\",n(c.p,{children:[\"在上一篇文章中，我们详细讨论了Fiber的整体结构和链表。本文将深入探讨Fiber对象的创建过程、初始化提交以及Fiber树的更新机制。本节\",e(c.code,{children:\"react\"}),\"版本18.3（新写的文章就不用看老版本了一样的）。\"]}),\"\\n\",n(c.h2,{id:\"1-创建fiber对象\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1-创建fiber对象\",children:e(c.span,{className:\"icon icon-link\"})}),\"1. 创建Fiber对象\"]}),\"\\n\",n(c.p,{children:[\"Fiber对象的创建是React渲染过程的起点。当我们调用\",e(c.code,{children:\"ReactDOM.createRoot().render()\"}),\"时，React开始创建Fiber树。\"]}),\"\\n\",n(c.h3,{id:\"11-创建rootfiber\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#11-创建rootfiber\",children:e(c.span,{className:\"icon icon-link\"})}),\"1.1 创建RootFiber\"]}),\"\\n\",e(c.p,{children:\"首先，React会创建一个RootFiber，它是整个Fiber树的根节点。\"}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" createFiberRoot\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"containerInfo\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"tag\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"hydrate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"hydrationCallbacks\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" root\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"new\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" FiberRootNode\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"containerInfo\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"hydrate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" uninitializedFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"createHostRootFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"tag\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"uninitializedFiber\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  uninitializedFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"stateNode\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"  initializeUpdateQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"uninitializedFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" root\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:\"这个函数创建了FiberRoot和RootFiber。FiberRoot是整个应用的起点，而RootFiber则是组件树的根节点。\"}),\"\\n\",n(c.h3,{id:\"12-创建子fiber节点\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#12-创建子fiber节点\",children:e(c.span,{className:\"icon icon-link\"})}),\"1.2 创建子Fiber节点\"]}),\"\\n\",n(c.p,{children:[\"接下来，React会根据组件树递归地创建子Fiber节点。这个过程发生在\",e(c.code,{children:\"reconcileChildren\"}),\"函数中：\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" reconcileChildren\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"current\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"workInProgress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"nextChildren\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"renderLanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    workInProgress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"mountChildFibers\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"nextChildren\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    workInProgress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"reconcileChildFibers\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"child\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"nextChildren\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"renderLanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:[e(c.code,{children:\"mountChildFibers\"}),\"和\",e(c.code,{children:\"reconcileChildFibers\"}),\"都是\",e(c.code,{children:\"ChildReconciler\"}),\"函数的返回值，它们的区别在于是否标记副作用。\"]}),\"\\n\",n(c.h3,{id:\"13-创建单个fiber节点\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#13-创建单个fiber节点\",children:e(c.span,{className:\"icon icon-link\"})}),\"1.3 创建单个Fiber节点\"]}),\"\\n\",n(c.p,{children:[\"创建单个Fiber节点的核心逻辑在\",e(c.code,{children:\"createFiberFromElement\"}),\"函数中：\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" createFiberFromElement\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"element\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"mode\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"lanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" owner\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" type\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\" // 获取元素类型（如 'div', 自定义组件等）\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" key\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"key\"}),e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\" // 获取元素的 key\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" pendingProps\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"element\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"props\"}),e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\" // 获取元素的 props\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" fiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"createFiberFromTypeAndProps\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"type\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"key\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pendingProps\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"owner\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"mode\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" fiber\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:\"这个函数根据React元素的类型、key和props创建对应的Fiber节点。\"}),\"\\n\",n(c.h2,{id:\"2-初始化提交\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2-初始化提交\",children:e(c.span,{className:\"icon icon-link\"})}),\"2. 初始化提交\"]}),\"\\n\",e(c.p,{children:'创建完Fiber树后，React需要将这些虚拟的Fiber节点渲染到实际的DOM中。这个过程称为\"提交\"(commit)。'}),\"\\n\",n(c.h3,{id:\"21-提交前的准备\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#21-提交前的准备\",children:e(c.span,{className:\"icon icon-link\"})}),\"2.1 提交前的准备\"]}),\"\\n\",e(c.p,{children:\"在进入提交阶段之前，React会做一些准备工作：\"}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" commitRoot\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" renderPriorityLevel\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"getCurrentPriorityLevel\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"  runWithPriority\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"ImmediatePriority\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"commitRootImpl\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"bind\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"renderPriorityLevel\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"))\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" null\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.p,{children:[\"这里，React将提交过程的优先级设置为最高(\",e(c.code,{children:\"ImmediatePriority\"}),\")，确保提交过程不会被打断。\"]}),\"\\n\",n(c.h3,{id:\"22-提交阶段\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#22-提交阶段\",children:e(c.span,{className:\"icon icon-link\"})}),\"2.2 提交阶段\"]}),\"\\n\",e(c.p,{children:\"提交阶段分为三个子阶段：Before mutation、Mutation和Layout。\"}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" commitRootImpl\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"root\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"renderPriorityLevel\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // Before mutation阶段\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"  commitBeforeMutationEffects\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"renderPriorityLevel\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // Mutation阶段\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"  commitMutationEffects\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"renderPriorityLevel\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // Layout阶段\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  root\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"current\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"finishedWork\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"  commitLayoutEffects\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"root\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"  requestPaint\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"()\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  return\"}),e(c.span,{style:{color:\"#FFD493\"},children:\" null\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:\"每个阶段都有特定的任务：\"}),\"\\n\",n(c.ol,{children:[\"\\n\",e(c.li,{children:\"Before mutation阶段：处理DOM操作前的准备工作，如调用getSnapshotBeforeUpdate生命周期方法。\"}),\"\\n\",e(c.li,{children:\"Mutation阶段：执行实际的DOM操作。\"}),\"\\n\",e(c.li,{children:\"Layout阶段：处理DOM操作后的工作，如调用componentDidUpdate生命周期方法。\"}),\"\\n\"]}),\"\\n\",n(c.h2,{id:\"3-fiber树的更新\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3-fiber树的更新\",children:e(c.span,{className:\"icon icon-link\"})}),\"3. Fiber树的更新\"]}),\"\\n\",e(c.p,{children:\"当组件的状态发生变化时，React需要更新Fiber树并重新渲染。\"}),\"\\n\",n(c.h3,{id:\"31-调度更新\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#31-调度更新\",children:e(c.span,{className:\"icon icon-link\"})}),\"3.1 调度更新\"]}),\"\\n\",n(c.p,{children:[\"当我们调用\",e(c.code,{children:\"setState\"}),\"或使用Hooks时，React会创建一个更新并将其加入更新队列：\"]}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" enqueueUpdate\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" updateQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"fiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" sharedQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"updateQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"shared\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"sharedQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pending\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"else\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    update\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"    pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"next\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#4BF3C8\"},children:\"  sharedQueue\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"pending\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"update\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",n(c.h3,{id:\"32-开始工作循环\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#32-开始工作循环\",children:e(c.span,{className:\"icon icon-link\"})}),\"3.2 开始工作循环\"]}),\"\\n\",e(c.p,{children:\"React使用工作循环来处理更新：\"}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" workLoopConcurrent\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  while\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" && !\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"shouldYield\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"()) {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#00DAEF\"},children:\"    performUnitOfWork\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"workInProgress\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\")\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:\"这个循环会不断地处理工作单元，直到完成所有工作或需要让出控制权。\"}),\"\\n\",n(c.h3,{id:\"33-对比和更新\",children:[e(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#33-对比和更新\",children:e(c.span,{className:\"icon icon-link\"})}),\"3.3 对比和更新\"]}),\"\\n\",e(c.p,{children:\"在更新过程中，React会对比新旧Fiber树，找出需要更新的部分：\"}),\"\\n\",e(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:e(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"function\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" reconcileChildFibers\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"returnFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"currentFirstChild\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"newChild\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"lanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\" newChild\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"'object'\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" && \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),e(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"    switch\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"$$typeof\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"      case\"}),e(c.span,{style:{color:\"#ACAFFF\"},children:\" REACT_ELEMENT_TYPE\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[e(c.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\" placeSingleChild\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#00DAEF\"},children:\"reconcileSingleElement\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"returnFiber\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"currentFirstChild\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"newChild\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),e(c.span,{style:{color:\"#4BF3C8\"},children:\"lanes\"}),e(c.span,{style:{color:\"#EEF0F9\"},children:\"))\"})]}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 处理其他类型...\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 处理文本节点和其他情况...\"})}),\"\\n\",e(c.span,{\"data-line\":\"\",children:e(c.span,{style:{color:\"#EEF0F9\"},children:\"}\"})})]})})}),\"\\n\",e(c.p,{children:\"这个过程会创建、更新或删除Fiber节点，最终形成一个新的Fiber树。\"})]})}return{default:function(l={}){const{wrapper:n}=l.components||{};return n?e(n,{...l,children:e(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "React Fiber对象的创建与更新机制",
          "url": "#react-fiber对象的创建与更新机制",
          "items": [
            {
              "title": "1. 创建Fiber对象",
              "url": "#1-创建fiber对象",
              "items": [
                {
                  "title": "1.1 创建RootFiber",
                  "url": "#11-创建rootfiber",
                  "items": []
                },
                {
                  "title": "1.2 创建子Fiber节点",
                  "url": "#12-创建子fiber节点",
                  "items": []
                },
                {
                  "title": "1.3 创建单个Fiber节点",
                  "url": "#13-创建单个fiber节点",
                  "items": []
                }
              ]
            },
            {
              "title": "2. 初始化提交",
              "url": "#2-初始化提交",
              "items": [
                {
                  "title": "2.1 提交前的准备",
                  "url": "#21-提交前的准备",
                  "items": []
                },
                {
                  "title": "2.2 提交阶段",
                  "url": "#22-提交阶段",
                  "items": []
                }
              ]
            },
            {
              "title": "3. Fiber树的更新",
              "url": "#3-fiber树的更新",
              "items": [
                {
                  "title": "3.1 调度更新",
                  "url": "#31-调度更新",
                  "items": []
                },
                {
                  "title": "3.2 开始工作循环",
                  "url": "#32-开始工作循环",
                  "items": []
                },
                {
                  "title": "3.3 对比和更新",
                  "url": "#33-对比和更新",
                  "items": []
                }
              ]
            }
          ]
        }
      ],
      "visible": true
    },
    "slugAsParams": "5.fiber-commit"
  },
  {
    "slug": "/content/react-source-code/6.react_core_scheduling_principles",
    "title": "6.React源码阅读(1)-核心调度原理",
    "description": "requestdleCallback简单实战，以及react中的调度核心原理.",
    "published": true,
    "date": "2022-11-20T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:n,jsxs:e}=arguments[0];function _createMdxContent(c){const r={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",h3:\"h3\",img:\"img\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",...c.components};return e(l,{children:[e(r.h1,{id:\"requestdlecallback简单实战以及react中的调度核心原理\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#requestdlecallback简单实战以及react中的调度核心原理\",children:n(r.span,{className:\"icon icon-link\"})}),\"requestdleCallback简单实战，以及react中的调度核心原理\"]}),\"\\n\",e(r.h2,{id:\"1核心功能介绍\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1核心功能介绍\",children:n(r.span,{className:\"icon icon-link\"})}),\"1、核心功能介绍\"]}),\"\\n\",e(r.p,{children:[\"讲到Fiber不得不先提到一个Api那就是\",n(r.code,{children:\"requestdleCallback\"}),\"，这个\",n(r.code,{children:\"Api\"}),\"是干嘛的那，就是说写在这个函数里的将在浏览器空闲时间被调用，当高优先级任务执行的时候，当前任务就可以被停止，执行高优先级任务。我想从这个\",n(r.code,{children:\"api\"}),\"的例子里去带大家去先理解一下\",n(r.code,{children:\"空闲时间\"}),\"以及\",n(r.code,{children:\"让出主线程\"}),\"，再深入理解\",n(r.code,{children:\"react\"}),\"里的调度核心原理。\"]}),\"\\n\",e(r.p,{children:[n(r.strong,{children:\"空闲时间\"}),\"：页面是一帧一帧渲染出来的，1s有60帧代表这个页面的流畅的，每一帧大概是16ms，而如果我们每一帧的执行是小于16ms，就意味着有空闲时间。\"]}),\"\\n\",e(r.p,{children:[n(r.strong,{children:\"Api介绍：\"}),\" \",n(r.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/Apidesciption.jpeg?updatedAt=1739631177528\",alt:\"image.png\"}),n(r.code,{children:\"2\"}),\"代表的是函数返回值的id，可以把它传入 \",n(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FcancelIdleCallback\",title:\"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/cancelIdleCallback\",children:n(r.code,{children:\"Window.cancelIdleCallback()\"})}),\" 方法来结束回调。\"]}),\"\\n\",e(r.p,{children:[n(r.code,{children:\"dieTimeout\"}),\"是一个\",n(r.code,{children:\"Boolean\"}),\"类型当它的值为 \",n(r.code,{children:\"true\"}),\" 的时候说明 \",n(r.code,{children:\"callback\"}),\" 正在被执行。\"]}),\"\\n\",e(r.p,{children:[\"其中的原型对象上有一个\",n(r.code,{children:\"timeRemaining\"}),\"表示的是当前这个周期（帧）的空闲时间剩余多少的时间。\"]}),\"\\n\",e(r.h2,{id:\"2简单实战\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2简单实战\",children:n(r.span,{className:\"icon icon-link\"})}),\"2、简单实战\"]}),\"\\n\",e(r.p,{children:[\"先看第一段代码和表现，计算会一直占用你的主线程，导致你用户的交互没法去吧背景更改颜色。\\n\",n(r.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/example.jpeg?updatedAt=1739631177716\",alt:\"image.png\"}),\"\\n\",n(r.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/example2.jpeg?updatedAt=1739631177591\",alt:\"image.png\"}),\"\\n紧接着看第二段代码，给他加上requestdleCallback就可以在用户点击的时候把当前计算任务暂停，然后去执行把背景颜色变为绿色的这个操作。\\n\",n(r.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/code.jpeg?updatedAt=1739631177609\",alt:\"image.png\"}),\"\\n\",n(r.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/code2.jpeg?updatedAt=1739631177883\",alt:\"image.png\"})]}),\"\\n\",e(r.h2,{id:\"3源码实现\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3源码实现\",children:n(r.span,{className:\"icon icon-link\"})}),\"3、源码实现\"]}),\"\\n\",e(r.p,{children:[\"这里只是描述了一下空闲时间以及让出主线程这个概念,但实际上react中并不是用requestdleCallback去实现调度，\",n(r.a,{href:\"https://juejin.cn/post/7170095557443551246\",children:\"具体可以看我写的这篇文章，讲了一下react到底为什么不用requestdleCallback去实现调度\"}),\"。\"]}),\"\\n\",e(r.h3,{id:\"31源码实现\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#31源码实现\",children:n(r.span,{className:\"icon icon-link\"})}),\"3.1、源码实现\"]}),\"\\n\",e(r.p,{children:[\"黄色的是向外抛出的事件，源码是通过\",n(r.code,{children:\"MessageChannel\"}),\"来实现消息的发送和接收。\\n\",n(r.img,{src:\"https://ik.imagekit.io/leiakito/react%20Core%20scheduling%20principles/source_code.jpeg?updatedAt=1739631177738\",alt:\"image.png\"})]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" taskTimeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = -\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" yieldInterval\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"5\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" deadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // TODO: Make this configurable\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // TODO: Adjust this based on priority?\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" maxYieldInterval\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"300\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" needsPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    enableIsInputPending\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    navigator\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    navigator\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"scheduling\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" &&\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    navigator\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"scheduling\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"isInputPending\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"undefined\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  ) {\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" scheduling\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"navigator\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"scheduling\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 17.02的源码这里比较简单，其实这都不用看直接看false,因为enableIsInputPending为false,就而且17.2里面isInputPending是不可以用的，我们直接看18把，然后我就发现18里面好像依然没解决这个问题\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"    shouldYieldToHost\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" >= \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"deadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 简单的说就是长时间阻塞主线程的东西就给它打断了，绘制（交互）和用户输入之类的东西就给他打断了，都不是我们可以在最大延时里再看看\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"needsPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"scheduling\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"isInputPending\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"()) {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // There is either a pending paint or a pending input.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"          return\"}),n(r.span,{style:{color:\"#FFD493\"},children:\" true\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 300ms最大延时打断\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" >= \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"maxYieldInterval\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 不需要打断\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        return\"}),n(r.span,{style:{color:\"#FFD493\"},children:\" false\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    };\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"    requestPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      needsPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"  } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 直接看这里这个deadline是在performWorkUntilDeadline执行任务的时候去设置的\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"    shouldYieldToHost\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" getCurrentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() >= \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"deadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    };\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // Since we yield every frame regardless, `requestPaint` has no effect.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"    requestPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {};\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 强制设置检测时间，源码没用到调试的时候可以设置,电脑越好，fps越高分片时间越短\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  forceFrameRate\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"fps\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"fps\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" < \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" || \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"fps\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"125\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // Using console['error'] to evade Babel and ESLint\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      console\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'error'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"](\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:\"        'forceFrameRate takes a positive int between 0 and 125, '\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" +\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:\"          'forcing frame rates higher than 125 fps is not supported'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      return\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"fps\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" > \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      yieldInterval\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"Math\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"floor\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"1000\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" / \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"fps\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // reset the framerate\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      yieldInterval\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"5\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" performWorkUntilDeadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = () \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 有执行任务\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 计算一帧的打断检测时间\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      deadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"yieldInterval\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" hasTimeRemaining\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      try\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 执行c回调\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" hasMoreWork\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"          hasTimeRemaining\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"          currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"        );\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 执行完该回调后, 判断后续是否还有其他任务\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"hasMoreWork\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"          isMessageLoopRunning\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"          scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"        } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 还有其他任务, 推进进入下一个宏任务队列中\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"          port\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"error\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // If a scheduler task throws, exit the current browser task so the\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // error can be observed.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"        port\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        throw\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" error\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      isMessageLoopRunning\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // Yielding to the browser will give it a chance to paint, so we can\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // reset this.\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 重置状态\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    needsPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" channel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"new\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" MessageChannel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // port2 发送\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" port\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"channel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"port2\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // port1 接收\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  channel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"port1\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"onmessage\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"performWorkUntilDeadline\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 在每一帧中执行任务\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  requestHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 回调注册\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"isMessageLoopRunning\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      isMessageLoopRunning\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 进入宏任务队列\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      port\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 取消回调\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  cancelHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    scheduledHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 设置超时回调\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  requestHostTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"ms\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    taskTimeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"      callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"());\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }, \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"ms\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 取消超时\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  cancelHostTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"    clearTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"taskTimeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    taskTimeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = -\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(r.p,{children:\"这段react的核心调度可以分成2部分：\"}),\"\\n\",e(r.p,{children:[\"调度：通过\",n(r.code,{children:\"MessageChannel\"}),\"建立通道，然后2个端口一个发消息一个接消息，我们抛出发消息的事件，当接到消息的时候我们就可以设置空闲时间\",n(r.code,{children:\"deadline\"}),\"，\",n(r.code,{children:\"yieldInterval\"}),\"是默认5ms的，同时也执行回调函数。\"]}),\"\\n\",e(r.p,{children:[\"切片：当我们接受到消息的时候设置了\",n(r.code,{children:\"deadline\"}),\"，\",n(r.code,{children:\"shouldYieldToHost\"}),\"通过\",n(r.code,{children:\"deadline\"}),\"返回一个boolean来决定是否去打断构建，就是实现时间分片的主要函数。\"]}),\"\\n\",e(r.h3,{id:\"32源码settimeout的降级实现\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#32源码settimeout的降级实现\",children:n(r.span,{className:\"icon icon-link\"})}),\"3.2、源码setTimeout的降级实现\"]}),\"\\n\",n(r.p,{children:\"当我们在没有dom环境下，我们的react选择的是setTimeout.\"}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(r.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:e(r.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 无dom环境下，感觉可能是因为node环境下MessageChannel用来做线程管理了，就使用一个降级策略用setTimeout去代替MessageChannel\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  typeof\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" window\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" === \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'undefined'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" ||\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // Check if MessageChannel is supported, too.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  typeof\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" MessageChannel\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'function'\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // If this accidentally gets imported in a non-browser environment, e.g. JavaScriptCore,\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // fallback to a naive implementation.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" _callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  let\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" _timeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(r.span,{style:{color:\"#00DAEF\"},children:\" _flushCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"_callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"      try\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" hasRemainingTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"        _callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"hasRemainingTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"        _callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"e\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"        setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"_flushCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"        throw\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" e\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  requestHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"cb\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"_callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // Protect against re-entrancy.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"      setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"requestHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"cb\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      _callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"cb\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"      setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"_flushCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"0\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  cancelHostCallback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    _callback\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  requestHostTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"cb\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"ms\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"    _timeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"cb\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"ms\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  cancelHostTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"    clearTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"_timeoutID\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#00DAEF\"},children:\"  shouldYieldToHost\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    return\"}),n(r.span,{style:{color:\"#FFD493\"},children:\" false\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"  requestPaint\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#00DAEF\"},children:\"forceFrameRate\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"() {};\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#EEF0F9\"},children:\"} \"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // Capture local references to native APIs, in case a polyfill overrides them.\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"window\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"setTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" clearTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"window\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"clearTimeout\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"  if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" console\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'undefined'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // TODO: Scheduler no longer requires these methods to be polyfilled. But\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // maybe we want to continue warning if they don't exist, to preserve the\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // option to rely on it in the future?\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" requestAnimationFrame\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"window\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"requestAnimationFrame\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    const\"}),n(r.span,{style:{color:\"#ACAFFF\"},children:\" cancelAnimationFrame\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"window\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\"cancelAnimationFrame\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" requestAnimationFrame\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'function'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // Using console['error'] to evade Babel and ESLint\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      console\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'error'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"](\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:'        \"This browser doesn\\'t support requestAnimationFrame. \"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" +\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:\"          'Make sure that you load a '\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" +\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:\"          'polyfill in older browsers. https://reactjs.org/link/react-polyfills'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(r.span,{style:{color:\"#54B9FF\"},children:\"typeof\"}),n(r.span,{style:{color:\"#4BF3C8\"},children:\" cancelAnimationFrame\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'function'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // Using console['error'] to evade Babel and ESLint\"})}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#4BF3C8\"},children:\"      console\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"[\"}),n(r.span,{style:{color:\"#FFD493\"},children:\"'error'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\"](\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:'        \"This browser doesn\\'t support cancelAnimationFrame. \"'}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" +\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:\"          'Make sure that you load a '\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\" +\"})]}),\"\\n\",e(r.span,{\"data-line\":\"\",children:[n(r.span,{style:{color:\"#FFD493\"},children:\"          'polyfill in older browsers. https://reactjs.org/link/react-polyfills'\"}),n(r.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"      );\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:n(r.span,{style:{color:\"#EEF0F9\"},children:\"  }\"})}),\"\\n\",n(r.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",e(r.h2,{id:\"4总结\",children:[n(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#4总结\",children:n(r.span,{className:\"icon icon-link\"})}),\"4、总结\"]}),\"\\n\",e(r.p,{children:[n(r.code,{children:\"调度中心\"}),\"最核心的代码, 在\",n(r.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Fscheduler%2Fsrc%2Fforks%2FSchedulerHostConfig.default.js\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/scheduler/src/forks/SchedulerHostConfig.default.js\",children:\"SchedulerHostConfig.default.js\"}),\"中,大家有空可以去看看源码.\"]})]})}return{default:function(l={}){const{wrapper:e}=l.components||{};return e?n(e,{...l,children:n(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "requestdleCallback简单实战，以及react中的调度核心原理",
          "url": "#requestdlecallback简单实战以及react中的调度核心原理",
          "items": [
            {
              "title": "1、核心功能介绍",
              "url": "#1核心功能介绍",
              "items": []
            },
            {
              "title": "2、简单实战",
              "url": "#2简单实战",
              "items": []
            },
            {
              "title": "3、源码实现",
              "url": "#3源码实现",
              "items": [
                {
                  "title": "3.1、源码实现",
                  "url": "#31源码实现",
                  "items": []
                },
                {
                  "title": "3.2、源码setTimeout的降级实现",
                  "url": "#32源码settimeout的降级实现",
                  "items": []
                }
              ]
            },
            {
              "title": "4、总结",
              "url": "#4总结",
              "items": []
            }
          ]
        }
      ],
      "visible": true
    },
    "slugAsParams": "6.react_core_scheduling_principles"
  },
  {
    "slug": "/content/react-source-code/7.react_core_reading_start",
    "title": "7.React源码阅读开篇之Fiber",
    "description": "为什么React要使用Fiber?",
    "published": true,
    "date": "2022-11-20T00:00:00.000Z",
    "body": "const{Fragment:e,jsx:n,jsxs:r}=arguments[0];function _createMdxContent(l){const c={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",h3:\"h3\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",...l.components};return r(e,{children:[r(c.h1,{id:\"react源码阅读开篇之fiber\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react源码阅读开篇之fiber\",children:n(c.span,{className:\"icon icon-link\"})}),\"React源码阅读开篇之Fiber\"]}),\"\\n\",r(c.h2,{id:\"1前因后果\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1前因后果\",children:n(c.span,{className:\"icon icon-link\"})}),\"1.前因后果\"]}),\"\\n\",n(c.p,{children:\"为什么React要使用Fiber那？它解决了什么问题那？它是怎么解决的那？它是怎样的一个思路？以及为什么我们要先从fiber入手去理解源码那？我觉得这是我们在理解Fiber路上要关注的问题。\"}),\"\\n\",r(c.h2,{id:\"2为什么使用fiber\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2为什么使用fiber\",children:n(c.span,{className:\"icon icon-link\"})}),\"2.为什么使用Fiber\"]}),\"\\n\",r(c.h3,{id:\"21解决的问题\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#21解决的问题\",children:n(c.span,{className:\"icon icon-link\"})}),\"2.1.解决的问题\"]}),\"\\n\",n(c.p,{children:\"React 16 之前的版本比对更新 VirtualDOM 的过程是采用循环加递归实现的，这种比对方式有一个问题，就是一旦任务开始进行就无法中断，如果应用中组件数量庞大，主线程被长期占用，直到整棵 VirtualDOM 树比对更新完成之后主线程才能被释放。主线程才能执行其他任务。这就会导致一些用户交互，动画等任务无法立即得到执行，页面就会产生卡顿,非常的影响用户体验。\"}),\"\\n\",n(c.p,{children:\"核心问题:递归无法中断，执行重任务耗时长。Javacript 又是单线程，无法同时执行其他任务，导致任务延迟页面卡顿，用户体验差。\"}),\"\\n\",r(c.h3,{id:\"22怎么解决的\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#22怎么解决的\",children:n(c.span,{className:\"icon icon-link\"})}),\"2.2.怎么解决的\"]}),\"\\n\",r(c.p,{children:[\"这时候Fiber就因此诞生了，Fiber是什么？本质上他就是一种新算法，新的比对机制，字面翻译一下，纤维，也就是更细的，颗粒化更小的。那么问题又来了，为什么它要更细？首先Fiber是采用\",n(c.strong,{children:\"scheduler\"}),\"来通过调度，来利用浏览器空闲时间去执行，来解决长期占用主线程的问题，那么这就意味着要放弃递归（因为它是一个不可终止的），也正是如此就只保留了循环（因为需要一个中断），下一次循环从上一次循环的结束（保留变量）继续，那这里因为会有一个终止和再执行的操作（这个操作都是指的VirtualDom）就必须要保证粒度的小就需要把大任务拆分（16前是把整个Vdom的树的对比视为一个任务，但现在是把每个节点视为一个任务）。\"]}),\"\\n\",r(c.h3,{id:\"23-为什么要从fiber去入手理解源码\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#23-为什么要从fiber去入手理解源码\",children:n(c.span,{className:\"icon icon-link\"})}),\"2.3 为什么要从fiber去入手理解源码\"]}),\"\\n\",r(c.p,{children:[\"因为在实际上，fiber整个的构建过程以及最后的提交相当于源码的一条主线路，我们可以在先理解主线的情况下，去拆解出支线去理解源码（例如\",n(c.code,{children:\"hooks\"}),\"、\",n(c.code,{children:\"suspense\"}),\"等）。\"]}),\"\\n\",r(c.h2,{id:\"3实现思路\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3实现思路\",children:n(c.span,{className:\"icon icon-link\"})}),\"3.实现思路\"]}),\"\\n\",r(c.p,{children:[\"在Fiber中，我觉得我们理解也可以分成两个部分，一部分是\",n(c.strong,{children:\"render\"}),\"阶段，一部分是\",n(c.strong,{children:\"commit\"}),\"阶段，也就是说render阶段的时候fiber是可中断的，但commit阶段也就是真实更新是不可中断的（17.2中，18已经实现渲染中断）。但在这里协调器（Reconciler）给Fiber打副作用标签来决定后面fiber到底进行什么操作就不深入讨论了，调度器、协调器、渲染器的问题了后面有机会单独开一个专栏讲一下。\"]}),\"\\n\",r(c.p,{children:[\"然后那这两部分我们同样可以细分为2个部分就是\",n(c.strong,{children:\"初始渲染\"}),\"，和\",n(c.strong,{children:\"更新渲染\"}),\"。\"]}),\"\\n\",r(c.p,{children:[n(c.strong,{children:\"初始渲染\"}),\"：jsx => react.creatElement（17以前）或者react/jsx-runtime（17以后） => vdom对象然后开始循环找到每个内部vdom，为每个vdom构建fiber对象，然后存在数组中，然后循环fiber数组，然后根据当前节点的操作类型，将操作提交到真实dom中去(commit)。\"]}),\"\\n\",r(c.p,{children:[n(c.strong,{children:\"dom更新\"}),\"：重新构建所有fiber,旧fiber VS 新fiber对比 => 形成最后的fiber数组 =》 将fiber对象到真实dom中（commit）。\"]}),\"\\n\",n(c.p,{children:\"接下来我们需要手写并理解源码的地方就是：1.创建任务队列。2.实现任务队列调度逻辑。3.创建Fiber对象。4.构建Effects数组。5.实现初始化commit。6.处理组件。7.处理fiber更新。\"}),\"\\n\",r(c.h2,{id:\"4关于启动模式\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#4关于启动模式\",children:n(c.span,{className:\"icon icon-link\"})}),\"4.关于启动模式\"]}),\"\\n\",r(c.p,{children:[\"在正式分析源码之前, 先了解一下\",n(c.code,{children:\"react\"}),\"应用的\",n(c.code,{children:\"启动模式\"}),\":\"]}),\"\\n\",r(c.p,{children:[\"在当前稳定版\",n(c.code,{children:\"react@17.0.2\"}),\"源码中, 有 3 种启动方式. 先引出官网上对于\",n(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fdocs%2Fconcurrent-mode-adoption.html%23why-so-many-modes\",title:\"https://zh-hans.reactjs.org/docs/concurrent-mode-adoption.html#why-so-many-modes\",children:\"这 3 种模式的介绍\"}),\", 其基本说明如下:\"]}),\"\\n\",r(c.ol,{children:[\"\\n\",r(c.li,{children:[\"\\n\",r(c.p,{children:[n(c.code,{children:\"legacy\"}),\" 模式: \",n(c.code,{children:\"ReactDOM.render(<App />, rootNode)\"}),\". 这是当前 React app 使用的方式. 这个模式可能不支持\",n(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fdocs%2Fconcurrent-mode-patterns.html%23the-three-steps\",title:\"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#the-three-steps\",children:\"这些新功能(concurrent 支持的所有功能)\"}),\".\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:r(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// LegacyRoot\"})}),\"\\n\",r(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"ReactDOM\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"render\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />, \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"document\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getElementById\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'root'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"), \"}),n(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"dom\"}),n(c.span,{style:{color:\"#54B9FF\"},children:\" =>\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" {}); \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 支持callback回调, 参数是一个dom对象\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\"]}),\"\\n\",r(c.li,{children:[\"\\n\",r(c.p,{children:[n(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fdocs%2Fconcurrent-mode-adoption.html%23migration-step-blocking-mode\",title:\"https://zh-hans.reactjs.org/docs/concurrent-mode-adoption.html#migration-step-blocking-mode\",children:\"Blocking 模式\"}),\": \",n(c.code,{children:\"ReactDOM.createBlockingRoot(rootNode).render(<App />)\"}),\". 目前正在实验中, 它仅提供了 \",n(c.code,{children:\"concurrent\"}),\" 模式的小部分功能, 作为迁移到 \",n(c.code,{children:\"concurrent\"}),\" 模式的第一个步骤.\"]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:r(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// BlockingRoot\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 1. 创建ReactDOMRoot对象\"})}),\"\\n\",r(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" reactDOMBlockingRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"ReactDOM\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"createBlockingRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",r(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"  document\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getElementById\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'root'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"),\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 2. 调用render\"})}),\"\\n\",r(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"reactDOMBlockingRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"render\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />); \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 不支持回调\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\"]}),\"\\n\",r(c.li,{children:[\"\\n\",r(c.p,{children:[n(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fdocs%2Fconcurrent-mode-adoption.html%23enabling-concurrent-mode\",title:\"https://zh-hans.reactjs.org/docs/concurrent-mode-adoption.html#enabling-concurrent-mode\",children:\"Concurrent 模式\"}),\": \",n(c.code,{children:\"ReactDOM.createRoot(rootNode).render(<App />)\"}),\". 也就是现在18的默认版本\",n(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fso.csdn.net%2Fso%2Fsearch%3Fq%3D%25E5%25B9%25B6%25E5%258F%2591%26spm%3D1001.2101.3001.7020\",title:\"https://so.csdn.net/so/search?q=%E5%B9%B6%E5%8F%91&spm=1001.2101.3001.7020\",children:\"并发\"}),\"渲染、自动批处理和 \",n(c.code,{children:\"transitions\"})]}),\"\\n\",n(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"houston\",children:r(c.code,{\"data-language\":\"javascript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// ConcurrentRoot\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 1. 创建ReactDOMRoot对象\"})}),\"\\n\",r(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\" reactDOMRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"ReactDOM\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"createRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#4BF3C8\"},children:\"document\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"getElementById\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(c.span,{style:{color:\"#FFD493\"},children:\"'root'\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"));\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 2. 调用render\"})}),\"\\n\",r(c.span,{\"data-line\":\"\",children:[n(c.span,{style:{color:\"#4BF3C8\"},children:\"reactDOMRoot\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(c.span,{style:{color:\"#00DAEF\"},children:\"render\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\"(<\"}),n(c.span,{style:{color:\"#ACAFFF\"},children:\"App\"}),n(c.span,{style:{color:\"#EEF0F9\"},children:\" />); \"}),n(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 不支持回调\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\"]}),\"\\n\"]}),\"\\n\",r(c.h2,{id:\"5总结\",children:[n(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#5总结\",children:n(c.span,{className:\"icon icon-link\"})}),\"5.总结\"]}),\"\\n\",n(c.p,{children:\"当前这块我们先主要分析17.2的fiber的实现思路和源码，当我们已经能够站在巨人的肩膀上熟悉并看懂源码，我们可以跟进18的源码，实际上在17.2的源码中已经有非常多的concurrent预装的功能，只是在18以后才实装了。\"})]})}return{default:function(e={}){const{wrapper:r}=e.components||{};return r?n(r,{...e,children:n(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "toc": {
      "content": [
        {
          "title": "React源码阅读开篇之Fiber",
          "url": "#react源码阅读开篇之fiber",
          "items": [
            {
              "title": "1.前因后果",
              "url": "#1前因后果",
              "items": []
            },
            {
              "title": "2.为什么使用Fiber",
              "url": "#2为什么使用fiber",
              "items": [
                {
                  "title": "2.1.解决的问题",
                  "url": "#21解决的问题",
                  "items": []
                },
                {
                  "title": "2.2.怎么解决的",
                  "url": "#22怎么解决的",
                  "items": []
                },
                {
                  "title": "2.3 为什么要从fiber去入手理解源码",
                  "url": "#23-为什么要从fiber去入手理解源码",
                  "items": []
                }
              ]
            },
            {
              "title": "3.实现思路",
              "url": "#3实现思路",
              "items": []
            },
            {
              "title": "4.关于启动模式",
              "url": "#4关于启动模式",
              "items": []
            },
            {
              "title": "5.总结",
              "url": "#5总结",
              "items": []
            }
          ]
        }
      ],
      "visible": true
    },
    "slugAsParams": "7.react_core_reading_start"
  },
  {
    "slug": "/content/react-source-code/8.react_core_code_reading_fiber_summary",
    "title": "8.React源码阅读-fiber的强相关总结",
    "description": "这篇文章是关于 React 源码中 fiber 的强相关总结",
    "published": true,
    "date": "2022-11-21T00:00:00.000Z",
    "body": "const{Fragment:e,jsx:l,jsxs:n}=arguments[0];function _createMdxContent(r){const c={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",ul:\"ul\",...r.components};return n(e,{children:[n(c.h1,{id:\"react源码阅读-fiber的强相关总结\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#react源码阅读-fiber的强相关总结\",children:l(c.span,{className:\"icon icon-link\"})}),\"React源码阅读-fiber的强相关总结\"]}),\"\\n\",l(c.p,{children:\"这篇文章是关于 React 源码中 fiber 的强相关总结，包括 Fiber 对象的属性及解释、Update 与 UpdateQueue 对象、双缓存树、构建全局变量、hooks 的相关内容（如数据结构、api 分类、初次构建和更新的不同函数、全局变量），还提出了手写 fiber 的思路。\"}),\"\\n\",l(c.p,{children:\"关联问题: Fiber 如何影响性能？ UpdateQueue 怎样工作？ 双缓存树优势在哪？\"}),\"\\n\",l(c.p,{children:\"AI智能总结首次生成速度较慢, 请耐心等待\"}),\"\\n\",n(c.h1,{id:\"fiber手写的准备工作\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#fiber手写的准备工作\",children:l(c.span,{className:\"icon icon-link\"})}),\"Fiber手写的准备工作\"]}),\"\\n\",n(c.p,{children:[\"因为\",l(c.code,{children:\"fiber\"}),\"是核心, react 体系的渲染和更新都要以 fiber 作为数据模型, 如果不能理解 fiber, 也无法深入理解react。但事实上如果说想了解fiber是个很残酷的事情,因为这意味着你要理解\",l(c.code,{children:\"react-reconciler\"}),\"(协调器)、同时也要知道一些\",l(c.code,{children:\"react-dom\"}),\"（渲染器）和\",l(c.code,{children:\"scheduler\"}),\"（调度中心）的事情。\"]}),\"\\n\",l(c.p,{children:\"所以想了一下我们需要先做一些抽离把一些跟fiber强相关的东西先拿出来说一下。（这篇是属于总结篇，就是阅读到哪部分都拿到这里）。\"}),\"\\n\",n(c.h2,{id:\"1fiber对象\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1fiber对象\",children:l(c.span,{className:\"icon icon-link\"})}),\"1.fiber对象\"]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"typescript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 一个Fiber对象代表一个即将渲染或者已经渲染的组件(ReactElement), 一个组件可能对应两个fiber(current和WorkInProgress)\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" type\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = {|\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  tag\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"WorkTag\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  key\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"string\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  elementType\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  type\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  stateNode\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  return\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  child\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  sibling\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  index\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  ref\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\":\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"    | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"    | (((\"}),l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"handle\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" void\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") & { \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"_stringRef\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"?\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"string\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", ... })\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"    | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"RefObject\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  pendingProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 从`ReactElement`对象传入的 props. 用于和`fiber.memoizedProps`比较可以得出属性是否变动\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  memoizedProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 上一次生成子节点时用到的属性, 生成子节点之后保持在内存中\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  updateQueue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 存储state更新的队列, 当前节点的state改动之后, 都会创建一个update对象添加到这个队列中.\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  memoizedState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 用于输出的state, 最终渲染所使用的state\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  dependencies\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Dependencies\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 该fiber节点所依赖的(contexts, events)等\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  mode\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"TypeOfMode\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 二进制位Bitfield,继承至父节点,影响本fiber节点及其子树中所有节点. 与react应用的运行模式有关(有ConcurrentMode, BlockingMode, NoMode等选项).\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // Effect 副作用相关\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  flags\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Flags\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 标志位\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  subtreeFlags\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Flags\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//替代16.x版本中的 firstEffect, nextEffect. 当设置了 enableNewReconciler=true才会启用\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  deletions\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 存储将要被删除的子节点. 当设置了 enableNewReconciler=true才会启用\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  nextEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 单向链表, 指向下一个有副作用的fiber节点\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  firstEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 指向副作用链表中的第一个fiber节点\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  lastEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 指向副作用链表中的最后一个fiber节点\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 优先级相关\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  lanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Lanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 本fiber节点的优先级\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  childLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Lanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 子节点的优先级\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  alternate\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 指向内存中的另一个fiber, 每个被更新过fiber节点在内存中都是成对出现(current和workInProgress)\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 性能统计相关(开启enableProfilerTimer后才会统计)\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // react-dev-tool会根据这些时间统计来评估性能\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  actualDuration\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"?\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 本次更新过程, 本节点以及子树所消耗的总时间\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  actualStartTime\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"?\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 标记本fiber节点开始构建的时间\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  selfBaseDuration\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"?\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 用于最近一次生成本fiber节点所消耗的时间\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  treeBaseDuration\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"?\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 生成子树所消耗的时间的总和\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"|};\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",l(c.p,{children:\"属性解释:\"}),\"\\n\",n(c.ul,{children:[\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.tag\"}),\": 表示 fiber 类型, 根据\",l(c.code,{children:\"ReactElement\"}),\"组件的 type 进行生成, 在 react 内部共定义了\",l(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactWorkTags.js%23L10-L35\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactWorkTags.js#L10-L35\",children:\"25 种 tag\"}),\".\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.key\"}),\": 和\",l(c.code,{children:\"ReactElement\"}),\"组件的 key 一致.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.elementType\"}),\": 一般来讲和\",l(c.code,{children:\"ReactElement\"}),\"组件的 type 一致\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.type\"}),\": 一般来讲和\",l(c.code,{children:\"fiber.elementType\"}),\"一致. 一些特殊情形下, 比如在开发环境下为了兼容热更新(\",l(c.code,{children:\"HotReloading\"}),\"), 会对\",l(c.code,{children:\"function, class, ForwardRef\"}),\"类型的\",l(c.code,{children:\"ReactElement\"}),\"做一定的处理, 这种情况会区别于\",l(c.code,{children:\"fiber.elementType\"}),\", 具体赋值关系可以查看\",l(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiber.old.js%23L571-L574\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiber.old.js#L571-L574\",children:\"源文件\"}),\".\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.stateNode\"}),\": 与\",l(c.code,{children:\"fiber\"}),\"关联的局部状态节点(比如: \",l(c.code,{children:\"HostComponent\"}),\"类型指向与\",l(c.code,{children:\"fiber\"}),\"节点对应的 dom 节点; 根节点\",l(c.code,{children:\"fiber.stateNode\"}),\"指向的是\",l(c.code,{children:\"FiberRoot\"}),\"; class 类型节点其\",l(c.code,{children:\"stateNode\"}),\"指向的是 class 实例).\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.return\"}),\": 指向父节点.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.child\"}),\": 指向第一个子节点.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.sibling\"}),\": 指向下一个兄弟节点.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.index\"}),\": fiber 在兄弟节点中的索引, 如果是单节点默认为 0.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.ref\"}),\": 指向在\",l(c.code,{children:\"ReactElement\"}),\"组件上设置的 ref(\",l(c.code,{children:\"string\"}),\"类型的\",l(c.code,{children:\"ref\"}),\"除外, 这种类型的\",l(c.code,{children:\"ref\"}),\"已经不推荐使用, \",l(c.code,{children:\"reconciler\"}),\"阶段会\",l(c.code,{children:\"将string\"}),\"类型的\",l(c.code,{children:\"ref\"}),\"转换成一个\",l(c.code,{children:\"function\"}),\"类型).\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.pendingProps\"}),\": 输入属性, 从\",l(c.code,{children:\"ReactElement\"}),\"对象传入的 props. 用于和\",l(c.code,{children:\"fiber.memoizedProps\"}),\"比较可以得出属性是否变动.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.memoizedProps\"}),\": 上一次生成子节点时用到的属性, 生成子节点之后保持在内存中. 向下生成子节点之前叫做\",l(c.code,{children:\"pendingProps\"}),\", 生成子节点之后会把\",l(c.code,{children:\"pendingProps\"}),\"赋值给\",l(c.code,{children:\"memoizedProps\"}),\"用于下一次比较.\",l(c.code,{children:\"pendingProps\"}),\"和\",l(c.code,{children:\"memoizedProps\"}),\"比较可以得出属性是否变动.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.updateQueue\"}),\": 存储\",l(c.code,{children:\"update更新对象\"}),\"的队列, 每一次发起更新, 都需要在该队列上创建一个\",l(c.code,{children:\"update对象\"}),\".\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.memoizedState\"}),\": 上一次生成子节点之后保持在内存中的局部状态.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.dependencies\"}),\": 该 fiber 节点所依赖的(contexts, events)等, 在\",l(c.code,{children:\"context\"}),\"机制章节详细说明.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.mode\"}),\": 二进制位 Bitfield,继承至父节点,影响本 fiber 节点及其子树中所有节点. 与 react 应用的运行模式有关(有 ConcurrentMode, BlockingMode, NoMode 等选项).\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.flags\"}),\": 标志位, 副作用标记(在 16.x 版本中叫做\",l(c.code,{children:\"effectTag\"}),\", 相应\",l(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fpull%2F19755\",title:\"https://github.com/facebook/react/pull/19755\",children:\"pr\"}),\"), 在\",l(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiberFlags.js%23L10-L41\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberFlags.js#L10-L41\",children:l(c.code,{children:\"ReactFiberFlags.js\"})}),\"中定义了所有的标志位. \",l(c.code,{children:\"reconciler\"}),\"阶段会将所有拥有\",l(c.code,{children:\"flags\"}),\"标记的节点添加到副作用链表中, 等待 commit 阶段的处理.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.subtreeFlags\"}),\": 替代 16.x 版本中的 firstEffect, nextEffect. 默认未开启, 当设置了\",l(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Fshared%2FReactFeatureFlags.js%23L93\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/shared/ReactFeatureFlags.js#L93\",children:\"enableNewReconciler=true\"}),\" 才会启用, 本系列只跟踪稳定版的代码, 未来版本不会深入解读, \",l(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactFiberCompleteWork.new.js%23L690-L714\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberCompleteWork.new.js#L690-L714\",children:\"使用示例见源码\"}),\".\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.deletions\"}),\": 存储将要被删除的子节点. 默认未开启, 当设置了\",l(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Fshared%2FReactFeatureFlags.js%23L93\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/shared/ReactFeatureFlags.js#L93\",children:\"enableNewReconciler=true\"}),\" 才会启用, 本系列只跟踪稳定版的代码, 未来版本不会深入解读, \",l(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactChildFiber.new.js%23L275-L287\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactChildFiber.new.js#L275-L287\",children:\"使用示例见源码\"}),\".\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.nextEffect\"}),\": 单向链表, 指向下一个有副作用的 fiber 节点.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.firstEffect\"}),\": 指向副作用链表中的第一个 fiber 节点.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.lastEffect\"}),\": 指向副作用链表中的最后一个 fiber 节点.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.lanes\"}),\": 本 fiber 节点所属的优先级, 创建 fiber 的时候设置.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.childLanes\"}),\": 子节点所属的优先级.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"fiber.alternate\"}),\": 指向内存中的另一个 fiber, 每个被更新过 fiber 节点在内存中都是成对出现(current 和 workInProgress)\"]}),\"\\n\"]}),\"\\n\",n(c.h2,{id:\"2-update-与-updatequeue-对象\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2-update-与-updatequeue-对象\",children:l(c.span,{className:\"icon icon-link\"})}),\"2. Update 与 UpdateQueue 对象\"]}),\"\\n\",n(c.p,{children:[\"在\",l(c.code,{children:\"fiber\"}),\"对象中有一个属性\",l(c.code,{children:\"fiber.updateQueue\"}),\", 是一个链式队列(即使用链表实现的队列存储结构), 后文会根据场景表述成链表或队列.\"]}),\"\\n\",n(c.p,{children:[\"首先观察\",l(c.code,{children:\"Update\"}),\"对象的数据结构、\"]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"typescript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" type\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" Update\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> = {|\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  eventTime\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 发起update事件的时间(17.0.2中作为临时字段, 即将移出)\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  lane\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Lane\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// update所属的优先级\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  tag\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"0\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"2\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"3\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  payload\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 载荷, 根据场景可以设置成一个回调函数或者对象\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  callback\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": (() \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" mixed\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 回调函数\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  next\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Update\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 指向链表中的下一个, 由于UpdateQueue是一个环形链表, 最后一个update.next指向第一个update对象\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"|};\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// =============== UpdateQueue ==============\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"type\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" SharedQueue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> = {|\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  pending\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Update\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"|};\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" type\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" UpdateQueue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> = {|\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  baseState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  firstBaseUpdate\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Update\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  lastBaseUpdate\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Update\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  shared\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"SharedQueue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\">,\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  effects\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Update\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"State\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\">> | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"|};\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",l(c.p,{children:\"属性解释：\"}),\"\\n\",n(c.ol,{children:[\"\\n\",n(c.li,{children:[\"\\n\",l(c.p,{children:l(c.code,{children:\"UpdateQueue\"})}),\"\\n\",n(c.ul,{children:[\"\\n\",n(c.li,{children:[l(c.code,{children:\"baseState\"}),\": 表示此队列的基础 state\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"firstBaseUpdate\"}),\": 指向基础队列的队首\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"lastBaseUpdate\"}),\": 指向基础队列的队尾\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"shared\"}),\": 共享队列\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"effects\"}),\": 用于保存有\",l(c.code,{children:\"callback\"}),\"回调函数的 update 对象, 在\",l(c.code,{children:\"commit\"}),\"之后, 会依次调用这里的回调函数.\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(c.li,{children:[\"\\n\",l(c.p,{children:l(c.code,{children:\"SharedQueue\"})}),\"\\n\",n(c.ul,{children:[\"\\n\",n(c.li,{children:[l(c.code,{children:\"pending\"}),\": 指向即将输入的\",l(c.code,{children:\"update\"}),\"队列. 在\",l(c.code,{children:\"class\"}),\"组件中调用\",l(c.code,{children:\"setState()\"}),\"之后, 会将新的 update 对象添加到这个队列中来.\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(c.li,{children:[\"\\n\",l(c.p,{children:l(c.code,{children:\"Update\"})}),\"\\n\",n(c.ul,{children:[\"\\n\",n(c.li,{children:[l(c.code,{children:\"eventTime\"}),\": 发起\",l(c.code,{children:\"update\"}),\"事件的时间(17.0.2 中作为临时字段, 即将移出)\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"lane\"}),\": \",l(c.code,{children:\"update\"}),\"所属的优先级\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"tag\"}),\": 表示\",l(c.code,{children:\"update\"}),\"种类, 共 4 种. \",l(c.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Freact-reconciler%2Fsrc%2FReactUpdateQueue.old.js%23L131-L134\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactUpdateQueue.old.js#L131-L134\",children:l(c.code,{children:\"UpdateState,ReplaceState,ForceUpdate,CaptureUpdate\"})})]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"payload\"}),\": 载荷, \",l(c.code,{children:\"update\"}),\"对象真正需要更新的数据, 可以设置成一个回调函数或者对象.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"callback\"}),\": 回调函数. \",l(c.code,{children:\"commit\"}),\"完成之后会调用.\"]}),\"\\n\",n(c.li,{children:[l(c.code,{children:\"next\"}),\": 指向链表中的下一个, 由于\",l(c.code,{children:\"UpdateQueue\"}),\"是一个环形链表, 最后一个\",l(c.code,{children:\"update.next\"}),\"指向第一个\",l(c.code,{children:\"update\"}),\"对象.\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(c.h2,{id:\"3fiber双缓存树\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3fiber双缓存树\",children:l(c.span,{className:\"icon icon-link\"})}),\"3.fiber双缓存树\"]}),\"\\n\",l(c.p,{children:\"什么是双缓存，就是在内存中直接进行构建然后进行替换的技术。\"}),\"\\n\",n(c.p,{children:[\"对应到\",l(c.code,{children:\"React\"}),\"中，会存在两颗\",l(c.code,{children:\"fiberDom树\"}),\"，一颗内存中\",l(c.code,{children:\"fiber树\"}),\"，一颗页面上的\",l(c.code,{children:\"fiber树\"}),\"，它们总是交替循坏，当更新后，页面上的\",l(c.code,{children:\"fiber树\"}),\"->内存中的\",l(c.code,{children:\"fiber树\"}),\"，内存中的\",l(c.code,{children:\"fiber树\"}),\" -> 页面上的\",l(c.code,{children:\"fiber\"}),\"树。\"]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// The root we're working on\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgressRoot\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// The fiber we're working on\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.h2,{id:\"4fiber中的构建全局变量\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#4fiber中的构建全局变量\",children:l(c.span,{className:\"icon icon-link\"})}),\"4.fiber中的构建全局变量\"]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 执行状态\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" executionContext\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"ExecutionContext\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"NoContext\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 页面上的fiber\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgressRoot\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"FiberRoot\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 内存中的fiber\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgress\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 渲染的车道\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgressRootRenderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Lanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"NoLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 跟节点的状态是否是已完成，挂起等\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgressRootExitStatus\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"RootExitStatus\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"RootIncomplete\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.h2,{id:\"5fiber中hooks的强相关\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#5fiber中hooks的强相关\",children:l(c.span,{className:\"icon icon-link\"})}),\"5.fiber中hooks的强相关\"]}),\"\\n\",n(c.p,{children:[l(c.code,{children:\"hooks\"}),\"中任意的api都是为了直接或者间接控制fiber中的状态\"]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" type\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = {|\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 1. fiber节点自身状态相关\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  pendingProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  memoizedProps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  updateQueue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  memoizedState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 2. fiber节点副作用(Effect)相关\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  flags\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Flags\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  nextEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null,\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  firstEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null,\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  lastEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null,\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"|};\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[l(c.code,{children:\"hooks\"}),\"数据结构、queue环形链表，只处理hooks中的状态。\"]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"type\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" Update\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> = {|\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  lane\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Lane\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  action\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  eagerReducer\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": ((\"}),l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"S\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"A\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" S\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") | null, \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//最新提交函数\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  eagerState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null, \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//最新状态\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  next\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Update\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\">,\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  priority\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"?\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"ReactPriorityLevel\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"|};\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"type\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" UpdateQueue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> = {|\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  pending\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Update\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"A\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> | null,\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#00DAEF\"},children:\"  dispatch\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": (\"}),l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"A\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" => \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mixed\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") | null,\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  lastRenderedReducer\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": ((\"}),l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"S\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"A\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" S\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") | null, \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//队尾的提交函数指向到最新的状态\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  lastRenderedState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"S\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null, \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//最后一次得到的 state\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"|};\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" type\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" Hook\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = {|\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  memoizedState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 当前状态\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  baseState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 基础状态\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  baseQueue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Update\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> | null, \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 基队列\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  queue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"UpdateQueue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> | null, \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 更新队列\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  next\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Hook\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null, \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// next指针\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"|};\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[l(c.code,{children:\"effect.tag\"}),\"标识符\"]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" const\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" NoFlags\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*  */\"}),l(c.span,{style:{color:\"#FFD493\"},children:\" 0b000\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" const\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" HasEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/* */\"}),l(c.span,{style:{color:\"#FFD493\"},children:\" 0b001\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 有副作用, 可以被触发\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" const\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" Layout\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*    */\"}),l(c.span,{style:{color:\"#FFD493\"},children:\" 0b010\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 浏览器渲染结束后执行\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" const\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" Passive\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"/*   */\"}),l(c.span,{style:{color:\"#FFD493\"},children:\" 0b100\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// dom更新完成后执行\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",l(c.p,{children:l(c.code,{children:\"effect对象\"})}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" type\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" Effect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = {|\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  tag\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"HookFlags\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//effct的标识符\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#00DAEF\"},children:\"  create\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": () \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" (() \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" void\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//effect的回调函数\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  destroy\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": (() \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" void\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\") | \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"void\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//回调函数中的return,执行销毁，清除副作用函数\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  deps\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"mixed\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> | null, \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//依赖项\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  next\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Effect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\", \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"//指向下一个effct\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"|};\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[l(c.code,{children:\"hooks\"}),\" api分类\"]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"export\"}),l(c.span,{style:{color:\"#54B9FF\"},children:\" type\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" HookType\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" =\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useState'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useReducer'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useContext'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useRef'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useEffect'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useLayoutEffect'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useCallback'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useMemo'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useImperativeHandle'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useDebugValue'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useDeferredValue'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useTransition'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useMutableSource'\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#EEF0F9\"},children:\"  | \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"'useOpaqueIdentifier'\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[l(c.code,{children:\"hooks\"}),\"初次构建和更新的不同的使用函数\"]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" HooksDispatcherOnMount\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Dispatcher\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  readContext\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useCallback\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountCallback\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useContext\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"readContext\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useImperativeHandle\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountImperativeHandle\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useLayoutEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountLayoutEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useMemo\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountMemo\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useReducer\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountReducer\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useRef\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountRef\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useDebugValue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountDebugValue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useDeferredValue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountDeferredValue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useTransition\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountTransition\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useMutableSource\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountMutableSource\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useOpaqueIdentifier\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"mountOpaqueIdentifier\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  unstable_isNewReconciler\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"enableNewReconciler\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"};\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" HooksDispatcherOnUpdate\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Dispatcher\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = {\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  readContext\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useCallback\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateCallback\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useContext\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"readContext\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useImperativeHandle\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateImperativeHandle\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useLayoutEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateLayoutEffect\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useMemo\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateMemo\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useReducer\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateReducer\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useRef\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateRef\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateState\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useDebugValue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateDebugValue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useDeferredValue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateDeferredValue\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useTransition\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateTransition\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useMutableSource\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateMutableSource\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  useOpaqueIdentifier\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"updateOpaqueIdentifier\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#4BF3C8\"},children:\"  unstable_isNewReconciler\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"enableNewReconciler\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F9\"},children:\"};\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.p,{children:[l(c.code,{children:\"hooks\"}),\" 全局变量\"]}),\"\\n\",l(c.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(c.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"js\",\"data-theme\":\"houston\",children:n(c.code,{\"data-language\":\"js\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 渲染优先级\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" renderLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Lanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\"NoLanes\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 当前正在构造的fiber, 等同于 workInProgress\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#00DAEF\"},children:\" currentlyRenderingFiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Fiber\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = (\"}),l(c.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"any\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// Hooks被存储在fiber.memoizedState 链表上\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" currentHook\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Hook\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// currentHook = fiber(current).memoizedState\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" workInProgressHook\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Hook\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" | null = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"; \"}),l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// workInProgressHook = fiber(workInProgress).memoizedState\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 在function的执行过程中, 是否再次发起了更新. 只有function被完全执行之后才会重置.\"})}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 当render异常时, 通过该变量可以决定是否清除render过程中的更新.\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" didScheduleRenderPhaseUpdate\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"boolean\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 在本次function的执行过程中, 是否再次发起了更新. 每一次调用function都会被重置\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" didScheduleRenderPhaseUpdateDuringThisPass\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"boolean\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// 在本次function的执行过程中, 重新发起更新的最大次数\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"const\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\" RE_RENDER_LIMIT\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"25\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:l(c.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"// dev模式下，暂不分析\"})}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" currentHookNameInDev\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#54B9FF\"},children:\"?\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"HookType\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" hookTypesDev\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"Array\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"<\"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"HookType\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\"> | null = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"null\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" hookTypesUpdateIndexDev\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"number\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = -\"}),l(c.span,{style:{color:\"#FFD493\"},children:\"1\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(c.span,{\"data-line\":\"\",children:[l(c.span,{style:{color:\"#54B9FF\"},children:\"let\"}),l(c.span,{style:{color:\"#4BF3C8\"},children:\" ignorePreviousDependencies\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\": \"}),l(c.span,{style:{color:\"#ACAFFF\"},children:\"boolean\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),l(c.span,{style:{color:\"#FFD493\"},children:\"false\"}),l(c.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",l(c.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(c.h2,{id:\"接下来我们分析一下我们的手写思路\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#接下来我们分析一下我们的手写思路\",children:l(c.span,{className:\"icon icon-link\"})}),\"接下来我们分析一下我们的手写思路\"]}),\"\\n\",n(c.ol,{children:[\"\\n\",l(c.li,{children:\"我们需要通过reactElement树去构建一个简单的fiber树。\"}),\"\\n\",l(c.li,{children:\"创建任务队列和实现调度逻辑，创建任务队列对标源码的reconciler（构造器或者说协调器）注册调度任务task。调度逻辑对标源码的scheduler的调度实现，去控制任务的回调时间，然后去实现任务分片以及可中断的特性。\"}),\"\\n\",l(c.li,{children:\"实现简单初始渲染。\"}),\"\\n\",l(c.li,{children:\"实现简单更新渲染。\"}),\"\\n\"]}),\"\\n\",n(c.h2,{id:\"总结\",children:[l(c.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#总结\",children:l(c.span,{className:\"icon icon-link\"})}),\"总结\"]}),\"\\n\",l(c.p,{children:\"方便我们后面简单实现fiber的时候，做出分析。\"})]})}return{default:function(e={}){const{wrapper:n}=e.components||{};return n?l(n,{...e,children:l(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "toc": {
      "content": [
        {
          "title": "React源码阅读-fiber的强相关总结",
          "url": "#react源码阅读-fiber的强相关总结",
          "items": []
        },
        {
          "title": "Fiber手写的准备工作",
          "url": "#fiber手写的准备工作",
          "items": [
            {
              "title": "1.fiber对象",
              "url": "#1fiber对象",
              "items": []
            },
            {
              "title": "2. Update 与 UpdateQueue 对象",
              "url": "#2-update-与-updatequeue-对象",
              "items": []
            },
            {
              "title": "3.fiber双缓存树",
              "url": "#3fiber双缓存树",
              "items": []
            },
            {
              "title": "4.fiber中的构建全局变量",
              "url": "#4fiber中的构建全局变量",
              "items": []
            },
            {
              "title": "5.fiber中hooks的强相关",
              "url": "#5fiber中hooks的强相关",
              "items": []
            },
            {
              "title": "接下来我们分析一下我们的手写思路",
              "url": "#接下来我们分析一下我们的手写思路",
              "items": []
            },
            {
              "title": "总结",
              "url": "#总结",
              "items": []
            }
          ]
        }
      ],
      "visible": true
    },
    "slugAsParams": "8.react_core_code_reading_fiber_summary"
  },
  {
    "slug": "/content/react-source-code/9.react_scheduling_reasons_source_code",
    "title": "9.究竟为什么React不使用requestIdleCallback实现调度",
    "description": "React不使用requestIdleCallback实现调度",
    "published": true,
    "date": "2022-11-26T00:00:00.000Z",
    "body": "const{Fragment:l,jsx:n,jsxs:e}=arguments[0];function _createMdxContent(c){const s={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",p:\"p\",pre:\"pre\",span:\"span\",...c.components};return e(l,{children:[e(s.h1,{id:\"究竟为什么react不使用requestidlecallback实现调度\",children:[n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#究竟为什么react不使用requestidlecallback实现调度\",children:n(s.span,{className:\"icon icon-link\"})}),\"究竟为什么React不使用requestIdleCallback实现调度\"]}),\"\\n\",n(s.p,{children:\"2022-11-26 3,168 阅读3分钟\"}),\"\\n\",e(s.h1,{id:\"1起因\",children:[n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#1起因\",children:n(s.span,{className:\"icon icon-link\"})}),\"1.起因\"]}),\"\\n\",n(s.p,{children:\"最近在一边啃源码，一边手写fiber嘛，然后也看了很多博客和资料，基本上大伙好像都是说用requestIdleCallback来模拟react实现一个空闲时间调度。但我自己手写的时候把怎么用怎么怪，老是感觉有什么地方不对劲而且是在调度过程中，可能是因为我是想写出来来一个相对健全一点的模版方便我以后写源码的其他部分把，然后分析了一下所以有了这篇博客。\"}),\"\\n\",e(s.h1,{id:\"2查找问题\",children:[n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#2查找问题\",children:n(s.span,{className:\"icon icon-link\"})}),\"2.查找问题\"]}),\"\\n\",n(s.p,{children:\"1.requestIdleCallback是利用帧之间空闲时间来执行JS，它是一个低优先级的处理策略它给我的感觉就是做一些类似上报之类的操作，但实际上Fiber的构建以及渲染内容，并不算是一个低优先级任务。\"}),\"\\n\",n(s.p,{children:\"2.兼容性这个就总所周知了，这个api并不适合在生产环境上。\"}),\"\\n\",e(s.p,{children:[\"3.requestIdleCallback实际上是在布局和绘制之后,那意味在也许你在里面做的事情（可能是通过数据修改触发dom修改）会重排。\",n(s.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLinjiayu6%2FFE-RequestIdleCallback-demo\",title:\"https://github.com/Linjiayu6/FE-RequestIdleCallback-demo\",children:\"可以看看这个试验\"})]}),\"\\n\",e(s.h1,{id:\"3解决问题\",children:[n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#3解决问题\",children:n(s.span,{className:\"icon icon-link\"})}),\"3.解决问题\"]}),\"\\n\",e(s.p,{children:[\"所以这时候我们就可以回到源码中去看,react是怎么实现的，\",n(s.a,{href:\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fblob%2Fv17.0.2%2Fpackages%2Fscheduler%2Fsrc%2Fforks%2FSchedulerHostConfig.default.js\",title:\"https://github.com/facebook/react/blob/v17.0.2/packages/scheduler/src/forks/SchedulerHostConfig.default.js\",children:\"源码地址\"}),\"。\"]}),\"\\n\",n(s.p,{children:\"核心调度实现\"}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#17191e\",color:\"#eef0f9\"},tabIndex:\"0\",\"data-language\":\"typescript\",\"data-theme\":\"houston\",children:e(s.code,{\"data-language\":\"typescript\",\"data-theme\":\"houston\",style:{display:\"grid\"},children:[n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 有执行任务\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"scheduledHostCallback\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" !== \"}),n(s.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(s.span,{style:{color:\"#ACAFFF\"},children:\" currentTime\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 计算一帧的过期时间点\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"      deadline\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"currentTime\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" + \"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"yieldInterval\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#54B9FF\"},children:\"      const\"}),n(s.span,{style:{color:\"#ACAFFF\"},children:\" hasTimeRemaining\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#54B9FF\"},children:\"      try\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 执行c回调\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#54B9FF\"},children:\"        const\"}),n(s.span,{style:{color:\"#ACAFFF\"},children:\" hasMoreWork\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#00DAEF\"},children:\"scheduledHostCallback\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"(\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"          hasTimeRemaining\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"          currentTime\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F9\"},children:\"        );\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // 执行完该回调后, 判断后续是否还有其他任务\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#54B9FF\"},children:\"        if\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"hasMoreWork\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"          isMessageLoopRunning\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"          scheduledHostCallback\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#EEF0F9\"},children:\"        } \"}),n(s.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"          // 还有其他任务, 推进进入下一个宏任务队列中\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"          port\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(s.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(s.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F9\"},children:\"        }\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#EEF0F9\"},children:\"      } \"}),n(s.span,{style:{color:\"#54B9FF\"},children:\"catch\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" (\"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"error\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // If a scheduler task throws, exit the current browser task so the\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"        // error can be observed.\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"        port\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(s.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(s.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#54B9FF\"},children:\"        throw\"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\" error\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F9\"},children:\"      }\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#EEF0F9\"},children:\"    } \"}),n(s.span,{style:{color:\"#54B9FF\"},children:\"else\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"      isMessageLoopRunning\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // Yielding to the browser will give it a chance to paint, so we can\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // reset this.\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 重置状态\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"    needsPaint\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#FFD493\"},children:\"false\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(s.span,{style:{color:\"#ACAFFF\"},children:\" channel\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#54B9FF\"},children:\"new\"}),n(s.span,{style:{color:\"#00DAEF\"},children:\" MessageChannel\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"();\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // port2 发送\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#54B9FF\"},children:\"  const\"}),n(s.span,{style:{color:\"#ACAFFF\"},children:\" port\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"channel\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"port2\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // port1 接收\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"  channel\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"port1\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"onmessage\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"performWorkUntilDeadline\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 在每一帧中执行任务\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#00DAEF\"},children:\"  requestHostCallback\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(s.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"    // 回调注册\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"    scheduledHostCallback\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"callback\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#54B9FF\"},children:\"    if\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" (!\"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"isMessageLoopRunning\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"      isMessageLoopRunning\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#FFD493\"},children:\"true\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"      // 进入宏任务队列\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"      port\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\".\"}),n(s.span,{style:{color:\"#00DAEF\"},children:\"postMessage\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(s.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F9\"},children:\"    }\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 取消回调\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#00DAEF\"},children:\"  cancelHostCallback\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"    scheduledHostCallback\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#FFD493\"},children:\"null\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 设置超时回调\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#00DAEF\"},children:\"  requestHostTimeout\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(s.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"callback\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\", \"}),n(s.span,{style:{color:\"#4BF3C8\",fontStyle:\"italic\"},children:\"ms\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\") {\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"    taskTimeoutID\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#00DAEF\"},children:\"setTimeout\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"(() \"}),n(s.span,{style:{color:\"#54B9FF\"},children:\"=>\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" {\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#00DAEF\"},children:\"      callback\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(s.span,{style:{color:\"#00DAEF\"},children:\"getCurrentTime\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"());\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#EEF0F9\"},children:\"    }, \"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"ms\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F98F\",fontStyle:\"italic\"},children:\"  // 取消超时\"})}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#00DAEF\"},children:\"  cancelHostTimeout\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = \"}),n(s.span,{style:{color:\"#54B9FF\"},children:\"function\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"() {\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#00DAEF\"},children:\"    clearTimeout\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\"(\"}),n(s.span,{style:{color:\"#4BF3C8\"},children:\"taskTimeoutID\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\");\"})]}),\"\\n\",e(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#4BF3C8\"},children:\"    taskTimeoutID\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\" = -\"}),n(s.span,{style:{color:\"#FFD493\"},children:\"1\"}),n(s.span,{style:{color:\"#EEF0F9\"},children:\";\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#EEF0F9\"},children:\"  };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"})]})})}),\"\\n\",n(s.p,{children:\"代码里的注释写得很清楚了把，但有几个点可以说一下。\"}),\"\\n\",n(s.p,{children:\"1.首先选择宏任务，因为我们需要去及时的让出主线程（微任务并不会让出主线程也是在更新页面前去执行）。\"}),\"\\n\",n(s.p,{children:\"2.其次是宏任务中的选择，MessageChannel，setTimeout，requestAnimationFrame,都是宏任务，setTimeout会浪费4ms(这个大伙可以去看看)，requestAnimationFrame的触发时间是不稳定的（可以看看浏览器的更新页面机制）,所以我猜想最后就选了MessageChannel把。\"}),\"\\n\",e(s.h1,{id:\"4总结\",children:[n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#4总结\",children:n(s.span,{className:\"icon icon-link\"})}),\"4.总结\"]}),\"\\n\",n(s.p,{children:\"其实到这思路也比较明了了，把React中为什么不使用requestIdleCallback理清楚，还顺便把React的核心调度原理看了一下。\"}),\"\\n\",e(s.h1,{id:\"5吐槽\",children:[n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#5吐槽\",children:n(s.span,{className:\"icon icon-link\"})}),\"5.吐槽\"]}),\"\\n\",n(s.p,{children:\"唉，其实看源码和手写源码完全是两种感觉，更多的是体现在实现细节和代码耦合性健壮性的问题，写是怎么写都行，但如何写优雅的方便人迭代的代码就好烧脑。比如你就想实现一个fiber的大体思路就不难，但是如果想你在fiber上加hook，难度几何飙升，基础构建和细节实现就很重要了，手写肯定是不等于抄，还需要在里面加写自己的想法和如何简化的方案。\"})]})}return{default:function(l={}){const{wrapper:e}=l.components||{};return e?n(e,{...l,children:n(_createMdxContent,{...l})}):_createMdxContent(l)}};",
    "toc": {
      "content": [
        {
          "title": "究竟为什么React不使用requestIdleCallback实现调度",
          "url": "#究竟为什么react不使用requestidlecallback实现调度",
          "items": []
        },
        {
          "title": "1.起因",
          "url": "#1起因",
          "items": []
        },
        {
          "title": "2.查找问题",
          "url": "#2查找问题",
          "items": []
        },
        {
          "title": "3.解决问题",
          "url": "#3解决问题",
          "items": []
        },
        {
          "title": "4.总结",
          "url": "#4总结",
          "items": []
        },
        {
          "title": "5.吐槽",
          "url": "#5吐槽",
          "items": []
        }
      ],
      "visible": true
    },
    "slugAsParams": "9.react_scheduling_reasons_source_code"
  }
]